% Authors:  Nils Carqueville, Daniel Murfet
 
\documentclass{compositio}
\usepackage{stmaryrd}
\usepackage{amsmath, amscd, amssymb, mathrsfs, accents, amsfonts}
\usepackage{url}
\usepackage[all]{xy}
\usepackage{longtable}
\usepackage{dsfont}
\usepackage{tikz}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.markings}
\def\nicedashedcolourscheme{\shadedraw[top color=blue!22, bottom color=blue!22, draw=gray, dashed]}
\def\nicecolourscheme{\shadedraw[top color=blue!22, bottom color=blue!22, draw=white]}
\def\nicepalecolourscheme{\shadedraw[top color=blue!12, bottom color=blue!12, draw=white]}
\def\nicenocolourscheme{\shadedraw[top color=gray!2, bottom color=gray!25, draw=white]}
\def\nicereallynocolourscheme{\shadedraw[top color=white!2, bottom color=white!25, draw=white]}
\definecolor{Myblue}{rgb}{0,0,0.6}
\usepackage[a4paper,colorlinks,citecolor=Myblue,linkcolor=Myblue,urlcolor=Myblue,pdfpagemode=None]{hyperref}

\SelectTips{cm}{}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem*{theoremn}{Theorem}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{s}[theorem]{}
\newtheorem*{setup}{Setup}
\newtheorem*{propositionn}{Proposition}

\numberwithin{equation}{section}
\numberwithin{figure}{section}

% Operators
\def\globalsigneval{n}
\def\eval{\operatorname{ev}}
\def\coev{\operatorname{coev}}
\def\res{\operatorname{Res}}
\def\sg{\operatorname{sg}}
\def\Inj{\operatorname{Inj}}
\def\inc{\operatorname{inc}}
\def\Proj{\operatorname{Proj}}
\def\Coker{\operatorname{Coker}}
\def\Ker{\operatorname{Ker}}
\def\Im{\operatorname{Im}}
\def\free{\operatorname{free}}
\def\can{\operatorname{can}}
\def\ac{\operatorname{ac}}
\def\HH{\operatorname{HH}}
\def\K{\mathbf{K}}
\def\D{\mathbf{D}}
\def\N{\mathbf{N}}
\def\sing{\operatorname{Sg}}
\def\Hom{\operatorname{Hom}}
\def\uHom{\underline{\Hom}}
\def\End{\operatorname{End}}
\def\uEnd{\underline{\End}}
\def\modd{\operatorname{mod}}
\def\Modd{\operatorname{Mod}}
\def\Grmodd{\operatorname{GrMod}}
\def\CM{\operatorname{CM}}
\def\Ker{\operatorname{Ker}}
\def\Spec{\operatorname{Spec}}
\def\straightK{\operatorname{K}}
\def\straightC{\operatorname{C}}
\def\holim{\operatorname{hocolim}}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\coh}{coh}
\DeclareMathOperator{\serre}{S}
\DeclareMathOperator{\Flat}{Flat}
\DeclareMathOperator{\qc}{qc}
\DeclareMathOperator{\Perf}{Perf}
\DeclareMathOperator{\Map}{Map}
\DeclareMathOperator{\Qco}{Qco}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\tot}{Tot}
\DeclareMathOperator{\skos}{K}
\DeclareMathOperator{\hht}{ht}
\DeclareMathOperator{\depth}{depth}
\DeclareMathOperator{\STr}{STr}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\ch}{ch}
\DeclareMathOperator{\str}{str}
\DeclareMathOperator{\hmf}{hmf}
\DeclareMathOperator{\HMF}{HMF}
\DeclareMathOperator{\HF}{HF}
\DeclareMathOperator{\pr}{pr}
\DeclareMathOperator{\lAt}{lAt}
\DeclareMathOperator{\At}{At}
\DeclareMathOperator{\mff}{mf}
\DeclareMathOperator{\MF}{MF}
\DeclareMathOperator{\Sh}{Sh}
\DeclareMathOperator{\Der}{Der}

\begin{document}

% Commands
\def\Atlarrow{\overset{\leftarrow}{\At}}
\def\Res{\res\!}
\newcommand{\cat}[1]{\mathcal{#1}}
\newcommand{\lto}{\longrightarrow}
\newcommand{\xlto}[1]{\stackrel{#1}\lto}
\newcommand{\mf}[1]{\mathfrak{#1}}
\newcommand{\md}[1]{\mathscr{#1}}
\newcommand{\intvar}{\bs{x}_{\textup{int}}}
\newcommand{\extvar}{\bs{x}_{\textup{ext}}}
\newcommand{\qderu}[2]{\mathbf{D}^{#1}(#2)}
\newcommand{\ud}{\mathrm{d}}
\def\l{\,|\,}
\def\by{f}
\def\totimes{\otimes}
\def\di{Q}
\newcommand{\cotimes}[1]{\,\widehat{\otimes}_{#1}\,}
\def\QQ{\mathds{Q}}
\def\krc{C}
\def\diffm{d}
\def\diffh{d_{\chi}}
\def\redh{\overline{H}}
\def\ZZ{\mathds{Z}}
\def\bs{\boldsymbol}
\def\Ztwo{\mathds{Z}_2}
\def\mdual{^{\vee}}
\def\KR{\operatorname{KR}}
\def\I{\!\operatorname{i}\!}
\def\E{\operatorname{e}\!}
\def\sln{\mathfrak{sl}(N)}
\def\nN{\mathds{N}}
\def\nZ{\mathds{Z}}
\def\nQ{\mathds{Q}}
\def\nR{\mathds{R}}
\def\nC{\mathds{C}}
\def\Bar{\mathds{B}}
\def\cBar{\widehat{\mathds{B}}}
\def\Se{S^{\operatorname{e}}}
\def\Re{R^{\operatorname{e}}}
\def\Ae{A^{\operatorname{e}}}
\def\Be{B^{\operatorname{e}}}
\def\Aop{A^{\operatorname{op}}}
\def\Rop{R^{\operatorname{op}}}
\def\lra{\longrightarrow}
\def\lmt{\longmapsto}
\def\LG{\mathcal{LG}_k}
\def\dual{\dagger}
\def\dlangle{\big\langle\!\big\langle}
\def\drangle{\big\rangle\!\big\rangle}
\def\bigdlangle{\Big\langle\!\!\Big\langle}
\def\bigdrangle{\Big\rangle\!\!\Big\rangle}
\def\reprod{\gamma}
\newcommand{\Ress}[1]{\res_{#1}\!}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\def\Xcirc{%
\begin{tikzpicture}[inner sep=0mm]
\node (X) at (0,0) {$X$};
\node (0) at (0,0) [circle,inner sep=0.99pt, thin,draw=black,fill= white] {};
\end{tikzpicture}%
}
\def\Xbul{%
\begin{tikzpicture}[inner sep=0mm]
\node (X) at (0,0) {$X$};
\node (0) at (0,0) [circle,inner sep=0.99pt, thin,draw=black,fill= black] {};
\end{tikzpicture}%
}

\renewcommand{\labelenumi}{(\roman{enumi})}

\allowdisplaybreaks

\usetikzlibrary{arrows,calc,decorations.pathreplacing,decorations.markings,shapes.geometric,shadows}
\tikzset{
    string/.style={draw=#1, postaction={decorate}, decoration={markings,mark=at position .51 with {\arrow[draw=#1]{>}}}},
    costring/.style={draw=#1, postaction={decorate}, decoration={markings,mark=at position .51 with {\arrow[draw=#1]{<}}}},
    ostring/.style={draw=#1, postaction={decorate}, decoration={markings,mark=at position .47 with {\arrow[draw=#1]{>}}}},
    ustring/.style={draw=#1, postaction={decorate}, decoration={markings,mark=at position .56 with {\arrow[draw=#1]{>}}}},
    oostring/.style={draw=#1, postaction={decorate}, decoration={markings,mark=at position .43 with {\arrow[draw=#1]{>}}}},
    uustring/.style={draw=#1, postaction={decorate}, decoration={markings,mark=at position .59 with {\arrow[draw=#1]{>}}}},
    directed/.style={string=blue!50!black}, 
    odirected/.style={ostring=blue!50!black}, 
    udirected/.style={ustring=blue!50!black}, 
    oodirected/.style={oostring=blue!50!black}, 
    uudirected/.style={uustring=blue!50!black},     
    redirected/.style={costring= blue!50!black},
}

\usetikzlibrary{fadings,decorations.pathreplacing}

\newcommand\pgfmathsinandcos[3]{%
  \pgfmathsetmacro#1{sin(#3)}%
  \pgfmathsetmacro#2{cos(#3)}%
}
\newcommand\LongitudePlane[3][current plane]{%
  \pgfmathsinandcos\sinEl\cosEl{#2} % elevation
  \pgfmathsinandcos\sint\cost{#3} % azimuth
  \tikzset{#1/.estyle={cm={\cost,\sint*\sinEl,0,\cosEl,(0,0)}}}
}
\newcommand\LatitudePlane[3][current plane]{%
  \pgfmathsinandcos\sinEl\cosEl{#2} % elevation
  \pgfmathsinandcos\sint\cost{#3} % latitude
  \pgfmathsetmacro\yshift{\cosEl*\sint}
  \tikzset{#1/.estyle={cm={\cost,0,0,\cost*\sinEl,(0,\yshift)}}} %
}
\newcommand\DrawLongitudeCircle[2][1]{
  \LongitudePlane{\angEl}{#2}
  \tikzset{current plane/.prefix style={scale=#1}}
  \pgfmathsetmacro\angVis{atan(sin(#2)*cos(\angEl)/sin(\angEl))} %
  \draw[redirected,current plane,color=blue!50!black, very thick] (\angVis:1) arc (\angVis:\angVis+180:1);
  \draw[current plane,dotted,color=blue!50!gray, very thick] (\angVis-180:1) arc (\angVis-180:\angVis:1);
}
\newcommand\DrawLatitudeCircle[2][1]{
  \LatitudePlane{\angEl}{#2}
  \tikzset{current plane/.prefix style={scale=#1}}
  \pgfmathsetmacro\sinVis{sin(#2)/cos(#2)*sin(\angEl)/cos(\angEl)}
  \pgfmathsetmacro\angVis{asin(min(1,max(\sinVis,-1)))}
  \draw[directed,current plane, color=blue!50!black] (\angVis:1) arc (\angVis:-\angVis-180:1);
  \draw[current plane,dashed, color=blue!50!gray] (180-\angVis:1) arc (180-\angVis:\angVis:1);
}
\newcommand\DrawLatitudeCircleU[2][1]{
  \LatitudePlane{\angEl}{#2}
  \tikzset{current plane/.prefix style={scale=#1}}
  \pgfmathsetmacro\sinVis{sin(#2)/cos(#2)*sin(\angEl)/cos(\angEl)}
  \pgfmathsetmacro\angVis{asin(min(1,max(\sinVis,-1)))}
  \draw[redirected,current plane, color=blue!50!black] (\angVis:1) arc (\angVis:-\angVis-180:1);
  \draw[current plane,dashed, color=blue!50!gray] (180-\angVis:1) arc (180-\angVis:\angVis:1);
}





\title{Adjunctions and defects in Landau-Ginzburg models}
%
% Other titles: 
% On signs
% Rise of the Planet of the Coevaluations
% Adjoint defects in Landau-Ginzburg models
% Adjunction and defects in Landau-Ginzburg models
% Adjunctions and defects in Landau-Ginzburg models
% On adjunctions and defects in Landau-Ginzburg models

\dedication{TODO: dedication}

\author{Nils Carqueville}
\email{nils.carqueville@physik.uni-muenchen.de}
\address{Arnold Sommerfeld Center for Theoretical Physics, LMU M\"unchen \& Excellence Cluster Universe}

\author{Daniel Murfet}
\email{daniel.murfet@math.ucla.edu}
\address{Department of Mathematics, UCLA}

\classification{TODO}

\begin{abstract}
In this paper we study the bicategory of Landau-Ginzburg models, which has potentials as objects and matrix factorisations as $1$-morphisms. Our main result is the existence of adjoints in this bicategory and a description of evaluation and coevaluation maps in terms of Atiyah classes and homological perturbation. Being simultaneously conceptual and explicit, our construction lends itself to applications in numerous directions. In particular, the bicategorical perspective offers a unified approach to Landau-Ginburg models: we show how to compute arbitrary correlators and recover the full structure of open/closed TFT, including the Kapustin-Li disk correlator and a simple proof of the Cardy condition, in terms of defect operators which in turn are directly computable from the adjunctions. 
\end{abstract}

\maketitle

\section{Introduction}\label{sec:Introduction}

Landau-Ginzburg models play an important role in many areas of mathematical physics and pure mathematics. Among them are diverse fields such as singularity theory, representation theory, (homological) mirror symmetry, knot invariants, and conformal or topological field theory. These areas are intimately interrelated, and this richness is one of the aesthetic motivations for studying Landau-Ginzburg models. Another general motivation is their dual nature of affording insight into deep structure while at the same time being concrete enough to allow for hands-on computations. 

In this paper we will show how this dichotomy manifests itself in the context of two-dimensional topological field theory (TFT) with defects. In short, we explain how Landau-Ginzburg models give rise to a bicategory with adjoints and we show that there is a simple description of the structure maps in this bicategory in terms of basic invariants called Atiyah classes \cite{atiyahconn}. These structure maps are explicit enough that one can do nontrivial computations, but also conceptually elegant in the sense that working with diagrams in the bicategory reduces to a calculus of Atiyah classes.

To set the stage and provide some background, we recall a few aspects of TFTs with defects in an informal fashion; for more detailed accounts we refer to~\cite{k1004.2307} and~\cite[Section~2]{dkr1107.0495}. We imagine the bulk sector theories~$T_I$ to ``live'' on a two-dimensional surface called the \textsl{worldsheet}. More precisely, the worldsheet may be partitioned into various domains to which the (not necessarily distinct) theories~$T_I$ are associated, and which are separated by one-dimensional oriented \textsl{defect lines} $D_\alpha$. A sketch of a typical such partitioned worldsheet is shown in Figure~\ref{worldsheetwithdefects}. 

In addition to the labels $T_I$ for the two-dimensional domains and $D_\alpha$ for the one-dimensional defect lines, we also include labels~$\phi_i$ for zero-dimensional points. These labels are interpreted as describing \textsl{fields} inserted at the points on the worldsheet. Note that the fields can also be placed at junctions of multiple defect lines. 

\begin{figure}[t]
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.7,color=blue!50!black, baseline,>=stealth]
\clip (0,0) ellipse (6cm and 3cm);
\nicedashedcolourscheme (0,0) ellipse (6cm and 3cm);

\draw (-4.15,1.3) [white] node {{\scriptsize $T_1$}};
\draw (-5.1,-0.3) [white] node {{\scriptsize $T_2$}};
\draw (-1.3,2.2) [white] node {{\scriptsize $T_3$}};
\draw (2.2,2.0) [white] node {{\scriptsize $T_4$}};
\draw (1,0) [white] node {{\scriptsize $T_5$}};

\draw (-4.9,-1) node {{\scriptsize $D_1$}};
\draw (-4.7,0.8) node {{\scriptsize $D_2$}};
\draw (-2.5,1.3) node {{\scriptsize $D_3$}};
\draw (-3.6,-1.1) node {{\scriptsize $D_4$}};
\draw (-2.1,0.6) node {{\scriptsize $D_5$}};
\draw (3.5,1.8) node {{\scriptsize $D_6$}};
\draw (-0.4,0) node {{\scriptsize $D_7$}};
\draw (1.7,-1.7) node {{\scriptsize $D_8$}};

\draw (-4,0.45) node {{\scriptsize $\phi_1$}};
\draw (-2.1,-2) node {{\scriptsize $\phi_2$}};
\draw (-1.45,-2.15) node {{\scriptsize $\phi_3$}};
\draw (-0.62,-2.2) node {{\scriptsize $\phi_4$}};
\draw (4.5,0.84) node {{\scriptsize $\phi_5$}};
\draw (0.85,2.32) node {{\scriptsize $\phi_6$}};

\draw[->, very thick, out=60, in=260] (-5,-2) to (-4.5,-1);
\draw[very thick, out=80, in=220] (-4.5,-1) to (-4,0);
\filldraw (-4,0) circle (2.5pt);
\draw[->,very thick, out=150, in=350] (-4,0) to (-5,0.5);
\draw[very thick, out=170, in=350] (-5,0.5) to (-6,0.75);

\draw[->,very thick, out=-30, in=110] (-4,0) to (-3.2,-1);
\draw[very thick, out=-70, in=170] (-3.2,-1) to (-2.5,-2);
\filldraw (-2.5,-2) circle (2.5pt);

\draw[->,very thick, out=70, in=230] (-2.5,-2) to (-1.5,0.5);
\draw[very thick, out=50, in=200] (-1.5,0.5) to (1,2);
\filldraw (1,2) circle (2.5pt);

\draw[very thick, out=-30, in=180] (1,2) to (2,1.5);
\draw[->,very thick, out=0, in=270] (2,1.5) to (3,2);
\draw[very thick, out=90, in=0] (3,2) to (2,2.5);
\draw[very thick, out=180, in=30] (2,2.5) to (1,2);

\draw[very thick] (1,0) circle (1);
\draw[->,very thick, out=90, in=270] (0,0) to (0,0);

\filldraw (-1.5,-2.5) circle (2.5pt);

\filldraw (-0.5,-2.6) circle (2.5pt);
\draw[->,very thick, out=0, in=220] (-0.5,-2.6) to (2,-2);
\draw[very thick, out=40, in=260] (2,-2) to (4.5,0.5);
\filldraw (4.5,0.5) circle (2.5pt);

\draw[->,very thick, out=40, in=260] (-4,0) to (-3,1.5);
\draw[very thick, out=80, in=270] (-3,1.5) to (-2.5,3);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
$$
\caption{Part of a worldsheet with defect lines and field insertions} 
\label{worldsheetwithdefects} 
\end{figure}


A TFT is a functor that assigns a number called the \textsl{correlator} to a labelled worldsheet like the one in Figure~\ref{worldsheetwithdefects}. Its topological nature implies that the value of any correlator does not depend on the precise position of the $D_\alpha$'s and $\phi_i$'s, but only on their isotopy class. 

It is natural to try and make sense of this situation in terms of a bicategory: its objects are the theories $T_I$, 1-morphisms are labelled defect lines $D_\alpha$, and 2-morphisms are the fields $\phi_i$. The composition of 2-morphisms is the operator product of the fields, which is strictly associative because we only consider \textsl{topological} field theories. The composition of 1-morphisms comes about as follows: since the exact locus of the defect lines does not matter, two (or more) adjacent defect lines can be brought together arbitrarily close, and the limit of this \textsl{fusion} is well-defined and nonsingular. The unit of the fusion product is the \textsl{invisible defect} which by definition leaves any other defect line invariant under fusion. 

Thus any TFT with defects is expected to be associated with a bicategory. Standard examples of bicategories include the bicategory of small categories (with objects, 1- and 2-morphisms given by categories, functors and natural transformations, respectively) or rings (rings, bimodules, bimodule maps), but these are too generic to describe TFTs. A rich and interesting example is the bicategory of algebraic varieties with Fourier-Mukai kernels as 1-morphisms~\cite{ct1007.2679} which describes B-twisted sigma models, see~e.\,g.~\cite{MB2}. 

The subject of this paper is the bicategory $\LG$ of Landau-Ginzburg models over a base ring $k$.\footnote{We will allow any commutative noetherian $\nQ$-algebra~$k$ for the coefficients of polynomial rings, e.\,g.~$k=\nC$ or $k=\nC[t_1,\ldots,t_d]$ where the~$t_i$ may be interpreted as deformation parameters.} Roughly, its objects (or bulk theories) are given by elements (or \textsl{potentials})~$W$ in a polynomial ring $R=k[x_1,\ldots,x_n]$ which have isolated singularities, and its 1- and 2-morphisms (or defects and fields) are described by the triangulated categories of matrix factorisations of potential differences $V-W$. The fusion of 1-morphisms is the tensor product~\cite{br0707.0922}, and the invisible defect is the stabilised diagonal which we present as the Koszul factorisation $\Delta = \bigwedge (\bigoplus_{i=1}^n (R\otimes_k R)\cdot \theta_i)$ (see Section~\ref{sec:Background} for a detailed description). That $\LG$ is indeed a bicategory has been worked out in~\cite{McNameethesis, Calinetal, cr0909.4381}. 

On general grounds it is expected that the bicategorical description of TFTs with defects involves additional structure. For example, the fact that defect lines are \textsl{oriented} means that we expect adjunctions on the level of 1-morphisms: any defect line should be adjoint to the ``same'' defect line with reversed orientation. In the case of Landau-Ginzburg models this means that for every matrix factorisation~$X\equiv (X,D)$ with $D^2 = (V-W)\cdot 1_X$, viewed as a 1-morphism between the bulk theories described by potentials $W \in k[x_1,\ldots,x_n]$ and $V \in k[z_1,\ldots,z_m]$, we expect a matrix factorisation~$X^\dual$ of $W-V$ together with evaluation and coevaluation maps
\be\label{evcoevintro}
\widetilde\eval_X: X \otimes_{k[x]} X^\dual \lra \Delta 
\, , \qquad
\widetilde\coev_X: \Delta \lra X^\dual \otimes_{k[z]} X
\ee
defining an adjunction between~$X$ and~$X^\dual$. Similarly, one expects a matrix factorisation~${}^\dual X$ and maps $\eval_X: {}^\dual X \otimes X \lto \Delta$ and $\coev_X: \Delta \lto X \otimes {}^\dual X$ making ${}^\dual X$ a left adjoint of $X$. The special case where~$V$ and~$W$ are the same polynomial and depend on only one variable was worked out in~\cite{cr1006.5609}; we refer to that paper's introductory section for further motivation from physics.

In the present paper we prove that every $1$-morphism $X:W\lra V$ in $\LG$ as above has left and right adjoints given by ${}^\dual X = X^{\vee}[m]$ and $X^\dual = X^{\vee}[n]$ where $X^{\vee} = \Hom_{k[x,z]}(X, k[x,z])$ is the dual factorisation. We provide explicit formulas for the evaluation and coevaluation maps in terms of residues and the \textsl{associative Atiyah class} of~$X$ that we introduce in Section~\ref{section:atiyahclasses} using noncommutative forms. There are two aspects of the construction that we wish to highlight: the first is that one gains conceptual insight into the structure of the bicategory $\LG$ by working with Atiyah classes, and the second is that having effectively computable formulas for evaluation and coevaluation maps opens the doors for many applications. 

Regarding the conceptual aspect we note that there is a close analogy between the Atiyah class of a complex of free modules over a ring (or vector bundles on a scheme) and the Riemann curvature operator of a Riemannian manifold. One way of making this precise is that the Atiyah class is the curvature of a superconnection in the sense of Quillen \cite{superquillen}, see Remark \ref{remark:curvature_superconnection}. The symmetries of the Riemann curvature operator, the most basic of which is that it is a skew-symmetric operator, play a fundamental role in differential geometry. One might therefore expect symmetries of the Atiyah class to play an important role in algebra, and indeed the Bianchi identity appears in Kapranov's study of Rozansky-Witten invariants \cite{kapranov}. In this paper we find that the existence of adjunctions in $\LG$ ultimately rests on the skew-symmetry of the Atiyah class of mapping complexes in dg-categories of matrix factorisations. For more examples of the Atiyah class in algebraic geometry and its connection with other classical invariants like the Chern character see \cite{illusie,markarian,buchweitz03,buchweitz08,roberts,huybrechts10}.

On the other hand our general construction also allows to carry out concrete calculations. To give a flavour of how explicit our formulas can be made, let $\{ e_i \}_i$ be a basis for the free $k[x,z]$-module~$X$ with dual basis $\{ e_i^* \}_i$. Then e.\,g.~the coevaluation map $\widetilde\coev_X$ is given by
\be\label{eq:formula_intro_coev}
\widetilde\coev_X( \gamma ) = \sum_{i,j} (-1)^{(r+1)|e_j| + s} \big\{ \partial_{[b_r]}(d_X) \ldots \partial_{[b_1]}(d_X) \big\}_{ji} \cdot e_i^* \otimes e_j
\ee
and there is a similar expression for $\coev_X$. Here $\gamma = \theta_{a_1} \ldots \theta_{a_{n-r}}$ is an element of the exterior algebra $\Delta$ and $\gamma' = \theta_{b_1} \ldots \theta_{b_r}$ is the ``complement'' of $\gamma$ in the sense that~$b_1 < \cdots < b_r$ is the unique sequence with $\gamma \wedge \gamma' = (-1)^{s} \theta_1 \ldots \theta_n$ a scalar multiple of the top degree form, and $\partial_{[i]}$ is a divided difference operator, see \eqref{diffquotop}. The evaluation maps have similar elementary presentations, which involve in addition supertraces and residues, see Section~\ref{sec:derivcoeval}.

The mixture of explicitness and conceptual control affords various applications which are of importance in their own right. We shall discuss some of them in later parts of this paper, and we briefly mention two of them already now. Recall that a bulk field in a Landau-Ginzburg model with potential $W\in k[x]$ is described as an endomorphism of the stabilised diagonal $\Delta_W$, so the field is an element in the Jacobi algebra $\operatorname{Jac}(W) = k[x]/(\partial_{x_i} W)$. Given a matrix factorisation $(X,D)$ of $V-W$, i.\,e.~a defect between the theories~$W$ and $V\in k[z_1,\ldots,z_m]$, we obtain an operator $\mathcal D_r(X)$ between the spaces of bulk fields by sending $\psi\in\operatorname{Jac}(W)$ to an element in $\operatorname{Jac}(V)$ obtained by ``wrapping the defect line labelled by~$X$ around~$\psi$''. We can make rigorous sense of this \textsl{defect action on bulk fields} in terms of string diagrams in the bicategory $\LG$ as 
\begin{align}\label{defectactionIntro}
\mathcal D_r(X)(\psi) = 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicepalecolourscheme (0,0) circle (3.5);
\fill (2.2,-2.2) circle (0pt) node[white] {{\small$V$}};
\nicecolourscheme (0,0) circle (2);
\fill (1.1,-1.1) circle (0pt) node[white] {{\small$W$}};
%
\draw (0,0) circle (2);
\fill (0:2) circle (0pt) node[right] {{\small$X$}};
\draw[<-, very thick] (0.100,2) -- (-0.101,2) node[above] {}; 
\draw[<-, very thick] (-0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[right] {{\small$\psi$}};
\fill (130:2) circle (3.3pt) node[left] {{\small$\rho_X$}};
\fill (230:2) circle (3.3pt) node[left] {{\small$\rho^{-1}_{X}$}};
\draw[dashed] (135:0) .. controls +(0,1) and +(0.5,-1) .. (130:2);
\fill (-0.1,1.15) circle (0pt) node {{\small $\Delta_W$}};
\fill (-0.1,-1.15) circle (0pt) node {{\small $\Delta_W$}};
\draw[dashed] (135:0) .. controls +(0,-1) and +(0.5,1) .. (230:2);
\draw[dashed] (270:2) -- (270:3.3)
node[near end,right] {{{\small$\Delta_V$}}};
\draw[dashed] (90:2) -- (90:3.3)
node[near end,right] {{{\small$\Delta_V$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\equiv\;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicepalecolourscheme (0,0) circle (3.5);
\fill (2.2,-2.2) circle (0pt) node[white] {{\small$V$}};
\nicecolourscheme (0,0) circle (2);
\fill (1.1,-1.1) circle (0pt) node[white] {{\small$W$}};
%
\fill (0:2) circle (0pt) node[right] {{\small$X$}};
\draw (0,0) circle (2);
\draw[<-, very thick] (0.100,2) -- (-0.101,2) node[above] {}; 
\draw[<-, very thick] (-0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[left] {{\small$\psi$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\; ,
\end{align}
where as usual (and explained in more detail in Section~\ref{subsec:bicatLG}) evaluation and coevaluation maps are denoted as caps and cups, respectively, $\rho_X$ is the right action of $\Delta_W$ on~$X$, and we always read diagrams like the above from bottom to top. Thus~\eqref{defectactionIntro} equals $\widetilde\eval_X \circ (1_{X}\otimes (\rho_{X} \circ (1_X \otimes \psi)\circ \rho_{X}^{-1})) \circ \coev_X$, from which in Section~\ref{sec:defectaction} we will prove the general formula 
\be\label{DrXpsi}
\mathcal D_r(X)(\psi)  = (-1)^{{m+1}\choose 2} \Res_{k[x,z]/k[z]} \left[ \frac{\psi \str\big( \partial_{x_1} D\ldots \partial_{x_n} D \, \partial_{z_1} D\ldots \partial_{z_m} D\big) \underline{\operatorname{d}\! x}}{\partial_{x_1} W \ldots \partial_{x_n} W} \right]
\ee
as well as various properties such as $\mathcal D_r(X\otimes Y) = \mathcal D_r(X) \circ \mathcal D_r(Y)$. 

One may also consider the situation in~\eqref{defectactionIntro} with an additional defect field $\Phi\in\End(X)$ inserted on the $X$-loop. We will see that this simply amounts to the insertion of~$\Phi$ as a factor inside the supertrace in~\eqref{DrXpsi}. As the two special cases $W=0$ and $V=0$ we thus obtain
$$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.4,color=blue!50!black, baseline,>=stealth]
\nicepalecolourscheme (0,0) circle (3.5);
\fill (-2.1,-2.1) circle (0pt) node[white] {{\small$V$}};
\shadedraw[top color=white, bottom color=white, draw=white] (0,0) circle (2);
%
\fill (180:1.8) circle (0pt) node[left] {{\small$X$}};
\fill (130:2) circle (3.3pt) node[left] {{\small$\Phi$}};
\draw (0,0) circle (2);
\draw[<-, very thick] (0.100,2) -- (-0.101,2) node[above] {}; 
\draw[<-, very thick] (-0.100,-2) -- (0.101,-2) node[below] {}; 
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 = 
(-1)^{{m+1\choose 2}} \str\big( \Phi \Lambda_X^{(z)} \big)
\, , \qquad
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.4,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\fill (-1.0,-1.0) circle (0pt) node[white] {{\small$W$}};
%
\fill (180:1.8) circle (0pt) node[left] {{\small$X$}};
\fill (130:2) circle (3.3pt) node[left] {{\small$\Phi$}};
\draw (0,0) circle (2);
\draw[<-, very thick] (0.100,2) -- (-0.101,2) node[above] {}; 
\draw[<-, very thick] (-0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[left] {{\small$\psi$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
= 
\Res_{k[x]/k} \!\!\left[ \frac{\psi \str\big( \Phi \Lambda_X^{(x)} \big) \underline{\operatorname{d}\! x}}{\partial_{x_1} W \ldots \partial_{x_n} W} \right] 
$$
where $\Lambda_X^{(x)} = \partial_{x_1} D\ldots \partial_{x_n} D$ and $\Lambda_X^{(z)} = \partial_{z_1} D\ldots \partial_{z_m} D$. 
In this way we respectively recover the \textsl{boundary-bulk map} (which reduces to the \textsl{Chern character} $(-1)^{{m+1\choose 2}} \str( \partial_{z_1} D\ldots \partial_{z_m} D)$ for $\Phi=1$) and the  \textsl{Kapustin-Li disk correlator}. As part of the general development we also give a new proof for the nondegeneracy of the Kapustin-Li pairing that holds over any noetherian $\mathbb{Q}$-algebra $k$.

Another application of our construction of adjunctions in $\LG$ is a new proof of the \textsl{Cardy condition} (see Section~\ref{sec:ocTFT} for its precise statement). This generalisation of the Hirzebruch-Riemann-Roch theorem is the most ``quantum'' among the axioms for open/closed TFTs (as it stems from a one-loop diagram) and may accordingly be viewed as a particularly deep structure. In the case of Landau-Ginzburg models it was proved only recently in~\cite{pv1002.2116} for $k=\nC$. Our proof works for any noetherian $\nQ$-algebra~$k$ and simply follows from the fact that the 2-morphism in $\LG$ to be read off from the diagram 
$$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\nicereallynocolourscheme (0,0) circle (1);
\fill (1.5,0) circle (0pt) node[white] {{\small$W$}};
\draw (0,0) circle (2);
\draw[->, very thick] (-0.100,2) -- (-0.101,2) node[above] {}; %{{\small$\eval_Y$}}; 
\draw[->, very thick] (0.100,-2) -- (0.101,-2) node[below] {}; % {{\small$\widetilde\coev_Y$}}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$\psi$}};
%
\draw (0,0) circle (1);
\draw[->, very thick] (0.100,1) -- (0.101,1) node[above] {}; % {{\small$\widetilde\eval_X$}}; 
\draw[->, very thick] (-0.100,-1) -- (-0.101,-1) node[below] {}; % {{\small$\coev_X$}}; 
\fill (135:1) circle (2.5pt) node[left] {{\small$\varphi$}};
\fill (180:0.9) circle (0pt) node[left] {{\small$X$}};
\fill (0:2.7) circle (0pt) node[left] {{\small$Y$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$$
(which is to be identified with an annulus correlator) can be evaluated in two ways: either by first contracting the inner $X$-loop and then contracting the outer $Y$-loop, or by first fusing~$X$ with~$Y$ and then contracting the fused $(X^\vee \otimes Y)$-loop. Applying special cases of our evaluation and coevaluation maps then immediately produces the Cardy condition, see Theorem~\ref{thm:CardyCondition}. 

Let us conclude this introductory section by naming some further motivations for, and future applications of, the results presented in this paper. One of the most intriguing properties of Landau-Ginzburg models is that they are on one of the \textsl{CFT/LG correspondence}. This roughly states that many aspects of a large class of conformal field theories (CFTs) can be described in terms of (non-conformal) Landau-Ginzburg models. CFTs have an extremely rich structure, and the subclass of \textsl{rational} CFTs are particularly well-understood. Starting with~\cite{tft1} their description in terms of a beautiful categorical theory has been developed, and one may wonder which structures encountered in rational CFT can also be found in the theory of Landau-Ginzburg models -- whether or not they correspond to a rational CFT. The complete answer to this question is not known, but at least all the formal properties of $\LG$ that we establish in this paper also hold for the bicategory of topological defects in rational conformal field theory. Of course this by no means exhausts the richness of rational CFT, and there remain many properties of Landau-Ginzburg models to be uncovered, inspired by the CFT/LG correspondence. 

One example is the \textsl{generalised orbifold} procedure of~\cite{ffrs0909.5013} which constructs all rational CFTs of fixed central charge and with identical left and right chiral algebras from any given single such CFT. Carried over to Landau-Ginzburg models this leads to the following picture: under the right circumstances a Landau-Ginzburg model with potential~$V$ can be obtained from a model with completely different potential~$W$ by identifying a 1-endomorphism~$F$ in $\LG(W,W)$ that can be equipped with the structure of a special symmetric Frobenius algebra (see e.\,g.~\cite[Section~3]{tft1}). Then the category of matrix factorisations of~$V$ is equivalent to the category of $F$-modules. The results of the present paper facilitate the construction of suitable algebras as follows: for any defect $X\in \LG(W,V)$ with invertible \textsl{quantum dimension} $\mathcal D_r(X)(1)$ we obtain a special symmetric Frobenius algebra $F = X^\dual \otimes X$ that allows to recast everything about theory~$V$ in terms of theory~$W$. Also note that with our explicit formula~\eqref{DrXpsi} the condition of invertibility of the quantum dimension is very easy to check in practice. The details of this construction will be described along with examples in the forthcoming paper~\cite{genorb}. 

The rest of the present paper is organised as follows. In Section~\ref{sec:Background} we collect necessary background material on bicategories with adjoints, matrix factorisations, noncommutative forms, residues, and homological perturbation theory. Section~\ref{section:atiyahclasses} introduces various notions of associative Atiyah classes, which together with homological perturbation allow us to invert and lift up to homotopy certain maps pertaining to the stabilised diagonal in Section~\ref{section:pertandhtpy}. Using these results we construct explicit evaluation and coevaluation maps in Section~\ref{sec:derivcoeval} and prove that they indeed endow the bicategory $\LG$ with left and right adjoints in Section~\ref{sec:Zorro}. In Section~\ref{sec:wiggliesandsigns} we discuss the details of the graphical calculus as well as pivotality, both important for applications of our main result, some of which we describe in the following three sections: defect action on bulk fields in Section~\ref{sec:defectaction}, open/closed TFT and in particular the Cardy condition in Section~\ref{sec:ocTFT}, and a bicategorical trace in Section~\ref{sec:shadows}. Finally, in Section~\ref{section:dualityadjointop} we provide a proof, similar in spirit to the construction of Section~\ref{sec:Zorro}, of the nondegeneracy of the Kapustin-Li pairing, for the general base~$k$ over which we work also in the bulk of the paper. 


\begin{acknowledgements}
TODO: especially Ragnar Buchweitz, also Ilka Brunner, Daniel Plencner, Peter Petersen, Ingo Runkel. Nils Carqueville thanks Paul Balmer, the UCLA math department and Espresso Profeta for hospitality and excellent working conditions. 
\end{acknowledgements}


\section{Background}\label{sec:Background}

Throughout rings are commutative and $k$ is a noetherian $\nQ$-algebra, unless specified otherwise.

\subsection{Bicategories and adjunction}\label{subsec:bicat}

In this section we recall the basic theory of bicategories, with \cite{bor94} as our main reference. In Section~\ref{subsec:bicatLG} we introduce the main example of interest, the bicategory of Landau-Ginzburg models. The basic references for bicategories are \cite{benabou, gray, kellystreet} and for a useful survey see \cite{lack}. 

\begin{definition} A bicategory $\cat{B}$ consists of the following data:
\begin{itemize}
\item A class $|\cat{B}|$ of \textsl{objects}.
\item For each pair $A,B$ of objects a small category $\cat{B}(A,B)$ whose objects we call \textsl{$1$-morphisms} and whose arrows we call \textsl{$2$-morphisms}. Composition of $2$-morphisms is denoted $\gamma \circ \delta$.
\item For each triple $A,B,C$ of objects a functor
\[
c_{ABC}: \cat{B}(A,B) \times \cat{B}(B,C) \lto \cat{B}(A,C)\,.
\]
Given $1$-morphisms $f: A \lto B$ and $g: B \lto C$ we write $g \otimes f$ for their \textsl{composite} $c_{ABC}( f, g )$, and given $2$-morphisms $\gamma: f \lto f'$ and $\delta: g \lto g'$ we write $\delta \otimes \gamma$ for $c_{ABC}(\gamma, \delta)$.
\item For each object $A$ an identity $1$-morphism $\Delta_A: A \lto A$.
\item For each triple of composable $1$-morphisms $h, g, f$ a $2$-isomorphism
\[
\alpha_{f,g,h}: (h \otimes g) \otimes f \lto h \otimes (g \otimes f)
\]
natural with respect to $2$-morphisms in all three variables.
\item For each $1$-morphism $f: A \lto B$ a pair of $2$-isomorphisms
\begin{align*}
\lambda_f&: \Delta_B \otimes f \lto f\,,\\
\rho_f&: f \otimes \Delta_A \lto f
\end{align*}
natural with respect to $2$-morphisms in the variable $f$.
\end{itemize}
This data is subject to two coherence axioms, one involving the associator $\alpha$ and the other the left and right unit actions $\lambda, \rho$, see \cite[(7.18),\,(7.19)]{bor94}.
\end{definition}

The identity $2$-endomorphism of a $1$-morphism $f: A \lto B$ is denoted $1_f$ and the identity $2$-endomorphism of $\Delta_A$ is denoted $1_A$. For the remainder of this section, $\cat{B}$ denotes a bicategory.

It is convenient to denote $2$-morphisms in a bicategory using \textsl{string diagram} notation. This was introduced in \cite{JSGoTCI,JSGoTCII} and the reader can also find very clear explanations in \cite{ladia,khovdia}. In order to fix our notation, recall that the diagram 
\be\label{eq:demonstratediagram}
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\fill (0,0) circle (2.9pt) node (gamma) {};
\draw[line width=0pt] 
(0.25,0.2) node[line width=0pt] (gamma2) {{\small $\gamma$}}
(0,-1) node[line width=0pt] (A) {{\small $A$}}
(-1,0.75) node[line width=0pt] (B) {{\small $B$}}
(1,0.75) node[line width=0pt] (C) {{\small $C$}};
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(-1.5,-1.5) -- (0,0)
node[midway, left] {{{\small$f$}}};
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(1.5,-1.5) -- (0,0)
node[midway, right] {{{\small$h$}}};
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,0) -- (0,1.5)
node[midway, left] {{{\small$g$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
\ee 
represents a $2$-morphism $\gamma: f \otimes h \lto g$ in $\cat{B}$ with $f: A \lto B, g: C \lto B$ and $h: C \lto A$ all $1$-morphisms. We call $\gamma$ the \textsl{value} of the diagram \eqref{eq:demonstratediagram}. In the following we will often refrain from displaying objects as labels for two-dimensional domains in such diagrams. 

In this diagrammatic calculus all diagrams are \textsl{progressively planar} in the sense of \cite{JSGoTCI}, i.\,e.~arcs proceed strictly upwards. It is straightforward to check \cite[Theorem $1.2$]{JSGoTCI} that an arbitrary such diagram may be unambiguously assigned a value as a $2$-morphism in $\cat{B}$, by ``tensoring horizontally and composing vertically'' and this justifies rigorously the use of diagrams like the one above. Where appropriate, we allow ourselves to migrate the arc labels so that they decorate the top and bottom horizontal boundaries, as e.\,g.~in the diagrams \eqref{Zorros} below.

We are interested in the relation of adjointness between $1$-morphisms in $\cat{B}$. In the bicategory of categories, functors and natural transformations, adjunction between functors can be expressed either in terms of a natural isomorphism of mapping spaces, or as an equation involving the units and counits of adjunction. In a general bicategory we define adjunction in terms of an equation; the equivalent description in terms of natural isomorphisms will not be used in the body of the text, but see Appendix \ref{app:adjoints}.

Our references for adjunction in bicategories are \cite[Chapter $6$]{gray} and \cite{kellystreet}.

\begin{definition}\label{def:adjointbicats} Two $1$-morphisms $f: A \lto B$ and $g: B \lto A$ are part of an \textsl{adjoint pair} when there exist $2$-morphisms
\be\label{evcoev}
\eval : g \otimes f \lra \Delta_A \, , \qquad \coev : \Delta_B \lra f \otimes g
\ee
satisfying 
\begin{align}
\rho_f \circ (1_f \otimes \eval) \circ \alpha_{f,g,f} \circ (\coev \otimes 1_f) \circ \lambda_f^{-1} & = 1_f \, , \label{uglyZorro1}\\
\lambda_{g} \circ (\eval \otimes 1_{g}) \circ \alpha^{-1}_{g,f,g} \circ (1_{g} \otimes \coev) \circ \rho_{g}^{-1} & = 1_{g} \, . \label{uglyZorro2}
\end{align}
Equivalently, the following two composites evaluate to the identity:
\begin{align*}
\xymatrix@C+1.5pc
{
f \ar[r]^-{\lambda_f^{-1}} & \Delta_B \otimes f \ar[r]^-{\coev \otimes 1_f} & ( f \otimes g ) \otimes f \ar[r]^-{\alpha_{f,g,f}} & f \otimes ( g \otimes f ) \ar[r]^-{1_f \otimes \eval} & f \otimes \Delta_A \ar[r]^-{\rho_f} & f
} ,\\
\xymatrix@C+1.5pc
{
g \ar[r]^-{\rho_g^{-1}} & g \otimes \Delta_B \ar[r]^-{1_g \otimes \coev} & g \otimes ( f \otimes g ) \ar[r]^-{\alpha^{-1}_{g,f,g}} & (g \otimes f) \otimes g \ar[r]^-{\eval \otimes 1_g} & \Delta_A \otimes g \ar[r]^-{\lambda_g} & g
} .
\end{align*}
In this case we say that $g$ is \textsl{left adjoint} to $f$ and that $f$ is \textsl{right adjoint} to $g$, and we write $g \dashv f$. The $2$-morphisms $\eval$ and $\coev$ are referred to as the \textsl{evaluation} and \textsl{coevaluation} maps.
\end{definition}

\begin{definition}\label{def:bicatduals}
$\mathcal B$ \textsl{has left adjoints} (resp.~\textsl{has right adjoints}) if every 1-morphism in $\cat{B}$ admits a left adjoint (resp.admits a right adjoint). If they exist these adjoints are unique up to isomorphism, and the unique left and right adjoints of $f$ are denoted by ${}^\dual f$ and $f^\dual$, respectively.
\end{definition}

If a $1$-morphism $f: A \lto B$ has both a left and right adjoint then we write the evaluation and coevaluation maps for the adjunction ${}^\dual f \dashv f$ with $f$ as a subscript, that is
\be\label{evcoev2}
\eval_f : {}^\dual f \otimes f \lra \Delta_A \, , \qquad \coev_f : \Delta_B \lra f \otimes {}^\dual f\,.
\ee
For the adjunction $f \dashv f^\dual$ we write the evaluation and coevaluation maps as
\be\label{evcoev3}
\widetilde\eval_f : f \otimes f^\dual \lra \Delta_B \, , \qquad \widetilde\coev_f : \Delta_A \lra f^\dual \otimes f\,.
\ee
It is very useful to use string diagrams when working with adjoints in a bicategory. In this language the evaluation and coevaluation maps~\eqref{evcoev2} are written as
$$
\eval_{f} = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.6cm]
\draw[line width=0pt] 
(2.5,1.6) node[line width=0pt] (I) {{\small$\Delta_A$}}
(3,0) node[line width=0pt] (D) {{\small $f\vphantom{f^\dual}$}}
(2,0) node[line width=0pt] (s) {\small{${}^\dual f$}}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\draw[dashed] (2.5,0.81) -- (I);
\end{tikzpicture}
\equiv
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.6cm]
\draw[line width=0pt] 
(3,0) node[line width=0pt] (D) {{\small$f\vphantom{f^\dual}$}}
(2,0) node[line width=0pt] (s) {{\small${}^\dual f$}}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
, 
\qquad
\coev_{f} = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.6cm,rotate=180]
\draw[line width=0pt] 
(2.5,1.6) node[line width=0pt] (I) {{\small$\Delta_B$}}
(3,0) node[line width=0pt] (D) {{\small$f\vphantom{{}^\dual f}$}}
(2,0) node[line width=0pt] (s) {{\small${}^\dual f$}}; 
\draw[redirected] (D) .. controls +(0,1) and +(0,1) .. (s);
\draw[dashed] (2.5,0.81) -- (I);
\end{tikzpicture}
\equiv
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.6cm,rotate=180]
\draw[line width=0pt] 
(3,0) node[line width=0pt] (D) {{\small$f\vphantom{A^\dual}$}}
(2,0) node[line width=0pt] (s) {{\small${}^\dual f$}}; 
\draw[redirected] (D) .. controls +(0,1) and +(0,1) .. (s);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
 \, . 
$$
We stress that, while suggestive, the arrows in these two diagrams have no meaning beyond that of the dot in \eqref{eq:demonstratediagram}. They are merely decorations intended to remind us that this diagram depicts an evaluation or coevaluation, with the direction of the arrow alerting us to the type. In particular, we do \textsl{not} mean that there is an oriented arc labelled with $f$, rather, there are three unoriented arcs adjacent to the vertex, which in the case of $\coev_f$ are labelled $f, {}^\dual f$ and $\Delta_B$.

In Section~\ref{subsec:alternatives} we will explain a richer kind of diagrammatics in which the arcs are honestly oriented and a label $f$ on a downwards oriented arc is understood in terms of the adjoints of $f$, but until then our diagrams have the simpler meaning described above.

With this notation the defining relations~\eqref{uglyZorro1} and~\eqref{uglyZorro2} translate into the \textsl{Zorro moves}
\be\label{Zorros}
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(-1,1.25) node[line width=0pt] (A) {{\small $f$}}
(1,-1.25) node[line width=0pt] (A2) {{\small $f$}}; 
\draw[directed] (0,0) .. controls +(0,-1) and +(0,-1) .. (-1,0);
\draw[directed] (1,0) .. controls +(0,1) and +(0,1) .. (0,0);
\draw (-1,0) -- (A); 
\draw (1,0) -- (A2); 
\end{tikzpicture}
=
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(0,1.25) node[line width=0pt] (A) {{\small $f$}}
(0,-1.25) node[line width=0pt] (A2) {{\small $f$}}; 
\draw (A2) -- (A); 
\end{tikzpicture}
\, , \qquad
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(1,1.25) node[line width=0pt] (A) {{\small ${}^\dual f$}}
(-1,-1.25) node[line width=0pt] (A2) {{\small ${}^\dual f$}}; 
\draw[directed] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[directed] (1,0) .. controls +(0,-1) and +(0,-1) .. (0,0);
\draw (-1,0) -- (A2); 
\draw (1,0) -- (A); 
\end{tikzpicture}
=
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(0,1.25) node[line width=0pt] (A) {{\small ${}^\dual f$}}
(0,-1.25) node[line width=0pt] (A2) {{\small ${}^\dual f$}}; 
\draw (A2) -- (A); 
\end{tikzpicture} \, .
\ee

Similarly the evaluation and coevaluation maps \eqref{evcoev3} are written
$$
\widetilde\eval_{f} = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.6cm]
\draw[line width=0pt] 
(2.5,1.6) node[line width=0pt] (I) {{\small$\Delta_B$}}
(3,0) node[line width=0pt] (D) {{\small $f^\dual\vphantom{f^\dual}$}}
(2,0) node[line width=0pt] (s) {\small{$f\vphantom{f^\dual}$}}; 
\draw[redirected] (D) .. controls +(0,1) and +(0,1) .. (s);
\draw[dashed] (2.5,0.81) -- (I);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\equiv
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.6cm]
\draw[line width=0pt] 
(3,0) node[line width=0pt] (D) {{\small$f^\dual$}}
(2,0) node[line width=0pt] (s) {{\small$f\vphantom{f^\dual}$}}; 
\draw[redirected] (D) .. controls +(0,1) and +(0,1) .. (s);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
, 
\qquad
\widetilde\coev_{f} = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.6cm,rotate=180]
\draw[line width=0pt] 
(2.5,1.6) node[line width=0pt] (I) {{\small$\Delta_A$}}
(3,0) node[line width=0pt] (D) {{\small$f^\dual$}}
(2,0) node[line width=0pt] (s) {{\small$f\vphantom{f^\dual}$}}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\draw[dashed] (2.5,0.81) -- (I);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\equiv
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.6cm,rotate=180]
\draw[line width=0pt] 
(3,0) node[line width=0pt] (D) {{\small$f^\dual$}}
(2,0) node[line width=0pt] (s) {{\small$f\vphantom{f^\dual}$}}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
$$
satisfying the associated Zorro moves
\be\label{otherZorros}
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(1,1.25) node[line width=0pt] (A) {{\small $f$}}
(-1,-1.25) node[line width=0pt] (A2) {{\small $f$}}; 
\draw[redirected] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,-1) and +(0,-1) .. (0,0);
\draw (-1,0) -- (A2); 
\draw (1,0) -- (A); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(0,1.25) node[line width=0pt] (A) {{\small $f$}}
(0,-1.25) node[line width=0pt] (A2) {{\small $f$}}; 
\draw (A2) -- (A); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, , \qquad
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(-1,1.25) node[line width=0pt] (A) {{\small $f^\dual$}}
(1,-1.25) node[line width=0pt] (A2) {{\small $f^\dual$}}; 
\draw[redirected] (0,0) .. controls +(0,-1) and +(0,-1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (0,0);
\draw (-1,0) -- (A); 
\draw (1,0) -- (A2); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(0,1.25) node[line width=0pt] (A) {{\small $f^\dual$}}
(0,-1.25) node[line width=0pt] (A2) {{\small $f^\dual$}}; 
\draw (A2) -- (A); 
\end{tikzpicture} \, .
%%%%%%%%%%%%%%%%%%%%%%
\ee
Note that in general there is no reason for the left and right adjoints to coincide.

\subsection{Bicategory of Landau-Ginzburg models}\label{subsec:bicatLG}

Next we define the bicategory $\LG$ of Landau-Ginzburg models over the base ring $k$. Recall that $k$ is a noetherian $\nQ$-algebra, with relevant examples being $k=\nC$ and $k=\nC[t_1,\ldots,t_d]$.

Objects of $\LG$ are pairs $(x, W)$ where $x = (x_1,\ldots,x_n)$ is an ordered sequence of variables and $W \in R = k[x_1,\ldots,x_n]$ is a \textsl{potential}, by which we mean that the Jacobi ring $R/(\partial_{x_1}W,\ldots,\partial_{x_n} W)$ is a finitely generated free $k$-module and the partial derivatives $\partial_{x_i}W$ form a regular sequence in $R$. If $k=\nC$ this simply means that the Jacobi ring is a finite-dimensional vector space. Typically we will simply write $k[x]$ for $k[x_1,\ldots,x_n]$. We will usually leave the chosen variable ordering implicit, and refer to objects of $\LG$ as pairs $(R, W)$ or even just a potential $W$ if this will not cause confusion.

The category $\LG(W, V)$ is defined in terms of matrix factorisations, which we now recall. Let $R = k[x_1,\ldots,x_n]$. A \textsl{linear factorisation} of $W\in R$ is a $\nZ_2$-graded $R$-module $X=X^0\oplus X^1$ together with an odd $R$-linear endomorphism~$d_X$ such that $d_X^2=W\cdot 1_X$. If~$X$ is a free $R$-module then the pair $(X,d_X)$ is called a \textsl{matrix factorisation}, and we often refer to it by~$X$ without explicitly mentioning the \textsl{differential} $d_X$; given a basis for~$X$ we sometimes identify the latter with the associated matrix: 
$$
d_{X} = \begin{pmatrix} 0 & d_X^1 \\ d_X^0 & 0\end{pmatrix} .
$$
Given two linear factorisations $X,Y$ of $W$, $\Hom_R(X,Y)$ is a $\nZ _2$-graded complex with differential
\[
d( \varphi ) = d_Y \circ \varphi - (-1)^{|\varphi|} \varphi \circ d_X\,.
\]
A \textsl{morphism} of linear factorisations $(X,d_X)$ and $(Y,d_Y)$ is an even $R$-linear map $\varphi: X \longrightarrow Y$ such that $d_Y \varphi = \varphi d_X$. Two morphisms $\varphi, \psi: X\lra Y$ are \textsl{homotopic} if there exists an odd $R$-linear map $\lambda:X\lra Y$ such that $d_Y\lambda + \lambda d_X = \psi-\varphi$. Equality up to homotopy is an equivalence relation.

Given a linear factorisation $X$ of $W$ the \textsl{dual factorisation} $X^\vee = \Hom_R(X, R)$ is a linear factorisation of $-W$ with $d_{X^\vee}( \nu ) = -(-1)^{|\nu|} \nu \circ d_X$. In terms of matrices
\be\label{eq:differentials_adjoints}
d_{X^\vee} = \begin{pmatrix} 0 & (d_X^0)^\vee \\ -(d_X^1)^\vee & 0\end{pmatrix} .
\ee

The \textsl{(homotopy) category of linear factorisations} $\HF(R,W)$ is the category of linear factorisations of $W\in R$ modulo homotopy relations. We denote by $\HMF(R,W)$ its full subcategory of matrix factorisations, and we write $\hmf(R,W)$ for the full subcategory of \textsl{finite-rank matrix factorisations}, i.\,e.~the matrix factorisations $X$ whose underlying $R$-module is free of finite rank. These three categories have standard triangulated structures whose shift functor we denote as~$[1]$. 

Since we work with polynomials rather than power series, $\hmf(R,W)$ is not necessarily idempotent complete; for an example of this phenomenon see \cite[Example A$.5$]{keller}. However $\HMF(R,W)$ has arbitrary coproducts and is therefore idempotent complete \cite{NeemanBook}, and $\hmf(R,W)^\omega$ denotes the idempotent closure of $\hmf(R,W)$ in this larger triangulated category. More concretely, this idempotent closure is the full subcategory of $\HMF(R,W)$ whose objects are those matrix factorisations $Y$ which are direct summands of finite-rank matrix factorisations (in the homotopy category). This is an idempotent complete triangulated category.

For objects $(R = k[x], W)$ and $(S = k[z], V)$ of $\LG$ we define
\be
\LG( (R, W), (S,V) ) = \hmf( R \otimes_k S, V - W )^\omega = \hmf( k[x,z], V - W)^\omega\,.
\ee
The reason for taking idempotent completions is that, as we will see in a moment, when composing $1$-morphisms we will find that the resulting matrix factorisation is not \textsl{a priori} finite-rank, only a summand in the homotopy category of something finite-rank. There seem to be two natural ways to resolve this: work throughout with power series rings and completed tensor products, or work with idempotent completions. The latter seems less technical, and has the advantage that the formalism also applies to graded rings and matrix factorisations.

In $\LG$ we compose $1$-morphisms using tensor products. For our purposes it will be sufficient to consider matrix factorisations $X\in \HMF(R_1\otimes_k R_2, W_2-W_1)$ and $Y\in \HMF(R_2\otimes_k R_3, W_3-W_2)$ (where $W_i \in R_i$ and of course $R_i = k$ is a possibility for any~$i$). Then the \textsl{tensor product matrix factorisation} $Y\otimes_{R_2} X \in \HMF(R_1\otimes_k R_3, W_3-W_1)$ is the $\nZ_2$-graded module 
$$
Y\otimes_{R_2} X = \Big( (Y^0\otimes_{R_2} X^0) \oplus (Y^1\otimes_{R_2} X^1) \Big) \oplus \Big( (Y^0\otimes_{R_2} X^1) \oplus (Y^1\otimes_{R_2} X^0) \Big) 
$$
together with the differential
$$
d_{Y\otimes X} = d_Y \otimes 1 + 1 \otimes d_X
$$
where the second term comes with the usual Koszul signs when applied to elements. Notice that even if $X,Y$ are finite-rank over $R_1 \otimes_k R_2$ and $R_2 \otimes_k R_3$ respectively, the tensor product $Y \otimes_{R_2} X$ is of \textsl{infinite} rank over $R_1 \otimes_k R_3$ whenever $R_2 \neq k$. We observe however that e.\,g.~by the argument of~\cite[Section~12]{dm1102.2957} the tensor product $Y \otimes_{R_2} X$ is still a direct summand in the homotopy category of something finite-rank, i.\,e.~we may define
\[
Y \circ X = Y \otimes_{R_2} X \in \hmf( R_1 \otimes_k R_3, W_3 - W_1 )^\omega = \LG( W_1, W_3 )\,.
\]
Letting the tensor product act in the obvious way on morphisms this defines a functor
\be\label{eq:backgroundcomptensor}
c_{W_1, W_2, W_3}: \LG( W_1, W_2 ) \times \LG( W_2, W_3 ) \lto \LG( W_1, W_3 ) \, , 
\qquad c( X, Y ) = Y \otimes_{R_2} X\,.
\ee
Also note that there are obvious natural isomorphisms $\alpha_{X,Y,Z}: (X\otimes Y)\otimes Z \lra X\otimes (Y \otimes Z)$. In the rest of the paper we drop the ``$\circ$'' notation for composition and simply write tensor products.

Finally, we discuss the unit $1$-morphisms $\Delta_W$ and the left and right unit actions $\lambda, \rho$. Given $W\in R=k[x_1,\ldots,x_n]$ there is always the \textsl{unit matrix factorisation} $\Delta_W \in \hmf(\Re, \widetilde W)$ where $\Re = R\otimes_k R$ and $\widetilde W = W\otimes 1 - 1\otimes W$. 
Using formal symbols $\theta_i$ we define the $\Re$-module
\be\label{DeltaW}
\Delta_W = \bigwedge \Big( \bigoplus_{i=1}^n \Re \theta_i \Big)
\ee
with the grading given by $\theta$-degree. Typically we will omit the wedge product and write  e.\,g.~$\theta_i\wedge \theta_j$ simply as $\theta_i \theta_j$. To describe the differential $d_{\Delta_W}$ we further need the variable-changing map
$$
{}^{t_i}(-): k[x,x'] \lra k[x,x'] \, , \qquad f \lmt f\big|_{x_i\lmt x'_i}
$$
in terms of which we can define difference quotient operators
\be\label{diffquotop}
\partial_{[i]}: k[x,x'] \lra k[x,x'] \, , \qquad f \lmt \frac{{}^{t_1\ldots t_{i-1}}f - {}^{t_1\ldots t_i}f}{x_i-x'_i} \, . 
\ee
It is easy to check that the $\partial_{[i]}$ satisfy the following kind of Leibniz rule: 
\begin{lemma}\label{lem:LeibnizForDQO}
For $f,g \in k[x,x']$ we have $\partial_{[i]}(fg) = (\partial_{[i]}f) ({}^{t_1\ldots t_{i}}g) + ({}^{t_1\ldots t_{i-1}}f) (\partial_{[i]}g)$. 
\end{lemma}

The differential on $\Delta_W$ is then given by
\be\label{DeltaW}
d_{\Delta_W} = \delta_+ + \delta_- \, , \qquad \delta_+ = \sum_{i=1}^n \partial_{[i]}W\cdot \theta_i \wedge (-)\, , \qquad \delta_- =  \sum_{i=1}^n (x_i-x'_i) \cdot \theta_i^* 
\ee
where $\theta_i^*$ acts on an element $\theta_{i_1} \ldots \theta_{i_n}$ of the exterior algebra with Koszul signs. We call $\Delta_W$ the unit matrix factorisation as it is the unit with respect to the tensor product of matrix factorisations. It is also referred to as the \textsl{stabilised diagonal} \cite{d0904.4713} or \textsl{Koszul model} of the diagonal since the morphism of linear factorisations of $\widetilde W$
\be\label{DeltaWstabmap}
\pi: \Delta_W \lra R\,,
\ee
given by the projection $\Delta_W \lra \Re$ to $\theta$-degree~$0$ followed by multiplication $\Re \lra R$, is universal in the homotopy category of linear factorisations among all morphisms from finite-rank matrix factorisations to $R$. Observe that the matrix factorisation $(\Delta_W, d_{\Delta_W})$ depends on the chosen ordering of the ring variables via the operators $\partial_{[i]}$ in the differential $\delta_{+}$. Another ordering will yield a different, but isomorphic, matrix factorisation; we address this point carefully in Section~\ref{sec:wiggliesandsigns}.

For $X\in \HMF(R_1 \otimes_k R_2,W_2-W_1)$ there are natural maps
\be\label{lambdarho}
\lambda_X = \pi \otimes 1_X: \Delta_{W_2} \otimes_{R_2} X \lra X \, , \qquad \rho_X = 1_X \otimes \pi : X \otimes_{R_1} \Delta_{W_1} \lra X
\ee
which are isomorphisms in $\HMF(R_1 \otimes_k R_2,W_2-W_1)$. These morphisms give the left and right unit actions in the bicategory of Landau-Ginzburg models. Later in Section~\ref{section:pertandhtpy} we will give a description of their explicit homotopy inverses. 

To summarise:

\begin{definition}
The \textsl{bicategory of Landau-Ginzburg models} $\LG$ consists of the following data: 
\begin{itemize}
\item Objects are pairs $(R,W)$ with $W\in R=k[x]$ a potential. 
\item 1- and 2-morphisms are the objects and morphisms of the categories
\[
\LG((R, W), (S,V)) = \hmf(R \otimes_k S,V-W)^\omega\,.
\]
\item The unit 1-morphisms are $\Delta_W \in \hmf(\Re,\widetilde W)$. 
\item The composition functor is the tensor product \eqref{eq:backgroundcomptensor}.
\item There are natural 2-isomorphisms $\alpha, \lambda, \rho$ as above. 
\end{itemize}
\end{definition}

\begin{proposition}[\cite{McNameethesis, Calinetal, cr0909.4381}] 
$\LG$ really is a bicategory, i.\,e.~$\alpha, \lambda, \rho$ are natural isomorphisms up to homotopy, and they satisfy the coherence axioms for bicategories. 
\end{proposition}

\begin{remark}\label{remark:integral_functors} It is often helpful to think of a potential $W \in k[x]$ as ``standing in'' for the triangulated category $\hmf(k[x], W)^\omega$, in which case a $1$-morphism $X: W \lto V$ stands for the functor
\[
\Phi_X: \hmf(k[x], W)^\omega \lto \hmf(k[z], V)^\omega\,,\qquad
\Phi_X( Y ) = X \otimes_{k[x]} Y\,.
\]
Working in the bicategory $\LG$ therefore amounts to doing algebra with integral functors. To make this precise, consider the object $\mathbb{I} = (k,0)$ of $\cat{LG}$. Then a $1$-morphism $\mathbb{I} \lto W$ is precisely an object of $\hmf(k[x], W)^\omega$ and $\Phi_X$ is the functor defined by composition with $X$: 
\[
\cat{LG}( \mathbb{I}, W ) \lto \cat{LG}( \mathbb{I}, V ) \, , \qquad Y \lmt X \otimes Y \, . 
\]
Moreover an adjunction in $\LG$ gives rise in this way to a pair of adjoint functors between categories of matrix factorisations. One way to say this is that $\cat{LG}( \mathbb{I}, - )$ defines a pseudofunctor from $\cat{LG}$ to the bicategory of categories, functors and natural transformations, and adjoint pairs are preserved by a pseudofunctor; see \cite[Section\,$4$]{benabou} and \cite{lack}.

Less tersely, given an adjunction $X \dashv X^\dual$ and $1$-morphisms $Y: \mathbb{I} \lto W$ and $Z: \mathbb{I} \lto V$ one deduces from the equation satisfied by the evaluation and coevaluation maps a natural isomorphism
\[
\Hom_{\LG(\mathbb{I}, V)}( X \otimes Y, Z ) \cong \Hom_{\LG(\mathbb{I}, W)}( Y, X^\dual \otimes Z )
\]
which makes the integral functor $\Phi_X$ left adjoint to $\Phi_{X^\dual}$. For the details see Appendix \ref{lemma:adjoint_nat_iso}.
\end{remark}

\begin{remark} One of the innovations in this paper is that we do not require our base ring to be a field. Naturally this means that somewhere we have to work harder, and we wish to pinpoint this so that the reader who only cares about $k = \nC $ knows where to get off the bus.

The key point comes in the proof of the Zorro moves: in \eqref{eq:zorroequalsH} we find that the Zorro move holds \textsl{up to some map} $H$, which we consequently want to prove is null-homotopic. The only way we know to do this is to use a nondegenerate pairing. If $k$ is a field, then we may use the Kapustin-Li formula of \cite{kl0305,hl0404,m0912.1629,dyckmurf}, but if $k$ is an arbitrary noetherian $\nQ$-algebra there is no longer a nondegenerate pairing on the \textsl{triangulated} category. Instead we use a ``homotopically'' nondegenerate pairing on the dg-category, which is constructed in Section \ref{section:dualityadjointop} for this purpose.
\end{remark}

\begin{remark}\label{remark:gradedbicategory}
The bicategory of \textsl{graded} Landau-Ginzburg models $\LG^{\mathrm{gr}}$ is defined as follows: its objects are pairs $(R = k[x_1,\ldots,x_n],W)$ as above with the additional data of a degree $|x_i| \ge 0$ for each variable, such that $W$ is homogeneous of even degree $2c$. A graded linear factorisation is a pair $(X,d_X)$ as before, but in addition we ask~$X$ to be a $\nZ$-graded module and~$d_X$ to be homogeneous of degree~$c$. Morphisms of graded linear factorisations must have $\nZ$-degree zero. Our conventions for the graded Hom and tensor products follow \cite{kr0401268} and \cite[Section $2.1$]{ khovhompaper}.

In this bicategory the $1$-morphisms are given by homotopy categories
\[
\LG^{\mathrm{gr}}((R,W),(S,V)) = \hmf^{\mathrm{gr}}(R \otimes_k S, V - W)
\]
of finite-rank graded matrix factorisations, and together with the tensor product and the same structure maps $\alpha, \lambda, \rho$ this defines a bicategory \cite{cr0909.4381}. We make $\Delta_W$ into a graded matrix factorisation with the same differential, and the grading given by assigning $\theta_i$ the bidegree $|\theta_i| = (-1,|x_i| - c)$.
\end{remark}

\subsection{Bar complex}\label{subsec:Bar}

For a polynomial ring the standard resolutions of the diagonal are the Koszul and bar resolutions. Above we defined the unit $1$-morphisms in $\LG$ using a Koszul model for the diagonal, but in the study of adjoints it will quickly become necessary to use the bar model for the diagonal as well. For this reason we recall in this section the necessary background on noncommutative forms and the bar complex from \cite{Loday, cuntzquillen}. We explain how to use the bar complex to construct a second model for the diagonal, and construct a map $\Psi$ which relates the Koszul and bar models.

For the moment $R$ is an arbitrary ring. \textsl{Noncommutative $n$-forms over~$R$} are elements in 
$$
\Omega^n R = R\otimes \bar R^{\otimes n} 
$$
where $\bar R = R/k$ and in this section by ``$\otimes$'' we mean ``$\otimes_k$''. We denote the projection of $a_0\otimes a_1 \otimes \ldots \otimes a_n \in R^{\otimes (n+1)}$ to $\Omega^n R$ as $(a_0,a_1,\ldots,a_n)$. The direct sum 
$$
\Omega R = \bigoplus_{n\geq 0} \Omega^n R
$$
is a differential graded algebra $(\Omega R, d, \cdot)$ with multiplication given by
$$
(a_0,\ldots,a_m) \cdot (a_{m+1},\ldots, a_{m+n}) = \sum_{i=0}^m (-1)^{m-i}(a_0,\ldots,a_{i-1},a_i a_{i+1},a_{i+2},\ldots, a_{m+n}) 
$$
and differential
$$
d: (a_0,\ldots,a_n) \lmt (1,a_0,\ldots,a_n)
$$
where $a_i\in R$. We will write $(a_0,a_1,\ldots,a_n)$ also as $a_0da_1\ldots da_n$. 

More generally one can consider relative noncommutative forms: for a subalgebra $B\subset R$ they are elements in $\Omega_B R = \bigoplus_{n\geq 0} R\otimes_B (R/B)^{\otimes_B n}$, which has a differential graded structure analogous to $\Omega R = \Omega_k R$. We refer to the book~\cite{Loday} for further details. 

A central role is played by the \textsl{(normalised) bar complex} 
\be\label{BarComplex}
\Bar = \bigoplus_{n\geq 0} \Bar_n \, , \qquad \Bar_n = \Omega^n R \otimes R \, .
\ee
It is an $(R \otimes R^{\text{op}})$-module via $(a\otimes a').(a_0da_1\ldots da_n\otimes a_{n+1}) = aa_0da_1\ldots da_n\otimes a_{n+1}a'$. Together with the differential $d\otimes 1_R$ (which by standard abuse of notation we usually simply write~$d$) and the product induced from $\Omega R$ and~$R$, the bar complex~$\Bar$ is a differential graded algebra $(\Bar,d,\cdot)$. While $d$ is right $R$-linear, we will also make use of the left $R$-linear operator $s$ on $\Bar$ defined by
% for the operator s see coevc3
\be\label{eq:definition_s}
s( a_0 da_1 \ldots da_n \otimes a_{n+1} ) = (-1)^{n+1} a_0 da_1 \ldots da_n da_{n+1}\,.
\ee 

There is a second differential graded structure on~$\Bar$ if the algebra~$R$ is commutative. To describe it let us first recall that (still for arbitrary~$R$) the bar complex is the standard resolution 
$$
\xymatrix{%
\cdots \ar[r]^-{b'} & R \otimes \bar R^{\otimes 2} \otimes R \ar[r]^-{b'} & R \otimes \bar R \otimes R \ar[r]^-{b'} & R\otimes R \ar[r]^-{b'} & R \ar[r] & 0
}%
$$
of~$R$, where the degree-lowering differential~$b'$ is the $R$-bilinear map
$$
(a_0,\ldots,a_n)\otimes a_{n+1} \lmt \sum_{i=0}^{n-1} (-1)^i (a_0,\ldots,a_i a_{i+1},\ldots, a_n) \otimes a_{n+1} + (-1)^n (a_0,\ldots,a_{n-1}) \otimes a_n a_{n+1} \, . 
$$
%Equivalently, in differential form notation~$b'$ acts as
%$$
%b': da_0\ldots da_n\otimes a_{n+1} \lmt (-1)^{n-1} a_0da_1\ldots da_{n-1} \cdot a_n \otimes a_{n+1} + (-1)^n a_0 da_1\ldots da_{n-1} \otimes a_n a_{n+1} \, . 
%$$
From this it is straightforward to check that we have the identities
\be\label{b'd+db'} 
b'd+db'=1_{\Bar} \, , \qquad b' s + s b' = 1_{\Bar}\,.
\ee

Henceforth we assume that~$R$ is commutative. Recall that $(m,n)$-shuffles are permutations in
$$
\operatorname{Sh}(m,n) = \big\{ \sigma\in S_{m+n} \,|\, \sigma(1)<\sigma(2)<\ldots<\sigma(m), \, \sigma(m+1)<\sigma(m+2)<\ldots<\sigma(m+n) \big\} \, . 
$$
We use them to define the $R$-bilinear \textsl{shuffle product}~$\times$ on~$\Bar$ as
\begin{align*}
& (a_0da_1\ldots da_m \otimes a_{m+1}) \times (b_0db_1\ldots db_n \otimes b_{n+1}) \\
& \qquad 
= \sum_{\sigma \in \operatorname{Sh}(m,n)} (-1)^{|\sigma|} a_0 b_0 \, \sigma_\bullet (da_1\ldots da_m db_1 \ldots db_n) \otimes a_{m+1} b_{n+1}
\end{align*}
where $\sigma_\bullet(da_1\ldots da_j) = da_{\sigma^{-1}(1)}\ldots da_{\sigma^{-1}(j)}$. One finds that $(\Bar,b',\times)$ is a graded-commutative differential graded algebra. Note that for $\omega\in R\otimes R=\Bar_0$ it follows immediately that $\omega\times(-) = \omega\cdot(-)$. 

We now return to the $k$-algebra $R=k[x_1,\ldots,x_n]$. Earlier we set $\widetilde W = W\otimes 1 - 1\otimes W \in \Re$ for a potential $W\in R$, in terms of which we now define the bar complex endomorphism
$$
d_{\Bar} = b' + d\widetilde W \times (-) \, . 
$$

\begin{lemma}\label{lemma:barisafactorisation}
$(\Bar,d_{\Bar})$ is a linear factorisation of $\widetilde W\in \Re$. 
\end{lemma}

\begin{proof}
The bar complex $\Bar=\Bar^0 \oplus \Bar^1$ is $\nZ_2$-graded with $\Bar^i = \bigoplus_{n\in 2\nN+i}\Bar_n$. Since~$b'$ and~$\times$ are both $R$-bilinear, $d_{\Bar}$ is indeed $\Re$-linear. Furthermore, we have $b'^2=0$ and $d\widetilde W \times d\widetilde W = (dW\otimes 1) \times (dW\otimes 1) = dWdW\otimes 1 - dWdW \otimes 1 = 0$, so that for $\omega\in\Bar$ we find 
\begin{align*}
d_{\Bar}^2 (\omega) & = b'(d\widetilde W \times \omega) + d\widetilde W \times b'(\omega) \\
& = b'(d\widetilde W) \times \omega - d\widetilde W \times b'(\omega) + d\widetilde W \times b'(\omega) \\
& = \widetilde W \times \omega \\
& = \widetilde W \cdot \omega
\end{align*}
where in the second last step we used~\eqref{b'd+db'} together with $b'(\widetilde W)=0$. 
\end{proof}

If we use~$\pi$ also to denote the projection $\Bar\lra \Bar_0 = \Re$ composed with multiplication $\Re \lra R$, then $\pi \otimes 1_X : \Bar \otimes X \lra X$ and $1_X \otimes \pi: X \otimes \Bar \lra X$ give left and right actions of~$\Bar$ as in~\eqref{lambdarho}. These maps have homotopy inverses too and we will construct them in Section~\ref{section:pertandhtpy}. For the moment we take the fact that~$\Bar$ is another model for the unit action on matrix factorisations as motivation to discuss its relation to the Koszul matrix factorisation~$\Delta_W$. 

Before we do this on the level of linear factorisations we consider the case of $\nZ $-graded complexes. We write $\Delta = \bigwedge( \bigoplus_{i=1}^n \Re \theta_i)$ and observe that $(\Delta, \delta_-)$ is the ordinary Koszul complex, see~\eqref{DeltaW}. 

There are two $\Re$-linear maps between~$\Bar$ and~$\Delta$ which will be important to us: 
\begin{align}
\Phi & : \Delta \lra \Bar \, , \qquad \theta_{i_1}\ldots \theta_{i_p} \lmt \sum_{\sigma\in S_p} (-1)^{|\sigma|} dx_{i_{\sigma(1)}} \ldots dx_{i_{\sigma(p)}} \otimes 1 \, , \label{intro_phi}\\
\Psi & : \Bar \lra \Delta \, , \qquad df_1\ldots df_p \otimes 1 \lmt \sum_{1\leq i_1<\ldots<i_p\leq n} \Big( \prod_{k=1}^p \partial_{[i_k]} f_k \Big) \, \theta_{i_1} \ldots \theta_{i_p} \, \label{intro_psi}.
\end{align}
These maps were studied in~\cite{sw0911.0917}, we only rephrase the presentation of~$\Psi$ in terms of the difference quotient operators~$\partial_{[i]}$ suitable for our setting. One easily verifies that $\Psi\Phi = 1_\Delta$.

\begin{lemma}\label{PhiPsiDG}
Both~$\Phi$ and~$\Psi$ are maps of differential graded algebras between $(\Delta, \delta_-, \wedge)$ and $(\Bar, b', \times)$. 
\end{lemma}

\begin{proof}
We refer to~\cite{sw0911.0917} for the case of~$\Phi$; since our expression for~$\Psi$ is not manifestly the same as in loc.~cit.~we spell out the proof. Let us first show that~$\Psi$ is compatible with the differentials. On the one hand we compute $(\delta_- \Psi) (df_1\ldots df_p \otimes 1)$ to be 
\begin{align}
& \delta_ -\Big( \sum_{i_1<\ldots <i_p} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_p]} f_p) \, \theta_{i_1} \ldots \theta_{i_p} \Big) \nonumber \\
& =  \sum_{i_1<\ldots <i_p} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_p]} f_p) \cdot (x_{i_k} - x'_{i_k}) \sum_{k=1}^p (-1)^{k+1} \theta_{i_1} \ldots \widehat{\theta_{i_k}} \ldots \theta_{i_p}  \nonumber \\
& = \sum_{k=1}^p (-1)^{k+1}\sum_{i_1<\ldots <i_p} (\partial_{[i_1]} f_1) \ldots ({}^{t_1\ldots t_{i_{k-1}}} f_k - {}^{t_1\ldots t_{i_{k}}} f_k) \ldots (\partial_{[i_p]} f_p) \, \theta_{i_1} \ldots \widehat{\theta_{i_k}} \ldots \theta_{i_p}  \nonumber \\
& = \sum_{2\leq i_2<\ldots< i_p} (f_1 - {}^{t_1\ldots t_{i_{2}-1}} f_1) (\partial_{[i_2]} f_2) \ldots (\partial_{[i_p]} f_p) \, \theta_{i_2} \ldots \theta_{i_p} \nonumber \\
& \qquad + \sum_{k=2}^{p-1} (-1)^{k+1}\sum_{i_1 < \ldots <i_p} (\partial_{[i_1]} f_1) \ldots ({}^{t_1\ldots t_{i_{k-1}}} f_k - {}^{t_1 \ldots t_{i_{k+1}-1}} f_k) \ldots (\partial_{[i_p]} f_p) \, \theta_{i_1} \ldots \widehat{\theta_{i_k}} \ldots \theta_{i_p}  \nonumber \\
& \qquad + (-1)^{p+1} \sum_{i_1<\ldots< i_{p-1}\leq n-1} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_{p-1}]} f_{p-1}) ({}^{t_1\ldots t_{i_{p-1}}} f_p - {}^{t_1\ldots t_n} f_p)  \, \theta_{i_1} \ldots \theta_{i_{p-1}} \nonumber \\
& = \sum_{2\leq t_2<\ldots <i_p} f_1 (\partial_{[i_2]} f_2) \ldots (\partial_{[i_p]} f_p) \, \theta_{i_2} \ldots \theta_{i_p} \nonumber \\
& \qquad + (-1)^{p} \sum_{i_1<\ldots< i_{p-1}\leq n-1} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_{p-1}]} f_{p-1}) \, {}^{t_1\ldots t_n} f_p  \, \theta_{i_1} \ldots \theta_{i_{p-1}}  \label{delPsi} 
\end{align}
while on the other hand $(\Psi b') (df_1\ldots df_p \otimes 1)$ equals
\begin{align*}
& \Psi \Big( f_1 df_2 \ldots df_p \otimes 1 + \sum_{k=1}^{p-1} (-1)^k df_1 \ldots d(f_k f_{k+1}) \ldots df_p \otimes 1 + (-1)^p df_1 \ldots df_{p-1} \otimes f_p \Big) \\
& = \sum_{i_1<\ldots< i_{p-1}} f_1 (\partial_{[i_1]} f_2) \ldots (\partial_{[i_{p-1}]} f_p) \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\
& \qquad + \sum_{k=1}^{p-1} (-1)^k \sum_{i_1<\ldots< i_{p-1}} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_k]} (f_k f_{k+1}) )\ldots (\partial_{[i_{p-1}]} f_p) \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\
& \qquad + (-1)^p \sum_{i_1<\ldots< i_{p-1}} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_{p-1}]} f_{p-1}) \, {}^{t_1\ldots t_n} f_p \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\
& = \sum_{2\leq i_1<\ldots< i_{p-1}} f_1 (\partial_{[i_1]} f_2) \ldots (\partial_{[i_{p-1}]} f_p) \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\ 
& \qquad + \sum_{2\leq i_2 \ldots< i_{p-1}} f_1 (\partial_{[1]} f_2) (\partial_{[i_2]} f_3) \ldots (\partial_{[i_{p-1}]} f_p) \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\ 
& \qquad + \sum_{k=1}^{p-1} (-1)^k \sum_{i_1<\ldots< i_{p-1}} (\partial_{[i_1]} f_1) \ldots \big\{ ({}^{t_1\ldots t_{i_k -1}}f_k)(\partial_{[i_k]} f_{k+1}) \\
& \qquad\quad + (\partial_{[i_k]} f_k) ({}^{t_1\ldots t_{i_k}} f_{k+1}) \big\} \ldots (\partial_{[i_{p-1}]} f_p) \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\
& \qquad + (-1)^p \sum_{i_1<\ldots< i_{p-1}\leq n-1} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_{p-1}]} f_{p-1}) \, {}^{t_1\ldots t_n} f_p \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\
& \qquad\quad + (-1)^p \sum_{i_1<\ldots< i_{p-2}\leq n-1} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_{p-1}]} f_{p-1}) \, {}^{t_1\ldots t_n} f_p \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\
& = \sum_{2\leq i_1<\ldots< i_{p-1}} f_1 (\partial_{[i_1]} f_2) \ldots (\partial_{[i_{p-1}]} f_p) \, \theta_{i_1} \ldots \theta_{i_{p-1}} \\ 
& \qquad + (-1)^p \sum_{i_1<\ldots< i_{p-1}\leq n-1} (\partial_{[i_1]} f_1) \ldots (\partial_{[i_{p-1}]} f_{p-1}) \, {}^{t_1\ldots t_n} f_p \, \theta_{i_1} \ldots \theta_{i_{p-1}} 
\end{align*}
which agrees with~\eqref{delPsi}. 

To establish compatibility with the products we compute 
\begin{align*}
& \Psi( df_1\ldots df_p \otimes 1) \wedge \Psi( df_{p+1}\ldots df_{p+q} \otimes 1) \\ 
=\, & \Big\{ \sum_{i_1<\ldots< i_p} \Big( \prod_{k=1}^p \partial_{[i_k]} f_k \Big) \theta_{i_1} \ldots \theta_{i_p}\Big\} 
\wedge 
\Big\{ \sum_{i_{p+1}<\ldots< i_{p+q}} \Big( \prod_{k=p+1}^{p+q} \partial_{[i_k]} f_k \Big) \theta_{i_{p+1}} \ldots \theta_{i_{p+q}} \Big\} \\
= \, & \sum_{i_1<\ldots< i_p} \sum_{i_{p+1}<\ldots< i_{p+q}} \Big( \prod_{k=1}^{p+q} \partial_{[i_k]} f_k \Big) \theta_{i_{1}} \ldots \theta_{i_{p+q}} \\
= \, & \sum_{i_1<\ldots< i_{p+q}} \sum_{\sigma\in\operatorname{Sh}(p,q)} (-1)^{|\sigma|} \Big( \prod_{k=1}^{p+q} \partial_{[i_{\sigma(k)}]} f_k \Big) \theta_{i_{1}} \ldots \theta_{i_{p+q}} \\
= \, & \Psi \big((df_1\ldots df_p \otimes 1) \times( df_{p+1}\ldots df_{p+q} \otimes 1) \big)
\end{align*}
where in the third step the anti-commutativity of the~$\theta_i$ allowed us to sum over the longer sequences $i_1<\ldots< i_{p+q}$ by introducing an additional sum over shuffles. 
\end{proof}

We will also need the following identity.

\begin{lemma}\label{lem:PsiToTheRight}
Let $\omega\in\Omega^n R$ and $f \in R$ be given. Then $\Psi(\omega \cdot (f \otimes 1))=\Psi(\omega) \cdot (1 \otimes f)$. 
\end{lemma}

\begin{proof}
We may assume that $\omega$ is of the form $da_1\ldots da_n$ for some $a_i\in R$. Then
\begin{align*}
\Psi(\omega f) & = \Psi \Big( \sum_{i=1}^n (-1)^{n-i} da_1\ldots da_{i-1} d(a_i a_{i+1}) da_{i+2}\ldots da_n df + (-1)^n a_1 da_2\ldots da_n df \Big) \\
& = \sum_{i=1}^n (-1)^{n-i} \partial_{[1]} a_1\ldots \partial_{[i-1]} a_{i-1} \partial_{[i]} (a_i a_{i+1}) \partial_{[i+1]} a_{i+2} \ldots \partial_{[n-1]} a_n \partial_{[n]} f \\
& \qquad + (-1)^n a_1 \partial_{[1]} a_2 \ldots \partial_{[n-1]} a_n \partial_{[n]} f \\
& = \sum_{i=1}^n (-1)^{n-i} \partial_{[1]} a_1\ldots \partial_{[i-1]} a_{i-1} \Big(\partial_{[i]} a_i {}	^{t_1\ldots t_i}a_{i+1} + {}^{t_1\ldots t_{i-1}} a_i \partial_{[i]} a_{i+1} \Big) \\
& \qquad \cdot  \partial_{[i+1]} a_{i+2} \ldots \partial_{[n-1]} a_n \partial_{[n]} f + (-1)^n a_1 \partial_{[1]} a_2 \ldots \partial_{[n-1]} a_n \partial_{[n]} f \\
& = \partial_{[1]} a_1 \ldots \partial_{[n]} a_n (1 \otimes f) \\
& = \Psi(\omega) (1 \otimes f) \, ,
\end{align*}
where we used Lemma~\ref{lem:LeibnizForDQO} in the third step. 
\end{proof}

Using the ordering of the ring variables to order the $\theta$'s, we obtain an $\Re$-linear map 
\be\label{eq:vareps}
\varepsilon: \Delta \lra \Re[n] 
\, , \qquad 
\theta_1\ldots \theta_n \lmt 1
\ee
that is non-zero only on elements in top $\theta$-degree.

On a practical level both the bar and Koszul complexes resolve the diagonal, so there must be a chain map lifting the identity on the diagonal, and $\Psi$ gives one particular example of such a chain map. For the reader looking for more conceptual insight, we mention that in our constructions the map $\Psi$ will almost always appear as part of the composite $\varepsilon \Psi: \Bar \lto \Re[n]$. This composite has a natural interpretation in Hochschild cohomology as a product of $n$ Hochschild cocycles associated to derivations; we explain this perspective in Appendix \ref{appendix:mapeppsi}.

Now we come back to consider any $W\in R$. The map~$\Psi$ continues to be a good map on the level of linear factorisations: 
\begin{lemma}\label{PsiHF}
$\Psi: (\Bar, d_\Bar) \lra (\Delta_W, d_{\Delta_W})$ is a morphism in $\HF(\Re,\widetilde W)$. 
\end{lemma}

\begin{proof}
We need to show $d_{\Delta_W} \Psi = \Psi d_\Bar$. But since $d_{\Delta_W} = \delta_+ + \delta_-$ and $d_\Bar = b' + d\widetilde W \times (-)$ by Lemma~\eqref{PhiPsiDG} what remains to be checked is $\delta_+ \Psi = \Psi (d\widetilde W\times (-))$. This can be done: 
\be\label{eq:deltaplusandpsi}
\delta_+ \Psi = \Big( \sum_{i=1}^n \partial_{[i]} W \cdot \theta_i^* \Big) \wedge \Psi(-) = \Psi(dW\otimes 1) \wedge \Psi(-) = \Psi (d\widetilde W\times (-)) \, . 
\ee
\end{proof}

Although $(\Bar, d_{\Bar})$ depends only on the pair $(R,W)$, the matrix factorisation $(\Delta_W, d_{\Delta_W})$ depends in addition on an ordering of the ring variables. The compatibility of $\delta_{+}$ and $\Psi$ in \eqref{eq:deltaplusandpsi} depends on the fact that $\Delta_W$ and $\Psi$ are defined using the \textsl{same} ordering.

\begin{remark}\label{remark:gradedbarmf} Suppose that $R$ is graded with $|x_i| \ge 0$ and that $W$ is homogeneous of degree $2c$. We make $\Bar$ into a graded $\Re$ module with $\Bar_n = R \otimes \bar{R}(c)^{\otimes n} \otimes R$ so that $d$ has polynomial degree $-c$, and $b'$ has degree $c$. Then $(\Bar, d_{\Bar})$ is a graded matrix factorisation of $\widetilde W$ and $\Psi$ is a degree zero morphism of graded matrix factorisations.
\end{remark}

\subsection{Residues}\label{section:residuebackground}

Residues feature prominently in the Kapustin-Li pairing and the evaluation maps, so we briefly recall their definition and basic property; see~\cite{Lipman84, Lipman} for more details. 

Given a regular sequence $(f_1,\ldots,f_n)$ in $k[x,y]$ the residue is the $k[y]$-linear map that sends a polynomial $g\in k[x,y]$ to the expression
$$
\Res_{k[x,y]/k[y]} \left[ \frac{g \, \underline{\operatorname{d}\! x}}{f_1, \ldots, f_n} \right] 
\in k[y]
$$
where $\underline{\operatorname{d}\!x}=\operatorname{d}\!x_1\ldots \operatorname{d}\!x_n$. In practice the residue is computed by the transformation rule
$$
\Res_{k[x,y]/k[y]} \left[ \frac{g \, \underline{\operatorname{d}\! x}}{f_1, \ldots, f_n} \right] 
= 
\Res_{k[x,y]/k[y]} \left[ \frac{\det(C) g \, \underline{\operatorname{d}\! x}}{f'_1, \ldots, f'_n} \right] 
, \qquad
f'_i = \sum_{j=1}^n C_{ij} f_j 
\, , \qquad
C_{ij} \in k[x,y] \, ,
$$
together with the defining property $\Res_{k[x,y]/k[y]} \left[ \underline{\operatorname{d}\! x}/(x_1^{a_1} ,\ldots, x_n^{a_n}) \right] = \delta_{a_1,1}\ldots \delta_{a_n,1}$. Note that the order of the elements of the regular sequence in the denominator plays a role; changing that order produces a permutation sign. There are various intrinsic ways of defining residues which make sense in very general contexts, not just for polynomials; using e.\,g.~Hochschild homology \cite{Lipman}.

In the next result we use the divided difference operators of \eqref{diffquotop}.

\begin{proposition}\label{prop:determinantresidue} 
The element $\delta = \det( (\partial_{[i]} f_j)_{i,j} )$ in $k[x,x']$ has the property that for any $g \in k[x]$
\be\label{eq:integrateagainstd}
\Res_{k[x,x']/k[x']} \left[ \frac{g \delta \,  \underline{\operatorname{d}\! x}}{f_1, \ldots, f_n} \right] = g(x')
\ee
as an element of the algebra $k[x']/(f_1(x'),\ldots,f_n(x'))$.
\end{proposition}
% see rfper3
\begin{proof}
As far as we know the first proof for $k$ a field is contained in \cite{pv1002.2116}, and the proof given there should generalise to the present setting. A related result appears in the Appendix to a paper of Mazur and Roberts, who attribute the argument to Tate \cite[Theorem A$.3$]{mazur}. They show that there is an isomorphism of $k[x]$-modules between $J = k[x]/(f_1,\ldots,f_n)$ and $\Hom_k(J,k)$ sending the identity to a functional which has a property analogous to \eqref{eq:integrateagainstd}. 

If one knew \textsl{a priori} that this functional was the residue map, this would prove \eqref{eq:integrateagainstd}, but we do not know a reference for this fact. In any case, we give a proof in the forthcoming \cite{meres}, which in particular proves \eqref{eq:integrateagainstd} for any noetherian $\nQ$-algebra $k$.
\end{proof}

\subsection{Perturbation}

A crucial role will be played by the homological perturbation lemma, which we will use to promote homotopy equivalences of complexes (arising from the bar and Koszul resolutions of the diagonal) to homotopy equivalences of associated matrix factorisations. More importantly, the perturbation lemma will provide explicit homotopy inverses in terms of Atiyah classes.

Let $R$ be a ring and $W \in R$. An $R$-linear \textsl{deformation retract datum} is a diagram
\begin{equation}\label{eq:perturbeddiagr1}
\xymatrix@C+2pc{
(X,d_X) \ar@<-1ex>[r]_-{\sigma} & (Y,d_Y) \ar@<-1ex>[l]_-{\pi}
}%
\!\!\!\xymatrix{%
{}\ar@(ur,dr)[]^{h}
}%
\end{equation}
in which $(X,d_X)$ and $(Y,d_Y)$ are linear factorisations of $W$, $\pi, \sigma$ are morphisms of linear factorisations and $h: Y \lto Y$ is a degree one $R$-linear map such that
$$
\pi \sigma = 1 \, , \qquad
\sigma \pi = 1 + d_Yh + hd_Y \, .
$$
A degree one morphism $\delta: Y \lto Y$ is a \textsl{small perturbation} of the deformation retract datum if $1_Y - \delta h$ is an isomorphism of $R$-modules. In this case we define
\[
\tau = (1- \delta h)^{-1} \delta
\]
and consider the new ``perturbed'' diagram
\begin{equation}\label{eq:perturbeddiagr}
\xymatrix@C+2pc{
(X,d_{X,\infty}) \ar@<-1ex>[r]_-{\sigma_\infty} & (Y,d_Y+\delta) \ar@<-1ex>[l]_-{\pi_\infty}
}%
\!\!\!\xymatrix{%
{}\ar@(ur,dr)[]^{h_\infty}
}%
\end{equation}
where
\begin{align*}
\sigma_\infty &= \sigma + h\tau\sigma \,, & h_\infty &= h + h \tau h\,,\\
\pi_\infty &= \pi + \pi \tau h \, , & d_{X,\infty} &= d_X + \pi \tau \sigma\,.
\end{align*}

\begin{proposition}\label{prop:pertlemma} Suppose that $h \sigma = 0, \pi h = 0$ and $h^2 = 0$. If $\delta$ is a small perturbation of (\ref{eq:perturbeddiagr1}) such that $(d_Y + \delta)^2 = W' \cdot 1_M$ for some $W' \in R$ then (\ref{eq:perturbeddiagr}) is a deformation retract datum of linear factorisations of $W'$ over $R$.
\end{proposition}
\begin{proof}
This follows straightforwardly from the standard results in~\cite{c0403266}. 
\end{proof}

In the cases of interest to us the sum $\sum_{m \ge 0} (\delta h)^m$ converges, so that $\tau = \sum_{m \ge 0} (\delta h)^m \delta$ and
\[
\sigma_\infty = \sigma + \sum_{m \ge 0} h(\delta h)^m \delta \sigma = \sum_{m \ge 0} (h \delta)^m \sigma\,.
\]

\subsection{Canonical morphisms}\label{section:canonicalmaps}
% see NMF and NMF2

In this section~$R$ is a ring and~$X$ and~$Y$ denote linear factorisations of~$W$ and~$V$ over $R$, respectively. There is a natural morphism of linear factorisations of $V - W$, 
\be
\xi: X^{\vee} \otimes_R Y \lto \Hom_R(X,Y)\, , \qquad
\xi( \nu \otimes y )(x) = (-1)^{|\nu||y|} \nu(x) \cdot y \, ,
\ee
which is an isomorphism if~$X$ is a finitely generated projective $R$-module.

There is a natural isomorphism of linear factorisations of $W + V$, 
\be
\textup{swap}: X \otimes_R Y \lto Y \otimes_R X\,, \qquad
x \otimes y \lmt (-1)^{|x||y|} y \otimes x\,.
\ee
Precomposing~$\xi$ with this swap isomorphism we have a canonical morphism
\be\label{eq:iso_tensorhom2}
Y \otimes_R X^{\vee} \lto \Hom_R(X,Y)\,, \qquad
y \otimes \nu \lmt \big\{ x \lmt \nu(x) \cdot y \big\}\,.
\ee
Since it is unlikely to cause confusion, we also denote this map by $\xi$.

There are natural isomorphisms of linear factorisations of $W + V$, 
\begin{align}
X[i] \otimes_R Y &\lto (X \otimes_R Y)[i]\,, \qquad
x \otimes y \lmt x \otimes y\,,\\
X \otimes_R Y[i] &\lto (X \otimes _R Y)[i]\,,\qquad 
x \otimes y \lmt (-1)^{i|x|} x \otimes y\,.
\end{align}

\section{Atiyah classes}\label{section:atiyahclasses}
% see assat, the onct series

As mentioned in the Introduction, the structure of the bicategory $\LG$ can be understood in terms of associative Atiyah classes. In this section we develop the basic theory of these operators, beginning with the simplest definition (which involves a choice of basis) and then afterwards developing the more abstract general theory in the setting of noncommutative form-valued connections. For this paper the simpler definition is sufficient, since we will only use the Atiyah class to construct explicit chain level representatives of morphisms which we already know to be well-defined up to homotopy, and in this situation it is natural to make some auxiliary choices. In any case, we develop the general theory in order to have a more solid foundation for the subject of associative Atiyah classes.

Let $k$ be a ring, $R$ a $k$-algebra, and set $\Re = R_1 \otimes_k R_2$ where $R_i = R$ for $i \in \{1,2\}$. We define  the operators $s,d$ on the bar complex~$\Bar$ as in Section \ref{subsec:Bar} and recall that $\Bar$ is equipped with an $\Re $-bimodule structure by left and right multiplication. Let $(X,D)$ be a pair consisting of a $\nZ _2$-graded free $\Re $-module $X$ and an odd $\Re $-linear operator $D$ on $X$ (for the moment we do not require any condition on $D^2$). By default $\otimes$ means $\otimes_{\Re }$ in this section.

Given a homogeneous basis $\{ e_i \}_{i}$ for~$X$ we can extend~$d$ and~$s$ to operators
\begin{align}
d&: X \otimes \Bar \lto X \otimes \Bar, &\qquad d( e_i \otimes \omega ) = (-1)^{|e_i|} e_i \otimes d \omega\,, \label{eq:extendd}\\
s&: X \otimes \Bar \lto X \otimes \Bar, &\qquad s( e_i \otimes \omega ) = (-1)^{|e_i|} e_i \otimes s \omega\,. \label{eq:extends}
\end{align}
So for example $d( a e_i \otimes \omega ) = (-1)^{|e_i|} e_i \otimes d( a \omega )$ for $a \in \Re $. 

\begin{definition}\label{defn:atiyahclassbasis}
The \textsl{associative Atiyah classes} of $(X,D)$ are operators on $X \otimes \Bar$ defined by
\begin{align*}
\At_{2}(X) &= [d, D] = d D + D d\,,\\
\At_{1}(X) &= [s, D] = s D + D s\,.
\end{align*}
Here we use the notation of graded commutators: for homogeneous operators $F_1, F_2$
\[
[F_1,F_2] = F_1 F_2 - (-1)^{|F_1||F_2|} F_2 F_1\,.
\]
\end{definition}

One checks that for $\omega \in \Bar$
\be\label{eq:at2nopower}
\At_{2}(X)( e_i \otimes \omega ) = \sum_j (-1)^{|e_j|} e_j \otimes d( D_{ji} ) \omega\,,
\ee
and more generally for $l \ge 1$,
\be
\At_{2}(X)^l( e_i \otimes \omega ) = (-1)^{l|e_i| + \binom{l+1}{2}} \sum_{j_1,\ldots,j_l} e_{j_l} \otimes d( D_{j_l j_{l-1}} ) \ldots d(D_{j_2 j_1})d( D_{j_1 i} ) \omega\, . \label{eq:powerofatiyah}
\ee
% for signs see for example shati
There are slightly more complicated formulas for $\At_1$, but since this Atiyah class is less important for us than $\At_2$ we leave the details to Remark \ref{remark:at2formulas} below. We call these \textsl{associative} Atiyah classes to distinguish them from the more standard Atiyah classes defined using commutative differential forms, but since the latter do not appear in this paper (with the exception of Section~\ref{section:dualityadjointop}) we will omit the qualifier ``associative''. Without conditions on $D^2$ there is no interpretation of $\At_1$ and $\At_{2}$ as a cohomology class, so we should perhaps refer to Atiyah \textsl{operators}, but we persist with the above terminology.

To discuss the linearity we need to be clear that $X \otimes \Bar$ is made into a right $\Re $-module via the right action of $\Re $ on $\Bar$ by multiplication. It is then apparent from \eqref{eq:at2nopower} that $\At_{2}(X)$ is right $\Re $-linear. The subscripts on the Atiyah classes arise because we think of $d$ (resp.~$s$) as differentiating in the $R_1$-directions (resp.~$R_2$-directions).

\begin{remark}\label{remark:linearatother} 
Suppose that $S$ is a $k$-algebra and $X$ a $\nZ _2$-graded free $(S \otimes_k \Re)$-module with $(S \otimes_k \Re)$-linear odd operator $D$. If we choose a homogeneous $(S \otimes_k \Re)$-basis for~$X$ and extend $d,s$ to $S$-linear operators on $X \otimes \Bar$ via \eqref{eq:extendd}, \eqref{eq:extends} then $\At_2(X) = [d, D]$ and $\At_1(X) = [s, D]$ define operators on $X \otimes \Bar$, and all our remarks apply equally well to this kind of Atiyah class.

Similarly if instead $X$ is a $\nZ _2$-graded free $(S \otimes_k R)$-module with $(S \otimes_k R)$-linear odd operator $D$ and we choose a homogeneous basis for $X$ and extend $d,s$ to $S$-linear operators on $X \otimes_R \Bar$ then $\At_2(X) = [d, D]$ and $\At_1(X) = [s,D]$ are operators on $X \otimes_R \Bar = (X \otimes_R \Re) \otimes \Bar$ which agree with the Atiyah classes of the $(S \otimes_k \Re)$-module $X \otimes_R \Re$.
\end{remark}

There are two more variants of the Atiyah class that differ from the above only in the way in which we order the noncommutative differential forms. We can extend $s,d$ to operators on $\Bar \otimes X$ (using the right $\Re $-multiplication on $\Bar$ to form the tensor product) as above, but now without Koszul signs, and define operators on this tensor product by $\lAt_{2}(X) = [d, D]$ and $\lAt_{1}(X) = [s,D]$. 
The difference from the other Atiyah classes appears when we exponentiate: 
\begin{equation}\label{eq:leftatiyahexp}
\lAt_{2}(X)^l( \omega \otimes e_i ) = \sum_{j_1,\ldots,j_l} \omega d( D_{j_1 i} ) d(D_{j_2 j_1}) \ldots d(D_{j_l j_{l-1}}) \otimes e_{j_l}\,.
\end{equation}
From this it is clear that $\lAt_{2}$ is left $\Re $-linear, using the action of left multiplication on $\Bar \otimes X$.

In addition to these four distinct kinds of Atiyah classes, we will sometimes need purely cosmetic variants where we switch the order of elements of $X$ and $\Bar$ in the tensors. This creates an awkward situation with the notation, since we want elements of $\Re $ traversing the tensor product to act on the same side of $\Bar$ as before. To indicate this is we use the map
\begin{equation}\label{eq:attau}
\reprod: \Re  \otimes_k \Re  \lto \Re  \otimes_k \Re , \qquad \reprod ( a \otimes a' ) = aa' \otimes 1
\end{equation}
so that in $\reprod_*( \Bar ) \otimes X$ we have $\omega \otimes a x$ = $a \omega \otimes x$. If we understand $d$ and $s$ to be extended to operators on $\reprod_*( \Bar ) \otimes X$ as before, then we define operators on this tensor product by $\Atlarrow_{2}(X) = [ d, D ]$ and $\Atlarrow_{1}(X) = [s, D]$. There is for $u \in \{1,2\}$ a commutative diagram
\[
\xymatrix@C+2pc@R+1pc{
X \otimes \Bar \ar[d]_{\At_{u}(X)^l} \ar[r]^-{\cong} & \reprod_*( \Bar ) \otimes X \ar[d]^{\Atlarrow_{u}(X)^l}\\
X \otimes \Bar \ar[r]_-{\cong} & \reprod_*( \Bar ) \otimes X
}
\]
in which the rows are graded twist maps (with Koszul signs). For example,
\be
\Atlarrow_{2}(X)^l( \omega \otimes e_i ) = (-1)^{l|\omega| + \binom{l}{2}} \sum_{j_1,\ldots,j_l} d(D_{j_l j_{l-1}}) \ldots d(D_{j_2 j_1}) d(D_{j_1 i}) \omega \otimes e_{j_l}\,. \label{eq:atlarrow_formula}
\ee

\begin{remark}\label{remark:atofshift} Consider the pair $(X[1], -D)$, with the same homogeneous basis as $X$. Then $\At_u(X)$ and $\At_u(X[1])$ define the same operator on the underlying module $X \otimes \Bar$ for $u \in \{1,2\}$. On the other hand, as operators on $\gamma_*(\Bar) \otimes X$ we have $\Atlarrow_u(X[1]) = - \Atlarrow_u(X)$.
\end{remark}

\begin{remark}\label{remark:at2formulas} We will need an explicit formula for $\At_1$ only for noncommutative forms $\omega' \in \Bar$ of the type $\omega' = a_0 da_1 \ldots da_n \otimes 1$. In this case, writing $D_{ji} = \sum D_{ji}^{(1)} \otimes D_{ji}^{(2)} \in \Re$, we have
\be
\At_1(X)(e_i \otimes \omega' ) = \sum_j (-1)^{|e_j| + |\omega'| + 1} e_j \otimes D_{ji}^{(1)} \omega' d( D_{ji}^{(2)} )\,.
\ee
The additional sign compared to \eqref{eq:at2nopower} comes from the sign in the definition \eqref{eq:definition_s} of the operator~$s$. More generally for $l \ge 1$,
\be
\At_1(X)^l( e_i \otimes \omega' ) = (-1)^{l|e_i| + l|\omega'|} \sum_{j_1,\ldots,j_l} e_{j_l} \otimes D_{j_1 i}^{(1)} \ldots D_{j_lj_{l-1}}^{(1)} \omega' d(D_{j_1i}^{(2)}) \ldots d(D_{j_lj_{l-1}}^{(2)})\,.
\ee
We will also need % see shati2
\be
\Atlarrow_1(X)^l( \omega' \otimes e_i ) = (-1)^l \sum_{j_1,\ldots,j_l} D_{j_1 i}^{(1)} \ldots D_{j_lj_{l-1}}^{(1)} \omega' d(D_{j_1i}^{(2)}) \ldots d(D_{j_lj_{l-1}}^{(2)}) \otimes e_{j_l}\,.
\ee
\end{remark}

% \subsection{Calculus of Atiyah classes}\label{section:calculusatiyah}

With the above notation, let $(X,d_X)$ and $(Y,d_Y)$ be $\nZ _2$-graded free $\Re $-modules equipped with odd $\Re $-linear differentials (again, no condition on $d_X^2$ or $d_Y^2$) and respective homogeneous bases $\{ e_i \}_{i}$ and $\{ \by_j \}_{j}$. Giving $X \otimes Y$ the differential $d_{X \otimes Y} = d_X \otimes 1 + 1 \otimes d_Y$ and the basis $\{ e_i \otimes \by_j \}_{i,j}$ we have for $u \in \{1,2\}$ three operators
\begin{align*}
\At_u(X) &\in \End_k( X \otimes \Bar ) \, ,\\
\Atlarrow_u(Y) &\in \End_k( \reprod_*(\Bar) \otimes Y ) \, ,\\
\At_u(X \otimes Y) &\in \End_k( X \otimes Y \otimes \Bar )\,.
\end{align*}
An important property of the commutative Atiyah class is that the class of $X \otimes Y$ can be expressed in terms of the classes of $X$ and $Y$. The analogue for associative Atiyah classes involves the shuffle product, which we make into an $\Re $-linear operation
\begin{equation}\label{eq:shuffle_opat}
\xymatrix@C+2pc{
X \otimes \reprod_*(\Bar) \otimes \reprod_*(\Bar) \otimes Y \ar[r]^-{1 \otimes \times \otimes 1} & X \otimes \reprod_*(\Bar) \otimes Y \ar[r]^-{\cong} & X \otimes Y \otimes \Bar
}
\end{equation}
where the last map is the graded twist on the second two components. %The following lemma is sufficient for our purposes, but it would be desirable to have a natural, basis-free analogue.

\begin{lemma}\label{lemma:atshufat} 
For $l \ge 0$ and $u \in \{1,2\}$ we have
\begin{align}
\At_u(X \otimes Y)^l( e_i \otimes \by_j ) &= \sum_{p+q = l} \At_u(X)^p(e_i) \times \Atlarrow_u(Y)^q(\by_j)\label{eq:atshufat}
\end{align}
where on the right-hand side we use the operation \eqref{eq:shuffle_opat}. 
\end{lemma}
\begin{proof}
We have
\[
\At_2(X \otimes Y)(e_i \otimes \by_j) = \sum_{i_1} (-1)^{|e_{i_1}| + |\by_j|} e_{i_1} \otimes \by_j \otimes d( d_{X,i_1 i}) + \sum_{j_1} (-1)^{|\by_{j_1}|} e_i \otimes \by_{j_1} \otimes d( d_{Y, j_1 j} )\,.
\]
Iterating, we see that $\At_2(X \otimes Y)^l(e_i \otimes \by_j)$ is a sum over all indices of terms
\be\label{eq:proofofatiyahshuff}
e_{i_{l-p}} \otimes \by_{j_p} \otimes \sigma_\bullet( \underbrace{d(d_{X,i_{l-p}i_{l-p-1}}), \ldots, d(d_{X,i_1i})}_{l-p}, \underbrace{d(d_{Y,j_pj_{p-1}}), \ldots, d(d_{Y,j_1j})}_p )
\ee
where $\sigma$ is an $(l-p,p)$ shuffle and the sign that is attached to such a term is $(-1)^q$ where
\[
q = |e_{i_{l-p}}| + \ldots + |e_{i_1}| + |\by_{j_p}| + \ldots + |\by_{j_1}| + (l-p)|\by_{j_p}| + |\sigma|\,.
\]
But considering \eqref{eq:powerofatiyah} it is straightforward to check that the right-hand side of~\eqref{eq:atshufat} is a sum over the same collection of terms, and the signs match, so that \eqref{eq:atshufat} holds for $u = 2$. The situation for $\At_1$ is similar.
\end{proof}

%\begin{remark}\label{remark:twistshufat} If in \eqref{eq:shuffle_opat} instead of twisting $\Bar$ to the right we twisted it to the left, so that the operation terminated in $\gamma_*(\Bar) \otimes X \otimes Y$, then \eqref{eq:atshufat} would instead compute $\Atlarrow(X \otimes Y)^m( e_i \otimes \by_j )$.
%\end{remark}

\subsection{Connections}\label{section:connections}

It is better to construct the Atiyah class from a choice of connection rather than a choice of basis, and such is the purpose of this section. However as we have already explained, these remarks will not be needed in the sequel and are included only for the sake of completeness. For this reason we restrict ourselves to a discussion of only one of the many ``types'' of Atiyah class presented above. 
%, the modifications for the other cases being left to the reader.

Let $R$ be a ring, $A$ an $R$-algebra and $\Omega A = \Omega_R A$ the differential graded algebra $(\Omega A, d, \cdot)$ of noncommutative differential forms explained in Section \ref{subsec:Bar}. An $R$-linear \textsl{connection} on a $\nZ _2$-graded $A$-module $X$ is an $R$-linear map
\[
\nabla: X \lto X \otimes_A \Omega^1 A\,,
\]
which sends $X^i$ into $X^i \otimes_A \Omega^1 A$ and satisfies the graded Leibniz rule
\[
\nabla( x a ) = \nabla( x ) a + (-1)^{|x|} x da 
\]
for $x \in X$, $a \in A$. A connection extends uniquely to a degree one $R$-linear operator on $X \otimes_A \Omega A$, still denoted $\nabla$, with the property that for homogeneous $\xi \in X \otimes_A \Omega A$ and $\omega \in \Omega A$
\[
\nabla( \xi \omega ) = \nabla( \xi ) \omega + (-1)^{|\xi|} \xi d \omega\,.
\]
Notice left and right multiplication make $\Omega A$ into an $A$-bimodule, and so $X \otimes_A \Omega A$ is an $A$-bimodule. Using the Leibniz rule it is easy to check that for any odd $A$-linear operator $D$ on $X$ the operator $[\nabla, D]$ on $X \otimes_A \Omega A$ is right $A$-linear, and we call this the \textsl{Atiyah class} of the pair $(X,D)$.

If $D^2 = W \cdot 1_X$ for some $W \in R$ then $[\nabla, D]$ is a closed map, i.\,e.~it gives a cohomology class in $\Hom_R(X, X \otimes_R \Omega^1 R)$. By a standard argument this cohomology class is independent of the choice of connection on $X$.

\begin{remark} To relate this to the earlier construction let $k$ be a ring, $R$ a $k$-algebra and set $A = R^e$ in the above. Then as dg-algebras the bar complex of $R$ over $k$ is
\[
\Bar = \Omega R \otimes_k R \cong \Omega_{R_2}(R_1 \otimes_k R_2) = \Omega_{R_2}(R^e) \, .
\]
For the canonical isomorphism between the second and third dg-algebras see \cite{cuntzquillen}. If $X$ is a free $\Re $-module with basis $\{ e_i \}_{i}$ then the operator
\[
d: X \lto X \otimes_{R^e} \Bar_1 \cong X \otimes_{R^e} \Omega^1_{R_2} R^e
\]
of \eqref{eq:extendd} is an $R_2$-linear connection, and so the definition just given of the Atiyah class is a generalisation of Definition \ref{defn:atiyahclassbasis}.
\end{remark}

We will also need to know that the Atiyah class is natural, up to homotopy. Let $X$ and $X'$ be $\nZ _2$-graded $A$-modules equipped with odd $A$-linear operators which for convenience we denote by $D$ in both cases, and suppose $X$ and $X'$ admit $R$-linear connections, both of which we denote $\nabla$.

\begin{lemma}\label{lemma:atiyahnat} Given an $A$-linear homogeneous map $\varphi: X \lto X'$ consider the diagram
\[
\xymatrix@C+1pc@R+1pc{
X \ar[r]^-{\varphi}\ar[d]_-{[\nabla, D]}\ar@{.>}[dr]^-{g} & X' \ar[d]^-{[\nabla, D]}\\
X \otimes_A \Omega^1 A \ar[r]_{\varphi \otimes 1} & X' \otimes_A \Omega^1 A
}
\]
where $g = [\varphi, \nabla]$. This is a right $A$-linear map, and
\[
[\varphi, [\nabla, D]] = (-1)^{|\varphi|} [ D, [\varphi, \nabla]] - [ \nabla, [D, \varphi]]\,.
\]
\end{lemma}
\begin{proof}
Follows from the graded Jacobi identity for commutators.
\end{proof}

In particular if $(X,D)$ and $(X', D)$ are linear factorisations of some $W \in k$, so that $[\nabla, D]$ is a closed map in both cases, then for any morphism $\varphi$ of linear factorisations we see that there is a right $A$-linear homotopy $g$ between $f \circ [ \nabla, D]$ and $[\nabla, D] \circ f$.

The Atiyah class can be viewed as a component of the curvature of a superconnection.

\begin{remark}\label{remark:curvature_superconnection} A \textsl{superconnection} $\Theta$ on a $\nZ _2$-graded $A$-module $X$ is an $R$-linear degree one operator~$\Theta$ on $X \otimes_A \Omega A$ satisfying the graded Leibniz rule
\[
\Theta( \xi \omega ) = \Theta( \xi ) \omega + (-1)^{|\xi|} \xi d \omega
\]
for all homogeneous $\xi \in X \otimes_A \Omega A$ and $\omega \in \Omega A$. If $\nabla$ is a connection on $X$ then we extend $\nabla$ to an operator on $X \otimes_A \Omega A$ and it is easily checked that for any odd $A$-linear operator $D$ on $X$ the operator
\[
\Theta = \nabla + D
\]
is a superconnection. The \textsl{curvature} of this superconnection is
\[
\Theta^2 = \nabla^2 + D^2 + [\nabla, D]\,.
\]
In this paper our connections $\nabla$ are flat, i.\,e.~$\nabla^2 = 0$, and so if $(X,D)$ is a complex the curvature~$\Theta^2$ is precisely the Atiyah class $[\nabla, D]$.
\end{remark}
%  \cite[Appendix $1$]{arnold}

\section{Perturbation and inverting unit actions}\label{section:pertandhtpy}
% mostly from barmf5, unitlg. The stuff involving s is from coevc3.

The fundamental technical results in this paper are constructions, using the perturbation lemma, of explicit homotopy inverses to morphisms involving the stabilised diagonal. Generically the results are geometric series in the associative Atiyah classes of the previous section. To give a specific example, recall that in defining the bicategory $\LG$ we have specified for any $1$-morphism $X \in \LG(W,V)$ a pair of natural isomorphisms
\begin{equation}\label{eq:pertandhtpy1}
\lambda: \Delta_V \otimes X \lto X \, , \qquad \rho: X \otimes \Delta_W \lto X
\end{equation}
called the \textsl{unit actions}, see \eqref{lambdarho}. Representing chain maps for the inverses of these morphisms are necessary for computing with diagrams in $\LG$, and in particular are needed for proving the Zorro moves in Section \ref{sec:Zorro}, but finding such representatives is nontrivial. 

Instead of inverting $\lambda$ and $\rho$ directly, which is difficult, we proceed by identifying $\rho$ as the shadow of a similar canonical map $\rho'$ on the bar model for the diagonal via a commutative diagram
\begin{equation}\label{eq:pertdia1}
\xymatrix{
X \,\widehat{\otimes}\, \Bar \ar[dr]_-{\rho'}\ar[rr]^{1 \otimes \Psi} & & X \otimes \Delta_W \ar[dl]^-{\rho}\\
& X
}
\end{equation}
where $\Psi$ is the canonical map given in (\ref{intro_psi}). Roughly speaking the inverse of $\rho'$ is the geometric series in powers of the Atiyah class of $X$ and by postcomposing with $\Psi$ we obtain the desired inverse to $\rho$. A similar argument works for inverting $\lambda$. A completion of $X \otimes \Bar$ is used in order to guarantee that the geometric series converges. We return to this example in Section \ref{section:rhoandlambdainverse} below.

Another important example is the following: given an object $(k[x],W) \in \LG$ and a $1$-morphism $X \in \LG(W,W)$ consider the problem of lifting a $k[x]$-bilinear morphism of linear factorisations $X \lto k[x]$ to a morphism $X \lto \Delta_W$ along the stabilisation map $\pi_{\Delta}: \Delta_W \lto k[x]$, 
\[
\xymatrix{
X \ar[dr] \ar@{.>}[rr] & & \Delta_W \ar[dl]^-{\pi_{\Delta}} \\
& k[x]\,.
}
\]
The solution to this lifting problem is given in Section \ref{section:liftingproblem}, and will be used to give an explicit formula for the evaluation maps in Section \ref{sec:derivcoeval}.

In order to address these examples and others at the same time, we work in the following general setting: $k$ is a ring, $R, S$ are $k$-algebras and $\Re  = R_1 \otimes_k R_2$ where $R_i = R$ for $i \in \{1,2\}$. We assume that a matrix factorisation
\be\label{eq:xisamf}
X \in \HMF(S \otimes_k \Re, U)
\ee
is given with homogeneous basis $\{ e_i \}_{i}$ as an $(S \otimes_k \Re)$-module. Let~$D$ denote the differential on~$X$ and unless specified otherwise in this section $\otimes$ denotes the tensor product $\otimes_{\Re}$. Consider the module
\[
X \,\widehat{\otimes}\, \Bar := \prod_{l \ge 0} X \otimes \Bar_l
\]
with the $\nZ _2$-grading
\[
\big( X \,\widehat{\otimes}\, \Bar \big)^i = \left( \prod_{l \in \nZ } X^i \otimes \Bar_{2l} \right) \oplus \left( \prod_{l \in \nZ } X^{i+1} \otimes \Bar_{2l+1} \right) . 
\]
It is sometimes helpful to view $X \,\widehat{\otimes}\, \Bar$ as the inverse limit of the system
\[
\cdots \lto X \otimes \Bar/\Bar_{\ge 2} \lto X \otimes \Bar/\Bar_{\ge 1}
\]
where $\Bar_{\ge l} = \bigoplus_{i \ge l} \Bar_i \subseteq \Bar$ and the maps are the obvious quotients $\Bar/\Bar_{\ge l+1} \lto \Bar/\Bar_{\ge l}$. Since $\Bar$ is an $\Re $-bimodule via left and right multiplication there are natural left and right $\Re $-actions on $X \,\widehat{\otimes}\, \Bar$. Since the left and right actions of $R_2$ on $\Bar$ agree, this amounts to an $R_2$-action on $X \,\widehat{\otimes}\, \Bar$ together with the structure of an $R_1$-bimodule. There is of course an $S$-module structure as well, which is preserved by all maps and which we will henceforth not emphasise.

Let $W \in R$ be arbitrary and set $\widetilde{W} = W \otimes 1 - 1 \otimes W \in \Re$. Our first observation is that $X \,\widehat{\otimes}\, \Bar$ can be equipped as a linear factorisation of $U + \widetilde{W}$. One checks that there are well-defined operators on $X \,\widehat{\otimes}\, \Bar$ given by
\begin{align*}
D(x_0, x_1, \ldots) &= (D(x_0), D(x_1), \ldots) \, , \\
b'(x_0, x_1, \ldots) &= (b'(x_1),b'(x_2),\ldots) \, , \\
d(x_0,x_1,\ldots) &= (0, d(x_0), d(x_1),\ldots) \, , \\
s(x_0,x_1,\ldots) &= (0, s(x_0), s(x_1), \ldots) \, , \\
d \widetilde{W} \times (x_0,x_1,\ldots) &= (0, d \widetilde{W} \times x_0, d \widetilde{W} \times x_1, \ldots)
\end{align*}
where $d$ and $s$ are extended to $X \otimes \Bar$ as in Section \ref{section:atiyahclasses} using the chosen basis. 

%For the next result assume that $U + \widetilde{W}$ belongs to the image of $S \otimes_k R_i$ in $S \otimes_k \Re $ for some $i \in \{1,2\}$ so that it makes sense to talk about linear factorisations of $U + \widetilde{W}$ over $S \otimes_k R_i$.

\begin{lemma} $( X \, \widehat{\otimes}\, \Bar, d_X + b' + d\widetilde{W} \times (-) )$ is a linear factorisation of $U + \widetilde{W}$.
\end{lemma}
\begin{proof}
This can be checked on the inverse system, where it follows from Lemma \ref{lemma:barisafactorisation}.
\end{proof}

There is a morphism of linear factorisations
\begin{equation}\label{eq:pibar}
\pi: X \, \widehat{\otimes}\, \Bar = \prod_{l \ge 0} X \otimes \Bar_l \lto X \otimes \Bar_0 \lto X \otimes R
\end{equation}
where the first map is the projection and the second is the product $\Re \lto R$. Next we show using the perturbation lemma that this map is a homotopy equivalence, and we give an explicit homotopy inverse in terms of Atiyah classes. In fact we give two homotopy inverses, one which is $R_2$-linear and the other left $R_1$-linear. We begin with the deformation retract arising from the fact that~$s$ and~$d$ are contracting homotopies for the differential $b'$.

\begin{remark}\label{remark:specialcaseinvert} The reader should keep in mind the special case where $S = k[z], R = k[x]$ and $X$ is the extension of scalars from $S \otimes_k R$ to $S \otimes_k \Re$ of a matrix factorisation $X'$ of $V - W$ over $k[x,z]$, with $V \in k[z], W \in k[x]$. Then $\pi$ is a morphism $X' \,\widehat{\otimes}_R\, \Bar \lto X'$ of linear factorisations of $V - W$.
\end{remark}

All deformation retract data in the following are at least $S$-linear.

\begin{lemma}\label{lemma:firstdefo} There are deformation retract data of $\nZ _2$-graded complexes
\begin{equation}\label{eq:firstdefo1}
\xymatrix@C+2pc{
(X \otimes R, 0) \ar@<-1ex>[r]_-{\sigma_2} & (X \, \widehat{\otimes} \, \Bar, b') \ar@<-1ex>[l]_-{\pi}
}%
\!\!\!\xymatrix{%
{}\ar@(ur,dr)[]^{-d}
}%
\end{equation}
and
\begin{equation}\label{eq:firstdefo2}
\xymatrix@C+2pc{
(X \otimes R, 0) \ar@<-1ex>[r]_-{\sigma_1} & (X \, \widehat{\otimes} \, \Bar, b') \ar@<-1ex>[l]_-{\pi}
}%
\!\!\!\xymatrix{%
{}\ar@(ur,dr)[]^{-s}
}%
\end{equation}
where
\begin{equation}\label{eq:sigmsandd}
\sigma_2(e_i \otimes a ) = e_i \otimes (1 \otimes a) \, , \qquad \sigma_1(e_i \otimes a ) = e_i \otimes (a \otimes 1)\,.
\end{equation}
Moreover, in \eqref{eq:firstdefo1} every map is $R_2$-linear and in \eqref{eq:firstdefo2} every map is left $R_1$-linear.
\end{lemma}
\begin{proof}
The required identities $b' d + d b' = 1 - \sigma \pi$ and $b' s + s b' = 1 - \sigma \pi$ are given in (\ref{b'd+db'}).
\end{proof}

\begin{lemma}\label{lemma:smallpertde} The perturbation $\delta = D + d\widetilde{W} \times (-)$ is small on $X\,\widehat{\otimes} \, \Bar$ with respect to both of the above deformation retract data. That is, both $1 + \delta d$ and $1 + \delta s$ are invertible.
\end{lemma}
\begin{proof}
Let $h$ be $-d$ or $-s$. Because we are working with $\prod_{l \ge 0} X \otimes \Bar_l$ it is clear that the sum $\sum_{l \ge 0} (\delta h)^l$ converges as an operator on $X \, \widehat{\otimes}\, \Bar$ and this gives the desired inverse to $1 - \delta h$.
\end{proof}

In the notation of Section \ref{section:atiyahclasses} we can now describe the homotopy inverses of $\pi$ using Atiyah classes. Note that $X$ is a free $(S \otimes_k \Re)$-module so we are using the convention of Remark \ref{remark:linearatother}.

\begin{proposition}\label{prop:finalpertdefo} The morphism $\pi$ is an $R_2$-linear homotopy equivalence with inverse
\[
\sigma_\infty = \sum_{m \ge 0} (-1)^m \At_{2}(X)^m \sigma_2\,.
\]
More precisely, there is an $R_2$-linear deformation retract datum
\be\label{eq:finalpertdefo001}
\xymatrix@C+2pc{
(X \otimes R, D \otimes 1) \ar@<-1ex>[r]_-{\sigma_\infty} & (X \, \widehat{\otimes} \, \Bar, D + b' + d\widetilde{W} \times (-)) \ar@<-1ex>[l]_-{\pi}
}.
\ee
\end{proposition}
\begin{proof}
It follows from the perturbation lemma (Proposition \ref{prop:pertlemma}) with Lemmas~\ref{lemma:firstdefo} and~\ref{lemma:smallpertde} that
\[
\xymatrix@C+2pc{
(X \otimes R, b_\infty) \ar@<-1ex>[r]_-{\sigma_\infty} & (X \, \widehat{\otimes} \, \Bar, D + b' + d\widetilde{W} \times (-)) \ar@<-1ex>[l]_-{\pi_\infty}
}
\]
is a deformation retract datum, where $\tau = \sum_{m \ge 0} (-1)^m (\delta d) \delta$
\begin{align*}
\sigma_\infty = \sum_{m \ge 0} (-1)^m (d \delta)^m \sigma_2 \, , \qquad
\pi_\infty = \pi + \pi \tau h\, , \qquad
b_\infty = \pi \tau \sigma_2\,.
\end{align*}
Clearly $\pi \delta = \pi D$ and $\pi$ vanishes on $\delta d$, so $\pi \tau = \pi D$. It follows that $b_\infty = D \otimes 1$ and $\pi_\infty = \pi - \pi D d = \pi$. So there is a deformation retract datum \eqref{eq:finalpertdefo001}, where we may use $d^2 = 0$ and $d \sigma_2 = 0$ to write
\[
\sigma_\infty = \sum_{m \ge 0} (-1)^m \big[ d, \delta \big]^m \sigma_2 = \sum_{m \ge 0} (-1)^m [d, D + d\widetilde{W} \times (-)]^m \sigma_2\,.
\]
Expanding this yields $\sum_{m \ge 0} (-1)^m [d, D]^m \sigma_2$ plus terms involving factors of the form
\begin{equation}\label{eq:finalpertdefo2}
[d, d\widetilde{W} \times (-)] [d,D]^i \sigma_2\,.
\end{equation}
Applying $[d,D]^i \sigma_2$ to an element of $X \otimes R$ produces a tensor whose form component is of the type $da_0 \ldots da_n \otimes a_{n+1}$. By Lemma \ref{lemma:shortobs} below $[d, d\widetilde{W} \times (-)]$ vanishes on such a tensor, so all terms of the form (\ref{eq:finalpertdefo2}) vanish and $\sigma_\infty$ is as given in the statement of the proposition.
\end{proof}

\begin{lemma}\label{lemma:shortobs} On $\Bar$ we have $[d, d\widetilde{W} \times (-)] = d \widetilde{W} \cdot d(-)$ and $[s, d\widetilde{W} \times (-)] = s(-) \cdot d\widetilde{W}$.
\end{lemma}
% see p.21 of (onct2), and p.4.1 of (coevc3) for the second statement
\begin{proof}
With $\alpha = d( W \otimes 1 - 1 \otimes W ) = dW \otimes 1$ and $\omega = a_0 da_1 \ldots da_n \otimes a_{n+1}$ we have
\begin{align*}
\alpha \times \omega &= a_0 dW da_1 \ldots da_n \otimes a_{n+1} - a_0 da_1 dW da_2 \ldots da_n \otimes a_{n+1}\\
& \qquad+ \ldots + (-1)^n a_0 da_1 \ldots da_n dW \otimes a_{n+1}\,.
\end{align*}
On the other hand
\begin{align*}
\alpha \times d\omega &= dW da_0 da_1 \ldots da_n \otimes a_{n+1} - da_0 dW da_1 \ldots da_n \otimes a_{n+1}\\
&\qquad+ \ldots + (-1)^{n+1} da_0 da_1 \ldots da_n dW \otimes a_{n+1}\,,
\end{align*}
from which it is clear that $d( \alpha \times \omega ) + \alpha \times d\omega = \alpha \cdot d\omega$. The second statement follows by a similar calculation.
\end{proof}

\begin{proposition}\label{prop:finalpertdefo} The morphism $\pi$ is a left $R_1$-linear homotopy equivalence with inverse
\[
\sigma_\infty = \sum_{m \ge 0} (-1)^m \At_{1}(X)^m \sigma_1\,.
\]
More precisely, there is a left $R_1$-linear deformation retract datum
\[
\xymatrix@C+2pc{
(X \otimes R, D \otimes 1) \ar@<-1ex>[r]_-{\sigma_\infty} & (X \, \widehat{\otimes} \, \Bar, D + b' + d\widetilde{W} \times (-)) \ar@<-1ex>[l]_-{\pi}
}\,.
\]
\end{proposition}
\begin{proof}
Using the second equation of Lemma \ref{lemma:shortobs} the proof is almost identical to that of Proposition \ref{prop:finalpertdefo}, so we omit it.
\end{proof}

%\begin{remark} In the situation of Remark \ref{remark:specialcaseinvert} we have shown that $\pi: X' \,\widehat{\otimes}_R\, \Bar \lto X'$ is an $R$-linear homotopy equivalence for the two possible $R$-actions on $X' \,\widehat{\otimes}_R\, \Bar$, the $R$-action on $X'$ which moves across the tensor to act as $R_1$ on $\Bar$, and the $R_2$-action on $\Bar$.
%\end{remark}

Now we turn to the Koszul stabilisation of the diagonal. Assume that $R = k[x_1,\ldots,x_n]$ and let $(\Delta, d_{\Delta})$ be the finite-rank matrix factorisation of $\widetilde{W}$ given in Section~\ref{subsec:bicatLG} where $d_{\Delta} = \delta_{+} + \delta_{-}$. We continue to assume that $X$ is a matrix factorisation as given in \eqref{eq:xisamf}, and we emphasise that $W$ is arbitrary, not necessarily a potential.

With $\pi_{\Delta}: \Delta \lto R$ the stabilisation morphism of \eqref{DeltaWstabmap} there is a morphism
\begin{equation}\label{eq:koszulpi}
\pi_{\Delta} = 1 \otimes \pi_{\Delta}: X \otimes \Delta \lto X \otimes R\,.
\end{equation}
This is compatible with the map $\pi$ of \eqref{eq:pibar} in the sense that there is a commutative diagram
\[
\xymatrix{
X \,\widehat{\otimes}\, \Bar \ar[dr]_-{\pi}\ar[rr]^{1 \otimes \Psi} & & X \otimes \Delta \ar[dl]^-{\pi_\Delta}\\
& X \otimes R
}
\]
in which the horizontal map is the morphism of linear factorisations
\[
1 \otimes \Psi: \xymatrix{
X \,\widehat{\otimes}\, \Bar = \prod_{l \ge 0} X \otimes \Bar_l \ar@{->>}[r] & \bigoplus_{0 \le l \le n} X \otimes \Bar_l \ar[r]^-{1 \otimes \Psi} & X \otimes \Delta
}
\]
in which the first map is the projection.

\begin{lemma}\label{lemma:koszulstab1} $\pi_\Delta$ is an $R_2$-linear homotopy equivalence and a left $R_1$-linear homotopy equivalence.
\end{lemma}
\begin{proof}
With $\Delta_j = \bigwedge^j (\bigoplus_{i=1}^n \Re \theta_i)$ there is a split exact sequence
\[
\xymatrix{
0 \ar[r] & \Delta_n \ar[r]^-{\delta_{-}} & \cdots \ar[r]^-{\delta_{-}} & \Delta_0 \ar[r] & R \ar[r] & 0
}
\]
and the splittings provide the $R_2$-linear (resp.~left $R_1$-linear) $\sigma: R \lto \Delta$ and homotopy $h$ making
\[
\xymatrix@C+2pc{
(X \otimes R, 0) \ar@<-1ex>[r]_-{\sigma} & (X \otimes \Delta, 1 \otimes \delta_{-}) \ar@<-1ex>[l]_-{\pi_\Delta}
}%
\!\!\!\xymatrix{%
{}\ar@(ur,dr)[]^{-h}
}%
\]
into an $R_2$-linear deformation retract datum (resp.left $R_1$-linear). Moreover $\delta = D \otimes 1 + 1 \otimes \delta_{+}$ is a small perturbation and the perturbation lemma shows that $\pi_\Delta$ is a homotopy equivalence.
\end{proof}

\begin{corollary}\label{corollary:koszulstab2} An $R_2$-linear homotopy inverse to $\pi_\Delta$ is given by
\begin{equation}\label{eq:koszulstab2_1}
\pi^{-1}_2 = \sum_{l \ge 0} (-1)^l \Psi \At_{2}(X)^l \sigma_2\,,
\end{equation}
while an $R_1$-linear homotopy inverse is given by
\begin{equation}\label{eq:koszulstab2_2}
\pi^{-1}_1 = \sum_{l \ge 0} (-1)^l \Psi \At_{1}(X)^l \sigma_1\,.
\end{equation}
where $\sigma_1, \sigma_2$ are as in \eqref{eq:sigmsandd}.
\end{corollary}

\subsection{Inverses of unit actions}\label{section:rhoandlambdainverse}

Let us now return to the problem of inverting the unit actions $\lambda$ and $\rho$, using the setting of Remark~\ref{remark:specialcaseinvert}, so that $R = k[x], S = k[z]$, $X$ is a matrix factorisation over $S \otimes_k R$ of $V - W$ and we take $X' = X \otimes_R \Re$ as the relevant matrix factorisation in the above. In this case $\pi_{\Delta}$ is precisely the right unit action $\rho: X \otimes_R \Delta_W \lto X$.

The relevant $S$-$R$-bimodule structure on $X \otimes_R \Delta_W$ is the one coming from the action of $S$ on $X$ and the right action of $R$ on $\Delta_W$ (which we have called $R_2$ above) and with respect to this bimodule structure the homotopy inverse of $\rho$ is given by \eqref{eq:koszulstab2_1}, that is
\be\label{eq:formula_rhoinverse}
\rho^{-1} = \sum_{l \ge 0} (-1)^l \Psi \At_{2}(X)^l \sigma_2\,.
\ee
Here $\At_2(X)$ denotes the operator $[d, d_{X}]$ on $X \otimes_R \Bar$ with $d$ being extended to $X \otimes_R \Bar$ using a fixed homogeneous $S \otimes_k R$-basis $\{ e_i \}_i$ for $X$ as explained in Remark \ref{remark:linearatother}. The summands in this formula are composites of $S$-$R_2$-bilinear maps
\[
\xymatrix@C+2pc{
X \ar[r]^-{\sigma_2} & X \otimes_R \Re \ar[r]^-{\At_2(X)^l} & X \otimes_R \Bar \ar[r]^-{\Psi} & X \otimes_R \Delta_W
}
\]
where $\sigma_2(e_i) = e_i \otimes (1 \otimes 1)$. Often \eqref{eq:formula_rhoinverse} is the most useful presentation of $\rho^{-1}$, but note that using the formulas \eqref{eq:powerofatiyah} and \eqref{intro_psi} we can also be very concrete: 
\[
\rho^{-1}(e_i) = \sum_{l \ge 0} \sum_{i_1 < \cdots < i_l} \sum_j (-1)^{l + l|e_i|} e_j \otimes \left\{ \partial_{[i_1]}(d_X) \ldots \partial_{[i_l]}(d_X) \right\}_{ji} \theta_{i_1} \ldots \theta_{i_l}\,.
\]
To give a formula for the homotopy inverse of $\lambda$, first let $\Delta_V$ denote the unit matrix factorisation of $\widetilde V$ and $X' = \Se \otimes_S X$. The unit action $\lambda: \Delta_V \otimes_S X \lto X$ can be written as a composite
\[
\xymatrix{
\Delta_V \otimes_S X \cong \Delta_V \otimes_{\Se} X' \ar[r]^-{\pi_{\Delta}} & S \otimes_{\Se} X' \cong X
}\,.
\]
Writing $\Se = S_1 \otimes_k S_2$, we seek an $S_1$-$R$-bilinear inverse to $\pi_{\Delta}$. It would suffice to invert
\be\label{eq:mashedkoalas}
X' \otimes_{\Se} \Delta_V \lto X' \otimes_{\Se} S
\ee
and then compose on both ends with swap isomorphisms, provided we keep in mind that we want an $S_1$-linear, not $S_2$-linear, inverse to \eqref{eq:mashedkoalas}. But switching the role of $R$ and $S$ in the above, this is exactly what is provided by \eqref{eq:koszulstab2_2}. Postcomposing with the swap isomorphism has the effect of converting $\At_{1}$ into $\Atlarrow_{1}$, so the conclusion is that an $S_1$-$R$-bilinear homotopy inverse for $\lambda$ is
\be\label{eq:formulalambdainv}
\lambda^{-1} = \sum_{l \ge 0} (-1)^l \Psi \Atlarrow_{1}(X)^l \sigma_1\,.
\ee
Here $\Atlarrow_1(X)$ denotes the operator $[s, d_{X}]$ on $\gamma_*(\Bar) \otimes_S X$ and the summands in this formula are composites of $S_1$-$R$-bilinear maps
\[
\xymatrix@C+2pc{
X \ar[r]^-{\sigma_1} & \Se \otimes_S X \ar[r]^-{\At_1(X)^l} & \gamma_*(\Bar) \otimes_S X \ar[r]^-{\Psi} & \Delta_V \otimes_S X
}
\]
where $\sigma_1(e_i) = (1 \otimes 1) \otimes e_i$. Notice that we have shown that $\lambda, \rho$ are homotopy equivalences, and provided explicit inverses, for an arbitrary matrix factorisation $X$ (i.\,e.~not necessarily finite-rank).

\subsection{The lifting problem}\label{section:liftingproblem}

The universal property of $\pi_{\Delta}: \Delta_W \lto R$ is that for any matrix factorisation $Y \in \hmf(\Re , \widetilde{W})$ and morphism of linear factorisations $\varphi: Y \lto R$ there is a unique (up to homotopy) morphism $\varphi_{\textup{lift}}$ making the following diagram commute up to homotopy: 
\be\label{eq:liftingproblem2}
\xymatrix{
Y \ar[dr]_-{\varphi} \ar@{.>}[rr]^-{\varphi_{\textup{lift}}} & & \Delta_W \ar[dl]^-{\pi_\Delta} \\
& R
} .
\ee
In this section we give an explicit formula for $\varphi_{\textup{lift}}$.

Having chosen a homogeneous basis $\{ e_i \}_{i}$ for $Y$, the formula is written in terms of the maps
\[
\xymatrix@C+2pc{
Y \ar[r]^-{\lAt_2(Y)^l} & \Bar \otimes_{\Re } Y \ar[r]^-{1 \otimes \varphi'} & \Bar \otimes_{\Re } \Re  \cong \Bar \ar[r]^-{\Psi} & \Delta_W
} 
\]
where $\varphi': Y \lto \Re $ is the $\Re $-linear map defined by $\varphi'(e_i) = 1 \otimes \varphi(e_i)$.
% see lipert3

\begin{proposition}\label{prop:liftingresult} 
In the above notation
\begin{equation}\label{eq:liftingresult}
\varphi_{\textup{lift}} = \sum_{l \ge 0} (-1)^l \Psi (1 \otimes \varphi') \lAt_{2}(Y)^l
\end{equation}
is a morphism of matrix factorisations making \eqref{eq:liftingproblem2} commute.
\end{proposition}
\begin{proof}
We apply Corollary \ref{corollary:koszulstab2} to see that the composite
\[
\xymatrix@C+2pc{
\Hom_{\Re }(Y, \Delta) \ar[r]^-{\cong}_-{\xi^{-1}} & Y^{\vee} \otimes_{\Re } \Delta \ar[r]^-{1 \otimes \pi_{\Delta}} & Y^{\vee} \otimes_{\Re } R \ar[r]^-{\cong}_-{\xi} & \Hom_{\Re }(Y, R)
}
\]
is a homotopy equivalence, with $\xi$ denoting the canonical isomorphisms (see Section \ref{section:canonicalmaps}). Evaluating the homotopy inverse $\xi \circ \pi_2^{-1} \circ \xi^{-1}$ on the cohomology class of $\varphi$ yields the map $\varphi_{\textup{lift}}$ defined by
\[
\varphi_{\textup{lift}} = \sum_i \sum_{l \ge 0} (-1)^m \xi \Psi \At_2(Y^\vee)^l \sigma_2( e_i^* \otimes \varphi(e_i) )\,.
\]
A straightforward computation yields (with $D = d_Y$)
\[
\varphi_{\textup{lift}}(e_j) = \sum_{l \ge 0}\sum_{i_0, i_1, \ldots, i_{l-1}} (-1)^{l|e_{i_0}| + l} \Psi\left( d( D_{i_{l-1},j}) d( D_{i_{l-2},i_{l-1}} ) \ldots d( D_{i_0, i_1} ) \cdot (1 \otimes \varphi(e_{i_0}) ) \right)
\]
which by \eqref{eq:leftatiyahexp} agrees with the right-hand side of \eqref{eq:liftingresult}.
\end{proof}

%\begin{remark} As the proof makes clear, we could have made use of $\pi^{-1}_1$ instead of $\pi^{-1}_2$ in the construction of $\varphi_{\textup{lift}}$, so that an alternative chain level representative of this homotopy class could be given using $\lAt_{1}$ instead of $\lAt_{2}$.
%\end{remark}

\section{Evaluation and coevaluation}\label{sec:derivcoeval}

Every $1$-morphism in $\LG$ has both a left and right adjoint. Specifically, if a $1$-morphism $W \lto V$ is represented by a finite-rank matrix factorisation $X$ of $V - W$ over $k[x,z]$, where $W\in k[x] = k[x_1,\ldots,x_n]$ and $V\in k[z] = k[z_1,\ldots,z_m]$ are potentials, then the $1$-morphisms
\be\label{eq:derivcoeval11}
X^\dual = R[n] \otimes_R X^\vee \, , \qquad {}^\dual X = X^\vee \otimes_S S[m]
\ee
are respectively the right and left adjoints of $X$ in $\LG$. These matrix factorisations are canonically isomorphic to $X^\vee[n]$ and $X^\vee[m]$ respectively, but there are good reasons to prefer the presentation of \eqref{eq:derivcoeval11}, see for example the graphical calculus in Section \ref{sec:wiggliesandsigns}. While $R[n] \otimes_R X^\vee$ is isomorphic to $X^\vee[n]$ with no intervention of signs and we freely interchange these two objects, the second isomorphism
\[
X^\vee[m] \cong X^\vee \otimes_S S[m], \qquad \nu \lmt (-1)^{m|\nu|} \nu
\]
involves signs. The dual $X^\vee$ is the object of $\hmf(k[x,z], W-V)$ with the differential spelled out in \eqref{eq:differentials_adjoints}. To prove that these $1$-morphisms are adjoint to $X$ we have to exhibit two pairs of evaluation and coevaluation maps, and prove that they satisfy the Zorro moves~\eqref{Zorros} and~\eqref{otherZorros}.

In Sections \ref{subsec:derivcoeval} and \ref{subsec:eval} below we define evaluation and coevaluation maps
\begin{align}
\coev_X &: \Delta_V \lto X \otimes_{k[x]} {}^\dual X
\, , \qquad
\eval_X: {}^\dual X \otimes_{k[z]} X \lto \Delta_W \, , \label{eq:derivcoeval1}\\
\widetilde\coev_X&: \Delta_W \lto X^\dual \otimes_{k[z]} X
\, , \qquad
\widetilde\eval_X: X \otimes_{k[x]} X^\dual \lto \Delta_V \label{eq:derivcoeval2}
\end{align}
and derive explicit formulas for these maps in terms of Atiyah classes. We already give these formulas below; the rest of the section will be spent justifying that these expressions do in fact define chain maps representing canonical morphisms \eqref{eq:derivcoeval1} and \eqref{eq:derivcoeval2} in the homotopy category of matrix factorisations. In Section~\ref{sec:Zorro} we will prove that these maps determine adjunctions ${}^\dual X \dashv X$ and $X \dashv X^\dual$ by proving the Zorro moves. 

Using the formulas for exponentiated Atiyah classes from Section \ref{section:atiyahclasses} and the explicit formula~\eqref{intro_psi} for the map $\Psi: \Bar \lra \Delta$ we also give completely elementary expressions for these maps involving only divided difference operators, see Remarks \ref{remark:explicitev} and \ref{remark:coev_divideddiff}. These explicit expressions can be useful in concrete examples, but in general they are difficult to manipulate, hence for example in the proof of the Zorro moves we will use the presentations \eqref{eq:coev10}--\eqref{eq:constructevalmap01} in terms of Atiyah classes. 
%While concrete, these expressions are very difficult to work with directly, and in particular they will not be used in the sequel.

While the homotopy classes of these morphisms are canonical the formulas depend on a choice of homogeneous basis $\{ e_i \}_{i}$ for $X$ with dual basis $\{ e_i^* \}_{i}$. Representatives for the coevaluation morphisms are given by the chain maps
\begin{align}
\widetilde\coev_X(\gamma) & = \sum_{l \ge 0} \varepsilon \left( \gamma \wedge  (-1)^{l+nl} \Psi \Atlarrow_2(X^\dual)^l( \iota_X ) \right) , \label{eq:coev10}\\
\coev_X( \gamma ) & = \sum_{l \ge 0} \varepsilon \left( \gamma \wedge (-1)^{l+ml} \Psi \Atlarrow_2(X)^l( \iota'_X ) \right) ,\label{eq:coev102}
\end{align}
where $\varepsilon$ and $\Psi$ is as defined in~\eqref{eq:vareps} and~\eqref{intro_psi}, respectively,  and
\be\label{eq:iotaX}
\iota_X = \sum_{j} (-1)^{|e_j|} e_j^* \otimes e_j \in X^\dual \otimes_{k[z]} X \, , \qquad 
\iota'_X = \sum_j e_j \otimes e_j^* \in X \otimes_{k[x]} {}^\dual X \, . 
\ee
The Atiyah classes involved in \eqref{eq:coev10} and \eqref{eq:coev102} are actually those of the $k[x]$-bimodule $X^\dual \otimes_{k[z]} X$ and the $k[z]$-bimodule $X \otimes_{k[x]} X^\dual$, respectively, but with a slight abuse of notation these simplify to the Atiyah classes given in the formulas; see Remark \ref{remark:ringactionsubtle}.

A representative for the evaluation morphism is given by
\be\label{eq:constructevalmap00}
\widetilde\eval_X( \eta \otimes \nu ) = \sum_{l \ge 0} (-1)^{\globalsigneval+l+n|\eta|} \Res_{k[x]/k} \left[ \frac{ \Psi \left( \lAt_2(X)^l( \Lambda^{(x)} \eta ), \nu \right) \, \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right]
\ee
where $\Lambda^{(x)} = (-1)^n \partial_{x_1}(d_X) \ldots \partial_{x_n}(d_X)$, $\underline{\operatorname{d}\!x} = \ud x_1 \ldots \ud x_n$ and $(\eta',\nu)$ denotes the evaluation of $\nu$ on an element $\eta'$ of $X$, with an appropriate Koszul sign and taking into account the fact that $\nu$ and $\eta$ involve different copies of the $z$-variables. For the precise statement see Proposition \ref{prop:constructevalmap}. 

In the other evaluation the Atiyah class of $X^{\vee}$ is applied to the functional $\nu \circ \Lambda^{(z)}$ with $\Lambda^{(z)} = \partial_{z_1}(d_X) \ldots \partial_{z_m}(d_X)$, and the resulting functional-valued form is evaluated on $\eta$: 
\be\label{eq:constructevalmap01}
\eval_X( \nu \otimes \eta ) = \sum_{l \ge 0} (-1)^{l} \Res_{k[z]/k} \left[ \frac{ \Psi \left( \lAt_2(X^{\vee})^l( \nu \circ \Lambda^{(z)} ), \eta\right) \, \underline{\operatorname{d}\!z}}{\partial_{z_1}V, \ldots, \partial_{z_m} V} \right]
\ee
where $\underline{\ud z} = \ud z_1 \ldots \ud z_m$. Here $(\nu', \eta)$ denotes the evaluation of a functional $\nu'$ on $\eta$, without signs but distinguishing between the two copies of the $x$-variables involved; a more careful explanation is given after Proposition \ref{prop:constructevalmapnontilde}. 

Throughout we write $R = k[x]$, $S = k[z]$ and $\Re  = R_1 \otimes_k R_2$ with $R_i = R$ and $\Se  = S_1 \otimes_k S_2$ with $S_i = S$. Then $\Delta_W$, $X^\dual \otimes X$, ${}^\dual X \otimes X$ are $\Re $-linear factorisations of $\widetilde{W} = W \otimes 1 - 1 \otimes W$ and $\eval_X, \widetilde\coev_X$ are $\Re$-linear, while $\Delta_V$ and $X \otimes X^\dual$, $X \otimes {}^\dual X$ are $\Se$-linear factorisations of $\widetilde{V} = V \otimes 1 - 1 \otimes V$ and $\coev_X, \widetilde\eval_X$ are $\Se$-linear. The differentials on $\Delta_V, \Delta_W$ are given by~\eqref{DeltaW}. We will also frequently make use of the canonical maps from Section~\ref{section:canonicalmaps}.

\subsection{Coevaluation}\label{subsec:derivcoeval}

In this section we present the coevaluation morphism $\widetilde\coev_X$ and the derivation of its explicit chain level representative. Afterwards we consider the other coevaluation $\coev_X$, but since the derivation is almost identical we will not provide all details. 

\begin{proposition}\label{prop:isogivescoev} There is a canonical homotopy equivalence of $\nZ _2$-graded $k$-complexes
\begin{equation}
\Hom_{\Re }( \Delta_W, X^\dual \otimes_{S} X ) \lto \Hom_{R \otimes_k S}(X,X)\,. \label{eq:isogivescoev}
\end{equation}
\end{proposition}

\begin{definition}\label{def:coeval} We define $\widetilde\coev_X$ to be the morphism in the category $\HMF(\Re, \widetilde{W})$ whose cohomology class maps to $1_X$ under the quasi-isomorphism \eqref{eq:isogivescoev}.
\end{definition}

\begin{proof}[Proof of Proposition \ref{prop:isogivescoev}]
Let $\Delta_W'$ denote the matrix factorisation of $- \widetilde{W}$ with the same underlying graded free module as $\Delta_W$ but the modified differential $d_{\Delta'} = - \delta_{+} + \delta_{-}$. This approximates the diagonal as a matrix factorisation of $- \widetilde{W}$ in the same way that $\Delta_W$ approximates it as a factorisation of $\widetilde{W}$. Also let~$K$ denote the $\nZ _2$-graded complex with the same underlying graded module as $\Delta_W$, but the differential~$\delta_{-}$, so~$K$ is the usual Koszul complex of $x_1 - x'_1, \ldots, x_n - x'_n$.

The product in the exterior algebra gives rise to a morphism of $\nZ _2$-graded complexes
\[
\Delta_W' \otimes_{\Re} \Delta_W \lto K\,.
\]
Composing with the morphism $\varepsilon: K \lto \Re[n]$ from~\eqref{eq:vareps} and taking the adjoint, we obtain the isomorphism of matrix factorisations
\be
\zeta: \Delta_W' \lto \Delta_W^\vee [n]\, , \qquad \omega \lmt \varepsilon( \omega \wedge - )\,.
\ee
Combining this with various canonical maps and the morphism $\pi: \Delta_W' \lto (\Delta_W')_0 = \Re \lto R$ we have the following diagram of $R_2$-linear morphisms:
\begin{equation}
\xymatrix{
\Hom_{\Re}( \Delta_W, X^\vee[n] \otimes_{S} X)\\
\Delta_W^\vee \otimes_{\Re} \left( X^\vee[n] \otimes_S X \right) \ar[u]^-{\cong}_-{\xi}\\
\Delta_W^\vee[n] \otimes_{\Re} \left( X^\vee \otimes_{S} X \right) \ar[u]^-{\cong}\\
\Delta_W' \otimes_{\Re} \left( X^\vee \otimes_S X \right) \ar[u]^-{\cong}_-{\zeta \otimes 1}\\
\left( X^\vee \otimes_{S} X \right) \otimes_{\Re} \Delta_W' \ar[u]^-{\cong}_-{\textup{swap}} \ar[d]^-{\pi}\\
\left( X^\vee \otimes_{S} X \right) \otimes_{\Re} R \ar[d]_-{\cong}\ar[d]^-{\kappa}\\
\Hom_{R \otimes_k S}(X,X)
}\label{eq:isogivescoev2}
\end{equation}
where for $f \in X^\vee$ and $g,g' \in X$ we define $\kappa( f \otimes g \otimes 1 )(g') = (-1)^{|f||g|} f(g') \cdot g$. To complete the proof we need only to show that the step marked $\pi$ is a homotopy equivalence. But this is a consequence of Lemma \ref{lemma:koszulstab1}.
\end{proof}

To give a representative chain map for the coevaluation we begin with $1_X$ at the bottom of (\ref{eq:isogivescoev2}) and apply the various maps in turn; the only nontrivial step will be to apply the homotopy inverse for $\pi$ found in Section \ref{section:pertandhtpy}. The two different choices of inverse provided there will lead to two different (but homotopic) chain level representatives for the coevaluation.

\begin{remark}\label{remark:ringactionsubtle} With $\reprod$ as in (\ref{eq:attau}) consider on $\reprod_*(\Bar) \otimes_{\Re} ( X^\dual \otimes_{S} X)$ the operator
\[
\Atlarrow_{2}(X^\dual \otimes X) = [d, d_{X^\dual \otimes X}] = [d, d_{X^\dual}]
\]
with the second equality holding because $d$ is $R_2$-linear. For this reason we abuse notation and write $\Atlarrow_2(X^\dual)$ for $\Atlarrow_{2}(X^\dual \otimes X)$. We adopt this notation in order to make make calculations like the ones in Section \ref{sec:Zorro} comprehensible, but the reader should keep in mind that while only the differential of $X^{\dual}$ contributes to the Atiyah class, in an expression like
\[
\varepsilon \Psi \Atlarrow_2(X^\dual)(e_i^* \otimes e_j)
\]
the output of $\varepsilon$ contains elements of $\Re = R_1 \otimes R_2$ with $R_1$ acting on $X^\dual$ and $R_2$ acting on $X$.
\end{remark}

In the formula for the coevaluation, we apply the map
\[
\xymatrix@C+0.5pc{
X^\dual \otimes_{S} X \ar[rr]^-{\Atlarrow_2(X^\dual)^l} & & \reprod_*(\Bar) \otimes_{\Re} ( X^\dual \otimes_{S} X ) \ar[r]^-{\Psi} & \Delta_W \otimes_{\Re} (X^\dual \otimes_{S} X)
}
\]
to the tensor $\iota_X = \sum_{j} (-1)^{|e_j|} e_j^* \otimes e_j$.


\begin{proposition}\label{prop:coev1} A representative for $\widetilde\coev_X$ is the chain map \eqref{eq:coev10}.
\end{proposition}
\begin{proof}
We lift the identity $1_X$ upwards through the sequence of quasi-isomorphisms in \eqref{eq:isogivescoev2}, noting that $\iota_X = \kappa^{-1}(1_X)$. To take the inverse image of $\iota_X$ under the map induced by $\pi$ on cohomology, we may use either of the homotopy inverses $\pi_1^{-1}, \pi_2^{-1}$ of Corollary \ref{corollary:koszulstab2}. Using the second yields
\begin{equation}\label{eq:coev11}
\pi^{-1}_2 \kappa^{-1}(1_X) = \sum_{l \ge 0} (-1)^l \Psi \At_2(X^{\vee})^l( \iota_X )\,.
\end{equation}
Applying the swap isomorphism has the effect of exchanging $\At_2$ for $\Atlarrow_2$ in this formula, so that the cohomology class in $\Delta_W' \otimes_{\Re} (X^\vee \otimes_S X)$ mapping to $1_X$ is $\sum_{l \ge 0} (-1)^l \Psi \Atlarrow_2(X^{\vee})^l( \iota_X )$.

A tensor $\omega \otimes \alpha$ in $\Delta_W' \otimes_{\Re} (X^\vee \otimes_S X)$ is sent under the remaining maps in \eqref{eq:isogivescoev2} to the function $(-1)^{n(|\omega| + n)} \xi( \varepsilon( \omega \wedge - ) \otimes \alpha )$. This map sends a form $\gamma \in \Delta_W$ to
\begin{align}
\gamma \lmt & \, (-1)^{n(|\omega| +n ) + (|\omega| + n)(|\alpha|+n)} \varepsilon( \omega \wedge \gamma ) \cdot \alpha\label{eq:signcalccoeval}\\
& \, = (-1)^{|\omega||\alpha| + n|\alpha| + |\omega||\gamma|} \varepsilon( \gamma \wedge \omega ) \cdot \alpha\,. \nonumber
\end{align}
This vanishes unless $|\gamma| + |\omega| = n$, so the final sign is $(-1)^{|\omega||\alpha| + n|\alpha| + n|\omega| + |\omega|}$. Since $\iota_X$ has degree zero the element $\sum_{l \ge 0} (-1)^l \Psi \Atlarrow_2(X^{\vee})^l( \iota_X )$ can be written as a sum of tensors $\omega \otimes \alpha$ with $|\omega| = |\alpha|$, in which case the sign on \eqref{eq:signcalccoeval} is just $+1$ and the formula \eqref{eq:coev10} follows.
\end{proof}

There is an alternative presentation which we will need. On $( X^\dual \otimes_S X) \otimes_{\Re } \Bar$ consider
\[
\At_{1}(X^\dual \otimes X) = [s, d_{X^\dual \otimes X}] = [s, d_X]
\]
which we denote by $\At_1(X)$. This abuse of notation has the same disclaimer as in Remark \ref{remark:ringactionsubtle}.

\begin{proposition}\label{prop:alt_formula_coev} 
A representative for $\widetilde\coev_X$ is the chain map
\be\label{eq:alt_formula_coev}
\gamma \lmt \varepsilon \left( \sum_{l \ge 0} (-1)^{l+nl} \Psi \At_{1}(X)^l( \iota_X ) \wedge \gamma \right) .
\ee
\end{proposition}

We conclude this section by explaining how one defines, and derives an explicit formula for, the other coevaluation. To begin with one constructs a canonical homotopy equivalence
\be\label{eq:othercoev11}
\Hom_{\Se}(\Delta_V, X \otimes_R {}^\dual X) \lto \Hom_{R \otimes_k S}(X, X)
\ee
in the same way that we constructed the homotopy equivalence of Proposition \ref{prop:isogivescoev}. The coevaluation $\coev_X$ is defined to be the morphism $\Delta_V \lto X \otimes_R {}^\dual X$ in $\HMF(\Se, \widetilde{V})$ whose cohomology class is the preimage of the identity under the quasi-isomorphism \eqref{eq:othercoev11}. Once again using the homotopy inverses computed in Corollary \ref{corollary:koszulstab2} one finds two different chain maps lifting the identity: 
\begin{proposition} 
A representative for $\coev_X$ is the chain map \eqref{eq:coev102}.
\end{proposition}
\begin{proposition} 
A representative for $\coev_X$ is the chain map
\be
\gamma \lmt \sum_{l \ge 0} (-1)^{l + ml} \varepsilon \left( \Psi \At_1({}^\dual X)^l( \iota'_X ) \wedge \gamma \right) .
\ee
where $\iota'_X$ is as given in~\eqref{eq:iotaX}.
\end{proposition}

\begin{remark}\label{remark:coev_divideddiff} 
The above formulas can be rewritten in terms of divided difference operators. Applying \eqref{eq:atlarrow_formula} and \eqref{intro_psi} one computes that $\widetilde \coev_X$ has the description given in \eqref{eq:formula_intro_coev} of the introduction. Similarly if $\gamma = \theta_{a_1} \ldots \theta_{a_l} \in \Delta_V$ there is a unique $\gamma' = \theta_{b_1} \ldots \theta_{b_r}$ with $\gamma \wedge \gamma'$ a nonzero multiple of the top degree form, say $(-1)^{s(\gamma)} \theta_1 \cdots \theta_m$. So $l + r = n$ and one computes
\be\label{eq:coev_divideddiff}
\coev_X(\gamma) = \sum_{j,i} (-1)^{\binom{r}{2} + s(\gamma) + r + mr} \big\{ \partial_{[b_1]}(d_X) \ldots \partial_{[b_r]}(d_X) \big\}_{ij} e_{i} \otimes e_j^* 
\ee
where the divided difference operators act on $\Se = k[z,z']$.
\end{remark}

\subsection{Evaluation}\label{subsec:eval}
% see (eval)

In this section we construct the evaluation map $\widetilde\eval_X$ by writing down a morphism $\widetilde\eval_0: X \otimes_R X^\dual \lto S$ and then lifting this via perturbation to a morphism into $\Delta_V$. The other evaluation $\eval_X$ is defined in a similar way, and will be treated briefly at the end of the section.

The partial derivatives $f_i = \partial_{x_i} W$ act null-homotopically on $X$ and we let $\lambda_i \in \Hom_{R \otimes_k S}(X,X)$ denote a degree-one map with $[d_X, \lambda_i] = f_i \cdot 1_X$. The construction will turn out to be independent of this choice up to homotopy, although this is not completely obvious; see Remark \ref{remark:indeptlambda}. We also set $\Lambda^{(x)} = \lambda_1 \ldots \lambda_n$. For example, taking $\lambda_i = -\partial_{x_i} d_X$ would do since by the Leibniz rule
\[
\partial_{x_i}(d_X) d_X + d_X \partial_{x_i}(d_X) = \partial_{x_i}( d_X^2 ) = - \partial_{x_i} W\,.
\]
However it will be important to allow other choices of null-homotopy.

To begin with there is a canonical map (an $\Se $-linear morphism of linear factorisations of $\widetilde{V}$)
\be\label{eq:defneval0_00}
X \otimes_R X^{\vee}[n] \cong (X \otimes_R X^{\vee})[n] \lto \left( X \otimes_R X^{\vee} \right)[n] \otimes_R \bar{R} \cong (\bar{X} \otimes_R \bar{X}^{\vee})[n]
\ee
where we write $\bar{R} = R/(f_1,\ldots,f_n)$ and $\bar{X} = X \otimes_R \bar{R}$. Then we compose with
\be\label{eq:defneval0_0}
\xymatrix@C+2.5pc{
(\bar{X} \otimes_R \bar{X}^{\vee})[n] \ar[r]^-{\Lambda^{(x)} \otimes 1} & \bar{X} \otimes_R \bar{X}^{\vee}
}
\ee
which is closed because $\Lambda^{(x)}$ is a closed map $X[n] \lto X$ modulo the $f_i$. Finally we compose with
\be\label{eq:defneval0_1}
\xymatrix@C+1.5pc{
\bar{X} \otimes_R \bar{X}^{\vee} \ar[r]^-{\can} & S \otimes_{\Se} ( \bar{X} \otimes_R \bar{X}^{\vee} ) \cong \Hom_{R \otimes_k S}(\bar{X}, \bar{X}) \ar[r]^-{\str} & \bar{R} \otimes_k S \ar[r]^-{\Res} & S
}
\ee
where the last map marked is the $S$-linear residue symbol (see Section~\ref{section:residuebackground})
\[
\Res_{R/k} \left[ \frac{ (-) \, \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right]: \bar{R} \otimes_k S \lto S\,.
\]
We note that the first map in~\eqref{eq:defneval0_1} and the second in \eqref{eq:defneval0_1} are as defined in Section \ref{section:canonicalmaps}.

\begin{definition}\label{defn:widetildeevalzero} $\widetilde\eval_0$ is $(-1)^{\globalsigneval}$ times the composite of \eqref{eq:defneval0_00}, \eqref{eq:defneval0_0} and \eqref{eq:defneval0_1}.
\end{definition}

The global sign is determined by the Zorro move and the signs on the coevaluation. 

\begin{lemma}\label{lemma:morphismevalzero} $\widetilde\eval_0$ is a morphism of linear factorisations of $\widetilde{V}$ over $\Se $, and for $\eta \in X, \nu \in X^\vee$ we have 
\begin{align}
\widetilde\eval_0( \eta \otimes \nu ) &= (-1)^{\globalsigneval+n|\eta|} \Res_{R/k} \left[ \frac{ \str( \Lambda^{(x)} \circ \eta \circ \nu) \, \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right]\\
&= (-1)^{\globalsigneval+n|\eta| + |\nu|} \Res_{R/k} \left[ \frac{ \nu \Lambda^{(x)}( \eta ) \, \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right] . 
\end{align}
\end{lemma} 

There is a stabilisation morphism $\pi_\Delta: \Delta_V \lto S$, and while $X \otimes_R X^\dual$ is not free of finite-rank over $\Se $, it is a direct summand of a finite-rank matrix factorisation in $\HMF(\Se , \widetilde{V})$. The unique lifting statement of Proposition \ref{prop:liftingresult} can be extended to summands (for the argument, see the proof of the proposition below) so there is up to homotopy a unique morphism of matrix factorisations $\widetilde\eval_X$ making the following diagram commute:
\be\label{eq:defineeval}
\xymatrix{
X \otimes_R X^\dual \ar[dr]_-{\widetilde\eval_0} \ar@{.>}[rr]^-{\widetilde\eval_X} & & \Delta_V \ar[dl]^-{\pi_\Delta} \\
& S
} .
\ee

\begin{definition} $\widetilde\eval_X$ is the unique morphism in $\HMF(\Se , \widetilde{V})$ making \eqref{eq:defineeval} commute.
\end{definition}

The formula for $\widetilde\eval_X$ involves the following $(\Se \otimes_k R)$-linear map
\begin{gather*}
(-,-): X \otimes_R X^{\vee} \lto \Se \otimes_k R\,,\qquad 
( e_i, e_j^* ) = (-1)^{|e_i||e_j|} e_j^*( e_i ) = (-1)^{|e_i|} \delta_{ij}\,.
\end{gather*}
This pairing is simply evaluation (with an appropriate Koszul sign) modulo the fact that $X$ and its dual $X^{\vee}$ involve different copies of the ring $S$.

\begin{proposition}\label{prop:constructevalmap} A representative for $\widetilde\eval_X$ is the chain map \eqref{eq:constructevalmap00}.
\end{proposition}

To be clear, the numerator of the residue in \eqref{eq:constructevalmap00} is the image of $\Lambda^{(x)}(\eta) \otimes \nu$ under the map
\[
\xymatrix@C+1pc{
X \otimes_R X^{\vee} \ar[r]^-{\lAt_2(X)^l} & \Bar \otimes_{\Se}(X \otimes_R X^{\vee} ) \ar[r]^-{1 \otimes (-,-)} & \Bar \otimes_{\Se} ( \Se \otimes_k R ) \cong \Bar \otimes_k R \ar[r]^-{\Psi \otimes 1} & \Delta_V \otimes_k R
}
\]
where $\lAt_2(X) = [d, d_X]$, $\Bar = \Bar_{S/k}$. The residue integrates out the $R$, leaving an element of $\Delta_V$.

As has already been mentioned, if $X \otimes_R X^\dual$ were finite-rank we could apply Proposition \ref{prop:liftingresult} directly to deduce a formula for the lifting $\widetilde\eval_X$. As this is not the case, we have to be a little indirect and appeal to the idempotent pushforward construction of \cite{dm1102.2957}. Specifically, with $\bar{R} = R/(f_1,\ldots,f_n)$, Theorem $7.4$ of loc.\,cit.~shows that there is a diagram
\be\label{eq:idempotentpushdia}
\xymatrix@C+2pc{
X \otimes_R X^\vee[n] \cong (X \otimes_R X^\vee)[n] \ar@<-1ex>[r]_-{\vartheta} & \bar{X} \otimes_{\bar{R}} \bar{X}^\vee := (X \otimes_R X^\vee) \otimes_R \bar{R} \ar@<-1ex>[l]_-{\psi}
}
\ee
in $\HMF(\Se , \widetilde{V})$ with $\psi \circ \vartheta = 1$ in the homotopy category and $\vartheta = \Lambda^{(x)} \otimes 1$. Observe that since $W$ is a potential, $R/(f_1,\ldots,f_n)$ is a finitely generated free $k$-module and $\bar{X} \otimes_{R} \bar{X}^\vee$ is therefore a finite-rank matrix factorisation of $\widetilde{V}$ over $\Se$.

\begin{proof}[Proof of Proposition \ref{prop:constructevalmap}] To lift $\widetilde\eval_0: X \otimes_R X^{\vee}[n] \lto S$, consider the commutative diagram
\be\label{eq:proofconstructevalmap}
\xymatrix@C+2pc{
\Hom_{\Se }( X \otimes_R X^\vee[n], \Delta ) \ar[d]_{\pi^\bullet_\Delta} \ar@<-1ex>[r]_-{\psi_\bullet} & \Hom_{\Se }(\bar{X} \otimes_{R} \bar{X}^\vee, \Delta ) \ar@<-1ex>[l]_-{\vartheta_\bullet} \ar[d]^{\pi^\bullet_\Delta}\\
\Hom_{\Se }( X \otimes_R X^\vee[n], S ) \ar@<-1ex>[r]_-{\psi_\bullet} & \Hom_{\Se }( \bar{X} \otimes_{R} \bar{X}^\vee, S) \ar@<-1ex>[l]_-{\vartheta_\bullet}
}
\ee
where a ``$\bullet$'' as a superscript indicates postcomposition and as a subscript it denotes precomposition, and we leave the isomorphism $X \otimes_R X^\vee[n] \cong (X \otimes_R X)[n]$ implicit throughout. By Proposition \ref{prop:liftingresult} the right-hand vertical map is a homotopy equivalence and therefore so is the left-hand vertical map. This justifies why in \eqref{eq:defineeval} there is a unique morphism $\widetilde\eval_X$ making the diagram commute: it is the image in cohomology of $\widetilde\eval_0$ under the homotopy inverse of $\pi_{\Delta}^\bullet$.

Let $\widetilde\eval'_0$ denote $(-1)^{\globalsigneval}$ times the morphism in \eqref{eq:defneval0_1} so that $\widetilde\eval_0 = \vartheta_\bullet( \widetilde\eval'_0 )$, and let $\widetilde\eval'$ denote the morphism $\bar{X} \otimes_{\bar R} \bar{X}^\vee \lto \Delta$ lifting $\widetilde\eval'_0$ which is produced by Proposition \ref{prop:liftingresult}. To run the lifting construction we need to fix an $\Se $-basis for $\bar{X} \otimes_{\bar R} \bar{X}^\vee$. The basis we pick is $\{ g_\alpha e_i \otimes e_j ^* \}_{\alpha, i, j}$ where $g_\alpha$ gives a $k$-basis of $\bar{R}$. We define $\widetilde\eval_X = \vartheta_\bullet( \widetilde\eval' ) = \widetilde\eval' \circ (\Lambda^{(x)} \otimes 1)$. By construction this morphism makes \eqref{eq:defineeval} commute, and it just remains to compute it explicitly.

The statement of Proposition \ref{prop:liftingresult} gives us
\[
\widetilde\eval_X = \sum_{l \ge 0} (-1)^{l} \Psi \circ (1 \otimes \widetilde\eval''_0) \circ \lAt(X \otimes X^\vee)^l \circ ( \Lambda^{(x)} \otimes 1 )
\]
where $\widetilde\eval''_0: \bar{X} \otimes_{\bar{R}} \bar{X}^\vee \lto \Se $ is the $\Se $-linear map defined by $\widetilde\eval''_0( g_\alpha e_i \otimes e_j^* ) = 1 \otimes \widetilde\eval'_0( f_\alpha e_i \otimes e_j^* )$. In $d_{X \otimes X^\vee} = d_X \otimes 1 + 1 \otimes d_{X^\vee}$ only $d_X$ involves polynomials in $R_1$, so $\lAt(X \otimes X^\vee) = \lAt(X)$. We compute using \eqref{eq:leftatiyahexp} that for $g \in R$ (writing $D = d_X$, and putting in the sign $n|e_i|$ from the first map of \eqref{eq:defneval0_00})
\begin{align*}
\widetilde\eval_X( g e_i \otimes e_j^* ) &= \sum_{l \ge 0} (-1)^{l+n|e_i|} \Psi (1 \otimes \widetilde\eval''_0)\left( g \sum_k \lAt(X)^l( \Lambda^{(x)}_{ki} e_k \otimes e_j ^*) \right)\\
&= \sum_{l \ge 0} (-1)^{l+n|e_i|} \Psi (1 \otimes \widetilde\eval''_0)\left( g \sum_{k, k_1, \ldots, k_l} \Lambda^{(x)}_{ki} \cdot d( D_{k_1k} ) \ldots d( D_{k_l k_{l-1}} ) \otimes e_{k_l} \otimes e_j^* \right)
\end{align*}
Applying $\widetilde\eval''_0$ involves taking the supertrace $\str( e_{k_l} \circ e_j^* ) = (-1)^{|e_j|}\delta_{jk_l}$ so that the above equals
\[
\sum_{l \ge 0} \sum_{k,k_1,\ldots,k_{l-1}} (-1)^{\globalsigneval+l+n|e_i|+|e_j|} \Lambda^{(x)}_{ki} \Psi( d(D_{k_1,k}) \ldots d(D_{j,k_{l-1}}) ) \Res_{R/k} \left[ \frac{ g \,  \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right]
\]
which agrees with \eqref{eq:constructevalmap00} for $\eta = g e_i$ and $\nu = e_j^*$, completing the proof.
\end{proof}

Next we give a brief explanation of the derivation of $\eval_X$. The partial derivatives $\partial_{z_i} V$ act null-homotopically on $X$ and we let $\lambda_i^{(z)} \in \Hom_{R \otimes_k S}(X,X)$ denote a degree-one map with $[d_X, \lambda_i^{(z)}] = \partial_{z_i} V \cdot 1_X$. For example $\lambda_i^{(z)} = \partial_{z_i} d_X$ would do. We set $\Lambda^{(z)} = \lambda_1^{(z)} \ldots \lambda_m^{(z)}$.

We define an operator $\lambda_{i \bullet}^{(z)}$ on $X^{\vee}$ by
\[
\lambda_{i \bullet}^{(z)} {}(\alpha) = (-1)^{|\alpha|} \lambda_i^{(z)} \circ \alpha\,.
\]
It is easily checked that $[d_{X^\vee}, \lambda_{i \bullet}^{(z)}] = \partial_{z_i} V \cdot 1_{X^\vee}$, so this is a null-homotopy for the action of $\partial_{z_i} V$. With $\bar{S} = S/(\partial_{z_1} V, \ldots, \partial_{z_m} V)$ there is an $\Re$-linear morphism of linear factorisations of $\widetilde{W}$
\be\label{eq:ordinaryeval00}
\xymatrix{
{}^\dual X \otimes_S X \cong X^{\vee}[m] \otimes_S X \ar[r] & \bar{X}^{\vee}[m] \otimes_S \bar{X} \ar[rrr]^-{\lambda^{(z)}_{m \bullet} \circ \cdots \circ \lambda^{(z)}_{1 \bullet} \otimes 1} & & & \bar{X}^{\vee} \otimes_S \bar{X}
}
\ee
which we can compose with
\be\label{eq:ordinaryeval01}
\xymatrix@C+1pc{
\bar{X}^{\vee} \otimes_S \bar{X} \ar[r]^-{\can} & S \otimes_{\Se}( \bar{X}^{\vee} \otimes_S \bar{X} ) \cong \Hom_{R \otimes_k S}(\bar{X}, \bar{X}) \ar[r]^-{\str} & R \otimes_k \bar{S} \ar[r]^-{\Res} & R
}
\ee
where the last map is the $R$-linear residue symbol 
\[
\Res_{S/k} \left[ \frac{ (-) \, \underline{\operatorname{d}\!z}}{\partial_{z_1}V, \ldots, \partial_{z_m} V} \right]: R \otimes_k \bar{S} \lto R\,.
\]

\begin{definition} $\eval_0$ is $(-1)^{\binom{m}{2}}$ times the composite of \eqref{eq:ordinaryeval00} and \eqref{eq:ordinaryeval01}.
\end{definition}

\begin{lemma} $\eval_0$ is a morphism of linear factorisations of $\widetilde W$ over $\Re$, and for $\eta \in X, \nu \in X^\vee$
\begin{align}
\eval_0( \nu \otimes \eta ) &= (-1)^{|\nu|} \Res_{S/k}\left[ \frac{ \str( \Lambda^{(z)} \circ \eta \circ \nu ) \, \underline{\operatorname{d}\!z}}{\partial_{z_1}V, \ldots, \partial_{z_m} V} \right]\\
&= \Res_{S/k} \left[ \frac{ \nu \Lambda^{(z)}( \eta ) \, \underline{\operatorname{d}\!z}}{\partial_{z_1}V, \ldots, \partial_{z_m} V} \right]\,.
\end{align}
\end{lemma}

We define $\eval_X$ to be the unique morphism in $\HMF(\Re, \widetilde{W})$ making the diagram
\be
\xymatrix{
{}^\dual X \otimes_S X \ar[dr]_-{\eval_0} \ar@{.>}[rr]^-{\eval_X} & & \Delta_W \ar[dl]^-{\pi_\Delta} \\
& R
} .
\ee
The existence of such a unique morphism, and the explicit formula for it, are established as before. First we have to write the infinite-rank matrix factorisation $X^{\vee}[m] \otimes_S X$ as a direct summand of a finite-rank factorisation as in \eqref{eq:idempotentpushdia}. Then Proposition \ref{prop:liftingresult} applies to this finite-rank factorisation in which we have embedded to produce the desired lifting.

\begin{proposition}\label{prop:constructevalmapnontilde} A representative for $\eval_X$ is the chain map \eqref{eq:constructevalmap01}.
\end{proposition}

The formula for $\eval_X$ involves the $(\Re \otimes_k S)$-linear map
$$
(-,-): X^{\vee} \otimes_S X \lto \Re \otimes_k S 
\, , \qquad 
( e_i^*, e_j ) = e_i^*( e_j ) = \delta_{ij}\,.
$$
The numerator of the residue in \eqref{eq:constructevalmap01} is the image of $\nu \circ \Lambda^{(z)} \otimes \eta$ under the map
\[
\xymatrix@C+1pc{
X^{\vee} \otimes_S X \ar[r]^-{\lAt_2(X^{\vee})^l} & \Bar \otimes_{\Re}(X^{\vee} \otimes_S X ) \ar[r]^-{1 \otimes (-,-)} & \Bar \otimes_{\Re} ( \Re \otimes_k S ) \cong \Bar \otimes_k S \ar[r]^-{\Psi \otimes 1} & \Delta_W \otimes_k S
}
\]
The residue integrates out the $S$, leaving us with an element of $\Delta_W$. By the argument given in Remark \ref{remark:indeptlambda} the morphism $\eval_X$ is independent of the choices of null-homotopy $\lambda^{(z)}_i$.

\begin{remark}\label{remark:indeptlambda} 
The morphisms $\widetilde\eval_X$ and $\eval_X$ are independent, up to homotopy, of the choices of null-homotopies $\lambda_i$. To justify this claim it clearly suffices to argue that $\widetilde\eval_0$ and $\eval_0$ are independent of the choices, and this is a consequence of the remarks in Appendix \ref{app:reshom}. In fact it is also shown there that, up to the sign of the relevant permutation, $\widetilde\eval_X$ and $\eval_X$ are independent up to homotopy of the chosen \textsl{ordering} of the homotopies $\lambda_i$. 
\end{remark}

\begin{remark}\label{remark:explicitev} The formulas for $\widetilde\eval_X$ and $\eval_X$ can be written in terms of divided difference operators as follows: for $g \in R$ we have
\begin{align}
\widetilde\eval_X( g e_j \otimes e_i^* ) = \sum_{l \ge 0} \sum_{i_1 < \cdots < i_l} &(-1)^{\binom{l+1}{2} + nl + (n+1)|e_i|} \, \theta_{i_1} \ldots \theta_{i_l} \\
&\cdot \Res_{R/k} \left[ \frac{ \left\{ \partial_{[i_1]}( d_X ) \ldots \partial_{[i_l]}(d_X) \Lambda^{(x)} \right\}_{ij} g \, \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right] .\nonumber
\end{align}
In this formula the divided difference operators act on $\Se = k[z,z']$. Similarly for $g \in S$,
\begin{align}
\eval_X( e_i^* \otimes g e_j ) = \sum_{l \ge 0} \sum_{i_1 < \cdots < i_l} &(-1)^{\binom{l}{2}+ml+l|e_i|} \, \theta_{i_1} \ldots \theta_{i_l}  \\
&\cdot \Res_{S/k} \left[ \frac{ \left\{ \Lambda^{(z)} \partial_{[i_1]}( d_X ) \ldots \partial_{[i_l]}(d_X) \right\}_{ij} g \, \underline{\operatorname{d}\!z}}{\partial_{z_1}V, \ldots, \partial_{z_m} V} \right] ,\nonumber
\end{align}
where the divided difference operators in this case act on $\Re = k[x,x']$.
\end{remark}

\subsection{Migration of $2$-morphisms}\label{section:natevcoev}

We end this section with a discussion of the naturality of the evaluation and coevaluation maps, which in diagrammatic notation amounts to a freedom to ``migrate'' $2$-morphisms around a cap or a cup. For a morphism $\varphi: X \lra Y$ in $\hmf(k[x_1,\ldots,x_n,z_1,\ldots,z_m], V-W)$ 
we define
$$
{}^\dual \varphi = \varphi^\vee[m] : {}^\dual Y \lra {}^\dual X \, , \qquad
\varphi^\dual = \varphi^\vee[n] : Y^\dual \lra X^\dual \, . 
$$

\begin{proposition}
\label{prop.morphismmigration}
 For a morphism $\varphi: X \lra Y$ as above we have
\begin{enumerate}
\item $(\varphi \otimes 1_{{}^\dual X}) \circ \coev_X = (1_Y \otimes {}^\dual \varphi) \circ \coev_Y$, 
\item $\eval_Y \circ (1_{{}^\dual Y} \otimes \varphi) = \eval_X \circ ({}^\dual \varphi \otimes 1_X)$, 
\item ${}^\dual \varphi = \lambda_{{}^\dual X} \circ (\eval_Y \otimes 1_{{}^\dual X}) \circ (1_{{}^\dual Y} \otimes \varphi \otimes 1_{{}^\dual X}) \circ (1_{{}^\dual Y} \otimes \coev_X) \circ \rho^{-1}_{{}^\dual Y}$
\end{enumerate}
and similarly for $\widetilde\eval$ and $\widetilde\coev$. Diagrammatically the above identities read
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,-1) and +(0,-1) .. (s);
\fill (2,0.5) circle (2.5pt) node[left] {{\small $\varphi$}};
\draw (3,0.35) -- (3,1)
node[above] {{{\small${}^\dual X$}}};
\draw (2,0.35) -- (2,1)
node[above] {{{\small$Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,-1) and +(0,-1) .. (s);
\fill (3,0.5) circle (2.5pt) node[right] {{\small ${}^\dual \varphi$}};
\draw (3,0.35) -- (3,1)
node[above] {{{\small${}^\dual X$}}};
\draw (2,0.35) -- (2,1)
node[above] {{{\small$Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
\, , \qquad
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\fill (3,0.5) circle (2.5pt) node[right] {{\small $\varphi$}};
\draw (3,0.65) -- (3,0)
node[below] {{{\small$X\vphantom{{}^\dual Y}$}}};
\draw (2,0.65) -- (2,0)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\fill (2,0.5) circle (2.5pt) node[left] {{\small ${}^\dual \varphi$}};
\draw (3,0.65) -- (3,0)
node[below] {{{\small$X\vphantom{{}^\dual Y}$}}};
\draw (2,0.65) -- (2,0)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
\, , \qquad
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\fill (3,0.5) circle (2.5pt) node[right] {{\small ${}^\dual \varphi$}};
\draw (3,0) -- (3,1.5)
node[above] {{{\small${}^\dual X$}}};
\draw (3,0) -- (3,-0.5)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,-1) and +(0,-1) .. (s);
\fill (2,0.5) circle (2.5pt) node[right] {{\small $\varphi$}};
\draw (2,0.32) -- (2,0.68);
\draw[line width=0pt] 
(2,0.5) node[line width=0pt] (D) {}
(1,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,+1) and +(0,+1) .. (s);
\draw (3,0.35) -- (3,1.5)
node[above] {{{\small${}^\dual X$}}};
\draw (1,0.65) -- (1,-0.5)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
\, . 
$$
\end{proposition}

\begin{proof}
Consider the diagrams
$$
\xymatrix{%
\Hom(\Delta, X \otimes {}^\dual X) \ar[rr]^-{(\varphi \otimes 1)\circ(-)} && \Hom(\Delta, Y \otimes {}^\dual X) \\
\Hom(X,X) \ar[rr]_-{\varphi\circ(-)} \ar[u]^-{\cong} && \Hom(X,Y)\,, \ar[u]_-{\cong}
}%
\quad
\xymatrix{%
\Hom(\Delta, Y \otimes {}^\dual Y) \ar[rr]^-{(1 \otimes {}^\dual \varphi)\circ(-)} && \Hom(\Delta, Y \otimes {}^\dual X) \\
\Hom(Y,Y) \ar[rr]_-{(-)\circ\varphi} \ar[u]^-{\cong} && \Hom(X,Y)\,, \ar[u]_-{\cong}
}%
$$
where the vertical maps are analogous to~\eqref{eq:isogivescoev2}. By their naturality both diagrams commute. The counterclockwise maps send $1_X \in \Hom(X,X)$ and $1_Y \in \Hom(Y,Y)$ to the same element in $\Hom(\Delta, {}^\dual X \otimes Y)$. Thus the two sides of part~(i) are equal as they are the images of~$1_X$,~$1_Y$ under the clockwise maps. 

To prove part~(iii) we only have to apply a Zorro move and use part~(i), and with this part~(ii) follows together with another Zorro move: 
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\fill (3,0.5) circle (2.5pt) node[right] {{\small ${}^\dual \varphi$}};
\draw (3,0) -- (3,1.5)
node[above] {{{\small${}^\dual X$}}};
\draw (3,0) -- (3,-0.5)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,-1) and +(0,-1) .. (s);
\fill (3,0.5) circle (2.5pt) node[left] {{\small ${}^\dual \varphi$}};
\draw (2,0.32) -- (2,0.68);
\draw[line width=0pt] 
(2,0.5) node[line width=0pt] (D) {}
(1,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,+1) and +(0,+1) .. (s);
\draw (3,0.35) -- (3,1.5)
node[above] {{{\small${}^\dual X$}}};
\draw (1,0.65) -- (1,-0.5)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,-1) and +(0,-1) .. (s);
\fill (2,0.5) circle (2.5pt) node[right] {{\small $\varphi$}};
\draw (2,0.32) -- (2,0.68);
\draw[line width=0pt] 
(2,0.5) node[line width=0pt] (D) {}
(1,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,+1) and +(0,+1) .. (s);
\draw (3,0.35) -- (3,1.5)
node[above] {{{\small${}^\dual X$}}};
\draw (1,0.65) -- (1,-0.5)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
\Rightarrow
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\fill (3,0.5) circle (2.5pt) node[left] {{\small $\varphi$}};
\draw (3,0.65) -- (3,-0.5)
node[below] {{{\small$X\vphantom{{}^\dual Y}$}}};
\draw (2,0.65) -- (2,-0.5)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(0,0.5) node[line width=0pt] (D) {}
(-1,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\fill (0,0.5) circle (2.5pt) node[left] {{\small $\varphi$}};
\draw (2,0.65) -- (2,-0.5)
node[below] {{{\small$X\vphantom{{}^\dual Y}$}}};
\draw (-1,0.65) -- (-1,-0.5)
node[below] {{{\small${}^\dual Y$}}};
\draw (2,0.32) -- (2,0.68);
\draw[line width=0pt] 
(2,0.5) node[line width=0pt] (D) {}
(1,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,+1) and +(0,+1) .. (s);
\draw[line width=0pt] 
(1,0.5) node[line width=0pt] (D) {}
(0,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,-1) and +(0,-1) .. (s);
\draw (1,0.32) -- (1,0.68);
\draw (0,0.32) -- (0,0.5);
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,1) and +(0,1) .. (s);
\fill (2,0.5) circle (2.5pt) node[right] {{\small ${}^\dual \varphi$}};
\draw (3,0.65) -- (3,-0.5)
node[below] {{{\small$X\vphantom{{}^\dual Y}$}}};
\draw (2,0.65) -- (2,-0.5)
node[below] {{{\small${}^\dual Y$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
\, . 
$$
The obvious analogous identities for $\widetilde\eval$ and $\widetilde\coev$ follow in the same way. 
\end{proof}

\section{Zorro moves}\label{sec:Zorro}

In this section we will show that the bicategory $\LG$ of Landau-Ginzburg models has adjoints, by proving that the evaluation and coevaluation morphisms of Section \ref{sec:derivcoeval} satisfy the Zorro moves. Let us fix two arbitrary potentials $W\in k[x] = k[x_1,\ldots,x_n]$ and $V\in k[z] = k[z_1,\ldots,z_m]$. Then we want to prove that for any matrix factorisation $X\in \hmf(k[x,z], V-W)$ and its left and right adjoints ${}^\dual X, X^\dual \in \hmf(k[x,z], W-V)$ the Zorro moves~\eqref{Zorros} and~\eqref{otherZorros} are satisfied. 

Let us consider the first identity of~\eqref{otherZorros} in more detail: 
\be\label{Zorro1detail}
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]

\fill (0.2,1.6) circle (0pt) node {{\small $\Delta_V$}};
\fill (-0.2,-1.6) circle (0pt) node {{\small $\Delta_W$}};

\fill (1,1.8) circle (2.5pt) node[right] {{\small $\lambda$}};
\fill (-1,-1.8) circle (2.5pt) node[left] {{\small $\rho^{-1}$}};

%\fill (-1.25,-2.25) circle (0pt) node {{\footnotesize $S$}};
%\fill (-0.75,-2.25) circle (0pt) node {{\footnotesize $R$}};

\fill (-1.25,0) circle (0pt) node {{\footnotesize $S\vphantom{S}$}};
\fill (-0.5,0) circle (0pt) node {{\footnotesize $R\vphantom{R}$}};
\fill (0.5,0) circle (0pt) node {{\footnotesize $S\vphantom{R}$}};
\fill (1.25,0) circle (0pt) node {{\footnotesize $R\vphantom{S}$}};

%\fill (1.25,2.25) circle (0pt) node {{\footnotesize $R$}};
%\fill (0.75,2.25) circle (0pt) node {{\footnotesize $S\vphantom{R}$}};

\draw[dashed] (-0.5,0.75) .. controls +(0,0.75) and +(-0.25,-0.75) .. (1,1.8);
\draw[dashed] (0.5,-0.75) .. controls +(0,-0.75) and +(0.25,0.75) .. (-1,-1.8);

\draw[line width=0] 
(1,2.7) node[line width=0pt] (A) {{\small $X$}}
(-1,-2.7) node[line width=0pt] (A2) {{\small $X$}}; 
\draw[redirected] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,-1) and +(0,-1) .. (0,0);
\draw (-1,0) -- (A2); 
\draw (1,0) -- (A); 
\end{tikzpicture}
=
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(0,2.7) node[line width=0pt] (A) {{\small $X$}}
(0,-2.7) node[line width=0pt] (A2) {{\small $X$}}; 
\draw (A2) -- (A); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\ee
Here we label the domains by the rings $R = k[x]$ and $S = k[z]$ pertaining to the two objects of $\LG$. We keep in mind that there are two $\Delta$'s which appear: one of which is an $R$-$R$-bimodule, and the other is an $S$-$S$-bimodule. We write $\Re = R_1 \otimes_k R_2$ with $R_i = R$ and $\Se  = S_1 \otimes_k S_2$ with $S_i = S$.

We call the left-hand side of (\ref{Zorro1detail}) the \textsl{Zorro map} and denote it $\mathcal Z$. It is the composite
\be\label{eq:zorro1a1}
\xymatrix@C+2pc{
X \ar[r]^-{\rho^{-1}} & X \otimes_R \Delta_W \ar[r]^-{1 \otimes\,\widetilde{\coev}} & X \otimes_R X^{\dagger} \otimes_S X \ar[r]^-{\widetilde{\eval}\, \otimes 1} & \Delta_V \otimes_S X \ar[r]^-{\lambda} & X\,,
}
\ee
and we will prove in detail that this map is homotopic to the identity on $X$. Since the argument is very similar for the other identity of \eqref{otherZorros} and the two identities of \eqref{Zorros}, we do not give full details in these cases, but see Remark \ref{remark:otherzorros}.

Note that we continue to discard subscripts that are clear from the context, e.\,g.~$\widetilde\eval = \widetilde\eval_X$. Our first order of business is to establish the expression for the Zorro map given in the next lemma. For this we need to introduce the $R_2$-linear map
$$
\big\langle\!\big\langle - \big\rangle\!\big\rangle: \Bar \lto R_2 
\, ,\qquad
\big\langle\!\big\langle \alpha \big\rangle\!\big\rangle = \Res_{\Re /R_2} \left[ \frac{ \varepsilon\Psi( \alpha ) \, \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right] .
$$
We use the maps $\varepsilon$ and $\Psi$ of Section~\ref{sec:Background} and $\underline{\operatorname{d}\!x}=\operatorname{d}\!x_1\ldots \operatorname{d}\!x_n$. To be clear, this differential form and the $\partial_{x_i} W$ in the denominator of the residue are all viewed as elements of $R_1$, the copy of $R$ which is integrated out by the residue.

Let $\{ e_i \}_{i}$ be a homogeneous $(S \otimes_k R)$-basis of $X$, $\{ e_i^* \}_{i}$ the dual basis and $\{ e_{ij} = e_i \circ e_j^* \}_{i,j}$ the determined basis of $\End(X) = \Hom_{S \otimes_k R}(X,X)$. Throughout this section an undecorated $\At$ denotes the Atiyah class $\At_2( \End(X) )$ of this complex, which we recall is the operator on $\End(X) \otimes_{R_1} \Bar$ determined by the basis $e_{ij}$ using the convention of Remark \ref{remark:linearatother}.

As before let $\lambda_i$ be a null-homotopy on $X$ for the action of $\partial_{x_i} W$, for example $\lambda_i= -\partial_{x_i}d_X(x,z)$, and set $\Lambda = \lambda_1\ldots \lambda_n$. Postcomposition with $\Lambda$ gives a well-defined operator $\Lambda^\bullet$ on $\End(X) \otimes_{R_1} \Bar$.

\begin{lemma}\label{lemma:Zorrointermediate} We have
\be\label{Zorrointermediate}
\mathcal Z = \sum_j (-1)^{n+|e_j|} \big\langle\!\big\langle \str \big( \Lambda \circ \At^n (-\circ e_j^*) \big) \big\rangle\!\big\rangle \cdot e_j\,.
\ee
\end{lemma}

\begin{remark} Before giving the proof of the lemma, let us sketch out the proof that $\mathcal Z$ is homotopic to the identity. The idea is that this should follow from skew-symmetry of $\At$, i.\,e.~up to homotopy
\be\label{eq:untrueformula}
\big\langle\!\big\langle \str \big( - \circ \At (-)\big) \big\rangle\!\big\rangle \simeq - \big\langle\!\big\langle \str \big( \At(-) \circ -\big) \big\rangle\!\big\rangle\,.
\ee
Unfortunately we do not know how to make sense of the right-hand side of this identity, let alone prove it. We expect a more thorough study of associative Atiyah classes will make possible a precise statement about skew-symmetry of the Atiyah class of $\End(X)$. But let us ignore this problem for a moment, freely use \eqref{eq:untrueformula}, and see where our daring gets us: we calculate that for $\varphi \in \End(X) \otimes_{R_1} \Bar$, there are homotopies of functionals of the variable $\varphi$: 
\begin{align*}
\dlangle \str \big( \lambda_1 \cdots \lambda_n \circ \At (\varphi) \big) \drangle &\simeq -\dlangle \str \big( \At(\lambda_1 \cdots \lambda_n) \circ \varphi \big) \drangle\\
&\simeq - \sum_{i=1}^n (-1)^{i+1}\dlangle \str \big( \lambda_1 \cdots \At(\lambda_i) \cdots \lambda_n \circ \varphi \big) \drangle\\
&\simeq -\sum_{i=1}^n (-1)^{i+1} \dlangle df_i \str \big( \lambda_1 \cdots \widehat{\lambda}_i \cdots \lambda_n \circ \varphi \big) \drangle\,.
\end{align*}
We will not make sense of the two intermediate steps, but the initial and final terms are well-defined and we prove that they are homotopic functionals of $\varphi$ as the $p = 0$ case of Lemma \ref{lemma:zorromain} below. In this way we may, by omitting the ill-defined intermediate steps, proceed ``using'' the skew-symmetry \eqref{eq:untrueformula} to prove the Zorro move. 

Taking $\varphi = \At^{n-1}(\alpha)$ in the above, we prove in Lemma \ref{lemma:zorromain} and Lemma \ref{lemma:langlecalc1} that
\begin{align*}
\dlangle \str &\big( \Lambda \circ \At^n( \alpha ) \big) \drangle \simeq 
-\sum_{i_1} (-1)^{i_1+1} \dlangle df_{i_1} \str \big( \lambda_1 \cdots \widehat{\lambda}_{i_1} \cdots \lambda_n \circ \At^{n-1}(\alpha) \big) \drangle\\
&\simeq (-1)^2 \sum_{i_1 \neq i_2} (-1)^{i_1+1+i_2+2} \dlangle (df_{i_1} df_{i_2} - df_{i_2} df_{i_1}) \str \big( \lambda_1 \cdots \widehat{\lambda}_{i_1} \cdots \widehat{\lambda}_{i_2} \cdots \lambda_n \circ \At^{n-2}(\alpha) \big) \drangle\\
&\simeq \cdots\\
&\simeq (-1)^n \sum_{\sigma \in S_n} (-1)^{|\sigma|} \dlangle df_{\sigma(1)} \cdots df_{\sigma(n)} \str( \alpha ) \drangle\\
&= (-1)^n \str( \alpha )
\end{align*}
where in the last step we use a standard fact of the residue calculus: integrating against the determinant of the matrix $( \partial_{[i]}(f_j) )$ is the identity. Applied to the formula \eqref{Zorrointermediate} this yields
\begin{equation}\label{eq:trueproofeq2}
\mathcal{Z} \simeq \sum_j (-1)^{|e_j|} \str(-\circ e_j^*) \cdot e_j = \sum_j \str(e_j^* \circ -) \cdot e_j = 1_X\, ,
\end{equation}
and the Zorro move is proved.
\end{remark}

\begin{proof}[Proof of Lemma \ref{lemma:Zorrointermediate}]
The proof rests on the central identity in Lemma~\ref{lemma:atshufat} for computing with Atiyah classes. Throughout we write $\At$ for $\At_2$. The image of a basis element $e_q$ under the first two maps of \eqref{eq:zorro1a1} is computed by the expressions in \eqref{eq:formula_rhoinverse} and \eqref{eq:coev10}, 
\begin{align}
(1 \otimes \widetilde{\coev}) \circ \rho^{-1}( e_q ) &= (1 \otimes \widetilde{\coev}) \sum_{l \ge 0} (-1)^l \Psi \At(X)^l (e_q)\nonumber\\
&= \sum_{j} \sum_{l+l'=n} (-1)^{n+nl'+|e_j|} \varepsilon\Big( \Psi \At(X)^l( e_q ) \wedge \Psi \Atlarrow(X^{\dual})^{l'}( e_j^* ) \otimes e_j \Big) \nonumber\\
&= \sum_{j} \sum_{l+l' = n} (-1)^{n+nl'+|e_j|} \varepsilon\Psi\Big( \At(X)^l( e_q ) \times \Atlarrow(X^{\dual})^{l'}( e_j^* ) \otimes e_j \Big) \label{eq:zorro1a12}
\end{align} 
where in the last step we use that $\Psi$ intertwines the shuffle product with the exterior product. 

In this formula $\At(X)$ is an operator on $X \otimes_{R_1} \Bar$, $\At(X^\dual)$ is an operator on $\gamma_*(\Bar) \otimes_{R_1} (X^\dual \otimes X)$, and we keep in mind the abuse detailed in Remark \ref{remark:ringactionsubtle}. Respectively these operators are the Atiyah classes of the $(S \otimes_k \Re)$-modules $X \otimes_{R_1} \Re$ and the pair $(X^\dual \otimes_S X, d_{X^\dual})$. Tensored over $\Re$ these modules form the $(\Se \otimes \Re)$-module
\be\label{eq:spacehipposattack}
(X \otimes_{R_1} \Re) \otimes_{\Re} (X^\dual \otimes_S X) \cong X \otimes_R X^\dual \otimes_S X\,.
\ee
Thus we are in a position to apply Lemma \ref{lemma:atshufat} and rewrite the shuffle product of Atiyah classes in \eqref{eq:zorro1a12} as a single Atiyah class, of the module in \eqref{eq:spacehipposattack}. In \eqref{eq:zorro1a12} the term inside the $\varepsilon \Psi ( - )$ belongs to $X \otimes \gamma_*(\Bar) \otimes X^\vee[n] \otimes X$. Moving the $\Bar$ to the right of the $X^\vee[n]$ introduces a sign $(-1)^{n( |e_j| + n + l' )}$.

We account for this sign by rewriting \eqref{eq:zorro1a12} as
\begin{align*}
\sum_{j} \sum_{l+l' = n} (-1)^{|e_j|+n(|e_j| + n + l') + n|e_j|} \varepsilon\Psi\Big( \At(X)^l( e_q ) \times \Atlarrow(X^{\dual})^{l'}( e_j^* ) \otimes e_j \Big)\,.
\end{align*}
Then Lemma \ref{lemma:atshufat} applies directly to show that
\[
(1 \otimes \widetilde{\coev}) \circ \rho^{-1}( e_q ) = \sum_j (-1)^{|e_j| + n|e_j|} \varepsilon \Psi\Big( \At(X \otimes_R X^{\vee}[n])^n(e_q \otimes e_j^*) \otimes e_j \Big)\,.
\]
To this we apply $\lambda \circ (\widetilde\eval \otimes 1)$, which amounts to the map $\widetilde\eval_0$ of Definition \ref{defn:widetildeevalzero}. Applying the first isomorphism of \eqref{eq:defneval0_00} yields
\[
\sum_j (-1)^{(n+1)|e_j| + n|e_q|} \varepsilon \Psi \Big( \At((X \otimes_R X^\vee)[n])^n( e_q \otimes e_j^* ) \otimes e_j \Big)\,.
\]
Since the Atiyah class of $Y[n]$ agrees with that of $Y$ (Remark \ref{remark:atofshift}), this is the same as
\[
\sum_j (-1)^{(n+1)|e_j|+n|e_q|} \varepsilon \Psi \Big( \At(X \otimes_R X^\vee)^n( e_q \otimes e_j^* ) \otimes e_j \Big)\,.
\]
The next step is to apply $(-) \otimes_{\Se} S$, that is, to identify the left and right actions of $S$, after which $X \otimes_R X^\vee$ becomes identified with $\End(X)$, and we are left with
\[
\sum_j (-1)^{(n+1)|e_j|+n|e_q|} \varepsilon \Psi \Big( \At( \End(X) )^n( e_q \circ e_j^* ) \otimes e_j \Big)\,.
\]
To finish applying $\widetilde\eval_0$ we compose with $\Lambda$, multiply by the global sign, supertrace and integrate:
\begin{align*}
\mathcal{Z}(e_q) &= \lambda \circ (\widetilde\eval \otimes 1) \circ (1 \otimes \widetilde\coev) \circ \rho^{-1}( e_q )\\
&= \sum_j (-1)^{n + (n+1)|e_j|+ n|e_q|}\Res_{\Re /R_2}\! \left[ \frac{ \varepsilon\Psi \str\Big( \Lambda \circ \At^n( e_q \circ e_j^* ) \Big) \underline{\operatorname{d}\! x} }{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right] \cdot e_j\\
&= \sum_j (-1)^{n + (n+1)|e_j|+n|e_q|} \big\langle\!\big\langle \str \big( \Lambda \circ \At^n (e_q\circ e_j^*) \big) \big\rangle\!\big\rangle \cdot e_j\,.
\end{align*}
The nonvanishing summands have $|e_q| = |e_j|$, so the sign in the last formula is $(-1)^{n+(n+1)|e_j| + n|e_q|} = (-1)^{n+|e_j|}$ and we have proven that the left- and right-hand sides of \eqref{Zorrointermediate} agree on basis elements $e_q$. To complete the proof it therefore suffices to argue that the right-hand side is $(S \otimes_k R)$-linear. But $S$-linearity is trivial and for $r \in R$ we use that the Atiyah class is right $\Re$-linear and Lemma \ref{lem:PsiToTheRight} to see that for $\eta \in X$
\begin{align}
\dlangle \str \big( \Lambda \circ \At^n (r \eta) \big) \drangle &= \dlangle \str \big( \Lambda \circ \At^n (\eta) \big) \cdot (r \otimes 1) \drangle\nonumber\\
&= \Res_{\Re /R_2}\! \left[ \frac{ \varepsilon\Psi \str\Big( \Lambda \circ \At^n( \eta ) \Big) \cdot (1 \otimes r) \underline{\operatorname{d}\! x} }{\partial_{x_1}W, \ldots, \partial_{x_n} W} \right]\nonumber\\
&= \dlangle \str \big( \Lambda \circ \At^n (\eta) \big) \drangle \cdot r\,.\label{eq:eatthemoon}
\end{align}
Hence both sides of \eqref{Zorrointermediate} are $(S \otimes_k R)$-linear and therefore agree.
\end{proof}

We write $\psi^\bullet$ for the operator $\psi^\bullet(\alpha \otimes \omega) = \psi \circ \alpha \otimes \omega$ on $\End(X) \otimes_{R_1} \Bar$, and $D = [d_X,-]$.

\begin{lemma}\label{lemma:lameadjoints} 
Given homogeneous $\psi \in \End(X)$ and $\varphi \in \End(X) \otimes_{R_1} \Bar$, 
\begin{align*}
\big\langle\!\big\langle \str( \psi \circ \At(\varphi) ) \big\rangle\!\big\rangle = - &\big\langle\!\big\langle d \str( D( \psi ) \circ \varphi ) \big\rangle\!\big\rangle + \dlangle \str\big( \big[ \psi^\bullet, d \big] ( D\varphi ) \big) \drangle\\
&- (-1)^{|\psi|}\dlangle \str\big( D(\psi) \circ d\varphi ) \big) \drangle \, . 
\end{align*}
\end{lemma}
\begin{proof}
The super Jacobi identity for operators on this tensor product gives 
\be\label{superJacobi0}
\big[ \psi^\bullet, \At \big] = \big[ \psi^\bullet, [d, D] \big] = (-1)^{|\psi|}\big[ D, \big[ \psi^\bullet, d \big] \big] - \big[ d, \big[ D, \psi^\bullet \big] \big]\,.
\ee
It is easy to see that $\str \circ d = d \circ \str$ and hence $\str \circ \At = 0$ so if we apply~\eqref{superJacobi0} to~$\varphi$ we find 
\begin{align*}
\dlangle \str\big( \psi \circ \At(\varphi) \big) \drangle &= (-1)^{|\psi|} \dlangle \str\big( \big[ D, \big[ \psi^\bullet, d \big] \big] \varphi \big) \drangle - \dlangle \str\big( \big[ d, \big[ D, \psi^\bullet \big] \big] \varphi \big) \drangle\\
&= \dlangle \str\big( \big[ \psi^\bullet, d \big] ( D\varphi ) \big) \drangle -  \dlangle d \str\big( \big[ D, \psi^\bullet \big] \varphi \big) \drangle - (-1)^{|\psi|}\dlangle \str\big( \big[ D, \psi^\bullet \big]( d \varphi ) \big) \drangle \, .
\end{align*}
But since $[D, \psi^\bullet] = D(\psi)^\bullet$ this is what we wanted to show.
\end{proof}

Given a sequence $\bs{i} = (i_1,\ldots,i_p)$ in $\{1, \ldots, n\}$ (not necessarily ascending) define $\ell(\bs{i}) = p$ and
\be
|\bs{i}| = \sum_{1 \le a < b \le p} \delta_{i_a > i_b}\, , \qquad \gamma(\bs{i}) = |\bs{i}| + i_1 + \ldots + i_p\,.
\ee
The empty sequence $\emptyset$ has length zero. We write $\Lambda_{i_1,\ldots,i_p}$ for the product $\Lambda = \lambda_1 \ldots \lambda_n$ with the $\lambda_{i_1},\ldots,\lambda_{i_p}$ omitted, and $f_i = \partial_{x_i} W$ as before.
%Let $D$ denote the differential on $\End(X)$, i.\,e.~the commutator with~$d_X$.

% see przor4
\begin{lemma}\label{lemma:zorromain} For $\varphi \in \End(X) \otimes_{R_1} \Bar$ and $0 \le p < n$ we have
\begin{align*}
\sum_{\ell(\bs{i}) = p} (-1)^{\gamma(\bs{i})} & \Big\langle\!\!\Big\langle d f_{i_1} \cdots d f_{i_p} \str\big( \Lambda_{i_1,\ldots,i_p} \circ \At(\varphi) \big) \Big\rangle\!\!\Big\rangle\\
&= \sum_{\ell(\bs{i}) = p+1} (-1)^{\gamma(\bs{i})+p} \Big\langle\!\!\Big\langle d f_{i_1} \cdots d f_{i_{p+1}} \str\big( \Lambda_{i_1,\ldots,i_p,i_{p+1}} \circ \varphi \big) \Big\rangle\!\!\Big\rangle + h_p( D \varphi )
\end{align*}
where the sums are over all sequences of length $p, p+1$, respectively, and
\[
h_p( \alpha ) = \sum_{\ell(\bs{i}) = p} (-1)^{\gamma(\bs{i})} \Big\langle\!\!\Big\langle d f_{i_1} \cdots d f_{i_p} \str\big( [ \Lambda_{i_1,\ldots,i_p}^\bullet, d](\alpha) \big) \Big\rangle\!\!\Big\rangle\,.
\]
\end{lemma}
\begin{proof}
Fix a sequence $\bs{i}$ of length $p$ and observe that for $q \notin \bs{i}$
\be\label{eq:lambdasigns}
\gamma( ( i_1, \ldots, i_p, q ) ) = \gamma(\bs{i}) + q + \sum_{1 \le a \le p} \delta_{i_a > q} = \gamma(\bs{i}) + q + p + \sum_{1\le b \le p} \delta_{i_b<q} \,.
\ee
Set $\psi = \Lambda_{i_1,\ldots,i_p}$ and $\eta = d f_{i_1} \cdots d f_{i_p}$. Then by the argument of Lemma \ref{lemma:lameadjoints}
\begin{align}
\dlangle \eta\, \str\big( \psi \circ \At(\varphi) \big) \drangle &= -\dlangle \eta\, d\, \str\big( D(\psi) \circ \varphi \big) \drangle \label{eq:hutch1}\\
&\qquad+  \dlangle \eta\, \str\big( [\psi^\bullet, d]( D\varphi ) \big) \drangle\label{eq:hutch2}\\
&\qquad- (-1)^{n-p}\dlangle \eta\, \str\big( D(\psi) \circ d\varphi \big) \drangle \, . \label{eq:hutch3}
\end{align}
Since $D(\lambda_i) = f_i$,
\be\label{eq:expansiondpsi}
D(\psi) = \sum_{q \notin \{ i_1, \ldots, i_p \} } (-1)^{q+1 + \sum_{1 \le b \le p} \delta_{i_b<q}} f_q \cdot \Lambda_{i_1,\ldots,i_p,q}
\ee
where the sign counts the number of $\lambda$'s appearing to the left of $\lambda_q$ in $\Lambda_{i_1,\ldots,i_p}$. We claim that the sum over all sequences of the last summand (\ref{eq:hutch3}), with the signs $(-1)^{\gamma(\bs{i})}$ given in the statement of the lemma, vanishes. Substituting \eqref{eq:expansiondpsi} the sum in question is
\begin{align*}
\sum_{\ell(\bs{i}) = p} \sum_{q \notin \bs{i}} &(-1)^{\gamma(\bs{i}) + q + 1 + \sum_{1 \le b \le p} \delta_{i_b<q}} \dlangle d f_{i_1} \cdots d f_{i_p} f_q \str\big( \Lambda_{i_1,\ldots,i_p,q} \circ d\varphi \big) \drangle\\
&= (-1)^{p+1}\sum_{\ell(\bs{i}) = p+1} (-1)^{\gamma(\bs{i})} \dlangle d f_{i_1} \cdots d f_{i_p} f_{i_{p+1}} \str\big( \Lambda_{i_1,\ldots,i_p,i_{p+1}} \circ d\varphi \big) \drangle
\end{align*}
which vanishes by Lemma \ref{lemma:langlecalc1} below, proving the claim.

The signed sum over all sequences of the remaining terms (\ref{eq:hutch1}) and (\ref{eq:hutch2}) gives us the right-hand side of the equation in the statement of the lemma, completing the proof.
\end{proof}

\begin{lemma}\label{lemma:banatechn} Given a sequence $\bs{i} = (i_1,\ldots,i_p)$ of length $p \ge 2$ and any $\omega \in \Bar$, 
\[
\sum_{\sigma \in S_p} (-1)^{|\sigma|} \dlangle d f_{i_{\sigma(1)}} \cdots d f_{i_{\sigma(p-1)}} f_{i_{\sigma(p)}} \omega \drangle = 0\,.
\]
\end{lemma}
\begin{proof}
For any permutation $\sigma$,
\begin{align}
\dlangle d f_{i_{\sigma(1)}} \cdots d f_{i_{\sigma(p-1)}} f_{i_{\sigma(p)}} \omega \drangle &= \dlangle d f_{i_{\sigma(1)}} \cdots d(f_{i_{\sigma(p-1)}} f_{i_{\sigma(p)}}) \omega \drangle\label{eq:bana1}\\
& \qquad - \dlangle d f_{i_{\sigma(1)}} \cdots f_{i_{\sigma(p-1)}} df_{i_{\sigma(p)}} \omega \drangle\,. \nonumber
\end{align}
When we sum over all permutations $\sigma$ the terms \eqref{eq:bana1} cancel pairwise due to the symmetry in exchanging $\sigma$ with $\sigma \circ (a, a-1)$. In this way we ``migrate'' the undifferentiated $f_i$ to the very left of the expression, where it annihilates with the residue in $\dlangle - \drangle$.
\end{proof}

% see przor4
\begin{lemma}\label{lemma:langlecalc1} For $\alpha \in \End(X)$ we have
\be\label{eq:langlecalc1}
\big\langle\!\big\langle \str \big( \Lambda \circ \At^n \alpha\big) \big\rangle\!\big\rangle = (-1)^{n} \str(\alpha) + \sum_{p=0}^{n-1} (-1)^{\binom{p}{2}} h_i( D \At^{n-p-1}\alpha )\,.
\ee
\end{lemma}
\begin{proof}
Applying Lemma \ref{lemma:zorromain} twice beginning with $\varphi = \At^{n-1}(\alpha)$ yields
\begin{align*}
\dlangle &\str( \Lambda \circ \At^n\alpha ) \drangle = \sum_{\ell(\bs{i}) = 1} (-1)^{\gamma(\bs{i})} \dlangle df_{i_1} \str( \Lambda_{i_1} \circ \At^{n-1}\alpha ) \drangle + h_0( D\At^{n-1}\alpha )\\
&= \sum_{\ell(\bs{i}) = 2} (-1)^{\gamma(\bs{i}) + 1} \dlangle df_{i_1} df_{i_2} \str( \Lambda_{i_1,i_2} \circ \At^{n-2}\alpha ) \drangle + h_0( D \At^{n-1} \alpha ) + h_1( D \At^{n-2} \alpha )\,.
\end{align*}
After $n$ steps we find that, writing $h(\alpha)$ for the second summand in \eqref{eq:langlecalc1},
\begin{align*}
\dlangle \str( \Lambda \circ \At^n\alpha ) \drangle &= \sum_{\ell(\bs{i}) = n} (-1)^{\gamma(\bs{i}) + \binom{n}{2}} \dlangle df_{i_1} \cdots df_{i_n} \str(\alpha) \drangle + h(\alpha)\\
&= (-1)^n \sum_{\sigma \in S_n} (-1)^{|\sigma|} \dlangle df_{\sigma(1)} \cdots df_{\sigma(n)} \str(\alpha) \drangle + h(\alpha)\\
&= (-1)^n \str(\varphi) + h(\alpha)\,.
\end{align*}
where in the last step we use the residue identity from Proposition~\ref{prop:determinantresidue}.
\end{proof}

Using the explicit formula for $\mathcal{Z}$ from Lemma \ref{lemma:Zorrointermediate} and the previous calculation, we compute that
\begin{align}
\mathcal{Z} &= \sum_j (-1)^{n+|e_j|} \big\langle\!\big\langle \str \big( \Lambda \circ \At^n (-\circ e_j^*) \big) \big\rangle\!\big\rangle \cdot e_j\nonumber\\
&= \sum_j (-1)^{|e_j|} \str(-\circ e_j^*) \cdot e_j + H\nonumber\\
&= \sum_j \str(e_j^* \circ -) \cdot e_j + H\nonumber\\
&= 1_X + H\label{eq:zorroequalsH}
\end{align}
where
\be\label{eq:defnmapH}
H = \sum_j \sum_{p=0}^{n-1} (-1)^{n+|e_j|+\binom{p}{2}} h_p( D \At^{n-p-1}(- \circ e_j^*) ) \cdot e_j\,.
\ee
As the difference of two closed maps $H = \mathcal{Z} - 1_X$ is a closed endomorphism of $X$, and to complete the proof that $\mathcal{Z} \simeq 1_X$ it remains only to prove that $H$ is null-homotopic.

The idea is to use the nondegenerate pairing on the mapping complexes of the dg-category of matrix factorisations  of $V-W$. If~$k$ is a field this is the Kapustin-Li pairing of \cite{kl0305,hl0404,m0912.1629,dyckmurf} but in general we use the contents of Section \ref{section:dualityadjointop}. The precise statement (Theorem \ref{theorem:generalkl}) is that there is a homotopy equivalence of $\nZ _2$-graded complexes over $k$
\be
\End(X) \lto \Hom_k( \End(X), k )[m+n]\,, \qquad \varphi \lmt \langle \varphi, - \rangle_X\,.
\ee
induced by the pairing
\begin{equation}\label{eq:bracketkl}
\langle \beta, \alpha \rangle_X = \Res_{R \otimes S/k} \left[ \frac{ \str( \beta \circ \alpha \circ \Lambda^{(x)} \Lambda^{(z)}) \, \underline{\operatorname{d}\!x} \underline{\operatorname{d}\!z}}{\partial_{x_1}W, \ldots, \partial_{x_n} W, \partial_{z_1} V, \ldots, \partial_{z_m} V} \right]
\end{equation}
where $\Lambda^{(x)} = \lambda_1 \cdots \lambda_n$ is the product of homotopies for the action of $\partial_{x_i}W$ introduced earlier, and $\Lambda^{(z)} = \mu_1 \cdots \mu_m$ is the product of homotopies for the action of $\partial_{z_j}V$ on~$X$. That is, $D( \mu_j ) = \partial_{z_j} V \cdot 1_X$. To be precise, the pairing \eqref{eq:generalklpairing} of the theorem symmetrises over permutations, but Lemma \ref{lemma:symmetrystrres} shows that this is not necessary; the pairings \eqref{eq:generalklpairing} and \eqref{eq:bracketkl} are homotopic.

To prove that $H: X \lto X$ is null-homotopic it is therefore sufficient to prove that $\langle H, - \rangle_X$ is a coboundary in the complex $\Hom_k( \End(X), k)$, or what is the same, that it can be factored through the differential $D$. This will follow from a careful study of the map $\str( H \circ - )$, the crux of which is: 
\begin{lemma}\label{lemma:strhalpha} For any even degree $\alpha \in \End(X)$,
\be\label{eq:strhalpha}
\str( H \circ \alpha ) = \sum_{p=0}^{n-1} (-1)^{n+\binom{p}{2}} h_p( D \At^{n-p-1} \alpha )\,.
\ee
\end{lemma}
\begin{proof}
By an argument similar to the one given in \eqref{eq:eatthemoon} one checks that for $r \in R$,
\be\label{eq:hpisgoodyes}
h_p( D \At^{n-p-1}( \alpha r ) ) = h_p( D \At^{n-p-1}(\alpha) ) \cdot r\,.
\ee
Hence to verify \eqref{eq:strhalpha} it suffices to check the case where $\alpha = e_i \circ e_j^*$ for some $i,j$, and this follows from the definition of $H$.
\end{proof}

\begin{theorem}\label{theorem:mainzorro} The Zorro map $\mathcal{Z}$ is homotopic to $1_X$.
\end{theorem}
\begin{proof}
It suffices to prove that $\langle H, - \rangle_X$ can be factored via the differential $D$. Writing $\Res\,\big[ - \big]$ for the residue in \eqref{eq:bracketkl} we compute using Lemma \ref{lemma:strhalpha} that for $\alpha \in \End(X)$,
\begin{align*}
\langle H, \alpha \rangle_X &= \Res\,\big[ \str( H \circ \alpha \circ \Lambda^{(x)} \Lambda^{(z)} ) \big]\\
&= \sum_{p=0}^{n-1} (-1)^{n+\binom{p}{2}} \Res\,\big[ h_p D\At^{n-p-1}( \alpha \circ \Lambda^{(x)} \Lambda^{(z)} ) ) \big]\\
&= \sum_{p=0}^{n-1} (-1)^{n+\binom{p}{2}} \Res\,\big[ h_p \At^{n-p-1}D( \alpha \circ \Lambda^{(x)} \Lambda^{(z)} ) \big]\\
&= \sum_{p=0}^{n-1} (-1)^{n+\binom{p}{2}} \Res\,\big[ h_p \At^{n-p-1}\left( D( \alpha ) \circ \Lambda^{(x)} \Lambda^{(z)} + \alpha \circ D(\Lambda^{(x)} \Lambda^{(z)})\right) \big]\,.
\end{align*}
The $\partial_{x_i} W$'s and $\partial_{z_i} V$'s which appear in the expansion of $D( \Lambda^{(x)} \Lambda^{(z)} )$ pass outside of $h_p$, in the first case by \eqref{eq:hpisgoodyes} and in the second case since everything in sight is $S$-linear, and annihilate with the denominator of the residue \eqref{eq:bracketkl}. We conclude that
\[
\langle H, \alpha \rangle_X = \sum_{p=0}^{n-1} (-1)^{n+\binom{p}{2}} \Res\,\big[ h_p \At^{n-p-1}\left( D( \alpha ) \circ \Lambda^{(x)} \Lambda^{(z)} \right) \big]
\]
which proves that $\langle H, - \rangle_X$ is null-homotopic, and \textsl{ipso facto} that $\mathcal{Z}$ is homotopic to the identity.
\end{proof}

\begin{remark}\label{remark:otherzorros} To establish the adjunction $X \dashv X^\dual$ it remains to prove the second Zorro move in \eqref{otherZorros}. In the above the Atiyah classes ``created'' in the coevaluation go the left and pair with the Atiyah classes created in the inverse of the right unit action. Looking at the picture of the second Zorro move, we see that the Atiyah classes created in the coevaluation must go to the \textsl{right} to meet the unit action, and so we use the formula \eqref{eq:alt_formula_coev} for the coevaluation in terms of $\At_1$.

The inverse of the left unit action \eqref{eq:formulalambdainv} is also written in terms of $\At_1$, and as above one proves that the map on the left-hand side of the second Zorro move is $\mathcal{Z}: X^\dual \lto X^\dual$ given by
\be\label{remark:otherzorros1}
\mathcal{Z} = \sum_j (-1)^{|e_j|} \dlangle \str\left( \Lambda \circ \At_1^n( e_j \circ - ) \right) \drangle \cdot e_j^*\,.
\ee
Here $\At_1$ operates on $\End(X) \otimes_{R_2} \Bar$. Replacing $d$ with $s$ and $\At_2$ with $\At_1$ the technical results of Lemma \ref{lemma:lameadjoints} and Lemma \ref{lemma:zorromain} still hold, and the analogue of Lemma \ref{lemma:langlecalc1} is the statement
\be
\dlangle \str( \Lambda \circ \At_1^n( \varphi ) \drangle = \str(\varphi)\,.
\ee
Combining this with \eqref{remark:otherzorros1} one proves that $\mathcal{Z}$ is homotopic to the identity as before.

The verification of the adjunction ${}^\dual X \dashv X$ follows in the same way, with the proof of the first Zorro move in \eqref{Zorros} using $\At_1$ while second involves $\At_2$.
\end{remark}
% see the ozor series

\begin{theorem}\label{theorem:adjointbicategoryyeah}
The bicategory $\LG$ has left and right adjoints: for any $1$-morphism $Y: W \lto V$,
\[
\xymatrix{
Y^{\vee} \otimes_S S[m] = {}^\dual Y \ar@{-|}[r] & Y \ar@{-|}[r] & Y^\dual = R[n] \otimes_R Y^{\vee}
} .
\]
Explicit expressions for the evaluation and coevaluation maps are those of Section~\ref{sec:derivcoeval}. 
\end{theorem}
\begin{proof}
So far we have shown that for any $1$-morphism $X$ given by a finite-rank matrix factorisation, the $1$-morphisms ${}^\dual X$ and $X^\dual$ are adjoint to $X$ with the evaluation and coevaluation maps specified in Section~\ref{sec:derivcoeval}. This does not exhaust the $1$-morphisms in $\LG$, as there may be objects $Y$ of $\LG(W,V) = \hmf(k[x,z], V - W)^\omega$ not isomorphic to objects of $\hmf(k[x,z], V- W)$. Nevertheless, the evaluation and coevaluation maps already specified can be uniquely extended to summands like $Y$.

The detailed argument is given in Appendix \ref{section:extendduality}, and we need only check that the hypotheses given there are satisfied for $\LG$. The contravariant functor
\[
(-)^\dual = (-)^\vee[n]: \LG(W,V) \lto \LG(V,W)
\]
is well-defined, and hypothesis (ii) of the Appendix is checked below in Proposition \ref{prop.morphismmigration}. The upshot is that every $1$-morphism $Y$ in $\LG(W,V)$ has right adjoint $R[n] \otimes_R Y^{\vee}$, and similarly one proves that $Y^{\vee} \otimes_S S[m]$ is left adjoint to $Y$.
\end{proof}

\begin{remark} It follows from Appendix \ref{section:extendduality} that the $2$-morphism migration properties of Proposition \ref{prop.morphismmigration} hold for $2$-morphisms between arbitrary $1$-morphisms in $\LG$, not just those represented by finite rank matrix factorisations.
\end{remark}

With the notation of Remark \ref{remark:integral_functors} this shows that there are adjunctions of integral functors
\[
\xymatrix@C+1pc{
\Phi_{{}^\dual X} \ar@{-|}[r] & \Phi_X \ar@{-|}[r] & \Phi_{X^\dual}
} .
\]
That is, for any $Y \in \hmf(k[x], W)^\omega$ and $Z \in \hmf(k[z], V)^\omega$ there are natural isomorphisms
\begin{align}
\underline{\Hom}( X \otimes_{k[x]} Y, Z ) & \xlto{\cong} \underline{\Hom}( Y, X^\dual \otimes_{k[z]} Z )\,,\\
\underline{\Hom}( {}^\dual X \otimes_{k[z]} Z, Y ) & \xlto{\cong} \underline{\Hom}( Z, X \otimes_{k[x]} Y ) \label{eq:crunchyacorns}
\end{align}
where $\underline{\Hom}$ denotes mapping spaces in one of the categories $\hmf(k[z], V)^\omega$ or $\hmf(k[x], W)^\omega$.

The units and counits of adjunction are derived from the evaluation and coevaluation maps of Section~\ref{sec:derivcoeval} in the obvious way; for example, the counit of the adjunction $\Phi_X \dashv \Phi_{X^\dual}$ is the natural transformation $\Phi_X \circ \Phi_{X^\dual} \lto 1$ which, evaluated on an object $Z \in \hmf(k[z], V)$, is the morphism
\[
\xymatrix@C+2pc{
(\Phi_X \circ \Phi_{X^\dual})(Z) = X \otimes_{k[x]} X^\dual \otimes_{k[z]} Z \ar[r]^-{\widetilde\eval_X \otimes 1_Z} & \Delta_V \otimes_{k[z]} Z \ar[r]^-{\lambda_Z} & Z
}.
\]

\begin{remark} We recover Serre duality in the triangulated categories $\hmf(k[z], V)^\omega$ as the special case of a $1$-morphism $X: \mathbb{I} \lto V$ where $\mathbb{I} = (k,0)$, with its left adjoint ${}^\dual X = X^{\vee}[m]: V \lto \mathbb{I}$. 

In this case $X \in \hmf(k[z], V)$ and, taking $Y = k$, there is a natural isomorphism \eqref{eq:crunchyacorns}
\begin{align*}
H^m \Hom_k( \Hom_{k[z]}(X,Z), k ) &\cong \underline{\Hom}( \Hom_{k[z]}(X, Z)[m], k )\\
&\cong \underline{\Hom}( X^{\vee}[m] \otimes_{k[z]} Z, k )\\
&\cong \underline{\Hom}( Z, X )\,.
\end{align*}
Recall that $k$ is arbitrary, so the left-hand side is not necessarily the dual of $\underline{\Hom}(X, Z[m])$.
\end{remark}

\begin{remark} The bicategory $\LG^{\mathrm{gr}}$ of Remark~\ref{remark:gradedbicategory} also has left and right adjoints. In the notation of the theorem, with $R = k[x_1,\ldots,x_n]$ and $S = k[z_1,\ldots,z_m]$ both graded and $W,V$ homogeneous of even degrees $2c, 2e$ respectively and $Y$ a finite-rank graded matrix factorisation of $V - W$, the adjoints of $Y$ have the same underlying matrix factorisations as before but the grading
\be\label{eq:derivcoeval11graded}
Y^\dual = R[n](a_R) \otimes_R Y^\vee \, , \qquad {}^\dual Y = Y^\vee \otimes_S S[m](a_S)
\ee
where
\[
a_R = nc - \sum_{i=1}^n |x_i|\,, \qquad a_S = me - \sum_{j=1}^m |z_j|\,.
\]
To prove this it suffices to check that the evaluation and coevaluation maps defined in the ungraded case are homogeneous, since then these morphisms give adjoint pairs in $\LG^{\mathrm{gr}}$. Keeping in mind Remark \ref{remark:gradedbarmf} everything in the formula for $\widetilde \coev_X$ in \eqref{eq:coev10} manifestly has $\nZ$-degree zero except for
\[
\varepsilon: \Delta_W \lto \Re[n]
\]
which has $\nZ$-degree $a_R = -|\theta_1 \cdots \theta_n|$, so that with the grading shifts in \eqref{eq:derivcoeval11graded} the coevaluation maps have $\nZ$-degree zero. That the evaluation maps have degree zero follows from the Zorro moves, or one can observe this directly using Lemma \ref{lemma:residuesarehomog}.
\end{remark}


\section{Diagrammatic calculus and pivotality}\label{sec:wiggliesandsigns}

With the proof that the bicategory $\LG$ has adjoints behind us, we turn in the next several sections to applications. But first we need to introduce a refined diagrammatic calculus more appropriate for working with adjoints in this bicategory; in particular, we realise the goal stated in the introduction of translating arbitrary correlators directly into diagrams in $\LG$. The new diagrams are also the appropriate language for clarifying the nature of double-adjoints. 

\subsection{Alternative graphical presentation of adjoints}\label{subsec:alternatives}

The string diagrams introduced in Section~\ref{subsec:bicat} and employed until now have the problem that the adjoints enter on an artifical footing: lines do not carry orientations, and the adjoints are added to the diagrams ``by hand''. In a bicategory where left and right adjoints coincide, or more precisely a bicategory with a pivotal structure, it is standard to employ the richer diagrammatics of \cite{JSGoTCII} where we consider non-progressive diagrams with oriented lines (i.e. lines may double back, forming caps and cups) and in computing the value of a diagram one interprets a line labelled $f$ with a downward orientation in terms of the adjoint $f^\dual$. See for example \cite{khovdia, ladia}.

Unfortunately the bicategory $\LG$ is not pivotal: the left and right adjoints differ by a shift. The solution, which we basically borrow from \cite{ct1007.2679}, is to follow the prescription of \cite{JSGoTCII} but enhancing the diagrams with a new type of ``wiggly'' line which stand for shifts. In particular, in the new notation we no longer have to deal with two daggered adjoints~${}^\dagger X$ and~$X^\dagger$, but only with the dual matrix factorisation~$X^\vee$. The basic properties of this setup are worked out in Section \ref{sec:pivotality} which shows that $\LG$ is pivotal ``up to shifts''. We will also see in Section~\ref{sec:ocTFT} that this notation allows us to unambigiously translate TFT correlators into computable 2-morphisms.

The new convention is as follows: a wiggly line with label $a \in \mathbb{Z}$ in a domain associated to an object $(R = k[x_1,\ldots,x_n],W)\in\LG$ represents $R[a]$, that is, the ring~$R$ shifted by $a$. A wiggly line in this domain with no label represents $R[n]$, where $n$ is the number of variables.

Recall that for a $1$-morphism $X: (R,W) \lra (S,V)$ in $\LG$ with $R=k[x_1,\ldots,x_n]$ and $S=k[z_1,\ldots,z_m]$ we have ${}^\dual X = X^\vee \otimes_S S[m]$ and $X^\dual = R[n] \otimes_R X^\vee$. In the new notation we use the following presentation for the adjunction maps defined earlier: 
\begin{align}
&
\eval_X = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.3cm]
\draw[directed] (3,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.1,0) .. controls +(0.1,0.5) and +(-0.5,-0.45) .. (2.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: {}^\dual X \otimes_S X \lra \Delta_W
\, , \qquad
\coev_X = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.4cm,rotate=180]
\draw[redirected] (3,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (1.87,0) .. controls +(0.1,0.5) and +(-0.7,-0.15) .. (2.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: \Delta_V \lra X \otimes_R {}^\dual X \, , \nonumber \\
&
\widetilde\eval_X = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.3cm]
\draw[redirected] (3,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.9,0) .. controls +(-0.1,0.5) and +(0.5,-0.45) .. (2.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: X \otimes_R X^\dual \lra \Delta_V
\, , \qquad
\widetilde\coev_X = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.4cm,rotate=180]
\draw[directed] (3,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (3.13,0) .. controls +(-0.1,0.5) and +(0.7,-0.15) .. (2.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: \Delta_W \lra X^\dual \otimes_S  X \, . \label{eq:wigglyadjunctionmaps}
\end{align}
The Zorro moves for the left and right adjoints now read
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[directed] (0,0) .. controls +(0,-1) and +(0,-1) .. (-1,0);
\draw[directed] (1,0) .. controls +(0,1) and +(0,1) .. (0,0);
\draw (-1,0) -- (-1,1.25); 
\draw (1,0) -- (1,-1.25); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.5,-0.75) .. controls +(0.75,0) and +(-0.5,-0.35) .. (0.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\;=\;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,-1.25) -- (0,1.25); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\; , \qquad
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[directed] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[directed] (1,0) .. controls +(0,-1) and +(0,-1) .. (0,0);
\draw (-1,0) -- (-1,-1.25); 
\draw (1,0) -- (1,1.25); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.9,-1.25) .. controls +(0,0.5) and +(-0.5,-0.35) .. (-0.5,0.75); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0.5,-0.75) .. controls +(0.8,0.05) and +(0,-1) .. (1.1,1.25); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\;=\;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{<}}}, postaction={decorate}
	]
	(0,-1.25) -- (0,1.25); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0.15,-1.25) -- (0.15,1.25); 
\end{tikzpicture} 
\; , \qquad 
%%%%%%%%%%%%%%%%%%%%%%
%
%
%
%
%
%
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[redirected] (0,0) .. controls +(0,-1) and +(0,-1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (0,0);
\draw (-1,0) -- (-1,1.25); 
\draw (1,0) -- (1,-1.25); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-1.1,1.25) .. controls +(0,-1) and +(-0.85,0) .. (-0.5,-0.75); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0.5,0.75) .. controls +(0.35,-0.05) and +(0,1) .. (0.85,-1.25); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\;=\;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{<}}}, postaction={decorate}
	]
	(0,-1.25) -- (0,1.25); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.15,-1.25) -- (-0.15,1.25); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\; , \qquad
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[redirected] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,-1) and +(0,-1) .. (0,0);
\draw (-1,0) -- (-1,-1.25); 
\draw (1,0) -- (1,1.25); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.5,0.75) .. controls +(0.35,-0.1) and +(-0.8,-0.15) .. (0.5,-0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\;=\;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,-1.25) -- (0,1.25); 
\end{tikzpicture} \; .
%%%%%%%%%%%%%%%%%%%%%%
$$
The value of a diagram is computed in the same way as before, by tensoring horizontally and composing vertically, with shifted rings inserted in the tensor products according to their appearance in each horizontal slice of the diagram. If unlabelled, a cap or a cup is associated with the appropriate kind of evaluation or coevaluation, and  
a downwards oriented solid line labelled by a $1$-morphism $X$ represents the dual factorisation~$X^\vee$.

There are several ways for wiggly lines to meet in a diagram. For example they can ``annihilate'' or be ``created in pairs'', i.\,e.~we have maps (\textbf{todo} give labels $a$)
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0.3cm]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,0) .. controls +(0.1,1.0) and +(-0.1,1.0) .. (0.75,0); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: R[a] \otimes_R R[a] \lra R \, , \qquad r_1\otimes r_2 \lmt r_1 r_2 \, , 
\qquad
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-0.4cm, rotate=180]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,0) .. controls +(0.1,1.0) and +(-0.1,1.0) .. (0.75,0); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: R \lra R[a] \otimes_R R[a]  \, , \qquad 1 \lmt 1 \otimes 1 \, . 
$$
These maps satisfy the identity (\textbf{todo} also label $a$)
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0.9cm]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,0) .. controls +(0.1,1.0) and +(-0.1,1.0) .. (0.75,0); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,1.85) .. controls +(0.1,-1.0) and +(-0.1,-1.0) .. (0.75,1.85); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\;=\;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0.9cm]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,0) -- (0,1.85); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0.25,0) -- (0.25,1.85); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, . 
$$

Secondly, wiggly lines can cross a 1-morphism $X: (R,W) \lra (S,V)$. There are morphisms 
\begin{align*}
& 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.3,-0.75) .. controls +(0,0.5) and +(0,-0.5) ..  (0.3,0.75);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,-0.75) -- (0,0); 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,0) -- (0,0.75); 
\draw[line width=1pt] 
(0,-0.75) node[line width=0pt, right] {{\small $X$}}; 
\draw[line width=1pt] 
(0.45,0.6) node[color=blue!55!white, line width=0pt] {{\tiny $a$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: S[a] \otimes_S X \lra X \otimes_R R[a] \, , \qquad 1\otimes \eta \lmt (-1)^{a |\eta|} \eta \otimes 1 \, , \\
& 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0.3,-0.75) .. controls +(0,0.5) and +(0,-0.5) ..  (-0.3,0.75);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,-0.75) -- (0,0); 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,0) -- (0,0.75); 
\draw[line width=1pt] 
(0,-0.75) node[line width=0pt, left] {{\small $X$}}; 
\draw[line width=1pt] 
(0.45,-0.75) node[color=blue!55!white, line width=0pt] {{\tiny $a$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: X \otimes_R R[a] \lra S[a] \otimes_S X \, , \qquad \eta \otimes 1 \lmt (-1)^{a |\eta|} 1\otimes \eta \, . 
\end{align*}
Using these maps we can freely move wiggly lines around (while paying attention to signs). In particular there are variants of the adjunction maps in~\eqref{eq:wigglyadjunctionmaps} where the wiggly lines enter the vertex from different directions. For example we define
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.4cm, rotate=180]
\draw[redirected] (3,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.5,0.75) .. controls +(0.6,-0.05) and +(-0.1,0.5) .. (3.1,0); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\; := \;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.4cm, rotate=180]
\draw[redirected] (3,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (3.1,0) .. controls +(0.1,0.5) and +(-1.3,-0.35) .. (2.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\!\!\!\!\!\!\!\!, \qquad
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.4cm, rotate=180]
\draw[directed] (3,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (1.85,0) .. controls +(0.1,0.5) and +(-0.5,-0.15) .. (2.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\; := \!\!\!\!\!\!\!\!\!
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=-.4cm, rotate=180]
\draw[directed] (3,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (1.85,0) .. controls +(-0.1,0.5) and +(1.3,-0.15) .. (2.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, . 
$$

Labelled wiggly lines can cross each other, giving rise to maps of the type
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0.4cm]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,0) -- (0.75,1); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,1) -- (0.75,0); 
%
\draw[line width=1pt] 
(-0.13,0.1) node[color=blue!55!white, line width=0pt] {{\tiny $b$}}
(0.85,0.1) node[color=blue!55!white, line width=0pt] {{\tiny $a$}}
(-0.1,0.9) node[color=blue!55!white, line width=0pt] {{\tiny $a$}}
(0.87,0.9) node[color=blue!55!white, line width=0pt] {{\tiny $b$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: R[a]\otimes_R R[b] \lra R[a] \otimes_R R[b] \, , \qquad
r_1 \otimes r_2 \lmt (-1)^{ab} r_2 \otimes r_1 \, .
$$
For $a=b$~mod~2 such a crossing can be ``resolved'', i.\,e.~we have the following identity:
\be\label{eq:wigglyresolution}
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0.4cm]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,0) -- (0.75,1); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}]  (0,1) -- (0.75,0); 
%
\draw[line width=1pt] 
(-0.13,0.1) node[color=blue!55!white, line width=0pt] {{\tiny $a$}}
(0.85,0.1) node[color=blue!55!white, line width=0pt] {{\tiny $a$}}
(-0.1,0.9) node[color=blue!55!white, line width=0pt] {{\tiny $a$}}
(0.87,0.9) node[color=blue!55!white, line width=0pt] {{\tiny $a$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\; = (-1)^a \;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0.4cm]
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0,0) .. controls +(0.2,0.4) and +(0.2,-0.4) .. (0,1); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0.75,0) .. controls +(-0.2,0.4) and +(-0.2,-0.4) .. (0.75,1); 
%
\draw[line width=1pt] 
(-0.13,0.1) node[color=blue!55!white, line width=0pt] {{\tiny $n$}}
(0.85,0.1) node[color=blue!55!white, line width=0pt] {{\tiny $n$}}
(-0.1,0.9) node[color=blue!55!white, line width=0pt] {{\tiny $n$}}
(0.87,0.9) node[color=blue!55!white, line width=0pt] {{\tiny $n$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, . 
\ee

Let $W\in R=k[x_1,\ldots,x_n]$, $V\in S=k[z_1,\ldots,z_m]$ be potentials and $X\in\hmf(k[x,z], V-W)$. Then there is an isomorphism of matrix factorisations
$$
X^\dual[m+n] \cong X^\vee[n][m+n] \cong X^\vee[m] \cong {}^\dual X \, . 
$$
Using $X^\dual[m+n] \cong R[m]\otimes_R R[n] \otimes_R X^\dual$ this has a simple diagrammatic presentation:
\be\label{eq:isoq}
q_X :=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline=1cm]
\draw[line width=1pt] 
(0,0) node[line width=0pt, right] (XY) {{\small $X$}}; 
% wiggly labels:
\draw[line width=1pt] 
(-0.62,0.1) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
(-1.23,0.1) node[color=blue!55!white, line width=0pt, right] {{\tiny $m$}};
%
\draw[
	decoration={markings, mark=at position 0.35 with {\arrow{<}}}, postaction={decorate}
	]
	(0,0) -- (0,3);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.75,0) .. controls +(0.01,1.0) and +(0,-1.0) .. (0.25,3); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.5,0) .. controls +(0,0.9) and +(0,00.9) .. (-0.25,0); 
%
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
: R[m]\otimes_R R[n] \otimes_R X^\dual \lra {}^\dual X \, , \qquad
q(\nu) = (-1)^{m|\nu|} \nu \, .
\ee


\subsection{Pivotality}\label{sec:pivotality}

In this section we clarify the relation between the adjunctions given by $\eval_X, \coev_X$ and $\widetilde\eval_X, \widetilde\coev_X$. Of particular importance are the identities~\eqref{eq:nicepivotality} and~\eqref{eq:nicepivotality2} which we will later need for applications in Sections~\ref{sec:defectaction} and~\ref{sec:ocTFT}, e.\,g.~to prove the Cardy condition. 


%\begin{definition}\label{def.pivotal}
%We call a bicategory with right adjoints \textsl{pivotal} if for each 1-morphism~$X$ there is a natural monoidal 2-isomorphism $\delta_X: X\lra X^{\dual\dual}$. It then follows that~$X^\dual$ is also left adjoint to~$X$, with adjunction maps $\overline\eval_X = \widetilde\eval_{X^\dual}\circ (1_{X^\dual} \otimes \delta_{X})$ and $\overline\coev_X = (\delta_X^{-1} \otimes 1_{X^\dual} ) \circ \widetilde\coev_{X^\dual}$. By the condition for~$\delta$ to be natural monoidal we mean that the identities
%$$
%%%%%%%%%%%%%%%%%%%%%%%
%\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
%\draw[line width=0] 
%(-1,1.25) node[line width=0pt] (A) {{\small $Z^\dual$}}
%(1,-1.25) node[line width=0pt] (A2) {{\small $Y^\dual$}}; 
%\fill (0,0) circle (2.5pt) node[left] {{\small $\varphi$}};
%\draw[redirected] (0,0) .. controls +(0,-1) and +(0,-1) .. (-1,0);
%\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (0,0);
%\draw (-1,0) -- (A); 
%\draw (1,0) -- (A2); 
%\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%
%=
%%%%%%%%%%%%%%%%%%%%%%%
%\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
%\draw[line width=0] 
%(1,1.25) node[line width=0pt] (A) {{\small $Z^\dual$}}
%(-1,-1.25) node[line width=0pt] (A2) {{\small $Y^\dual$}}; 
%\draw[directed] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
%\draw[directed] (1,0) .. controls +(0,-1) and +(0,-1) .. (0,0);
%\fill (0,0) circle (2.5pt) node[right] {{\small $\varphi$}};
%\draw (-1,0) -- (A2); 
%\draw (1,0) -- (A); 
%\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%
%\, , \qquad 
%%%%%%%%%%%%%%%%%%%%%%%
%\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline=0.45cm]
%\draw[line width=1pt] 
%(-2,-1) node[line width=0pt] (X) {{\small $Y^\dual$}}
%(-1,-1) node[line width=0pt] (Y) {{\small $X^\dual$}}
%(2,2) node[line width=0pt] (XY) {{\small $(X\otimes Y)^\dual$}}; 
%\draw[directed] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
%\draw[directed] (1,0) .. controls +(0,2) and +(0,2) .. (-2,0);
%\draw[directed] (2,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
%\draw (-1,0) -- (Y);
%\draw (-2,0) -- (X);
%\draw[dotted] (0,0) -- (1,0);
%\draw (2,0) -- (XY);
%\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%
%=
%%%%%%%%%%%%%%%%%%%%%%%
%\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline=0.45cm]
%\draw[line width=1pt] 
%(2,-1) node[line width=0pt] (Y) {{\small $Y^\dual$}}
%(3,-1) node[line width=0pt] (X) {{\small $X^\dual$}}
%(-1,2) node[line width=0pt] (XY) {{\small $(X\otimes Y)^\dual$}}; 
%\draw[directed] (1,0) .. controls +(0,1) and +(0,1) .. (2,0);
%\draw[directed] (0,0) .. controls +(0,2) and +(0,2) .. (3,0);
%\draw[directed] (-1,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
%\draw (2,0) -- (Y);
%\draw (3,0) -- (X);
%\draw[dotted] (0,0) -- (1,0);
%\draw (-1,0) -- (XY);
%\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%
%$$
%hold for every 2-morphism $\varphi: Z \lra Y$, where above (and only there!) the caps and cups with left-oriented arrows represent $\overline\eval$ and $\overline\coev$. 
%\end{definition}

As mentioned in the Introduction, the adjoint $X^{\dual}$ of a $1$-morphism $X$ is interpreted as describing the same defect condition as $X$ but with the opposite orientation. Since reversing the orientation twice is doing nothing, it is natural to expect that $X^{\dagger\dagger}$ should be identified with~$X$, in a suitable sense. In the categorical approach to rational conformal field theory (conjecturally related to Landau-Ginzburg models via the CFT/LG correspondence) this is made precise by the result which states that in this setting there is always a \textsl{pivotal structure}, i.\,e.~a natural monoidal transformation~$\delta$ between the identity and the functor $(-)^{\dagger\dagger}$. This implies in particular that the left and right adjoints are isomorphic.

The story for the bicategory $\LG$ is subtler, as we only expect the left and right adjoints of $X$ to be isomorphic when the number of variables in the regions on either side of $X$ agree mod $2$. This is the case, for example, when $X$ is an endomorphism of an object of $\LG$. Indeed, what we prove in this section implies that the rigid monoidal categories $\hmf(\Re,\widetilde W)^\omega = \LG(W,W)$ are pivotal for any potential $W\in R$. See Remark \ref{remark:notpivotal} for the construction of an isomorphism between $X$ and $X^{\dual \dual}$ in the case of equal variable parity.

In general we do not phrase the discussion in terms of an isomorphism between $X$ and its double-adjoint, but in terms of the relationship between the left and right adjoints. We have specified in~\eqref{eq:isoq} above a choice of isomorphism $q$ between the left adjoint and a suspension of the right adjoint of any $1$-morphism. We show in Proposition~\ref{prop:monoidalproperty} below that these isomorphisms possess nontrivial properties that we might call ``pivotality up to shifts''. These properties are what will be important in applications. 

To explain what we mean, we first recall a formal result of category theory. If $X: W \lto V$ and $Y: V \lto U$ are $1$-morphisms in $\LG$ then $X^{\dual} \otimes Y^{\dual}$ and ${}^\dual X \otimes {}^\dual Y$ are the right and left adjoint to $Y \otimes X$, respectively, and so by uniqueness of adjoints there are canonical isomorphisms
\[
\mathscr{R}: (Y \otimes X)^{\dual} \stackrel{\cong}{\lra} X^{\dual} \otimes Y^{\dual}\, , \qquad 
\mathscr{L}: {}^\dual (Y \otimes X) \stackrel{\cong}{\lra} {}^\dual X \otimes {}^\dual Y\,.
\]
Concretely, we define these morphisms by the diagrams
\[
\mathscr R = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(2,-2) node[line width=0pt, right] (Y) {{\small $Y$}}
(3,-2) node[line width=0pt, right] (X) {{\small $X$}}
(-1,3) node[line width=0pt, right] (XY) {{\small $Y\otimes X$}}; 
%% wiggly labels:
%\draw[line width=1pt] 
%(2.65,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}m$}}
%(3.55,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}n$}}
%(-0.45,2.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}};
%
%
\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[redirected] (0,0) .. controls +(0,2) and +(0,2) .. (3,0);
\draw[redirected] (-1,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (2,0) -- (2,-2);
\draw (3,0) -- (3,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (-1,0) -- (-1,3);
%
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.35,-0.76) .. controls +(-0.7,0.5) and +(0.1,-1) .. (-0.85,3); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.15,-2) .. controls +(0,1.3) and +(0.8,0.05) .. (1.5,0.75); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (3.15,-2) .. controls +(0,1.5) and +(2.0,0.05) .. (1.5,1.5); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, , \qquad 
\mathscr L = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(-2,-2) node[line width=0pt, left] (X) {{\small $Y$}}
(-1,-2) node[line width=0pt, left] (Y) {{\small $X$}}
(2,3) node[line width=0pt, left] (XY) {{\small $Y\otimes X$}}; 
%% wiggly labels:
%\draw[line width=1pt] 
%(2.6,2.1) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
%(2.9,1.4) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
%(-1.7,1.4) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
%(-0.5,-1.2) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
%(-1.3,-1.2) node[color=blue!55!white, line width=0pt, right] {{\tiny $m$}};
%
%
\draw[redirected] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,2) and +(0,2) .. (-2,0);
\draw[redirected] (2,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (-1,0) -- (-1,-2);
\draw (-2,0) -- (-2,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (2,0) -- (2,3);
%
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-1.15,-2) .. controls +(0,1.0) and +(-1.0,0.1) .. (-0.4,0.75); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-2.15,-2) .. controls +(0,1.5) and +(-2.3,-0.1) .. (-0.4,1.5); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (1.25,-0.76) .. controls +(0.7,0.5) and +(0,-1) .. (1.85,3);
%
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\]
Note that the graphical presentation makes it manifest that the above two maps are indeed isomorphisms in $\LG$: applying the Zorro moves one checks their inverses are given by copies of themselves if rotated by 180 degrees. 

One can ask whether or not these isomorphisms $\mathscr{R}, \mathscr{L}$ are compatible with the isomorphism $q$ which exchanges left and right adjoints, and this is precisely the content of the next result. For the statement, we let $W \in R = k[x_1,\ldots,x_n]$, $V \in S = k[z_1,\ldots,z_m]$, $U \in T = k[y_1,\ldots,y_p]$ be potentials and $X \in \hmf(k[x,z],V-W)$ and $Y\in \hmf(k[y,z],U-V)$.

\begin{proposition}\label{prop:monoidalproperty} 
\begin{enumerate}
\item For any morphism~$\varphi:Z\lra X$ in $\hmf(k[x,z], V-W)$ we have 
$$
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(-1,1.25) node[line width=0pt, right] (A) {{\small $Z$}}
(1,-1.25) node[line width=0pt, right] (A2) {{\small $X$}}; 
\fill (0,0) circle (2.5pt) node[left] {{\small $\varphi$}};
\draw[redirected] (0,0) .. controls +(0,-1) and +(0,-1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (0,0);
\draw (-1,0) -- (-1,1.25); 
\draw (1,0) -- (1,-1.25); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.5,-0.76) .. controls +(-0.9,0.1) and +(0.1,-1) .. (-1.15,1.25);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0.5,0.76) .. controls +(0.35,-0.2) and +(0,1) .. (0.85,-1.25);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
=\;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(0,1.25) node[line width=0pt, right] (A) {{\small $Z$}}
(0,-1.25) node[line width=0pt, right] (A2) {{\small $X$}}; 
\fill (0,0) circle (2.5pt) node[right] {{\small $\varphi^\vee$}};
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,1.25) -- (0,0); 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,0) -- (0,-1.25); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.15,1.25) -- (-0.15,-1.25); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, , \qquad
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(1,1.25) node[line width=0pt, left] (A) {{\small $Z$}}
(-1,-1.25) node[line width=0pt, left] (A2) {{\small $X$}}; 
\draw[directed] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[directed] (1,0) .. controls +(0,-1) and +(0,-1) .. (0,0);
\fill (0,0) circle (2.5pt) node[right] {{\small $\varphi$}};
\draw (-1,0) -- (-1,-1.25); 
\draw (1,0) -- (1,1.25); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.5,0.76) .. controls +(-0.35,-0.2) and +(0,1) .. (-0.85,-1.25);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0.5,-0.76) .. controls +(0.8,0.1) and +(0,-1) .. (1.15,1.25);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
=\;
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=0cm]
\draw[line width=0] 
(0,1.25) node[line width=0pt, left] (A) {{\small $Z$}}
(0,-1.25) node[line width=0pt, left] (A2) {{\small $X$}}; 
\fill (0,0) circle (2.5pt) node[left] {{\small $\varphi^\vee$}};
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,1.25) -- (0,0); 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	(0,0) -- (0,-1.25); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (0.15,1.25) -- (0.15,-1.25); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\; .
$$
\item 
The following identity holds true: 
\be\label{eq:monoidalproperty}
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(2,-2) node[line width=0pt, right] (Y) {{\small $Y$}}
(3,-2) node[line width=0pt, right] (X) {{\small $X$}}
(-1,3) node[line width=0pt, right] (XY) {{\small $Y\otimes X$}}; 
% wiggly labels:
\draw[line width=1pt] 
(2.65,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}m$}}
(3.55,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}n$}}
(3.9,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}n$}}
(4.25,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
(-0.45,2.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}};
%
%
\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[redirected] (0,0) .. controls +(0,2) and +(0,2) .. (3,0);
\draw[redirected] (-1,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (2,0) -- (2,-2);
\draw (3,0) -- (3,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (-1,0) -- (-1,3);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (3.5,-2) -- (3.5,3);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (3.85,-2) -- (3.85,3);
%
%
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.35,-0.76) .. controls +(-0.7,0.5) and +(0.1,-1) .. (-0.85,3); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.15,-2) .. controls +(0,1.3) and +(0.8,0.05) .. (1.5,0.75); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (3.15,-2) .. controls +(0,1.5) and +(2.0,0.05) .. (1.5,1.5); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
= (-1)^m
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(-2,-2) node[line width=0pt, right] (X) {{\small $Y$}}
(-1,-2) node[line width=0pt, right] (Y) {{\small $X$}}
(2,3) node[line width=0pt, right] (XY) {{\small $Y\otimes X$}}; 
% wiggly labels:
\draw[line width=1pt] 
(2.6,2.1) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
(2.9,1.4) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
(-1.7,1.4) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
(-0.5,-1.2) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
(-1.3,-1.2) node[color=blue!55!white, line width=0pt, right] {{\tiny $m$}};
%
%
\draw[redirected] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,2) and +(0,2) .. (-2,0);
\draw[redirected] (2,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (-1,0) -- (-1,-2);
\draw (-2,0) -- (-2,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (2,0) -- (2,3);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.75,3) .. controls +(-0.01,-1.0) and +(0.7,0.1) .. (1.25,-0.7); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.25,3) .. controls +(0,-0.9) and +(0,-0.9) .. (2.50,3); 
%
%
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-1.85,-2) .. controls +(0,0.7) and +(-1.2,0.1) .. (-0.4,0.75); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.25,-2) .. controls +(-0.2,2.2) and +(-3.8,-0.4) .. (-0.4,1.5); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.75,-2) .. controls +(0,0.9) and +(0,0.9) .. (-.50,-2); 
%
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\ee
\end{enumerate}
\end{proposition}

\begin{proof}
Part (i) follows in a standard way by applying Zorro moves together with the ``morphism migration properties'' of Proposition~\ref{prop.morphismmigration}. 

Regarding part (ii), we claim that the equality~\eqref{eq:monoidalproperty} is equivalent to the commutativity up to homotopy of the diagram
\be\label{eq:monoidalpropertycomd}
\xymatrix@C+2pc{
R[p] \otimes R[n] \otimes (Y \otimes X)^{\dual} \ar[d]_-{(-1)^m\mathscr{R}} \ar[rr]^-{q_{Y \otimes X}} & & {}^\dual( Y \otimes_S X ) \ar[ddd]^{\mathscr{L}}\\
R[p] \otimes R[n] \otimes (X^\dual \otimes Y^\dual) \ar[d]\\
R[p] \otimes R[m] \otimes R[m] \otimes R[n] \otimes (X^\dual \otimes Y^\dual) \ar[d]\\
(R[m] \otimes R[n] \otimes X^\dual) \otimes ( S[p] \otimes S[m] \otimes Y^\dual ) \ar[rr]_-{q_X \otimes q_Y} & & {}^\dual X \otimes {}^\dual Y \, .
}
\ee
This is an exercise in the diagrammatic calculus for wiggly lines. 

As explained in Appendices~\ref{section:symidem} and~\ref{app:adjoints}, the infinite-rank matrix factorisation $Y\otimes X$ of $U - W$ over $k[x,y]$ is homotopy equivalent to a direct summand of a finite-rank matrix factorisation. More precisely, the appendix shows that the quotient map
$$
\kappa: Y \otimes X \lto \bar Y \otimes \bar X := (Y \otimes_{k[z]} X) \otimes_{k[z]} k[z]/(\partial_{z_1}V, \ldots, \partial_{z_m}V)
$$
is a split monomorphism in $\HMF(k[x,y], U - W)$, i.\,e.~there is a morphism $\xi$ such that $\kappa\xi = 1$.

But then the dual $\kappa^{\vee}: (\bar Y \otimes \bar X)^\vee \lto (Y \otimes X)^\vee$ is a split epimorphism, and to prove that the two sides of \eqref{eq:monoidalproperty} are homotopic it is enough to prove that they are homotopic after precomposing (i.\,e.~inserting at the bottom of the diagram) with the morphism $\kappa^{\vee}$. By the morphism migration rules of Proposition~\ref{prop.morphismmigration} it is equivalent to prove that the two sides of \eqref{eq:monoidalproperty} are homotopic with $Y \otimes X$ replaced by $\bar Y \otimes \bar X$ and the junction labelled $1_{Y \otimes X}$ replaced by a junction labelled $\kappa$.

Thus on the left-hand side we have (ignoring the suspensions) the map
\be\label{eq:leftmonoidaldetail}
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(2,-2) node[line width=0pt, right] (Y) {{\small $Y$}}
(3,-2) node[line width=0pt, right] (X) {{\small $X$}}
(-1,3) node[line width=0pt, right] (XY) {{\small $\bar Y\otimes \bar X$}}; 
\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[redirected] (0,0) .. controls +(0,2) and +(0,2) .. (3,0);
\draw[redirected] (-1,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (2,0) -- (2,-2);
\draw (3,0) -- (3,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (-1,0) -- (-1,3);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.35,-0.76) .. controls +(-0.7,0.5) and +(0.1,-1) .. (-0.85,3); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.15,-2) .. controls +(0,2) and +(0.7,-0.15) .. (1.5,0.75); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (3.15,-2) .. controls +(0,2) and +(1.8,0) .. (1.5,1.5); 
%
%
\fill (0.5,0) circle (2.2pt) node[below] {{\small$\kappa$}};
%
\coordinate (lambdainv) at ($ (-1,2.2) $);
\fill (lambdainv) circle (2.2pt) node[right] {{\small$\lambda^{-1}$}};
\coordinate (rhoinv) at ($ (2.3,1.28) $);
\fill (rhoinv) circle (2.2pt) node[above] {{\small$\rho^{-1}$}};
\coordinate (rho) at ($ (2,-1.4) $);
\fill (rho) circle (2.2pt) node[below right] {{\small$\rho$}};
%
\draw[dashed] (rho)  .. controls +(-1,0.3) and +(0,-1) ..  (-0.31,-0.72);
\draw[dashed] (rhoinv)  .. controls +(-0.1,-0.5) and +(0,0.5) ..  (1.45,0.74);
\draw[dashed] (1.45,1.49)  .. controls +(-0.1,0.5) and +(0,-0.5) ..  (lambdainv);
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, .
\ee
We denote this morphism by $\bar{\mathscr{R}}: (\bar{Y} \otimes \bar{X})^\dual \lto X^\dual \otimes Y^\dual$. Similarly, after adding $\kappa^{\vee}$ and migrating, the right-hand side of~\eqref{eq:monoidalproperty} becomes a morphism $\bar{\mathscr{L}}: (\bar{Y} \otimes \bar{X})^\dual \lto X^\dual \otimes Y^\dual$. 

It remains to compute $\bar{\mathscr{R}}$ and $\bar{\mathscr{L}}$ and then prove that $\bar{\mathscr{R}} = (-1)^m \bar{\mathscr{L}}$. For this let $\{e_i\}_i$ be a $k[x,z]$-basis of~$X$, $\{f_j\}_j$ a $k[y,z]$-basis of~$Y$, and $\{g_\alpha\}_\alpha$ a $k$-basis of $k[z]/(\partial V)$. Then $\{ f_j \otimes g_\alpha e_i \}_{i,j,\alpha}$ is a $k[x,y]$-basis of $\bar{Y} \otimes \bar{X}$. Using the expressions~\eqref{eq:formulalambdainv} and~\eqref{eq:alt_formula_coev} together with Lemma~\ref{lemma:atshufat} we find that $\lambda^{-1}$ and $\widetilde\coev_X$ in \eqref{eq:leftmonoidaldetail} send $(f_q \otimes g_\alpha e_p)^* \in (\bar Y \otimes \bar X)^\vee$ to
$$
\sum_j (-1)^{n + |e_j| + n|f_q| + n|e_p|} \, e_j^* \otimes \varepsilon \Psi \At_1 \big(X\otimes (\bar Y \otimes \bar X)^\dual \big)^n \big(e_j\otimes (f_q \otimes g_\alpha e_p)^*\big) \, . 
$$
Similarly with~\eqref{eq:formula_rhoinverse} and~\eqref{eq:coev10} we compute that $\rho^{-1}$ and $\widetilde\coev_Y$ map this to
\begin{align*}
&\sum_{j,k} 
(-1)^{n + (m+1)|f_k| + |e_j| + n|f_q| + n|e_p|} \, \\
& \qquad\; \cdot \varepsilon \Psi \At_2(X^\dual \otimes Y^\dual)^m (e_j^* \otimes f_k^*)
\otimes \varepsilon \Psi \At_1\big((Y\otimes X)\otimes( \bar Y \otimes \bar X)^\dual\big)^n \big( f_k \otimes e_j \otimes (f_q \otimes g_\alpha e_p)^*\big) \, . 
\end{align*}
Here there is a recurrence of the subtlety mentioned in Remark \ref{remark:ringactionsubtle}. Namely, the output of the $\varepsilon \Psi \At_2$ term is an element of $\Se = S_1 \otimes_k S_2$, with the $S_2$ component going to act on the $f_k$ which is subsequently introduced as an argument of the $\varepsilon \Psi \At_1$ term, so we keep in mind that this input is actually a sum of terms of the form $g_\beta f_k$.

Next we apply the quotient map~$\kappa$. By naturality of the Atiyah class (Lemma \ref{lemma:atiyahnat}) the sole effect of~$\kappa$ on the above is to replace $\At_1((Y\otimes X)\otimes( \bar Y \otimes \bar X)^\dual)$ by $\At_1((\bar Y\otimes \bar X)\otimes( \bar Y \otimes \bar X)^\dual)$. This means that we are in precisely the same situation as in the proof of the Zorro move for $\bar Y \otimes \bar X$, i.\,e.~after applying $\widetilde\eval_{\bar Y \otimes \bar X}$ and~$\rho$ we are left with
\be\label{eq:valueofLpivot}
\bar{\mathscr{R}}( (f_q \otimes g_\alpha e_p )^* ) = (-1)^{m|f_q|} \, 
(1 \otimes g_\alpha^*) \varepsilon \Psi \At_2(X^\dual \otimes Y^\dual)^m (e_p^* \otimes f_q^*) \, . 
\ee
To explain the notation: the output of $\varepsilon$ is an element of $(X^\dual \otimes Y^\dual) \otimes_{S_1} \Se$ and to this we apply the functional $1 \otimes g_\alpha^*$ which sends $s \otimes t \in \Se$ to $s \cdot g_\alpha^*(t)$ (it is the $g_\beta$ factors mentioned above which become integrated into basis elements $f_k \otimes g_\beta e_j$ of $\bar{Y} \otimes \bar{X}$ and by the argument of the Zorro proof ultimately fed into $g_\alpha^*$).

Similarly one computes that $\bar{\mathscr{L}}$ is given by
\be\label{eq:valueofRpivot}
\bar{\mathscr{L}}( (f_q \otimes g_\alpha e_p)^* ) = (-1)^{m|f_q|} \, 
(g_\alpha^* \otimes 1) \varepsilon \Psi \At_1 (X^\dual \otimes Y^\dual)^m (e_p^* \otimes f_q^*) \, . 
\ee

We prove now that $\bar{\mathscr{R}}$ is homotopic to $(-1)^m \bar{\mathscr{L}}$. The main discrepancy is that $\bar{\mathscr{R}}$ involves $\At_2$ while $\bar{\mathscr{L}}$ involves $\At_1$. In order to match these let $\bar{\mathscr{R}}'$ be the morphism computed by the diagram~\eqref{eq:leftmonoidaldetail} but with the variable ordering $z_{m}, z_{m-1}, \ldots, z_1$ on the ring $k[z]$. By Appendix \ref{app:variableordering}, $\bar{\mathscr{R}}'$ is homotopic to $(-1)^{\binom{m}{2}} \bar{\mathscr{R}}$ so we must prove that
\be\label{eq:lversusrbeforeh}
\bar{\mathscr{R}}' = (-1)^{\binom{m+1}{2}} \bar{\mathscr{L}} \, .
\ee
Again we need to reduce to finite rank, using the split monomorphism
\[
\kappa': X^\dual \otimes Y^\dual \lto \bar{X}^\dual \otimes \bar{Y}^\dual = (X^\dual \otimes Y^\dual) \otimes_{k[z]} k[z]/(\partial_{z_1}V, \ldots, \partial_{z_m}V)
\]
in $\HMF(k[x,y], U - W)$. 
To prove \eqref{eq:lversusrbeforeh} it therefore suffices to prove
\be\label{eq:lversusrafterh}
\kappa' \circ \bar{\mathscr{R}}' = (-1)^{\binom{m+1}{2}} \kappa' \circ \bar{\mathscr{L}}\,.
\ee
Actually we show that these two maps are \textsl{equal} as module maps, not just homotopic. Since $\bar{X}^\dual \otimes \bar{Y}^\dual$ has a $k[x,y]$-basis consisting of tensors $e_i^* \otimes g_\alpha f_j^*$, to prove \eqref{eq:lversusrafterh} it suffices to prove both sides are equal after applying $g_\beta^*$ for every $\beta$. In light of \eqref{eq:valueofLpivot} and \eqref{eq:valueofRpivot}, we have to show
\be
(g_\beta^* \otimes g_\alpha^*) \varepsilon \Psi_\sigma \At_2(X^\dual \otimes Y^\dual)^m (e_p^* \otimes f_q^*) = (-1)^{\binom{m+1}{2}} (g_\alpha^* \otimes g_\beta^*) \varepsilon \Psi \At_1 (X^\dual \otimes Y^\dual)^m (e_p^* \otimes f_q^*)\,.
\ee
Here $\Psi_\sigma$ denotes the map computed using the variable ordering $z_{\sigma(1)}, \ldots, z_{\sigma(m)}$ with $\sigma(i) = m - i + 1$. Let $\tau: \Se \lto \Se$ be the isomorphism $\tau(s \otimes s') = s' \otimes s$. It is easily checked that for $a \in S$, using the notation of Appendix \ref{app:variableordering},
\[
\tau \partial_{[i]}(a) = \partial^{\,\sigma}_{[m-i+1]}(a)\,.
\]
Hence
\begin{align*}
\varepsilon \Psi_\sigma( da_1 \cdots da_m ) = \partial^{\,\sigma}_{[1]}(a_1) \cdots \partial^{\,\sigma}_{[m]}(a_m) = \tau\left( \partial_{[m]}(a_1) \cdots \partial_{[1]}(a_m) \right) 
\end{align*}
and so we compute using the formulas of Section \ref{section:atiyahclasses}, with $D$ the differential on $X^\dual \otimes Y^\dual$,
\begin{align*}
&(g_\alpha^* \otimes g_\beta^*) \varepsilon \Psi \At_1 (X^\dual \otimes Y^\dual)^m (e_p^* \otimes f_q^*)\\
&= (g_\beta^* \otimes g_\alpha^*) \tau \big( (-1)^{m|e_p| + m|f_q|} \sum_{p',q'} \left\{ \partial_{[m]} D \cdots \partial_{[1]} D \right\}_{p'q', pq} e_{p'}^* \otimes f_{q'}^* \big)\\
&= (g_\beta^* \otimes g_\alpha^*) (-1)^{m|e_p| + m|f_q|} \sum_{p',q'} \left\{ \partial^{\,\sigma}_{[1]} D \cdots \partial^{\,\sigma}_{[m]} D \right\}_{p'q', pq} e_{p'}^* \otimes f_{q'}^*\\
&= (-1)^{\binom{m+1}{2}} (g_\beta^* \otimes g_\alpha^*) \varepsilon \Psi_{\sigma} \At_2(X^\dual \otimes Y^\dual)^m( e_p^* \otimes f_q^* )
\end{align*}
which completes the proof.
\end{proof}

\begin{corollary}\label{cor:nicerpivotalitydiagrams}
For $X$ and $Y$ as above we have 
\begin{align}\label{eq:nicepivotality}
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(2,-2) node[line width=0pt, right] (Y) {{\small $Y$}}
(3,-2) node[line width=0pt, right] (X) {{\small $X$}}
(-1,3) node[line width=0pt, right] (XY) {{\small $Y\otimes X$}}; 
%% wiggly labels:
%\draw[line width=1pt] 
%(2.65,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}m$}}
%(3.55,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}n$}}
%(-0.45,2.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}};
%
%
\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[redirected] (0,0) .. controls +(0,2) and +(0,2) .. (3,0);
\draw[redirected] (-1,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (2,0) -- (2,-2);
\draw (3,0) -- (3,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (-1,0) -- (-1,3);
%
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.35,-0.76) .. controls +(-0.7,0.5) and +(0.1,-1) .. (-0.85,3); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.15,-2) .. controls +(0,1.3) and +(0.8,0.05) .. (1.5,0.75); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (3.15,-2) .. controls +(0,1.5) and +(2.0,0.05) .. (1.5,1.5); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
& = (-1)^{m+p} \; 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(-2,-2) node[line width=0pt, right] (X) {{\small $Y$}}
(-1,-2) node[line width=0pt, right] (Y) {{\small $X$}}
(2,3) node[line width=0pt, right] (XY) {{\small $Y\otimes X$}}; 
%% wiggly labels:
%\draw[line width=1pt] 
%(2.6,2.1) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
%(2.9,1.4) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
%(-1.7,1.4) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
%(-0.5,-1.2) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
%(-1.3,-1.2) node[color=blue!55!white, line width=0pt, right] {{\tiny $m$}};
%
%
\draw[redirected] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,2) and +(0,2) .. (-2,0);
\draw[redirected] (2,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (-1,0) -- (-1,-2);
\draw (-2,0) -- (-2,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (2,0) -- (2,3);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.25,3) -- (2.25,-2); 
%
%
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-1.85,-2) .. controls +(0,0.7) and +(-1.2,0.1) .. (-0.4,0.75); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (1.25,-0.75) .. controls +(0.7,0.5) and +(2.5,-0.2) .. (-0.4,1.5); 
%
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, , \\
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(-2,-2) node[line width=0pt, left] (X) {{\small $Y$}}
(-1,-2) node[line width=0pt, left] (Y) {{\small $X$}}
(2,3) node[line width=0pt, left] (XY) {{\small $Y\otimes X$}}; 
%% wiggly labels:
%\draw[line width=1pt] 
%(2.6,2.1) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
%(2.9,1.4) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
%(-1.7,1.4) node[color=blue!55!white, line width=0pt, right] {{\tiny $p$}}
%(-0.5,-1.2) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}}
%(-1.3,-1.2) node[color=blue!55!white, line width=0pt, right] {{\tiny $m$}};
%
%
\draw[redirected] (0,0) .. controls +(0,1) and +(0,1) .. (-1,0);
\draw[redirected] (1,0) .. controls +(0,2) and +(0,2) .. (-2,0);
\draw[redirected] (2,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (-1,0) -- (-1,-2);
\draw (-2,0) -- (-2,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (2,0) -- (2,3);
%
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-1.15,-2) .. controls +(0,1.0) and +(-1.0,0.1) .. (-0.4,0.75); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-2.15,-2) .. controls +(0,1.5) and +(-2.3,-0.1) .. (-0.4,1.5); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (1.25,-0.76) .. controls +(0.7,0.5) and +(0,-1) .. (1.85,3);
%
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
& = (-1)^{m} \; 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline, rotate=180]
\draw[line width=1pt] 
(2,-2) node[line width=0pt, left] (Y) {{\small $Y$}}
(3,-2) node[line width=0pt, left] (X) {{\small $X$}}
(-1,3) node[line width=0pt, left] (XY) {{\small $Y\otimes X$}}; 
%% wiggly labels:
%\draw[line width=1pt] 
%(2.65,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}m$}}
%(3.55,-1.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $\vphantom{p}n$}}
%(-0.45,2.5) node[color=blue!55!white, line width=0pt, right] {{\tiny $n$}};
%
%
\draw[redirected] (1,0) .. controls +(0,1) and +(0,1) .. (2,0);
\draw[redirected] (0,0) .. controls +(0,2) and +(0,2) .. (3,0);
\draw[redirected] (-1,0) .. controls +(0,-1) and +(0,-1) .. (0.5,0);
\draw (2,0) -- (2,-2);
\draw (3,0) -- (3,-2);
\draw[dotted] (0,0) -- (1,0);
\draw (-1,0) -- (-1,3);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-1.25,3) -- (-1.25,-2); 
%
%
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-0.35,-0.76) .. controls +(-0.7,0.5) and +(-2.5,-0.2) .. (1.5,1.5);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2.85,-2) .. controls +(0,1.3) and +(0.8,0.05) .. (1.5,0.75); 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, . \label{eq:nicepivotality2}
\end{align}
\end{corollary}

\begin{proof}
This follows from the previous proposition by applying the wiggly line calculus of Section~\ref{subsec:alternatives}. 
\end{proof}


\begin{remark}\label{remark:notpivotal}
In the bicategory $\LG$ the natural candidate for a pivotal structure is
\be\label{delta}
\delta_X = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,-1) and +(0,-1) .. (s);
\fill (2.6,-0.3) circle (0pt) node[below] {{\small $\coev_{X^\dual}$}};
\draw (2,0.32) -- (2,0.68);
\draw[line width=0pt] 
(1,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[directed] (D) .. controls +(0,+1) and +(0,+1) .. (s);
\fill (1.6,1.23) circle (0pt) node[above] {{\small $\widetilde\eval_{X}$}};
\draw (3,0.35) -- (3,1.5)
node[above] {{{\small${}^\dual X^{\dual}$}}};
\draw (1,0.65) -- (1,-0.5)
node[below] {{{\small$X$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
: X\stackrel{\cong}{\lra} {}^\dual X^\dual \cong X^{\vee\vee}[n+n] = X^{\vee\vee}
\, , \qquad 
\delta_X^{-1} = 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=1.0,color=blue!50!black, baseline=.4cm]
\draw[line width=0pt] 
(3,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[redirected] (D) .. controls +(0,-1) and +(0,-1) .. (s);
\fill (2.6,-0.28) circle (0pt) node[below] {{\small $\widetilde\coev_{X}$}};
\draw (2,0.32) -- (2,0.68);
\draw[line width=0pt] 
(1,0.5) node[line width=0pt] (D) {}
(2,0.5) node[line width=0pt] (s) {}; 
\draw[redirected] (D) .. controls +(0,+1) and +(0,+1) .. (s);
\fill (1.6,1.23) circle (0pt) node[above] {{\small $\eval_{X^\dual}$}};
\draw (3,0.35) -- (3,1.5)
node[above] {{{\small$X$}}};
\draw (1,0.65) -- (1,-0.5)
node[below] {{{\small${}^\dual X^{\dual}$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
\ee
for each 1-morphism $X\in \hmf(k[x_1,\ldots,x_n,z_1,\ldots,z_m], V-W)$. Observing that~$\delta_X$ is simply the Zorro map~\eqref{eq:trueproofeq2} with~$e_j$ exchanged by $e_j^{**}$, it is straightforward to verify that~$\delta_X$ is the canonical map given by $(\delta_X(a))(\Phi) = \sigma(\Phi(a))$ for all $a\in X, \Phi\in X^\dual$, where $\sigma: R\otimes_k S \lra S\otimes_k R$ is the linear map that swaps tensor factors. 

For~$\delta$ to describe a pivotal structure it must be an isomorphism between~$X$ and $X^{\dual\dual} = X^\vee[n]^\dual \cong X^{\vee\vee}[m+n]$. This is indeed true ``half of the time'', to wit whenever $m+n$ is even, and the results of this section imply that in this case the properties of pivotality hold. However, when $m+n$ is odd~$X$ and $X^{\dual\dual}$ are not isomorphic in general in the strict sense (a counterexample being $W=0$, $V=z^d$, $X=S^{\oplus 2}$, $d_X = (\begin{smallmatrix}0&z^n\\z^{d-n}&0\end{smallmatrix})$ for $n\notin d/2$).
\end{remark}


\section{Defect action on bulk fields}\label{sec:defectaction}

In any bicategory with adjoints which is pivotal, in the sense that left and right adjoints are related in the way described in Section \ref{sec:pivotality}, there are natural maps between the endomorphism spaces of unit 1-morphisms constructed by ``capturing'' a 2-endomorphism of a unit 1-morphism inside a loop labelled by an arbitrary 1-morphism. Below we present the details for the bicategory $\LG$ and give a natural interpretation in terms of defect actions on bulk fields in Landau-Ginzburg models. 

Let $X\in \hmf(k[x_1,\ldots,x_n,z_1,\ldots,z_m], V-W)$ as before. In this section when we write $\uHom$ and $\uEnd$ we mean the spaces of 2-morphisms in $\LG$. We define \textsl{defect operators} 
$$
\mathcal D_l(X): \uEnd(\Delta_V) \longrightarrow \uHom(\Delta_W, \Delta_W[m+n]) \, , \qquad
\mathcal D_r(X): \uEnd(\Delta_W) \longrightarrow \uHom(\Delta_V, \Delta_V[m+n])
$$
as follows. For $\phi\in \uEnd(\Delta_V)$ and $\psi\in \uEnd(\Delta_W)$ we set 
\begin{align}
\mathcal D_l(X)(\phi) & = \eval_X[m+n] \circ (1_{X^\dual}\otimes (\lambda_X \circ (\phi\otimes 1_X)\circ \lambda_X^{-1})) \circ \widetilde\coev_X \, , \nonumber \\ 
\mathcal D_r(X)(\psi) & = \widetilde\eval_X[m+n] \circ (1_{X}\otimes (\rho_{X} \circ (1_X \otimes \psi)\circ \rho_{X}^{-1})) \circ \coev_X \, . \label{defectactionwrittenout}
\end{align}
Since $\uHom(\Delta,\Delta[1]) = 0$ for any unit $1$-morphism $\Delta$ in $\LG$ the operators $\mathcal D_l(X)$ and $\mathcal D_r(X)$ are zero if $m+n$ is odd, while for even $m+n$ they map to $\uEnd(\Delta_W)$ and $\uEnd(\Delta_V)$, respectively. 
In the special case where $\phi=1$ and $\psi=1$ we obtain the left and right \textsl{quantum dimensions} $\operatorname{qdim}_l(X) = \mathcal D_l(X)(1)$ and $\operatorname{qdim}_r(X) = \mathcal D_r(X)(1)$. 

Diagrammatically these definitions read
\begin{align}
\label{leftdefectaction}
& \mathcal D_l(X)(\phi) =
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (3.5);
\fill (-2.2,-2.2) circle (0pt) node[white] {{\small$W$}};
\nicepalecolourscheme (0,0) circle (2);
\fill (-1.1,-1.1) circle (0pt) node[white] {{\small$V$}};
%
%\fill (180:2) circle (0pt) node[left] {{\small$x\vphantom{z'}$}};
%\fill (180:2) circle (0pt) node[right] {{\small$z\vphantom{z'}$}};
%\fill (0:2) circle (0pt) node[left] {{\small$z'\vphantom{z'}$}};
%\fill (0:2) circle (0pt) node[right] {{\small$x'\vphantom{z'}$}};
\draw (0,0) circle (2);
\fill (180:2) circle (0pt) node[right] {{\small$X$}};
\draw[<-, very thick] (0.100,-2) -- (-0.101,-2) node[above] {}; 
\draw[<-, very thick] (-0.100,2) -- (0.101,2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[left] {{\small$\phi$}};
\fill (50:2) circle (3.3pt) node[right] {{\small$\lambda$}};
\fill (-50:2) circle (3.3pt) node[right] {{\small$\lambda^{-1}$}};
\draw[dashed] (135:0) .. controls +(0,1) and +(-0.5,-1) .. (50:2);
\fill (0.41,1.15) circle (0pt) node {{\small $\Delta_V$}};
\fill (0.41,-1.15) circle (0pt) node {{\small $\Delta_V$}};
\draw[dashed] (135:0) .. controls +(0,-1) and +(-0.5,1) .. (-50:2);
\draw[dashed] (270:2) -- (270:3.3)
node[near end,right] {{{\small$\Delta_W$}}};
\draw[dashed] (90:2) -- (90:3.3)
node[near end,right] {{{\small$\Delta_W$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
=
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (3.5);
\fill (-2.2,-2.2) circle (0pt) node[white] {{\small$W$}};
\nicepalecolourscheme (0,0) circle (2);
\fill (-1.1,-1.1) circle (0pt) node[white] {{\small$V$}};
%
\draw[very thin, color=blue!85!black, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (270:2) .. controls +(-3,0) and +(-3,-1) .. (90:2); 
\draw (0,0) circle (2);
\fill (180:2) circle (0pt) node[right] {{\small$X$}};
\draw[<-, very thick] (0.100,-2) -- (-0.101,-2) node[above] {}; 
\draw[<-, very thick] (-0.100,2) -- (0.101,2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[left] {{\small$\phi$}};
\fill (50:2) circle (3.3pt) node[right] {{\small$\lambda$}};
\fill (-50:2) circle (3.3pt) node[right] {{\small$\lambda^{-1}$}};
\draw[dashed] (135:0) .. controls +(0,1) and +(-0.5,-1) .. (50:2);
\fill (0.41,1.15) circle (0pt) node {{\small $\Delta_V$}};
\fill (0.41,-1.15) circle (0pt) node {{\small $\Delta_V$}};
\draw[dashed] (135:0) .. controls +(0,-1) and +(-0.5,1) .. (-50:2);
\draw[dashed] (270:2) -- (270:3.3)
node[near end,right] {{{\small$\Delta_W$}}};
\draw[dashed] (90:2) -- (90:3.3)
node[near end,right] {{{\small$\Delta_W$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\, ,  \\
& \mathcal D_r(X)(\psi) = 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicepalecolourscheme (0,0) circle (3.5);
\fill (2.2,-2.2) circle (0pt) node[white] {{\small$V$}};
\nicecolourscheme (0,0) circle (2);
\fill (1.1,-1.1) circle (0pt) node[white] {{\small$W$}};
%
\draw (0,0) circle (2);
\fill (0:2) circle (0pt) node[left] {{\small$X$}};
\draw[<-, very thick] (0.100,2) -- (-0.101,2) node[above] {}; 
\draw[<-, very thick] (-0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[right] {{\small$\psi$}};
\fill (130:2) circle (3.3pt) node[left] {{\small$\rho$}};
\fill (230:2) circle (3.3pt) node[left] {{\small$\rho^{-1}$}};
\draw[dashed] (135:0) .. controls +(0,1) and +(0.5,-1) .. (130:2);
\fill (-0.1,1.15) circle (0pt) node {{\small $\Delta_W$}};
\fill (-0.1,-1.15) circle (0pt) node {{\small $\Delta_W$}};
\draw[dashed] (135:0) .. controls +(0,-1) and +(0.5,1) .. (230:2);
\draw[dashed] (270:2) -- (270:3.3)
node[near end,right] {{{\small$\Delta_V$}}};
\draw[dashed] (90:2) -- (90:3.3)
node[near end,right] {{{\small$\Delta_V$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
= 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicepalecolourscheme (0,0) circle (3.5);
\fill (2.2,-2.2) circle (0pt) node[white] {{\small$V$}};
\nicecolourscheme (0,0) circle (2);
\fill (1.1,-1.1) circle (0pt) node[white] {{\small$W$}};
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (270:2) .. controls +(3,0) and +(3,-1) .. (90:2); 
\draw (0,0) circle (2);
\fill (0:2) circle (0pt) node[left] {{\small$X$}};
\draw[<-, very thick] (0.100,2) -- (-0.101,2) node[above] {}; 
\draw[<-, very thick] (-0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[right] {{\small$\psi$}};
\fill (130:2) circle (3.3pt) node[left] {{\small$\rho$}};
\fill (230:2) circle (3.3pt) node[left] {{\small$\rho^{-1}$}};
\draw[dashed] (135:0) .. controls +(0,1) and +(0.5,-1) .. (130:2);
\fill (-0.1,1.15) circle (0pt) node {{\small $\Delta_W$}};
\fill (-0.1,-1.15) circle (0pt) node {{\small $\Delta_W$}};
\draw[dashed] (135:0) .. controls +(0,-1) and +(0.5,1) .. (230:2);
\draw[dashed] (270:2) -- (270:3.3)
node[near end,right] {{{\small$\Delta_V$}}};
\draw[dashed] (90:2) -- (90:3.3)
node[near end,right] {{{\small$\Delta_V$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{rightdefectaction}
\end{align}
in the nontrivial case, where we use the notation of Section~\ref{subsec:alternatives} on the right-hand side. 

\begin{remark}
$\uEnd(\Delta_W) = k[x]/(\partial_{x_i}W)$ is the Hochschild cohomology of $\hmf(k[x], W)$~\cite{d0904.4713}. This space also precisely describes bulk fields of Landau-Ginzburg models with potential~$W$, it is a commutative Frobenius algebra whose nondegenerate pairing
\be\label{bulktopmet}
\langle \phi, \psi \rangle_W = 
\Res_{k[x]/k} \left[ \frac{\phi\,  \psi \, \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W}\right]
\ee
describes 2-point correlators on the sphere, see also Section~\ref{sec:ocTFT}. Furthermore, matrix factorisations of $V-W$ describe defect conditions between different Landau-Ginzburg models. Hence the maps~\eqref{leftdefectaction} and~\eqref{rightdefectaction} have the natural interpretation in terms of defect operators on bulk fields: for example, a bulk field~$\phi$ in the theory with potential~$V$ is mapped to the bulk field $\mathcal D_l(X)(\phi)$ in the theory with potential~$W$ by wrapping around its insertion on the worldsheet a defect line labelled by~$X$, and then collapsing this loop onto the insertion point. This limiting process is nonsingular as the bicategory $\LG$ describes the purely topological sector of Landau-Ginzburg models. 

%As already observed in Section~\ref{sec:Introduction}, for the special case $V=0$ the right defect action in~\eqref{defectaction} is precisely the disk correlator of the bulk field~$\psi$ in the presence of the boundary condition~$X$. If we allow for boundary field insertions on the $X$-line we naturally recover the general disk correlator as a 2-morphism in our setting, as follows from the proof of Proposition~\ref{prop:defectaction}. This is another example of the general fact that string diagrams in the bicategory $\LG$ exactly compute the correlators of worldsheets with insertions that they intuitively depict. 
\end{remark}

Using the ``folding trick'', which relates defects to boundary conditions in a product theory, one can argue for explicit expressions for $\mathcal D_l(X)$ and $\mathcal D_r(X)$ (in particular, from this perspective it is also immediate that $\mathcal D_l(X)$ and $\mathcal D_r(X)$ should vanish for odd $m+n$). This was done in~\cite{cr1006.5609} for the case $V=W$ in one variable. Here we use our adjunction formulas to directly prove it for the general case. In addition, we want to allow for the additional decoration with a map $\Phi: X \lra X$ for which we define the following variants of the operators $\mathcal D_l(X)$ and $\mathcal D_r(X)$: 
\be\label{defectactionwithfieldinsertion}
\mathcal D_l^\Phi(X)(\phi) =
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (3.5);
\fill (-2.2,-2.2) circle (0pt) node[white] {{\small$W$}};
\nicepalecolourscheme (0,0) circle (2);
\fill (-1.1,-1.1) circle (0pt) node[white] {{\small$V$}};
%
%\fill (180:2) circle (0pt) node[left] {{\small$x\vphantom{z'}$}};
%\fill (180:2) circle (0pt) node[right] {{\small$z\vphantom{z'}$}};
%\fill (0:2) circle (0pt) node[left] {{\small$z'\vphantom{z'}$}};
%\fill (0:2) circle (0pt) node[right] {{\small$x'\vphantom{z'}$}};
\draw (0,0) circle (2);
\fill (180:2) circle (0pt) node[right] {{\small$X$}};
\draw[<-, very thick] (0.100,-2) -- (-0.101,-2) node[above] {}; 
\draw[<-, very thick] (-0.100,2) -- (0.101,2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[left] {{\small$\phi$}};
\fill (0:2) circle (3.3pt) node[right] {{\small$\Phi$}};
\fill (50:2) circle (3.3pt) node[right] {{\small$\lambda$}};
\fill (-50:2) circle (3.3pt) node[right] {{\small$\lambda^{-1}$}};
\draw[dashed] (135:0) .. controls +(0,1) and +(-0.5,-1) .. (50:2);
\fill (0.41,1.15) circle (0pt) node {{\small $\Delta_V$}};
\fill (0.41,-1.15) circle (0pt) node {{\small $\Delta_V$}};
\draw[dashed] (135:0) .. controls +(0,-1) and +(-0.5,1) .. (-50:2);
\draw[dashed] (270:2) -- (270:3.3)
node[near end,right] {{{\small$\Delta_W$}}};
\draw[dashed] (90:2) -- (90:3.3)
node[near end,right] {{{\small$\Delta_W$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\, , \qquad
\mathcal D_r^\Phi(X)(\psi) = 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicepalecolourscheme (0,0) circle (3.5);
\fill (2.2,-2.2) circle (0pt) node[white] {{\small$V$}};
\nicecolourscheme (0,0) circle (2);
\fill (1.1,-1.1) circle (0pt) node[white] {{\small$W$}};
%
\draw (0,0) circle (2);
\fill (0:2) circle (0pt) node[left] {{\small$X$}};
\draw[<-, very thick] (0.100,2) -- (-0.101,2) node[above] {}; 
\draw[<-, very thick] (-0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (135:0) circle (3.3pt) node[right] {{\small$\psi$}};
\fill (180:2) circle (3.3pt) node[left] {{\small$\Phi$}};
\fill (130:2) circle (3.3pt) node[left] {{\small$\rho$}};
\fill (230:2) circle (3.3pt) node[left] {{\small$\rho^{-1}$}};
\draw[dashed] (135:0) .. controls +(0,1) and +(0.5,-1) .. (130:2);
\fill (-0.1,1.15) circle (0pt) node {{\small $\Delta_W$}};
\fill (-0.1,-1.15) circle (0pt) node {{\small $\Delta_W$}};
\draw[dashed] (135:0) .. controls +(0,-1) and +(0.5,1) .. (230:2);
\draw[dashed] (270:2) -- (270:3.3)
node[near end,right] {{{\small$\Delta_V$}}};
\draw[dashed] (90:2) -- (90:3.3)
node[near end,right] {{{\small$\Delta_V$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\, . 
\ee

\begin{proposition}\label{prop:defectaction}
For any $X\in \hmf(k[x_1,\ldots,x_n,z_1,\ldots,z_m], V-W)$, $\Phi \in \uEnd(X)$, $\phi\in \uEnd(\Delta_V)$ and $\psi\in \uEnd(\Delta_W)$ we have
\begin{align*}
\mathcal D_l^\Phi(X)(\phi) & 
= (-1)^{{{n+1}\choose 2}}\Res_{k[x,z]/k[x]} \left[ \frac{\phi(z) \str\big( \Phi \, \partial_{x_1} d_{X}\ldots \partial_{x_n} d_{X} \partial_{z_1} d_{X}\ldots \partial_{z_m} d_{X} \big) \underline{\operatorname{d}\! z}}{\partial_{z_1} V, \ldots, \partial_{z_m} V} \right] , \\
\mathcal D_r^\Phi(X)(\psi) & = (-1)^{{{m+1}\choose 2}}  \Res_{k[x,z]/k[z]} \left[ \frac{\psi(x) \str\big( \Phi \, \partial_{x_1} d_{X}\ldots \partial_{x_n} d_{X} \partial_{z_1} d_{X}\ldots \partial_{z_m} d_{X} \big) \underline{\operatorname{d}\! x}}{\partial_{x_1} W, \ldots, \partial_{x_n} W} \right] . 
\end{align*}
\end{proposition}

\begin{proof}
We treat the case of $\mathcal D_r^\Phi(X)$ in detail, the argument for $\mathcal D_l^\Phi(X)$ is similar. Since $\uEnd(\Delta_W) = k[x]/(\partial_{x_i}W)$ and $\uEnd(\Delta_V) = k[z]/(\partial_{z_i}V)$ we are free to identify the variables on both sides of the unit 1-endomorphisms at appropriate places. Furthermore, $\rho_X$ will project out all non-zero degree contributions coming from the action of $\rho_{X}^{-1}$, so $\rho_{X} \circ (1_X \otimes \psi)\circ \rho_{X}^{-1}$ is simply multiplication by the polynomial $\psi(z)$. 

In the lower part of the expression for $\mathcal D_r^\Phi(X)(\psi)$ in~\eqref{defectactionwithfieldinsertion} we have using \eqref{eq:coev_divideddiff}
$$
\coev_X(1) = \sum_j (-1)^{{m\choose 2}} \partial_{[1]} d_X \ldots \partial_{[m]} d_X e_j \otimes e_j^* \, . 
$$
%\begin{align}
%\widetilde\coev_X (1) & = \sum_j (-1)^{|e_j|} (\varepsilon\Psi) \left( (-\At_{X})^n (e_j^*\otimes e_j) \right) \nonumber \\
%& = \sum_j (-1)^{|e_j| + n} (-1)^{(|e_j| + 1)+\ldots +(|e_j| + n) + n|e_j|} e^*_{j} \otimes e_{k_n} \otimes (\varepsilon\Psi) \left( d(d_{X})_{k_n k_{n-1}} \ldots d(d_{X})_{k_1 j} \right) \nonumber \\
%& = \sum_j (-1)^{|e_j|(|e_j| + n) + {n+1\choose 2} + n} e_j^* \otimes e_{k_n}\big( \partial_{[1]} d_{X} \ldots \partial_{[n]} d_{X} \big)_{k_n j} \nonumber \\
%& = \sum_j (-1)^{|e_j|(|e_j| + n) + {n\choose 2}} e_j^* \otimes \big( \partial_{x_1} d_{X} \ldots \partial_{x_n} d_{X} \big) (e_{j}) \label{coevtilde1}
%\end{align}
%which we identify with $(-1)^{{n\choose 2}} \partial_{x_1} d_{X} \ldots \partial_{x_n} d_{X}$ in $\End(X)$. Note that in the last step leading to~\eqref{coevtilde1} we set $\partial_{[i]} d_{X}(x,z) = \partial_{x_i} d_{X}(x,z)$ since $x=x'$ in $\End(\Delta_W)$. 
Next we apply~$\Phi$, $\psi$ and $\widetilde\eval_X$. Since the latter maps back to~$\Delta_V$ we may set $\partial_{[i]} d_X = \partial_{z_i} d_X$. Thus we obtain
$$
\mathcal D_r^\Phi(X)(\psi) = 
(-1)^{{m+1\choose 2}} \Res_{k[x,z]/k[z]} \left[ \frac{\psi(x) \str\big( \Phi \, \partial_{x_1} d_{X}\ldots \partial_{x_n} d_{X} \partial_{z_1} d_{X}\ldots \partial_{z_m} d_{X} \big) \underline{\operatorname{d}\! x}}{\partial_{x_1} W, \ldots, \partial_{x_n} W} \right] + \mathcal O(\theta) \, . 
$$
Here we collectively denote the contributions from $\widetilde\eval_X$ of non-zero degree in the Koszul complex $\Delta_V$ by $\mathcal O(\theta)$. Since we know that $\mathcal D_r^\Phi(X)(\psi)$ is a morphism in $\uEnd(\Delta_V) = k[z]/(\partial_{z_i}V)$ it follows that $\mathcal O(\theta)$ must be null-homotopic, thus concluding the proof. 
\end{proof}

\begin{corollary}
For any $X\in \hmf(k[x,z], V-W)$ the operators $\mathcal D_l(X)$ and $\mathcal D_r(X)$ are adjoint with respect to the pairings~\eqref{bulktopmet}, i.\,e.~we have
\be\label{Dadjoint}
\big\langle \mathcal D_l(X)(\phi), \psi \big\rangle_W = \big\langle \phi , \mathcal D_r(X)(\psi) \big\rangle_V
\ee
for all $\phi\in \uEnd(\Delta_V)$ and $\psi\in \uEnd(\Delta_W)$. 
\end{corollary}

\begin{proof}
This directly follows from the explicit expressions for $\mathcal D_l(X)$, $\mathcal D_r(X)$ and $\big\langle -, -\big\rangle_W$, $\big\langle -, -\big\rangle_V$, together with the transitivity rule for residues. 
\end{proof}


\begin{remark}
We recall the physical interpretation of the relation~\eqref{Dadjoint}. Both sides of this equation are 2-point correlators on the Riemann sphere, with a defect line labelled by~$X$ wrapped around counterclockwise the bulk field~$\phi$, or wrapped around~$\psi$ in clockwise fashion. That both correlators should be equal follows from the fact that the topological defect can be moved around the sphere at no cost: 
$$
\left\langle
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[baseline=-0.1cm]
\def\R{1.85}
\def\angEl{45}
\filldraw[ball color= white!77!blue,draw=white] (0,0) circle (\R);
\DrawLatitudeCircleU[\R,rotate=130,very thick, blue]{65}
\fill (-0.95,-0.83) circle (1.3pt) node[above] {{\small$\phi$}}; 
\fill (0.95,-0.83) circle (1.3pt) node[above] {{\small$\psi$}}; 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\right\rangle
=
\left\langle
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[baseline=-0.1cm]
\def\R{1.85}
\def\angEl{45}
\filldraw[ball color= white!77!blue,draw=white] (0,0) circle (\R);
\DrawLongitudeCircle[\R]{80}
\fill (-0.95,-0.83) circle (1.3pt) node[above] {{\small$\phi$}}; 
\fill (0.95,-0.83) circle (1.3pt) node[above] {{\small$\psi$}}; 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\right\rangle
=
\left\langle
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[baseline=-0.1cm]
\def\R{1.85}
\def\angEl{45}
\filldraw[ball color= white!77!blue,draw=white] (0,0) circle (\R);
\DrawLatitudeCircle[\R,rotate=-130, very thick, blue]{65}
\fill (-0.95,-0.83) circle (1.3pt) node[above] {{\small$\phi$}}; 
\fill (0.95,-0.83) circle (1.3pt) node[above] {{\small$\psi$}}; 
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\right\rangle .
$$
\end{remark}

The defect operators satisfy the following compatibility conditions: 

\begin{proposition}
\label{prop:defectactionproperties}
Let $W\in k[x_1,\ldots,x_n]$, $V\in k[z_1,\ldots,z_m]$, $U\in k[y_1,\ldots,y_p]$ be potentials and $Y\in \hmf(k[y,z],U-V)$, $X\in \hmf(k[x,z],V-W)$. 
\begin{enumerate}
\item $\mathcal D_l(\Delta) = 1 = \mathcal D_r(\Delta)$. 
\item $\mathcal D_l(X) = \mathcal D_r(X^\vee)$ and $\mathcal D_r(X) = \mathcal D_l(X^\vee)$.
\item $\mathcal D_l(X) \circ \mathcal D_l(Y) = \mathcal D_l(Y \otimes X)$ and $\mathcal D_r(Y) \circ \mathcal D_r(X) = \mathcal D_r(Y \otimes X)$. 
\item $\mathcal D_l(X[a]) = (-1)^a \mathcal D_l(X)$ and $\mathcal D_r(X[a]) = (-1)^a \mathcal D_r(X)$ for $a \in \mathbb{Z}$.
\end{enumerate}
Analogous results hold for the operators $\mathcal D^\Phi_l, \mathcal D^\Phi_r$ decorated with endomorphisms of $X$ and $Y$.
\end{proposition}

\begin{proof}
(i) is a direct consequence of Proposition~\ref{prop:defectaction} and the results of~\cite[Section\,5.1, Eq.\,(21)]{kr0405232} while (iv) is trivial.

(ii): By the argument of Remark~\ref{remark:indeptlambda} reordering the partial derivatives of $d_{X^\vee}$ leaves $\mathcal D_r(X^\vee)$ invariant up to a sign. Together with $(d_{X^\vee})_{ij} = (-1)^{|e_i|}(d_X)_{ji}$ one checks that the claim then follows from Proposition~\ref{prop:defectaction}. 

(iii): We give the proof for $\mathcal D_l$, the other case is analogous. It suffices to prove the identity for $\mathcal D_l$ under the assumption that the variable numbers $n,m,p$ all have the same parity, since otherwise $\mathcal D_l(X) \circ \mathcal D_l(Y)$ is zero. The basic argument is a standard calculation with string diagrams. There are however slight modifications needed due to the fact that $\LG$ is only ``pivotal up to shifts'' as discussed in Section~\ref{sec:pivotality}. 

We start by writing $\mathcal D_l(X) \circ \mathcal D_l(Y)$ as
$$
\!\!\!\!\!\!\!\!\!\!\!\!
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.7,color=blue!50!black, baseline=-0.75cm,>=stealth]
% semicircles: 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:1) arc (0:180:1);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:2) arc (0:180:2);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-1,-2) arc (180:360:1);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-2,-2) arc (180:360:2);
%	
% wiggly lines: 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(0,1) .. controls +(-2,-1.5) and +(-2,0.4) .. (0,-3); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(0,2) .. controls +(-3,-1.5) and +(-4,0.4) .. (0,-4); 
% vertical lines: 
\draw (-1,0) -- (-1,-2);
\draw (-2,0) -- (-2,-2);
%
\draw (1,0) -- (1,-2);
\draw (2,0) -- (2,-2);
% line labels: 
\draw (0.7,0.23) node {{\scriptsize $Y$}};
\draw (1.7,0.23) node {{\scriptsize $X$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\,=\!\!\!\!\!\!\!\!\!\!\!\!\!\!
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.7,color=blue!50!black, baseline=-0.75cm,>=stealth]
% semicircles: 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:1) arc (0:180:1);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:2) arc (0:180:2);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-1,-2) arc (180:360:1);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-2,-2) arc (180:360:2);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(2.75,0) arc (360:180:0.625);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(1.5,-2) arc (180:0:0.625);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{<}}}, postaction={decorate}
	] 
	(2.75,1.5) arc (180:0:0.625);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(2.75,-3.5) arc (180:360:0.625);	
% wiggly lines: 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(0,1) .. controls +(-2,-1.5) and +(-2,0.4) .. (0,-3); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(0,2) .. controls +(-3,-1.5) and +(-4,0.4) .. (0,-4); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(2.25,-0.625) .. controls +(1.5,0.4) and +(-1,-1) .. (3.375,2.1); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(2.25,-1.375) .. controls +(0.5,-1) and +(-1.5,0) .. (3.375,-4.1); 
% vertical lines: 
\draw (-1,0) -- (-1,-2);
\draw (-2,0) -- (-2,-2);
%
\draw (2.75,-2) -- (2.75,-3.5);
\draw (2.75,0) -- (2.75,1.5);
%
\draw (4,-3.5) -- (4,1.5);
% horizontal lines: 
\draw[dotted] (1,0)[] -- (2,0);
\draw[dotted] (1,-2) -- (2,-2);
% line labels: 
\draw (0.7,0.23) node {{\scriptsize $Y$}};
\draw (1.7,0.23) node {{\scriptsize $X$}};
\draw (4.7,0.225) node {{\scriptsize $Y \otimes X$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
%\,=\!\!\!\!\!\!\!\!\!\!\!\!\!
%%%%%%%%%%%%%%%%%%%%%%%
%\begin{tikzpicture}[very thick,scale=0.7,color=blue!50!black, baseline=-0.75cm,>=stealth]
%% semicircles: 
%\draw[
%	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
%	] 
%	(0:1) arc (0:180:1);
%\draw[
%	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
%	] 
%	(0:2) arc (0:180:2);
%%
%\draw[
%	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
%	] 
%	(-1,-2) arc (180:360:1);
%\draw[
%	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
%	] 
%	(-2,-2) arc (180:360:2);
%%
%\draw[
%	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
%	] 
%	(2.75,0) arc (360:180:0.625);
%\draw[
%	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
%	] 
%	(1.5,-2) arc (180:0:0.625);
%%
%\draw[
%	decoration={markings, mark=at position 0.5 with {\arrow{<}}}, postaction={decorate}
%	] 
%	(2.75,1.5) arc (180:0:0.625);
%\draw[
%	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
%	] 
%	(2.75,-3.5) arc (180:360:0.625);
%% wiggly lines: 
%\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
%(0,1) .. controls +(-2,-1.5) and +(-2,0.4) .. (0,-3); 
%\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
%(0,2) .. controls +(-3,-1.5) and +(-4,0.4) .. (0,-4); 
%\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
%(2.25,-0.625) .. controls +(1.5,0.4) and +(-1,-1) .. (3.375,2.1); 
%\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
%(2.25,-1.375) .. controls +(0.5,-1) and +(-1.5,0) .. (3.375,-4.1); 
%% vertical lines: 
%\draw (-1,0) -- (-1,-2);
%\draw (-2,0) -- (-2,-2);
%%
%\draw (2.75,-2) -- (2.75,-3.5);
%\draw (2.75,0) -- (2.75,1.5);
%%
%\draw (4,-3.5) -- (4,1.5);
%% horizontal lines: 
%\draw[dotted] (1,0) -- (2,0);
%\draw[dotted] (1,-2) -- (2,-2);
%% 2-morphisms: 
%\coordinate (psi) at ($ (1.5,0) $);
%\fill (psi) circle (2.5pt) node[below left] {{\small$\xi$}};
%\coordinate (theta) at ($ (4,0) $);
%\fill (theta) circle (2.5pt) node[right] {{\small$\kappa$}};
%%
%\coordinate (psi2) at ($ (4,-2) $);
%\fill (psi2) circle (2.5pt) node[right] {{\small$\xi$}};
%\coordinate (theta2) at ($ (1.5,-2) $);
%\fill (theta2) circle (2.5pt) node[above left] {{\small$\kappa$}};
%% line labels: 
%\draw (0.7,0.23) node {{\scriptsize $Y$}};
%\draw (1.7,0.23) node {{\scriptsize $X$}};
%\draw (4.7,0.75) node {{\scriptsize $\bar Y \otimes \bar X$}};
%\draw (4.7,-1) node {{\scriptsize $Y \otimes X$}};
%\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%%
$$
where we used the Zorro moves to re-express the identity on $Y\otimes X$, and here and below we do not display the argument of the defect operators. Now we are in a position to apply Corollary~\ref{cor:nicerpivotalitydiagrams} to the lower part of the diagram on the right-hand side to find that $\mathcal D_l(X) \circ \mathcal D_l(Y)$ is equal to
$$
\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.7,color=blue!50!black, baseline=-0.75cm,>=stealth]
% semicircles: 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:1) arc (0:180:1);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:2) arc (0:180:2);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-1,-2) arc (360:180:2);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-2,-2) arc (360:180:1);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(2.75,0) arc (360:180:0.625);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-4.5,-2) arc (0:180:0.625);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{<}}}, postaction={decorate}
	] 
	(2.75,1.5) arc (180:0:0.625);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-5.75,-3.5) .. controls +(0,-2) and +(0,-2) .. (4,-3.5);
% wiggly lines: 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(-3,-3) .. controls +(2.3,0.2) and +(-1.3,-0.2) .. (0,1); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(-3,-4) .. controls +(-3.4,0.2) and +(0,-0.72) .. (-5.25,-1.375); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(2.25,-0.625) .. controls +(1.4,0.2) and +(-1.0,-0.32) .. (3.375,2.1); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(-1,-5) .. controls +(-11.9,-0.1) and +(-3.3,-0.75) .. (0,2); 
% vertical lines: 
\draw (-1,0) -- (-1,-2);
\draw (-2,0) -- (-2,-2);
%
\draw (-5.75,-2) -- (-5.75,-3.5);
\draw (2.75,0) -- (2.75,1.5);
%
\draw (4,-3.5) -- (4,1.5);
% horizontal lines: 
\draw[dotted] (1,0) -- (2,0);
\draw[dotted] (-4,-2) -- (-5,-2);
% line labels: 
\draw (0.7,0.23) node {{\scriptsize $Y$}};
\draw (1.7,0.23) node {{\scriptsize $X$}};
\draw (4.7,0.23) node {{\scriptsize $Y \otimes X$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, . 
$$
Next we employ the calculus of wiggly lines, in particular the identity~\eqref{eq:wigglyresolution}, in conjunction with the Zorro moves to find that the above equals 
$$
\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!\!
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.7,color=blue!50!black, baseline=-0.75cm,>=stealth]
% semicircles: 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:1) arc (0:180:1);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:2) arc (0:180:2);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-1,-2) arc (360:180:2);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-2,-2) arc (360:180:1);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(2.75,0) arc (360:180:0.625);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-4.5,-2) arc (0:180:0.625);
%
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{<}}}, postaction={decorate}
	] 
	(2.75,1.5) arc (180:0:0.625);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-5.75,-3.5) .. controls +(0,-2) and +(0,-2) .. (4,-3.5);
% wiggly lines: 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(-3,-3) .. controls +(2.3,0.2) and +(-2.3,-0.2) .. (0,2); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(-3,-4) .. controls +(3.7,0.2) and +(-1.3,-0.32) .. (0,1); 
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(2.25,-0.625) .. controls +(1.4,0.2) and +(-1.0,-0.32) .. (3.375,2.1); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(-1,-5) .. controls +(-7.9,-0.1) and +(-0.3,-0.75) .. (-5.25,-1.375); 
% vertical lines: 
\draw (-1,0) -- (-1,-2);
\draw (-2,0) -- (-2,-2);
%
\draw (-5.75,-2) -- (-5.75,-3.5);
\draw (2.75,0) -- (2.75,1.5);
%
\draw (4,-3.5) -- (4,1.5);
% horizontal lines: 
\draw[dotted] (1,0) -- (2,0);
\draw[dotted] (-4,-2) -- (-5,-2);
%% 2-morphisms: 
%\coordinate (psi) at ($ (1.5,0) $);
%\fill (psi) circle (2.5pt) node[below left] {{\small$\xi$}};
%\coordinate (theta) at ($ (4,-1) $);
%\fill (theta) circle (2.5pt) node[right] {{\small$e$}};
%%
%\coordinate (theta2) at ($ (-4.5,-2) $);
%\fill (theta2) circle (2.5pt) node[above right] {{\small$\kappa$}};
% line labels: 
\draw (0.7,0.23) node {{\scriptsize $Y$}};
\draw (1.7,0.23) node {{\scriptsize $X$}};
\draw (4.7,0.23) node {{\scriptsize $Y \otimes X$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.7,color=blue!50!black, baseline=-0.75cm,>=stealth]
% semicircles: 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(0:1) arc (0:180:1);
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	] 
	(-1,-2) arc (180:360:1);
%	
% wiggly lines: 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] 
(0,1) .. controls +(-2,-1.5) and +(-2,0.4) .. (0,-3); 
% vertical lines: 
\draw (-1,0) -- (-1,-2);
\draw (1,0) -- (1,-2);
%
% line labels: 
\draw (1.7,0.23) node {{\scriptsize $Y \otimes X$}};
\end{tikzpicture}
%%%%%%%%%%%%%%%%%%%%%%
\, , 
$$
thus ending the proof. 
\end{proof}


\section{Open/closed topological field theory}\label{sec:ocTFT}

In this section we describe how the structure of two-dimensional open/closed topological field theory (TFT) is completely  captured in the bicategory $\LG$. We will see how all TFT data are naturally encoded in string diagrams that directly translate the physical intuition into straightforwardly computable 2-morphisms. More generally, this allows for the computation of any correlator (of worldsheets of arbitrary genus, possibly with boundaries and defect lines). As an example we will compute an annulus correlator, thereby providing a new, simple proof of the Cardy condition. 

Recall from~\cite{l0312, ms0609042} that one way to present a two-dimensional open/closed TFT is by the data of 
\begin{itemize}
\item a commutative Frobenius algebra~$C$, 
\item a Calabi-Yau category~$\mathcal O$, 
\item \textsl{bulk-boundary maps} $\beta_A: C \lra \End_{\mathcal O}(A)$ and \textsl{boundary-bulk maps} $\beta^A: \End_{\mathcal O}(A) \lra C$ for all $A\in \mathcal O$. 
\end{itemize}
These data are subject to the following conditions. 
\begin{itemize}
\item The bulk-boundary maps $\beta_A$ are morphisms of unital algebras that map into the centre of $\End_{\mathcal O}(A)$. 
\item $\beta_A$ and $\beta^A$ are mutually adjoint with respect to the nondegenerate pairings $\langle -,- \rangle$ on~$C$ and $\langle -,- \rangle_A$ on $\End_{\mathcal O}(A)$ (which are part of the Frobenius and Calabi-Yau structure): 
$$
\langle \beta_A(\phi) , \psi \rangle_A = \langle \phi, \beta^A(\psi) \rangle
$$
for all $\phi\in C$ and $\psi\in \End_{\mathcal O}(A)$. 
\item The \textsl{Cardy condition} is satisfied, i.\,e.~we have
$$
\str ( {}_\psi m_\varphi ) = \langle \beta^A(\varphi), \beta^B(\psi) \rangle
$$
for all $\varphi: A \lra A$, $\psi: B \lra B$ where ${}_\psi m_\varphi (\alpha) = \psi\alpha\varphi$ for all $\alpha \in \Hom_{\mathcal O}(A,B)$. 
\end{itemize}

Every Landau-Ginzburg model with potential $W\in R = k[x_1,\ldots,x_n]$ gives rise to an open/closed TFT with $C = R/(\partial W)$, $\mathcal O = \hmf(R,W)$, 
\be\label{bubobobu}
\beta_X : \phi \lmt \phi \cdot 1_X \, , \qquad  
\beta^X : \psi \lmt (-1)^{n+1\choose 2} \str(\psi \, \partial_{x_1} d_X \ldots \partial_{x_n} d_X) 
\ee
and the bulk and boundary pairings
\begin{align}
\langle \phi_1 , \phi_2 \rangle 
& = 
\Res_{k[x]/k} \left[ \frac{\phi_1 \phi_2 \, \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W}\right] , \label{bulkpairing} \\
\langle \psi_1 , \psi_2 \rangle_X 
& = 
\Res_{k[x]/k} \left[ \frac{ \str (\psi_1 \psi_2 \, \partial_{x_1} d_X \ldots \partial_{x_n} d_X) \,  \underline{\operatorname{d}\!x}}{\partial_{x_1}W, \ldots, \partial_{x_n} W}\right] . \label{KapuLi}
\end{align}
The hardest part in establishing this result is to prove the nondegeneracy of the Kapustin-Li pairing~\eqref{KapuLi} and that the Cardy condition holds (the fact that~\eqref{bulkpairing} is nondegenerate is a classical result in residue theory, and checking the remaining axioms is obvious or straightforward); this was first done in~\cite{m0912.1629} and~\cite{pv1002.2116}, respectively, in the case where~$k$ is a field. In Section~\ref{section:dualityadjointop} and at the end of this section we will give (new) proofs for the general case. 

Before turning to the Cardy condition we wish to explain how the above data can be extracted from the bicategory $\LG$ using the powerful and suggestive string diagram language.\footnote{Note however that $\LG$ contains much more information than just the structure of open/closed TFT.} For $X\in \hmf(R,W)$ the bulk-boundary and boundary-bulk maps~\eqref{bubobobu} are given by
$$
\beta_X(\phi) = 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.5,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (-2.6,-3.3) rectangle (0,3.3);
\fill (-2.1,-2.2) circle (0pt) node[white] {{\small$W$}};
%
\draw[->, very thick] (0,-3.3) -- (0,0); 
\draw[very thick] (0,0) -- (0,3.3);
\draw[dashed] (0,-2) .. controls +(-0.5,1) and +(0,-1) .. (-1,0);
\draw[dashed] (-1,0) .. controls +(0,1) and +(-0.5,-1) .. (0,2);
\fill (0,0) circle (0pt) node[right] {{\small$X$}};
\fill (-1,0) circle (3.3pt) node[left] {{\small$\phi$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\, , \qquad 
\beta^X(\psi) = 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.5,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (3.5);
\fill (-2.1,-2.2) circle (0pt) node[white] {{\small$W$}};
%
\shadedraw[top color=white, bottom color=white, draw=white] (0,0) circle (2);
\draw (0,0) circle (2);
\draw[->, very thick] (0.100,-2) -- (-0.101,-2) node[above] {}; 
\draw[->, very thick] (-0.100,2) -- (0.101,2) node[below] {}; 
\fill (90:2) circle (0pt) node[below] {{\small$X$}};
\fill (180:2) circle (3.3pt) node[left] {{\small$\psi$}};
\draw[dashed] (270:2) -- (270:3.3)
node[near end,right] {{{\small$\Delta_W$}}};
\draw[dashed] (90:2) -- (90:3.3)
node[near end,right] {{{\small$\Delta_W$}}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
$$
where we used the identification $R/(\partial W) \cong \End_{\hmf(R,W)}(\Delta_W)$ and a special case of Proposition~\ref{prop:defectaction}. Another special case of the same proposition allows us to recover the Kapustin-Li pairing as the obvious 2-morphism representing the disk correlator, 
$$
\langle \psi_1 , \psi_2 \rangle_X = 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\fill (-1.1,-1.1) circle (0pt) node[white] {{\small$W$}};
%
\draw (0,0) circle (2);
\draw[<-, very thick] (0.100,-2) -- (-0.101,-2) node[above] {}; 
\draw[<-, very thick] (-0.100,2) -- (0.101,2) node[below] {}; 
\fill (-22.5:2) circle (3.3pt) node[right] {{\small$\psi_1$}};
\fill (22.5:2) circle (3.3pt) node[right] {{\small$\psi_2$}};
\fill (270:2) circle (0pt) node[below] {{\small$X$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\, .
$$
Note that here and from now on we do no longer display dashed lines for the unit 1-endomorphism~$\Delta_W$. 

The bulk pairing $\langle -,- \rangle = \langle -,- \rangle_W$ describes the 2-point \textsl{sphere} correlator; flattening the sphere suggests the identity
\be\label{DeltaDisk}
\langle \phi_1, \phi_2 \rangle_W = 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\fill (0,0) circle (0pt) node[white] {{\small$W(x)-W(y)$}};
%
\draw (0,0) circle (2);
\draw[<-, very thick] (0.100,-2) -- (-0.101,-2) node[above] {}; 
\draw[<-, very thick] (-0.100,2) -- (0.101,2) node[below] {}; 
%\draw[dashed] (135:0) .. controls +(0,1) and +(-0.5,-1) .. (50:2);
%\draw[dashed] (135:0) .. controls +(0,-1) and +(-0.5,1) .. (-50:2);
\fill (-22.5:2) circle (3.3pt) node[right] {{\small$\phi_1(x)$}};
\fill (22.5:2) circle (3.3pt) node[right] {{\small$\phi_2(x)$}};
\fill (270:2) circle (0pt) node[below] {{\small$\Delta_W$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\ee
where we view $\Delta_W$ as a 1-morphism $(k,0) \lra (\Re, \widetilde W)$, i.\,e.~as a boundary condition of the doubled theory with potential $W(x)-W(y)$. The above equality indeed holds as follows from our explicit expressions for the adjunction maps together with~\cite[Proposition\,4.1.2]{pv1002.2116}. A more conceptual derivation of~\eqref{DeltaDisk} would involve to endow the bicategory $\LG$ with a monoidal structure (so as to give rigorous meaning to the process of folding worldsheets together, i\,.e~tensoring objects in the bicategory $\LG$). 

We have just seen how the structure of open/closed TFT embeds into $\LG$. In principle this is enough to compute arbitrary correlators using the factorisation property of TFT. However, one can also compute more general correlators directly in $\LG$: all we have to do is to interpret the physical picture of a worldsheet~$\Sigma$ with insertions and defect lines as the associated string diagram representing a 2-morphism $k \lra k$ which is the value of the correlator of~$\Sigma$. 

As an illustrative example let us consider the genus-3 correlator of the worldsheet with two phases governed by the potentials~$V$ and~$W$, depicted in the upper part of Figure~\ref{fig:worldsheet}. Here we label boundaries, defect lines, bulk fields, boundary fields, defect fields by $Y, X, \phi, \psi, \Phi$ with appropriate indices, respectively. The string diagram computing this correlator is shown in the lower part of Figure~\ref{fig:worldsheet}. It is exactly the same as the worldsheet picture, apart from the fact that we interpret the relevant parts as evaluation and coevaluation maps, and if the numbers~$m$ and~$n$ of variables on which~$V$ and~$W$ depend are both odd then we use the wiggly line notation explained in Section~\ref{subsec:alternatives}.\footnote{Note that if~$m$ and~$n$ have opposite parity then by the results of Section~\ref{sec:defectaction} the correlator vanishes as it corresponds to a map in $\Hom_{\hmf(k,0)}(k,k[1]) = 0$.} 
We point out that in general the nature of the 1-morphisms/defects involved determines uniquely whether a given cup or cap is a tilded or untilded adjunction map. There may be ambiguities how to make wiggly lines meet, but the value of the 2-morphism obtained is independent of this choice. 

\begin{figure}[h!]
$$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.95,color=blue!50!black, baseline,>=stealth]
%
% big circle
\nicecolourscheme[
	decoration={markings, mark=at position 0.25 with {\arrow{>}}}, postaction={decorate}
	] 
	(0,0) circle (5.2);
\draw (0,0) circle (5.2);
%
% draw 4 circles inside big one: 
\nicepalecolourscheme (-2,-2) circle (1.5);
\shadedraw[top color=white, bottom color=white, draw=white] (-2,2) circle (1.5);
\shadedraw[top color=white, bottom color=white, draw=white] (2,2) circle (1.5);
\shadedraw[top color=white, bottom color=white, draw=white] (2,-2) circle (1.5);
%
\draw[
	decoration={markings, mark=at position 0.25 with {\arrow{>}}}, postaction={decorate}
	] 
	(-2,-2) circle (1.5);
\draw[
	decoration={markings, mark=at position 0.25 with {\arrow{<}}}, postaction={decorate}
	]
	(2,-2) circle (1.5);
\draw[
	decoration={markings, mark=at position 0.25 with {\arrow{<}}}, postaction={decorate}
	]
	 (-2,2) circle (1.5);
\draw[
	decoration={markings, mark=at position 0.25 with {\arrow{<}}}, postaction={decorate}
	]
	 (2,2) circle (1.5);
%
% potentials: 
\fill (0.5,-4.5) circle (0pt) node[white] {{\small$W$}};
\fill (-1.3,-2.8) circle (0pt) node[white] {{\small$V$}};
%
% field insertions: 
\fill (225:5.2) circle (2.2pt) node[left] {{\small$\Psi_1$}};
\coordinate (Psi2) at ($ (-2,2) + (45:1.5) $);
\fill (Psi2) circle (2.2pt) node[right] {{\small$\Psi_2$}};
\fill (35:5.2) circle (2.2pt) node[right] {{\small$\Psi_3$}};
\fill (75:5.2) circle (2.2pt) node[above] {{\small$\Phi_1$}};
\coordinate (Phi2) at ($ (2,2) + (130:1.5) $);
\fill (Phi2) circle (2.2pt) node[left] {{\small$\Phi_2$}};
\coordinate (Phi3) at ($ (2,2) + (-10:1.5) $);
\fill (Phi3) circle (2.2pt) node[right] {{\small$\Phi_3$}};
\fill (4.2,0) circle (2.2pt) node[right] {{\small$\Phi_4$}};
\coordinate (Phi5) at ($ (2,-2) + (10:1.5) $);
\fill (Phi5) circle (2.2pt) node[right] {{\small$\Phi_5$}};
\fill (-2,-2) circle (2.2pt) node[right] {{\small$\phi_1$}};
\fill (-4,-1) circle (2.2pt) node[left] {{\small$\phi_2$}};
%
% more defects: 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	 (Phi2) .. controls +(-0.2,1) and +(0.3,-0.5) .. (75:5.2); % X_2
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	 (4.2,0) .. controls +(0,1) and +(0.2,-0.5) .. (Phi3); 	% X_3
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	 (Phi5) .. controls +(0.2,0.5) and +(0,-1) .. (4.2,0); 	% X_4
%
% label arrowheads: 
\fill (0,5.45) circle (0pt) node {{\small$Y_1$}}; %Y_1
%\fill (0,-5.5) circle (0pt) node {{\small$\widetilde\coev_{Y_1}$}};
\fill (-2,3.8) circle (0pt) node {{\small$Y_2$}}; %Y_2
%\fill (-2,0.2) circle (0pt) node {{\small$\coev_{Y_2}$}};
\fill (2,3.8) circle (0pt) node {{\small$Y_3$}}; %Y_3
%\fill (2,0.2) circle (0pt) node {{\small$\coev_{Y_3}$}};
\fill (2,-0.2) circle (0pt) node {{\small$Y_4$}}; %Y_4
%\fill (2,-3.8) circle (0pt) node {{\small$\coev_{Y_4}$}};
%
\fill (-2,-0.2) circle (0pt) node {{\small$X_1$}}; %X_1
%\fill (-2,-3.8) circle (0pt) node {{\small$\widetilde\coev_{X_1}$}};
\fill (0.75,4.1) circle (0pt) node {{\small$X_2$}}; % X_2
\fill (3.7,0.8) circle (0pt) node {{\small$X_3$}}; % X_3
\fill (3.7,-0.8) circle (0pt) node {{\small$X_4$}}; % X_4
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$$
\vspace{0.05cm}
$$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.95,color=blue!50!black, baseline,>=stealth]
%
% big circle
\nicecolourscheme[
	decoration={markings, mark=at position 0.25 with {\arrow{>}}, mark=at position 0.75 with {\arrow{>}}}, postaction={decorate}
	] 
	(0,0) circle (5.2);
\draw (0,0) circle (5.2);
%
% draw 4 circles inside big one: 
\nicepalecolourscheme (-2,-2) circle (1.5);
\shadedraw[top color=white, bottom color=white, draw=white] (-2,2) circle (1.5);
\shadedraw[top color=white, bottom color=white, draw=white] (2,2) circle (1.5);
\shadedraw[top color=white, bottom color=white, draw=white] (2,-2) circle (1.5);
%
\draw[
	decoration={markings, mark=at position 0.25 with {\arrow{>}}, mark=at position 0.75 with {\arrow{>}}}, postaction={decorate}
	] 
	(-2,-2) circle (1.5);
\draw[
	decoration={markings, mark=at position 0.25 with {\arrow{<}}, mark=at position 0.75 with {\arrow{<}}}, postaction={decorate}
	]
	(2,-2) circle (1.5);
\draw[
	decoration={markings, mark=at position 0.25 with {\arrow{<}}, mark=at position 0.75 with {\arrow{<}}}, postaction={decorate}
	]
	 (-2,2) circle (1.5);
\draw[
	decoration={markings, mark=at position 0.25 with {\arrow{<}}, mark=at position 0.75 with {\arrow{<}}}, postaction={decorate}
	]
	 (2,2) circle (1.5);
%
% potentials: 
\fill (0.5,-4.5) circle (0pt) node[white] {{\small$W$}};
\fill (-1.3,-2.8) circle (0pt) node[white] {{\small$V$}};
%
% field insertions: 
\fill (225:5.2) circle (2.2pt) node[left] {{\small$\Psi_1$}};
\coordinate (Psi2) at ($ (-2,2) + (45:1.5) $);
\fill (Psi2) circle (2.2pt) node[right] {{\small$\Psi_2$}};
\fill (35:5.2) circle (2.2pt) node[right] {{\small$\Psi_3$}};
\fill (75:5.2) circle (2.2pt) node[above] {{\small$\Phi_1$}};
\coordinate (Phi2) at ($ (2,2) + (130:1.5) $);
\fill (Phi2) circle (2.2pt) node[left] {{\small$\Phi_2$}};
\coordinate (Phi3) at ($ (2,2) + (-10:1.5) $);
\fill (Phi3) circle (2.2pt) node[right] {{\small$\Phi_3$}};
\fill (4.2,0) circle (2.2pt) node[right] {{\small$\Phi_4$}};
\coordinate (Phi5) at ($ (2,-2) + (10:1.5) $);
\fill (Phi5) circle (2.2pt) node[right] {{\small$\Phi_5$}};
\fill (-2,-2) circle (2.2pt) node[right] {{\small$\phi_1$}};
\fill (-4,-1) circle (2.2pt) node[left] {{\small$\phi_2$}};
%
% more defects: 
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	 (Phi2) .. controls +(-0.2,1) and +(0.3,-0.5) .. (75:5.2); % X_2
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	 (4.2,0) .. controls +(0,1) and +(0.2,-0.5) .. (Phi3); 	% X_3
\draw[
	decoration={markings, mark=at position 0.5 with {\arrow{>}}}, postaction={decorate}
	]
	 (Phi5) .. controls +(0.2,0.5) and +(0,-1) .. (4.2,0); 	% X_4
%
% wiggly lines:
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-2,0.5) .. controls +(-3.5,0) and +(-4,-0.5) .. (0,5.2); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (-2,-3.5) .. controls +(-2.5,0) and +(-2,-1) .. (-2,-0.5); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2,-3.5) .. controls +(-3,0) and +(0,-1) .. (0,3); 
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (2,0.5) .. controls +(-1.7,0) and +(0,-1) .. (0,3); 
%
% label arrowheads: 
\fill (0,5.4) circle (0pt) node {{\small$\eval_{Y_1}$}}; %Y_1
\fill (0,-5.5) circle (0pt) node {{\small$\widetilde\coev_{Y_1}$}};
\fill (-2,3.8) circle (0pt) node {{\small$\widetilde\eval_{Y_2}$}}; %Y_2
\fill (-2,0.2) circle (0pt) node {{\small$\coev_{Y_2}$}};
\fill (2,3.8) circle (0pt) node {{\small$\widetilde\eval_{Y_3}$}}; %Y_3
\fill (2,0.2) circle (0pt) node {{\small$\coev_{Y_3}$}};
\fill (2,-0.2) circle (0pt) node {{\small$\widetilde\eval_{Y_4}$}}; %Y_4
\fill (2,-3.8) circle (0pt) node {{\small$\coev_{Y_4}$}};
%
\fill (-2,-0.25) circle (0pt) node {{\small$\eval_{X_1}$}}; %X_1
\fill (-2,-3.8) circle (0pt) node {{\small$\widetilde\coev_{X_1}$}};
\fill (0.75,4.1) circle (0pt) node {{\small$X_2$}}; % X_2
\fill (3.7,0.8) circle (0pt) node {{\small$X_3$}}; % X_3
\fill (3.7,-0.8) circle (0pt) node {{\small$X_4$}}; % X_4
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
$$
\caption{A genus-3 worldsheet and the 2-morphism in $\LG$ computing its correlator} 
\label{fig:worldsheet} 
\end{figure}


\subsection{Cardy condition}

The diagrammatic language for adjunctions in $\LG$ enables us to prove deep results about matrix factorisations in a way that directly follows the physical intuition. Moreover, since the diagrammatics work over an arbitrary noetherian $\mathbb{Q}$-algebra $k$, any statement about matrix factorisations that can be proven using diagrams automatically extends from the absolute case $k = \mathbb{C}$ to families (viewing e.g. $k = \nC[t_1,\ldots,t_d]$ as the base space of a deformation).

Even very simple diagrams can encode nontrivial theorems. For example in this section we give a novel proof of the Cardy condition by thinking about the possible ways of computing the value of a decorated annulus. For Landau-Ginzburg models the Cardy condition was proven recently for $k$ a field, by different methods, in~\cite{pv1002.2116} and there were subsequent proofs in \cite{dm1102.2957,buchweitzstratten}. 

We fix a potential $W\in k[x] = k[x_1,\ldots,x_n]$, matrix factorisations $X,Y \in \hmf(k[x], W)$, and two morphisms $\varphi: X\lra X$, $\psi: Y\lra Y$. Then the $2$-morphism
\be\label{annulus}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\nicereallynocolourscheme (0,0) circle (1);
\fill (1.5,0) circle (0pt) node[white] {{\small$W$}};
\draw (0,0) circle (2);
\draw[->, very thick] (-0.100,2) -- (-0.101,2) node[above] {}; %{{\small$\eval_Y$}}; 
%\draw[->, very thick] (0.100,-2) -- (0.101,-2) node[below] {}; % {{\small$\widetilde\coev_Y$}}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$\psi$}};
%
\draw (0,0) circle (1);
\draw[->, very thick] (0.100,1) -- (0.101,1) node[above] {}; % {{\small$\widetilde\eval_X$}}; 
%\draw[->, very thick] (-0.100,-1) -- (-0.101,-1) node[below] {}; % {{\small$\coev_X$}}; 
\fill (135:1) circle (2.5pt) node[left] {{\small$\varphi$}};
\fill (180:0.9) circle (0pt) node[left] {{\small$X$}};
\fill (0:2.7) circle (0pt) node[left] {{\small$Y$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\equiv \; 
%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\nicereallynocolourscheme (0,0) circle (1);
\fill (1.5,0) circle (0pt) node[white] {{\small$W$}};
\draw (0,0) circle (2);
\draw[->, very thick] (-0.100,2) -- (-0.101,2) node[above] {{\small$\eval_Y$}}; 
\draw[->, very thick] (0.100,-2) -- (0.101,-2) node[below] {{\small$\widetilde\coev_Y$}}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$\psi$}};
%
\draw (0,0) circle (1);
\draw[->, very thick] (0.100,1) -- (0.101,1) node[above] {{\small$\widetilde\eval_X$}}; 
\draw[->, very thick] (-0.100,-1) -- (-0.101,-1) node[below] {{\small$\coev_X$}}; 
\fill (135:1) circle (2.5pt) node[left] {{\small$\varphi$}};
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (270:1) .. controls +(-2,0) and +(-2,-0.2) .. (90:2); %decorate, decoration={zigzag}
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%% 
\ee
is a map $k\lra k$, i.e. an element of $k$, that we call~$C$. We can think of~$C$ as the value of the annulus correlator with boundary conditions $X,Y$ and boundary fields $\varphi,\psi$. 

%To put ourselves in a position to better understand and manipulate~\eqref{annulus} let us spell out its constituents. From the general expressions in Section~\ref{sec:derivcoeval} for evaluation and coevaluation maps we find
%\begin{align}
%& \widetilde\eval_X (e_i \otimes e_j^*) = (-1)^{|e_j|} \delta_{ij} + \mathcal O(\theta) \, , \qquad 
%\eval_Y (f_i^* \otimes f_j) = (-1)^{n} \Res_{k[x]/k} \left[ \frac{ (\Lambda_Y)_{ij} \,\underline{\operatorname{d}\! x}}{\partial_1 W, \ldots, \partial_n W} \right] , \nonumber \\
%& \coev_X (1) = \sum_j (-1)^{{n\choose 2}} \bar\Lambda_X e_j \otimes e_j^* \, , \qquad 
%\widetilde\coev_Y (1) = \sum_j (-1)^{|f_j|} f_j^* \otimes f_j \label{evcoeveasy}
%\end{align}
%where $\bar\Lambda_X = \partial_{[1]} d_X\ldots \partial_{[n]} d_X$ and $\Lambda_Y = \partial_1 d_Y\ldots \partial_n d_Y$, and $\{ e_i \}_i$ and $\{ f_j \}_j$ are homogeneous bases of~$X$ and~$Y$, respectively. 

There are two natural ways to compute the value of~\eqref{annulus}. One possibility is to first collapse the $X$-loop to obtain a ``$W$-bubble'', and then to collapse the boundary loop of this bubble to arrive at a scalar. The main result on defect actions (Proposition \ref{prop:defectaction}) shows that the first step produces the 2-morphism $(-1)^{n+1\choose 2} \str(\varphi \Lambda_X)\in\End(\Delta_W)$ where $\Lambda_Z = \partial_{x_1}(d_Z) \ldots \partial_{x_n}(d_Z)$ for $Z \in \{X,Y\}$. 

Similarly, the second step of collapsing the~$Y$-loop produces a residue
$$
C 
= 
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\nicereallynocolourscheme (0,0) circle (1);
\fill (1.5,0) circle (0pt) node[white] {{\small$W$}};
\draw (0,0) circle (2);
\draw[->, very thick] (-0.100,2) -- (-0.101,2) node[above] {}; 
\draw[->, very thick] (0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$\psi$}};
%
\draw (0,0) circle (1);
\draw[->, very thick] (0.100,1) -- (0.101,1) node[above] {}; 
\draw[->, very thick] (-0.100,-1) -- (-0.101,-1) node[below] {}; 
\fill (135:1) circle (2.5pt) node[left] {{\small$\varphi$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
= 
(-1)^{n+1\choose 2} \,  
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\fill (1.5,0) circle (0pt) node[white] {{\small$W$}};
\draw (0,0) circle (2);
\draw[->, very thick] (-0.100,2) -- (-0.101,2) node[above] {}; 
\draw[->, very thick] (0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$\psi$}};
%
\fill (45:0) circle (2.5pt) node[below] {{\small$\str(\varphi\Lambda_X)$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
= 
(-1)^{n+1\choose 2} \,  
\Res_{k[x]/k} \left[ \frac{\str\! \big( \str( \varphi \Lambda_X) \psi \Lambda_Y \big) \underline{\operatorname{d}\! x}}{\partial_1 W, \ldots, \partial_n W} \right] .
$$
Writing $\beta^X(\varphi) = (-1)^{n+1\choose 2} \str(\varphi \Lambda_X)$ and $\beta^Y(\psi) = (-1)^{n+1\choose 2} \str(\psi \Lambda_Y)$ for the boundary-bulk maps we thus find from the above that
\be\label{C1}
C = (-1)^{n+1\choose 2} \,  
\Res_{k[x]/k} \left[ \frac{\beta^X(\varphi) \, \beta^Y (\psi) \, \underline{\operatorname{d}\! x}}{\partial_1 W, \ldots, \partial_n W} \right] .
\ee
A second way of computing~$C$ is to inflate the $X$-loop in \eqref{annulus} and fuse it with the outer $Y$-loop, creating a single loop labelled by $X^\vee \otimes Y \in \End_{\LG}( (k,0) )$. Rigorously, this process is described by the series of equalities
\[
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\nicereallynocolourscheme (0,0) circle (1);
\fill (1.5,0) circle (0pt) node[white] {{\small$W$}};
\draw (0,0) circle (2);
\draw[->, very thick] (-0.100,2) -- (-0.101,2) node[above] {}; %{{\small$\eval_Y$}}; 
%\draw[->, very thick] (0.100,-2) -- (0.101,-2) node[below] {}; % {{\small$\widetilde\coev_Y$}}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$\psi$}};
%
\draw (0,0) circle (1);
\draw[->, very thick] (0.100,1) -- (0.101,1) node[above] {}; % {{\small$\widetilde\eval_X$}}; 
%\draw[->, very thick] (-0.100,-1) -- (-0.101,-1) node[below] {}; % {{\small$\coev_X$}}; 
\fill (135:1) circle (2.5pt) node[left] {{\small$\varphi$}};
\fill (180:0.9) circle (0pt) node[right] {{\small$X$}};
\fill (0:2.7) circle (0pt) node[left] {{\small$Y$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.8,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (2);
\nicereallynocolourscheme (0,0) circle (1);
\fill (1.5,0) circle (0pt) node[white] {{\small$W$}};
\draw (0,0) circle (2);
\draw[->, very thick] (-0.100,2) -- (-0.101,2) node[above] {}; %{{\small$\eval_Y$}}; 
%\draw[->, very thick] (0.100,-2) -- (0.101,-2) node[below] {}; % {{\small$\widetilde\coev_Y$}}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$\psi$}};
%
\draw (0,0) circle (1);
\draw[->, very thick] (-0.100,1) -- (-0.101,1) node[above] {}; % {{\small$\widetilde\eval_X$}}; 
%\draw[->, very thick] (-0.100,-1) -- (-0.101,-1) node[below] {}; % {{\small$\coev_X$}}; 
\fill (135:1) circle (2.5pt) node[left] {{\small$\varphi^{\vee}$}};
\fill (180:0.9) circle (0pt) node[right] {{\small$X^{\vee}$}};
\fill (0:2.7) circle (0pt) node[left] {{\small$Y$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\draw[ultra thick] (0,0) circle (2);
\draw[->, ultra thick] (-0.100,2) -- (-0.101,2) node[above] {}; 
\draw[->, ultra thick] (0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$1\otimes\psi$}};
\fill (135:2) circle (2.5pt) node[left] {{\small$\varphi^{\vee}\otimes 1$}};
\fill (0:2.7) circle (0pt) node[right] {{\small$X^{\vee} \otimes Y$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
\]
where in the first step we use Proposition \ref{prop:defectactionproperties}(ii) to reorient the inner loop, and in the second step we use (iii) to fuse the two loops (note that the proof of (iii) relies on Proposition~\ref{prop:monoidalproperty}). The complexes $X^{\vee} \otimes Y$ and $\Hom(X,Y)$ are isomorphic, so
\be\label{eq:finaldiagramcardycond}
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\draw[ultra thick] (0,0) circle (2);
\draw[->, ultra thick] (-0.100,2) -- (-0.101,2) node[above] {}; 
\draw[->, ultra thick] (0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (45:2) circle (2.5pt) node[right] {{\small$1\otimes\psi$}};
\fill (135:2) circle (2.5pt) node[left] {{\small$\varphi^{\vee}\otimes 1$}};
\fill (0:2.7) circle (0pt) node[right] {{\small$X^{\vee} \otimes Y$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
=
%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.6,color=blue!50!black, baseline,>=stealth]
\draw[ultra thick] (0,0) circle (2);
\draw[->, ultra thick] (-0.100,2) -- (-0.101,2) node[above] {}; 
\draw[->, ultra thick] (0.100,-2) -- (0.101,-2) node[below] {}; 
\fill (45:2) circle (2.5pt) node[right] {{\small${}_\psi m_{\varphi}$}};
\fill (0:2.7) circle (0pt) node[right] {{\small$\Hom(X,Y)$}};
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%
= \str({}_\psi m_{\varphi})
\ee
where $ {}_\psi m_\varphi \in \End_k(\Hom(X,Y))$ is the operator that sends~$\alpha$ to $ \psi\circ\alpha\circ\varphi$. 

The value of an oriented loop labelled by a finite rank $\mathbb{Z}_2$-graded $k$-complex $F$ with the insertion of a morphism of complexes $\phi: F \lto F$ is easily checked to be the supertrace of $\phi$. If $k$ were a field the infinite rank $k$-complex $\Hom(X,Y)$ would be isomorphic, in $\HMF(k,0)$, to the finite dimensional $\mathbb{Z}_2$-graded vector space $H^*\Hom(X,Y)$ with zero differential, and the value of \eqref{eq:finaldiagramcardycond} would be the supertrace of the action of ${}_\psi m_{\varphi}$ on this cohomology.

In general $\Hom(X,Y)$ is not isomorphic to its cohomology, but it is at least a summand in the homotopy category of a finite rank $\mathbb{Z}_2$-graded free $k$-module and therefore any operator on $\Hom(X,Y)$ has a well-defined supertrace. Indeed, once we choose such a split embedding of $\Hom(X,Y)$ in something finite rank, the supertrace can be computed by writing out the diagram \eqref{eq:finaldiagramcardycond} as a series of morphisms, using the evaluation and coevaluation maps for infinite rank objects produced in Appendix \ref{app:adjoints} from a choice of embedding.

Comparing~\eqref{C1} and~\eqref{eq:finaldiagramcardycond} we thus observe: 

\begin{theorem}\label{thm:CardyCondition}
The Cardy condition holds in $\LG$: given 1-morphisms $X,Y \in \hmf( k[x_1,\ldots,x_n], W)$ and 2-morphisms $\varphi: X\lra X$, $\psi: Y\lra Y$ we have 
$$
\str ( {}_\psi m_\varphi ) 
= 
(-1)^{n+1\choose 2} \,  
\Res_{k[x]/k} \left[ \frac{\beta^X(\varphi) \, \beta^Y (\psi) \, \underline{\operatorname{d}\! x}}{\partial_1 W,
 \ldots, \partial_n W} \right] 
$$
with ${}_\psi m_\varphi(\alpha) = \psi\circ\alpha\circ\varphi$ for $\alpha\in \Hom(X,Y)$. 
\end{theorem}

\begin{remark}
The Cardy condition also holds if one or both of the maps $\varphi, \psi$ are odd (which we present as morphisms $X\lra X[1]$ in $\LG$). The proof of this fact proceeds similarly to the above. 
\end{remark}


\section{Shadows}\label{sec:shadows}

The adjunctions in $\LG$ afford us the construction of a bicategorical trace in terms of shadow functors~\cite{p0807.1471}. We will also see that shadows allow to recover and generalise the boundary-bulk and bulk-boundary maps of the two-dimensional topological field theories based on Landau-Ginzburg models. 

\begin{definition}
A bicategory~$\mathcal B$ \textsl{has shadows} if there is a category~$\mathcal C$ together with functors
$$
\langle\!\langle - \rangle\!\rangle : \mathcal B(A,A) \lra \mathcal C 
$$
for every object $A\in \mathcal B$ such that there are natural isomorphisms $\theta : \langle\!\langle X \otimes Y \rangle\!\rangle \lra \langle\!\langle Y \otimes X \rangle\!\rangle$ for every pair of composable 1-morphisms $X,Y$, and the diagrams
$$
\xymatrix{%
\langle\!\langle (X \otimes Y) \otimes Z \rangle\!\rangle \ar[r]^-{\theta} \ar[d]_-{\langle\!\langle \alpha \rangle\!\rangle} & 
\langle\!\langle Z \otimes (X \otimes Y) \rangle\!\rangle \ar[r]^-{\langle\!\langle \alpha^{-1} \rangle\!\rangle} & 
\langle\!\langle (Z \otimes X) \otimes Y \rangle\!\rangle \\
\langle\!\langle X \otimes (Y \otimes Z) \rangle\!\rangle \ar[r]^-{\theta} & 
\langle\!\langle (Y \otimes Z) \otimes X \rangle\!\rangle \ar[r]^-{\langle\!\langle \alpha \rangle\!\rangle} & 
\langle\!\langle Y \otimes (Z \otimes X) \rangle\!\rangle \ar[u]_-{\theta}
}%
$$
and
$$
\xymatrix{%
\langle\!\langle X \otimes 1_A \rangle\!\rangle \ar[r]^-{\theta} \ar[dr]_-{\langle\!\langle \rho \rangle\!\rangle} & 
\langle\!\langle 1_A \otimes X \rangle\!\rangle \ar[r]^-{\theta} \ar[d]^-{\langle\!\langle \lambda \rangle\!\rangle} & 
\langle\!\langle X \otimes 1_A \rangle\!\rangle \ar[dl]^-{\langle\!\langle \rho \rangle\!\rangle}  \\
 & 
\langle\!\langle X \rangle\!\rangle & 
}%
$$
commute whenever they make sense. 
\end{definition}

\begin{proposition}
The bicategory $\LG$ has shadows given by 
\begin{align*}
\langle\!\langle - \rangle\!\rangle : \LG \big( (R,W), (R,W) \big) & \lra \hmf(k,0) \, , \\
Z & \lmt Z\otimes_{\Re} R
\end{align*}
with the isomorphism $\theta: \langle\!\langle X \otimes Y \rangle\!\rangle \lra \langle\!\langle Y\otimes X  \rangle\!\rangle$ induced by the graded swap map $X \otimes Y \lra Y \otimes X$. 
\end{proposition}

The proof is a straightforward check of the axioms, made especially easy by the fact that $\langle\!\langle - \rangle\!\rangle$ is simply defined as tensoring with the actual diagonal~$R$. Note however that this is homotopy equivalent to tensoring with the unit matrix factorisation $\Delta_W$. 

Since $\LG$ is a bicategory with adjoints and shadows it is automatically equipped with a 2-categorical trace operation as introduced and discussed at length in~\cite{p0807.1471, ps0910.1306}. We only quote the definition: 

\begin{definition}
Let~$\mathcal B$ be a bicategory with shadows and 1-morphism~$Y$ with left adjoint~${}^\dual Y$. Then the \textsl{trace} of a 2-morphism $\psi: X\otimes Y \lra Y \otimes Z$ is the map 
$$
\xymatrix{%
\langle\!\langle X \rangle\!\rangle \ar[rr]^-{\langle\!\langle1\otimes \coev_Y\rangle\!\rangle} && 
\langle\!\langle X \otimes Y \otimes {}^\dual Y \rangle\!\rangle \ar[r]^-{\langle\!\langle\psi \otimes 1\rangle\!\rangle} & 
\langle\!\langle Y \otimes Z \otimes {}^\dual Y \rangle\!\rangle \ar[r]^-{\theta} &
\langle\!\langle {}^\dual Y \otimes Y \otimes Z \rangle\!\rangle \ar[rr]^-{\langle\!\langle\eval_Y \otimes 1\rangle\!\rangle} && 
\langle\!\langle Z \rangle\!\rangle 
}%
. 
$$
\end{definition}

Next we wish to point out a connection between shadows and the structure of two-dimensional open/closed topological field theory (TFT) for Landau-Ginzburg models. For this we merely observe that the bulk-boundary and boundary-bulk maps~\eqref{bubobobu} can also be recovered from the adjunction and shadow structure of $\LG$ as follows. On the one hand we have 
$$
\langle\!\langle \Delta_W \rangle\!\rangle = R/(\partial W)[n]
$$
since $\langle\!\langle \Delta_W \rangle\!\rangle = \Delta_W \otimes_{\Re} R = (\bigwedge (\bigoplus_{i=1}^n R \theta_i), \sum_{i=1}^n \partial_{x_i}W \theta_i)$ which is homotopy equivalent (and therefore equal in $\hmf(k,0)$) to $R/(\partial W)[n]$. On the other hand $\langle\!\langle X^\dual \otimes X \rangle\!\rangle = X^\vee \otimes_k X \otimes_{\Re} R = \End_R(X)$ for $X\in \hmf(R,W)$. Thus from the explicit expressions in Section~\ref{sec:derivcoeval} we find that $\beta_X = \langle\!\langle \widetilde\coev_X \rangle\!\rangle$ and $\beta^X = \langle\!\langle \eval_X \rangle\!\rangle$. 

Motivated by the above this construction can be extended to any 1-morphism in $\LG$: for $X \in \hmf(k[x_1,\ldots,x_n,z_1,\ldots,z_m], V-W)$ we define the \textsl{generalised bulk-boundary} and \textsl{boundary-bulk maps} to be
$$
\beta_X= \langle\!\langle \widetilde\coev_X \rangle\!\rangle : \langle\!\langle \Delta_{W} \rangle\!\rangle \lra \langle\!\langle X^\dual \otimes X \rangle\!\rangle
\, , \qquad 
\beta^X= \langle\!\langle \eval_X \rangle\!\rangle : \langle\!\langle {}^\dual X \otimes X \rangle\!\rangle \lra \langle\!\langle \Delta_{W} \rangle\!\rangle \, , 
$$
respectively. Substituting the expressions for the adjiunction maps in Section~\ref{sec:derivcoeval} we find that the form of $\beta_X$ stays the same while for $m\neq 0$ the generalised boundary-bulk map $\beta^X$  involves a residue and additional derivatives $\partial_{z_i} d_X$: 
\begin{align*}
\beta_X : k[x]/(\partial V)[n] & \lra \End_{k[x,z]}(X)[m] \, , \\
\phi & \lmt \phi \cdot 1_{X}[m] \, , \\
\beta^X : \End_{k[x,z]}(X)[m] & \lra k[x]/(\partial V)[n] \, , \\
\psi & \lmt (-1)^{{m+1\choose 2}} \Res_{k[x,z]/k[x]} \left[ \frac{\str\left( \psi\,  \partial_{x_1} d_X \ldots \partial_{x_n} d_X \partial_{z_1} d_X \ldots \partial_{z_m} d_X \right) \underline{\operatorname{d}\!x}}{\partial_{x_1} W, \ldots, \partial_{x_n} W} \right] . 
\end{align*}


\section{Duality via adjoint operators}\label{section:dualityadjointop}

Let $k$ be a noetherian $\nQ$-algebra and $R = k[x_1,\ldots,x_n]$. If $k$ is a field then we know from \cite{m0912.1629, dyckmurf} that for any polynomial $W$ with an isolated singularity, the Kapustin-Li formula gives a nondegenerate pairing on the mapping spaces of the triangulated category of matrix factorisations of $W$ over $R$. In this section we prove the analogue of this result for an arbitrary base $k$. In particular, the mapping spaces of the triangulated category will not be flat over $k$, so we work instead with dg-categories.

Given $W \in R$ and two finite-rank matrix factorisations $X,Y$ of $W$ let $\Hom(X,Y) = \Hom_R(X,Y)$ denote the $\nZ _2$-graded Hom-complex. We define a natural $k$-bilinear pairing
\[
\langle -, - \rangle_{XY}: \Hom(X,Y) \otimes_k \Hom(Y,X) \lto k[n]
\]
by the following formula, where $\lambda_i = \partial_{x_i}d_Y, \omega = \ud x_1 \ldots \ud x_n$ and $f_i = \partial_{x_i} W$: 
\begin{equation}\label{eq:generalklpairing}
\langle \varphi, \psi \rangle_{XY} = \frac{1}{n!} \sum_{\sigma \in S_n} (-1)^{|\sigma|} \Ress{R/k}\Bigg[ \frac{ \str( \varphi \circ \psi \circ \lambda_{\sigma(1)} \circ \ldots \circ \lambda_{\sigma(n)} )\, \omega }{ f_1, \ldots, f_n } \Bigg]\,.
\end{equation}
In order to be able to define this residue we require that the partial derivatives $f_i$ form a regular sequence $f = \{f_1,\ldots,f_n\}$ in $R$ and that $\bar{R} = R/(f_1,\ldots,f_n)R$ is a finitely generated free $k$-module.
One can show that, up to homotopy, the pairing is unaffected if we replace $\lambda_i$ by any null-homotopy for the action of $\partial_{x_i} W$ on $Y$, and that we need not symmetrise over permutations; see Appendix \ref{app:reshom}.

Such a pairing is \textsl{homotopically nondegenerate} if the adjoint morphism of $\nZ _2$-graded complexes
\begin{align*}
\Hom(X,Y) & \lto \Hom_k( \Hom(Y,X), k )[n]\,,\\
\varphi & \lmt \langle \varphi, - \rangle_{XY}
\end{align*}
is a homotopy equivalence over $k$. The main theorem here is that in complete generality: 

\begin{theorem}\label{theorem:generalkl} The pairing $\langle -, - \rangle_{XY}$ is homotopically nondegenerate.
\end{theorem}

%This nondegeneracy is used in Section~\ref{sec:Zorro} to prove that specified evaluation and coevaluation morphisms give rise to adjoint $1$-morphisms in the bicategory of Landau-Ginzburg models over $k$.

There is also version when $X,Y$ are graded matrix factorisations; see Section \ref{section:gradedduality}. The proof of the theorem takes up the rest of this section. We argue that $\Hom(X,Y)[n]$ and $\Hom_k(\Hom(Y,X),k)$ are homotopy equivalent by showing that they respectively split idempotents on
\be\label{eq:hombarappendix}
\Hom(\bar{X},\bar{Y}) = \Hom(X,Y) \otimes_R \bar{R}
\ee
and
\be
\Hom_k( \Hom(\bar{Y}, \bar{X}), k) = \Hom_k( \Hom(Y,X) \otimes_R \bar{R}, k )
\ee
in the homotopy category of $\nZ _2$-graded $k$-complexes. There is an isomorphism
\begin{equation}\label{eq:frobnondeg}
\Hom(\bar{X}, \bar{Y}) \cong \Hom_k( \Hom(\bar{Y}, \bar{X}), k)
\end{equation}
of complexes which identifies these idempotents, and from this the theorem will follow. The existence of the isomorphism (\ref{eq:frobnondeg}) is an easy consequence of the fact that $\bar{R}$ is Frobenius over $k$. The hard work lies in showing that this isomorphism identifies the two idempotents, and for this we need to carefully study adjointness between operators on dg-categories. Thus the first part of the proof, in Section \ref{section:adjointopdg}, consists in formalising this kind of adjointness.

\subsection{Adjoint operators on dg-categories}\label{section:adjointopdg}
% TODO: Point out that these Atiyah classes are from connections over k[f], not k like in the associative case.

In this section $\otimes$ denotes $\otimes_k$. Let $\cat{C}$ be a $\nZ _2$-graded dg-category over $k$ equipped with the data of a $k$-linear morphism of complexes 
\[
c_{XY}: \cat{C}(X,Y) \otimes \cat{C}(Y,X) \lto k
\]
for each pair of objects $X,Y$ in $\cat{C}$. 
When it is convenient we write $\langle \alpha, \beta \rangle$ for $c_{XY}(\alpha \otimes \beta)$. Throughout the differentials on the $\cat{C}(X,Y)$ and their tensor products are denoted $D$.

\begin{definition}\label{defn:nondegpair} We say that the family of pairings $\{ c_{XY} \}_{X,Y \in \cat{C}}$ is
\begin{itemize}
\item[(i)] \textsl{cyclic} if for all $X,Y$ the diagram
\[
\xymatrix{
\cat{C}(X,Y) \otimes \cat{C}(Y,X) \ar[dr]_{c_{XY}}\ar[rr]^\tau & & \cat{C}(Y,X) \otimes \cat{C}(X,Y) \ar[dl]^{c_{YX}}\\
& k
}
\]
commutes, where $\tau$ is the graded twist $\tau( \varphi \otimes \psi) = (-1)^{|\varphi||\psi|} \psi \otimes \varphi$; 
\item[(ii)] \textsl{nondegenerate} if for all $X,Y$ the morphism
\begin{align*}
\zeta_{XY}: \cat{C}(X,Y) & \lto \Hom_k( \cat{C}(Y,X), k)\,,\\
\varphi & \lmt c_{XY}( \varphi \otimes - )
\end{align*}
is an isomorphism of complexes.
\end{itemize}
\end{definition}

From now on we assume $\cat{C}$ is equipped with a cyclic nondegenerate pairing. In this section an \textsl{operator} is a closed homogeneous $k$-linear operator on some mapping complex $\cat{C}(X,Y)$ in $\cat{C}$, that is, a closed homogeneous element of the complex $\Hom_k( \cat{C}(X,Y), \cat{C}(X,Y) )$. We are interested in linear operators on the $\cat{C}(X,Y)$ and adjunctions between them, with respect to the pairing.

Recall that if $\Psi$ is homogeneous then $1 \otimes \Psi$ acts on tensors with Koszul signs.

\begin{definition}\label{defn:adjointop} An operator $\Phi$ on $\cat{C}(X,Y)$ is \textsl{adjoint} to an operator $\Psi$ on $\cat{C}(Y,X)$ if both~$\Phi$ and~$\Psi$ are homogeneous of the same degree and the diagram
\[
\xymatrix@C+1pc@R+0.5pc{
\cat{C}(X,Y) \otimes \cat{C}(Y,X) \ar[d]_{\Phi \otimes 1} \ar[r]^{1 \otimes \Psi} & \cat{C}(X,Y) \otimes \cat{C}(Y,X) \ar[d]^{c_{XY}}\\
\cat{C}(X,Y) \otimes \cat{C}(Y,X) \ar[r]_-{c_{XY}} & k
}
\]
commutes up to homotopy. Equivalently, there is a $k$-linear degree $|\Phi|+1$ morphism
\[
\mu: \cat{C}(X,Y) \otimes \cat{C}(Y,X) \lto k
\]
with the property that $[D, \mu] = c_{XY} \circ (1 \otimes \Psi) - c_{XY} \circ ( \Phi \otimes 1)$. Evaluated on homogeneous morphisms $\alpha, \beta$ this identity reads
\begin{equation}\label{eq:adjointopeq}
(-1)^{|\Phi|} \mu D(\alpha \otimes \beta) = (-1)^{|\alpha||\Psi|}\langle \alpha, \Psi(\beta) \rangle - \langle \Phi(\alpha) , \beta \rangle \, .
\end{equation}
\end{definition}

We will show in a moment that this type of adjointness is symmetric in $\Phi, \Psi$ so there is no need to distinguish between left and right adjoints. If $\Psi$ is a homogeneous operator on $\cat{C}(Y,X)$ then $\Psi^*$ is the operator on $\Hom_k(\cat{C}(Y,X),k)$ defined by $\Psi^*(f) = (-1)^{|f||\Psi|} f \circ \Psi$. 

\begin{lemma} An operator $\Phi$ is adjoint to $\Psi$ if and only if the diagram
\begin{equation}\label{eq:lemadjointdia}
\xymatrix@C+2pc{
\cat{C}(X,Y) \ar[d]_\Phi \ar[r]^-{\zeta} & \Hom_k( \cat{C}(Y,X), k ) \ar[d]^{\Psi^*}\\
\cat{C}(X,Y) \ar[r]_-{\zeta} & \Hom_k( \cat{C}(Y,X), k)
}
\end{equation}
commutes up to homotopy.
\end{lemma}

\begin{lemma} An operator $\Phi$ is adjoint to $\Psi$ if and only if $\Psi$ is adjoint to $\Phi$.
\end{lemma}
\begin{proof}
By naturality of the graded twist $\tau$ and the cyclicity axiom for $c_{XY}$.
\end{proof}

\begin{lemma} Any operator $\Phi$ admits an adjoint, which is unique up to homotopy. 
\end{lemma}
\begin{proof}
This follows from commutativity of (\ref{eq:lemadjointdia}).
\end{proof}

\begin{definition} Given an operator $\Phi$ we denote by $\Phi^{\dagger}$ the adjoint of $\Phi$.
\end{definition}

Since the adjoint is only well-defined up to homotopy it is implicit that in any identities involving the dagger notation we are working with homogeneous operators up to homotopy (to be clear, odd operators are homotopic if they differ by $[D,\alpha]$ for an even operator $\alpha$). 

The following basic properties of adjoints are easily checked.

\begin{lemma} 
\begin{enumerate}
\item Let $\Phi_1, \Phi_2$ be operators on $\cat{C}(X,Y)$ and $\cat{C}(Y,Z)$ respectively. Then
\[
(\Phi_2 \circ \Phi_1)^{\dagger} = (-1)^{|\Phi_1||\Phi_2|} \Phi_1^{\dagger} \circ \Phi_2^{\dagger}\,.
\]
\item If $\Phi_1, \Phi_2$ are operators on $\cat{C}(X,Y)$ of the same degree, then $(\Phi_1 + \Phi_2)^{\dagger} = \Phi_1^{\dagger} + \Phi_2^{\dagger}$.
\end{enumerate}
\end{lemma}

\subsection{Skew-symmetry of the Atiyah class}

Now we apply this general theory to the dg-category of matrix factorisations. In order to introduce the Atiyah classes, which are interesting examples of adjoint operators on this dg-category, we need $R$ to be equipped with a connection. For $R = k[x_1,\ldots,x_n]$ it may be necessary to pass to the $(f_1,\ldots,f_n)$-adic completion to ensure the existence of a connection, so for the next two sections we work instead with an arbitrary noetherian $k$-algebra $R$, $W \in R$, satisfying:
\begin{itemize}
\item[(H1)] $f = \{ f_1,\ldots,f_n \}$ is any regular sequence in $R$ with the property that multiplication by $f_i$ is a null-homotopic endomorphism of $X,Y \in \hmf(R,W)$ for $1 \le i \le n$, and $\lambda_i \in \Hom(Y,Y)$ is a null-homotopy, that is, an odd operator with $[d_Y, \lambda_i] = f_i \cdot 1_Y$.
\item[(H2)] $\bar{R} = R/(f_1,\ldots,f_n)R$ is a finitely generated free $k$-module.
\item[(H3)] $R$ admits a flat $k$-linear connection
\[
\nabla: R \lto R \otimes_{k[f]} \Omega^1_{k[f]/k}
\]
as a $k[f]$-module, which is standard in the sense of \cite[Definition 8.6]{dm1102.2957}.
\item[(H4)] There is an $n$-form $\omega \in \Omega^n_{R/k}$ such that the $R$-linear map
\begin{align*}
\bar{R} & \lto \Hom_k( \bar{R}, k)\, , \\
r & \lmt \Ress{R/k}\Bigg[ \frac{r \cdot (-) \cdot \omega}{ f_1, \ldots, f_n} \Bigg]
\end{align*}
is an isomorphism.
\end{itemize}
In this situation the pairing (\ref{eq:generalklpairing}) still makes sense and we prove that it is homotopically nondegenerate in Proposition \ref{prop:almostkltheorem}. The theorem follows by passing from $k[x_1,\ldots,x_n]$ to the completion, which satisfies (H1)--(H4) above.

We let $\cat{C}$ denote the dg-category whose objects are finite-rank matrix factorisations of $W$ and whose mapping complexes are given by the quotients
\[
\cat{C}(X,Y) = \Hom(\bar{X}, \bar{Y}) = \Hom(X,Y) \otimes_R \bar{R}\,.
\]
While the ordinary dg-category of matrix factorisations only admits a pairing which is homotopically nondegenerate, this (linear) quotient $\cat{C}$ admits a cyclic nondegenerate pairing in the stronger sense explained above. To define it, let
\[
\langle - \rangle: R \lto k
\]
be the $k$-linear map
\[
\langle r \rangle = \Ress{R/k}\Bigg[ \frac{r \cdot \omega}{ f_1, \ldots, f_n} \Bigg]\,.
\]
This map annihilates the ideal $(f_1,\ldots,f_n)R$ and therefore factors via a $k$-linear map $\bar{R} \lto k$.

% see dviat
\begin{proposition}\label{prop:barnondeg} The pairing on $\cat{C}$ defined by
\begin{align*}
\langle -, - \rangle_{\cat{C}}: \Hom(\bar{X}, \bar{Y}) \otimes \Hom(\bar{Y}, \bar{X}) \lto k\,, \qquad
\langle \varphi, \psi \rangle_{\cat{C}} = \langle \str( \varphi \circ \psi ) \rangle
\end{align*}
is cyclic and nondegenerate in the sense of Definition \ref{defn:nondegpair}.
\end{proposition}
\begin{proof}
The pairing factors as
\begin{equation}\label{eq:barnondeg}
\xymatrix@C+1pc{
\Hom(\bar{X}, \bar{Y}) \otimes \Hom(\bar{Y}, \bar{X}) \ar[r]^-{-\circ-} & \Hom(\bar{Y}, \bar{Y}) \ar[r]^-{\str} & \bar{R} \ar[r]^-{\langle - \rangle} & k
}
\end{equation}
so it is clear that it is a closed $k$-linear map, and moreover cyclicity follows from the cyclicity of the supertrace. Nondegeneracy follows from hypothesis (H4) and the following calculation, in which the first step is adjoint to the composite of the first two maps in (\ref{eq:barnondeg}) with $\otimes$ replaced by $\otimes_{\bar{R}}$: 
\begin{align*}
\Hom_R(\bar{X}, \bar{Y}) &\cong \Hom_R( \Hom(\bar{Y}, \bar{X}), \bar{R} )\,\\
&\cong \Hom_R( \Hom(\bar{Y}, \bar{X}), \Hom_k( \bar{R}, k) )\\
&\cong \Hom_k( \Hom(\bar{Y}, \bar{X}), k )\,.
\end{align*}
\end{proof}

We have in mind two special classes of operators on the dg-category $\cat{C}$. The first arises because the $f_i$ act as zero on the cohomology of $\cat{C}$ but via nonzero maps on the dg-level. In what follows let $X,Y$ denote finite-rank matrix factorisations of $W$.

\begin{definition} We define the odd operator $\lambda_i^\bullet$ on $\Hom(\bar{X},\bar{Y})$ by
\[
\lambda_i^\bullet(\varphi) = \lambda_i \circ \varphi\,
\]
and the odd operator ${\lambda_i}_\bullet$ on $\Hom(\bar{Y}, \bar{X})$ by
\[
{\lambda_i}_\bullet(\varphi) = (-1)^{|\varphi|} \varphi \circ \lambda_i \,.
\]
\end{definition}

Observe that composition with $\lambda_i$ is not a closed map on $\Hom(X,Y)$ but is closed as an operator on $\Hom(\bar{X}, \bar{Y})$. These operators give the simplest example of an adjoint pair: 

\begin{lemma}\label{lemma:lambdaadjoint} The operator $\lambda_i^\bullet$ is adjoint to ${\lambda_i}_\bullet$.
\end{lemma}
\begin{proof}
The identity (\ref{eq:adjointopeq}) holds with $\mu = 0$, since
\begin{align*}
\langle {\lambda_i}_\bullet(\alpha), \beta \rangle_{\cat{C}} &= \langle \str( {\lambda_i}_\bullet(\alpha) \circ \beta ) \rangle = (-1)^{|\varphi|} \langle \str( \alpha \circ \lambda_i \circ \beta ) \rangle = (-1)^{|\varphi|} \langle \alpha, \lambda_i^\bullet(\beta) \rangle_{\cat{C}}\,.
\end{align*}
\end{proof}

The second class of operators are the components of the Atiyah class. Our reference for Atiyah classes is \cite{buchweitz03}, see also \cite[\S 9]{dm1102.2957}. Recall that by hypothesis (H2) the ring $R$ admits a flat $k$-linear connection $\nabla$ as a $k[f]$-module. The components of $\nabla$ define $k$-linear operators $\partial_{f_i} = (\ud f_i)^* \circ \nabla$ on $R$ with the property that $[\partial_{f_i}, f_j] = \delta_{ij}$.

Any free $R$-module admits a $k$-linear connection over $k[f]$. For convenience choose homogeneous $R$-bases $\{ e_i \}_{i}$ for~$X$ and $\{ e_j \}_{j}$ for~$Y$ respectively. Then the maps $e_{ji} = e_j \circ e_i^*$ form an $R$-basis for $\Hom(X,Y)$ and the induced $k$-linear connection over $k[f]$ is defined by
\begin{align*}
\nabla = \nabla_{XY}: \Hom(X,Y) & \lto \Hom(X,Y) \otimes_{k[f]} \Omega^1_{k[f]/k}\,,\\
r e_{ji} & \lmt e_{ji} \otimes \nabla(r)\,.
\end{align*}
In contrast to Section \ref{section:connections} the connections here do not have sign contributions from the $\nZ _2$-grading, so $\nabla$ satisfies the usual Leibniz rule rather than the graded Leibniz rule, and $\nabla$ is given degree zero for the purpose of computing graded commutators.

The connection has components $\partial_{f_i}$ defined by $\partial_{f_i}( r e_{ji} ) = \partial_{f_i}(r) \cdot e_{ji}$ which are $k$-linear operators on $\Hom(X,Y)$. The \textsl{Atiyah class} of $\Hom(X,Y)$ is the commutator
\[
\At = \At_{XY} = [D, \nabla] = D \circ \nabla - \nabla \circ D: \Hom(X,Y) \lto \Hom(X,Y) \otimes_{k[f]} \Omega^1_{k[f]/k}
\]
where $D$ is the differential on $\Hom(X,Y)$. The Atiyah class is a $k[f]$-linear closed map of degree one whose homotopy class is independent of the choice of connection, and therefore independent of the basis chosen for $X,Y$. It is important to distinguish this kind of Atiyah class from the associative Atiyah classes introduced in Section \ref{section:atiyahclasses} and used in the rest of the paper; the distinction is that here we use ordinary commutative differential forms, whereas associative Atiyah classes are defined using noncommutative forms.

In terms of the components: 

\begin{definition} For $1 \le i \le n$ the components $\At_i = [D, \partial_{f_i}]$ of the Atiyah class define $k$-linear closed operators of degree one on $\Hom(\bar{X}, \bar{Y})$ which are canonically defined up to homotopy.
\end{definition}

Conceptually, duality in the dg-category of matrix factorisations arises from the fact that these operators are skew-symmetric. To prove this we need the following Leibniz rule for Atiyah classes.

\begin{lemma}\label{lemma:leibnizatiyah} For homogeneous $\alpha \in \Hom(Y,Z)$ and $\beta \in \Hom(X,Y)$
\begin{equation}\label{eq:leibnizcompos}
\At_i( \alpha \circ \beta ) = \At_i(\alpha) \circ \beta + (-1)^{|\alpha|} \alpha \circ \At_i(\beta) + [g,D]( \alpha \otimes \beta)
\end{equation}
where $g( \alpha \otimes \beta ) = \partial_i(\alpha) \circ \beta + \alpha \circ \partial_i(\beta) - \partial_i( \alpha \circ \beta )$.
\end{lemma}
\begin{proof}
If $\nabla_{YZ}, \nabla_{XY}$ respectively denote the connections on $\Hom(Y,Z)$ and $\Hom(X,Y)$ then
\[
\nabla_{YZ,XY}(\alpha \otimes \beta) = \nabla_{YZ}(\alpha) \otimes \beta + \alpha \otimes \nabla_{XY}(\beta)
\]
defines a connection on $\Hom(Y,Z) \otimes_{k[f]} \Hom(X,Y)$. With $\At_{YZ,XY} = [D, \nabla_{YZ,XY}]$ it follows from naturality of the Atiyah class that the diagram
\[
\xymatrix{
\Hom(Y,Z) \otimes_{k[f]} \Hom(X,Y) \ar[d]_{\At_{YZ,XY}}\ar[r]^-{\kappa} & \Hom(X,Z) \ar[d]^{\At_{XZ}}\\
\Hom(Y,Z) \otimes_{k[f]} \Hom(X,Y) \otimes_{k[f]} \Omega^1_{k[f]/k} \ar[r]_-{\kappa} & \Hom(X,Z) \otimes_{k[f]} \Omega^1_{k[f]/k}
}
\]
commutes up to homotopy, where $\kappa$ is the composition map. Specifically, if $g = [\kappa, \nabla] = \kappa \circ \nabla_{YZ,XY} - \nabla_{XZ} \circ \kappa$ then a simple calculation using the graded Jacobi identity shows that
\[
\At_{XZ} \circ \kappa - \kappa \circ \At_{YZ,XY} = [g,D]\,.
\]
Applying both sides to $\alpha \otimes \beta$ and projecting to the $\ud f_i$ component yields (\ref{eq:leibnizcompos}).
\end{proof}

\begin{lemma}\label{lemma:stratiyahzero} For any $\alpha \in \Hom(X,X)$ we have $\str( \At_i( \alpha ) ) = 0$ in $R$.
\end{lemma}
\begin{proof}
Consider the diagram
\[
\xymatrix@C+1pc{
\Hom(X,X) \ar[d]_{\At_{XX}} \ar[r]^-{\str} & R \ar[d]^{\At = 0}\\
\Hom(X,X) \otimes_{k[f]} \Omega^1_{k[f]/k} \ar[r]_-{\str} & R \otimes_{k[f]} \Omega^1_{k[f]/k}\,.
}
\]
By the graded Jacobi identity $\str \circ \At_{XX} = [\str, \At] = [g,D]$ where $g: \Hom(X,X) \lto R \otimes_{k[f]} \Omega^1_{k[f]/k}$ is $g = [\str, \nabla]$. But from the way we have defined our connections, it is clear that $\str$ and $\nabla$ commute, so $g = 0$ and $\str \circ \At_{XX} = 0$.
\end{proof}

\begin{proposition}\label{prop:atselfadjoint} The operator $\At_i$ on $\Hom(\bar{X}, \bar{Y})$ is adjoint to $-\At_i$ on $\Hom(\bar{Y}, \bar{X})$.
\end{proposition}
\begin{proof}
If we apply $\langle \str( - ) \rangle$ to both sides of (\ref{eq:leibnizcompos}) and use Lemma \ref{lemma:stratiyahzero} we find that
\begin{align*}
\langle \At_i(\alpha), \beta \rangle_{\cat{C}} = -(-1)^{|\alpha|} \langle \alpha,  \At_i(\beta) \rangle_{\cat{C}} - \langle \str( gD(\alpha \otimes \beta) ) \rangle\,.
\end{align*}
So $\mu( \alpha \otimes \beta ) = \langle \str( g( \alpha \otimes \beta ) ) \rangle$ is a homotopy expressing $\At_i$ as adjoint to $-\At_i$.
\end{proof}

\subsection{Idempotents}\label{section:idempkl}

In the previous section we constructed operators $\lambda_i^\bullet, {\lambda_i}_\bullet$ and $\At_i$ on the dg-category $\cat{C}$. Now we use these operators to define idempotent endomorphisms of the complex
\[
\cat{C}(X,Y) = \Hom(\bar{X}, \bar{Y})
\]
which split in the homotopy category of $\nZ _2$-graded $k$-complexes to give $\Hom(X,Y)$. In this way the dg-category of matrix factorisations can be recovered from the quotient $\cat{C}$ and the nondegenerate pairing defined above induces the homotopically nondegenerate pairing $\langle -, - \rangle$.

The main result of \cite{dm1102.2957} is that if $V$ is the free $k$-module on the basis $\theta_1,\ldots,\theta_n$ then there is a homotopy equivalence
\[
\Hom(\bar{X}, \bar{Y}) \cong \Hom(X,Y) \otimes_k \bigwedge V\,.
\]
There are consequently $2^n$ ways to embed $\Hom(X,Y)$ in the homotopy category of $k$-complexes as a direct summand in $\Hom(\bar{X}, \bar{Y})$. The ``top degree'' embedding, corresponding to the form $\theta_1 \ldots \theta_n$, is determined by the following idempotent endomorphism of $\Hom(\bar{X}, \bar{Y})$: 
\[
e = \frac{1}{(n!)^2} (-1)^{\binom{n+1}{2}}\sum_{\sigma,\tau \in S_n} (-1)^{|\sigma\tau|} \lambda_{\sigma(1)}^\bullet \ldots \lambda_{\sigma(n)}^\bullet \At_{\tau(1)} \ldots \At_{\tau(n)}\,.
\]
The details are recalled in Appendix \ref{section:symidem}, see \eqref{eq:ordinaryidem}. 

Similarly there are $2^n$ ways to embed $\Hom(Y,X)$ as a summand in $\Hom(\bar{Y}, \bar{X})$. The embedding corresponding to the $0$-form $1$ in $\bigwedge V$ was not discussed in \cite{dm1102.2957} but we give the details in Appendix \ref{section:symidem}, specifically Proposition \ref{prop:otheridempotent}. The upshot is that that this embedding is determined by the following idempotent endomorphism of $\Hom(\bar{Y}, \bar{X})$
\[
e' = \frac{1}{(n!)^2} (-1)^{\binom{n+1}{2}}\sum_{\sigma, \tau \in S_n} (-1)^{|\sigma\tau|} \At_{\tau(1)} \ldots \At_{\tau(n)} {\lambda_{\sigma(1)}}_\bullet \ldots {\lambda_{\sigma(n)}}_\bullet\,.
\]
To be precise, taking $Z = \Hom(X,Y)$ in \eqref{eq:finalidempotents2} we have a diagram of degree zero $k$-linear morphisms
\be\label{eq:homxysummand}
\xymatrix@C+2pc{
\Hom(\bar{X}, \bar{Y}) \ar@<-0.7ex>[r]_-{\psi} & \Hom(X,Y)[n] \ar@<-0.7ex>[l]_-{\vartheta}
}
\ee
with $\psi \circ \vartheta = 1$ and $\vartheta \circ \psi = e$ (equalities meaning equal up to $k$-linear homotopy) and a diagram
\be
\xymatrix@C+2pc{
\Hom(\bar{Y}, \bar{X}) \ar@<-0.7ex>[r]_-{\psi'} & \Hom(Y,X) \ar@<-0.7ex>[l]_-{\kappa}
}
\ee
with $\psi' \circ \kappa = 1$ and $\kappa \circ \psi' = e'$. A concrete description of $\psi, \psi'$ is not important for us, but we will need to know that $\kappa$ is simply the quotient map, and that
\[
\vartheta = \frac{1}{n!} (-1)^n \sum_{\sigma \in S_n} (-1)^{|\sigma|} \lambda_{\sigma(1)}^\bullet \ldots \lambda_{\sigma(n)}^{\bullet}\,.
\]

\begin{proposition}\label{prop:eadjointeprime} The idempotent $e$ is adjoint to $e'$. Equivalently, the diagram
\begin{equation}\label{eq:eadjointeprime}
\xymatrix@C+2pc{
\Hom(\bar{X}, \bar{Y}) \ar[d]_-{e} \ar[r]^-{\zeta}_-{\cong} & \Hom_k(\Hom(\bar{Y},\bar{X}),k) \ar[d]^-{(e')^*}\\
\Hom(\bar{X}, \bar{Y}) \ar[r]_-{\zeta}^-{\cong} & \Hom_k( \Hom(\bar{Y}, \bar{X}), k )
}
\end{equation}
commutes up to homotopy, where $\zeta(\varphi) = \langle \varphi, - \rangle_{\cat{C}} = \langle \str( \varphi \circ - ) \rangle$.
\end{proposition}
\begin{proof} 
Observe that by the symmetries established above (see Lemma \ref{lemma:lambdaadjoint} and Proposition \ref{prop:atselfadjoint})
\begin{align*}
\left( \lambda_{\sigma(1)}^\bullet \ldots \lambda_{\sigma(n)}^\bullet \At_{\tau(1)} \ldots \At_{\tau(n)} \right)^{\dagger} &= (-1)^n \At^\dagger_{\tau(n)} \ldots \At^\dagger_{\tau(1)} (\lambda_{\sigma(n)}^\bullet)^\dagger \ldots (\lambda_{\sigma(1)}^\bullet)^{\dagger}\\
&= \At_{\tau(n)} \ldots \At_{\tau(1)} {\lambda_{\sigma(n)}}_{\bullet} \ldots {\lambda_{\sigma(1)}}_{\bullet}\,,
\end{align*}
from which it is immediate that $e^{\dagger} = e'$.
\end{proof}

% the core of all this is in dviat4 and dviat5
\begin{proposition}\label{prop:almostkltheorem} The pairing (\ref{eq:generalklpairing}) is homotopically nondegenerate.
\end{proposition}
\begin{proof} Consider the diagram
\[
\xymatrix@C+2pc{
\Hom(\bar{X},\bar{Y}) \ar[d]_-{\zeta}^-{\cong} \ar@<-0.7ex>[r]_-{\psi} & \Hom(X,Y)[n] \ar@<-0.7ex>[l]_-{\vartheta} \ar@{.>}[d]^{\chi}\\
\Hom_k(\Hom(\bar{Y}, \bar{X},k) \ar@<-0.7ex>[r]_-{\kappa^*} & \Hom_k( \Hom(Y,X), k) \ar@<-0.7ex>[l]_-{(\psi')^*}
}
\]
where $\chi = \kappa^* \circ \zeta \circ \vartheta$. It is immediate from commutativity of~\eqref{eq:eadjointeprime} up to homotopy that $\chi$ is a homotopy equivalence with inverse $\psi \circ \zeta^{-1} \circ (\psi')^*$. To prove the theorem it only remains to observe that $\chi(\alpha)$ is the functional $\langle \alpha, - \rangle_{XY}$ from \eqref{eq:generalklpairing}. But
\begin{align*}
\chi(\alpha) &= \kappa^* \zeta \vartheta( \alpha )\\
&= \kappa^* \zeta\left( \frac{1}{n!} (-1)^n \sum_{\sigma \in S_n} (-1)^{|\sigma|} \lambda_{\sigma(1)} \circ \ldots \circ \lambda_{\sigma(n)} \circ \alpha \right)\\
&= \frac{1}{n!} (-1)^n \sum_{\sigma \in S_n} (-1)^{|\sigma|} \langle \str( \lambda_{\sigma(1)} \circ \ldots \circ \lambda_{\sigma(n)} \circ \alpha \circ - ) \rangle\\
&= \frac{1}{n!} \sum_{\sigma \in S_n} (-1)^{|\sigma|} \langle \str(  \alpha \circ - \circ \lambda_{\sigma(1)} \circ \ldots \circ \lambda_{\sigma(n)} ) \rangle\\
&= \langle \alpha, - \rangle_{XY}
\end{align*}
which completes the proof.
\end{proof}

\subsection{Proof of the theorem}

Let us now abandon the general setting, and return to the situation of the main theorem where $R = k[x_1,\ldots,x_n]$, $f_i = \partial_{x_i} W$ and $\omega = \ud x_1 \ldots \ud x_n$. The main nontrivial input that we need is:

\begin{theorem}\label{theorem:nonlocalduality} The $R$-linear map
\begin{align*}
\bar{R} & \lto \Hom_k( \bar{R}, k)\, , \\
r & \lmt \Ress{R/k}\Bigg[ \frac{r \cdot (-) \, \underline{\ud x}}{ f_1, \ldots, f_n} \Bigg]
\end{align*}
is an isomorphism.
\end{theorem}
\begin{proof}
For local rings $R$ this is the statement of local duality. A proof which works in the present level of generality is given in the forthcoming \cite{meres}.
\end{proof}

Set $I = (f_1,\ldots,f_n)R$ and let $\widehat{R}$ denote the $I$-adic completion of $R$. The axioms (H1)--(H4) hold for $\widehat{R}$, since by \cite[Appendix B]{dm1102.2957} this algebra admits a flat standard connection as a $k[f]$-module, and (H4) follows from from Theorem \ref{theorem:nonlocalduality}. Note that in (H1) we only need that the $f_i$ act null-homotopically on the matrix factorisations
\[
\widehat{X} = X \otimes_R \widehat{R} \, , \qquad \widehat{Y} = Y \otimes_R \widehat{R}
\]
extended from $R$. 

\begin{proof}[Proof of Theorem \ref{theorem:generalkl}] Consider the diagram
\[
\xymatrix@C+2pc{
\Hom_R(X,Y) \ar[d]_{\can} \ar[r] & \Hom_k( \Hom_R(Y,X), k )[n]\\
\Hom_{\widehat{R}}(\widehat{X}, \widehat{Y}) \ar[r] & \Hom_k( \Hom_{\widehat{R}}(\widehat{X}, \widehat{Y}), k)[n] \ar[u]_{\can}
}
\]
where the columns are the canonical maps, and the rows are adjoint to the two versions of the pairing (\ref{eq:generalklpairing}). It is easy to see that this diagram commutes, and as the bottom row is a homotopy equivalence by Proposition \ref{prop:almostkltheorem}, to prove the theorem it is enough to argue that the canonical map
\[
\Hom_R(X,Y) \lto \Hom_{\widehat{R}}(\widehat{X}, \widehat{Y})
\]
is a homotopy equivalence of $\nZ _2$-graded complexes over $k$. But this is a consequence of the general fact that the ``pushforward commutes with flat base change'', see \cite[Remark 7.7]{dm1102.2957}.
\end{proof}

\subsection{Graded duality}\label{section:gradedduality}

In this section we collect together the modifications necessary in order to make Theorem \ref{theorem:generalkl} compatible with an additional $\nZ $-grading on matrix factorisations. Our conventions for graded modules and matrix factorisations are contained in Remark \ref{remark:gradedbicategory}.

Let $k = \bigoplus_{i \ge 0 } k_i$ be a noetherian $\nQ$-algebra which is graded, and let $R = k[x_1,\ldots,x_n]$ be a graded ring in such a way that the structural map $k \lto R$ has degree zero and $|x_i| \ge 0$ for $1 \le i \le n$. Let $W \in R$ be given, homogeneous of degree $|W| = 2c$, with the property that the $f_i = \partial_{x_i} W$ form a regular sequence and $\bar{R} = R/(f_1,\ldots,f_n)R$ is a finitely generated free $k$-module. Define
\[
a = nc - \sum_{i=1}^n |x_i|\,
\]
and let $X,Y$ be finite-rank graded matrix factorisations of $W$ over $R$.

\begin{theorem}\label{theorem:generalklgraded} 
The pairing $\langle -, - \rangle_{XY}$ of \eqref{eq:generalklpairing} is adjoint to a homotopy equivalence of $(\nZ  \times \nZ _2)$-graded complexes over $k$
\[
\Hom(X,Y) \lto \Hom^{\operatorname{gr}}_k( \Hom(Y,X), k )[n](-a)\,.
\]
\end{theorem}

Note that $\Hom(Y,X)$ is unlikely to be finitely generated over $k$, so there is a need to distinguish between $\Hom_k$ and $\Hom_k^{\operatorname{gr}}$. For the proof we need the following fact about residues.

\begin{lemma}\label{lemma:residuesarehomog} If $f_1,\ldots,f_n$ is a regular sequence in $R$ of homogeneous elements, then the map
\[
\Ress{R/k}\Bigg[ \frac{(-) \, \underline{\ud x}}{ f_1, \ldots, f_n} \Bigg]: R \lto k
\]
is homogeneous of degree $\sum_{i=1}^n( |x_i| - |f_i| )$.
\end{lemma}
\begin{proof}
Follows from the determinantal formula for residues in Lipman's book \cite[(1.10.5)]{Lipman}.
\end{proof}

\begin{proof}[Proof of Theorem \ref{theorem:generalklgraded}]
Consider the following diagram of $\nZ _2$-graded complexes
\[
\xymatrix@C+2pc{
\Hom(X,Y) \ar@{.>}[dr]_-{\zeta_{\operatorname{gr}}} \ar[r]^-{\xi} & \Hom(\Hom(Y,X),k)[n]\\
& \Hom^{\operatorname{gr}}_k( \Hom(Y,X), k)[n](-a) \ar[u]_{\iota = \inc}
}
\]
where $\xi$ is adjoint to (\ref{eq:generalklpairing}), and is therefore a homotopy equivalence by the earlier theorem. It is clear from the explicit formula for the pairing and Lemma \ref{lemma:residuesarehomog} that the image of $\xi$ lies in the subspace of homogeneous maps, and we let $\zeta_{\operatorname{gr}}$ denote this factorisation. The value of $a$ is chosen such that $\zeta_{\operatorname{gr}}$ is homogeneous of degree zero. It is enough to prove that $\zeta_{\operatorname{gr}}$ is a homotopy equivalence of $\nZ _2$-graded complexes (forgetting the $\nZ $-grading) since then by an elementary argument we can find a homotopy inverse which is degree zero, and graded homotopies.

It suffices to prove that the inclusion $\iota$ is a homotopy equivalence of $\nZ _2$-graded complexes. This would be a tautology if $\Hom(Y,X)$ were a finitely generated $k$-module, and in general we use the fact that $\Hom(Y,X)$ embeds up to homotopy in a finitely generated complex via morphisms $\psi, \vartheta$ as in \eqref{eq:homxysummand} above. Examining the expressions for $\vartheta, \psi$ in \cite[Section $7$]{dm1102.2957} we see that $\vartheta$ has degree $a$, $\psi$ has degree $-a$, and the homotopy between $\psi \circ \vartheta$ and the identity is homogeneous. If we apply both $\Hom_k(-,k)$ and $\Hom_k^{\operatorname{gr}}(-,k)$ to \eqref{eq:homxysummand} we obtain a diagram
\[
\xymatrix@C+2pc{
\Hom_k( \Hom(\bar{Y}, \bar{X}), k ) \ar@<-0.5ex>[r]_-{\vartheta^*} & \Hom_k(\Hom(Y,X),k)[n] \ar@<-0.5ex>[l]_-{\psi^*}\\
\Hom_k^{\operatorname{gr}}(\Hom(\bar{Y}, \bar{X}), k) \ar[u]^{=} \ar@<-0.5ex>[r]_-{\vartheta^*} & \Hom_k^{\operatorname{gr}}(\Hom(Y,X),k)[n](a) \ar@<-0.5ex>[l]_-{\psi^*} \ar[u]_{\iota}
}
\]
in which both of the implict squares commute up to homotopy, and from this we deduce that $\iota$ is a homotopy equivalence with inverse $\vartheta^* \circ \psi^*$.
\end{proof}


\appendix

\section{Symmetrised idempotents}\label{section:symidem}

In Section \ref{section:dualityadjointop} we used the idempotent pushforward construction of \cite{dm1102.2957} to establish a relative form of duality for matrix factorisations. We needed slightly more than what is stated in loc.~cit.~and in this appendix we provide the necessary additions. With later applications in mind we work in the same generality as the original construction, but the reader should keep in mind that for Section~\ref{section:dualityadjointop} we only need the case $Z = \Hom_R(X,Y)$ and $W = 0$ of the following.

Let $k$ be a $\nQ$-algebra and $R$ a $k$-algebra with a quasi-regular sequence $f=\{ f_1, \ldots, f_n \}$ such that $\bar{R} = R/(f_1,\ldots,f_n)R$ is a finitely generated projective $k$-module. Let $W \in k$ be given and let $Z$ be a finite-rank matrix factorisation of $W$ over $R$ with each $f_i$ acting null-homotopically on $Z$, and moreover let $\lambda_i \in \Hom_R(Z,Z)$ be odd maps with $[D, \lambda_i] = f_i \cdot 1_Z$ for each $1 \le i \le n$ where $D = d_Z$. We fix a homogeneous basis for $Z$ and, unless specified otherwise, $\otimes = \otimes_R$.

The aim is to write $Z$, up to $k$-linear homotopy equivalence, as the splitting of an idempotent on the quotient $\bar{Z} = Z \otimes \bar{R}$. Suppose that $R$ admits a flat $k$-linear connection $\nabla$ as a $k[f]$-module which is standard in the sense of \cite[Definition 8.6]{dm1102.2957}. The components of $\nabla$ are denoted $\partial_{f_i}$. If $K(f) = K(f_1,\ldots,f_n)$ denotes the usual Koszul complex then by hypothesis the map $K(f) \lto \bar{R}$ is a quasi-isomorphism and by \cite[Section 10]{dm1102.2957} the projection
\begin{equation}\label{eq:symidem1}
\pi: Z \otimes K(f) \lto Z \otimes \bar{R} = \bar{Z}
\end{equation}
is a homotopy equivalence over $k$. 

As a graded $R$-algebra $K(f)$ is the exterior algebra $\bigwedge F$ where $F$ is $R$-free on symbols $\theta_1,\ldots,\theta_n$ placed in degree $-1$. Since the $f_i$ all act null-homotopically on $Z$, if we think of $Z \otimes K(f)$ as being constructed by iterated mapping cones it is easy to see that this complex is homotopy equivalent over $R$ to the tensor product $Z \otimes \bigwedge F$, with no differential placed on the exterior component; see \cite[Section~$4$]{dm1102.2957}. This is just a direct sum of $2^n$ copies of $Z$ and $Z[1]$. In light of (\ref{eq:symidem1}) this means that in the homotopy category of linear factorisations of $W$ over $k$, there is an isomorphism
\[
\bar{Z} \cong Z \otimes_k \bigwedge (k\theta_1 \oplus \ldots \oplus k\theta_n)
\]
between $\bar{Z}$ and a direct sum of shifted copies of $Z$, and to this direct sum decomposition corresponds $2^n$ orthogonal $k$-linear idempotents on $\bar{Z}$. Our aim is to describe the idempotents corresponding to the top degree summand $Z \theta_1 \ldots \theta_n$ and the bottom degree summand $Z \cdot 1$.

The strategy is to construct a pair of $R$-linear idempotents on $Z \otimes K(f)$, and then transfer these idempotents to $\bar{Z}$. More precisely, we will construct a diagram
\begin{equation}\label{eq:twoidempotents}
\xymatrix@C+2pc{
Z[n] \ar@<0.7ex>[r]^-{\vartheta'} & Z \otimes K(f) \ar@<0.7ex>[l]^-{\varepsilon}\ar@<0.7ex>[r]^-{\rho} & Z \ar@<0.7ex>[l]^-{\kappa'}
}
\end{equation}
in which the maps are $R$-linear morphisms of linear factorisations satisfying $\rho \circ \kappa' = 1$ and $\varepsilon \circ \vartheta' = 1$. The composites $\kappa' \circ \rho$ and $\vartheta' \circ \varepsilon$ will be the desired pair of idempotents on $Z \otimes K(f)$ corresponding to top and bottom degree.

To this end consider the case of a single $f_i$, so there is an exact sequence
\[
\xymatrix{
0 \ar[r] & Z \ar[r]^-{\kappa'_i} & Z \otimes K(f_i) \ar[r]^-{\varepsilon_i} & Z\theta_i \ar[r] & 0
}
\]
where $Z\theta_i = Z[1]$, $\kappa'_i(x) = x \otimes 1$ is the inclusion and $\varepsilon_i( x \theta_i ) = (-1)^{|x|} x$. This sequence is split exact; choosing a splitting is equivalent to choosing a null-homotopy on $X$ for the action of $f_i$. The maps
\[
\rho_i(x + y \theta_i) = x + (-1)^{|y|} \lambda_i(y) \, , \qquad 
\vartheta'_i(x) = (-1)^{|x|} x \theta_i - \lambda_i(x)
\]
satisfy $\kappa'_i \circ \rho_i + \vartheta'_i \circ \varepsilon_i = 1$ and $\rho_i \circ \kappa'_i = 1, \varepsilon_i \circ \theta_i = 1$ and $\rho_i \circ \vartheta'_i = 0$. That is, they equip $Z \otimes K(f_i)$ with the structure of a biproduct on $Z \oplus Z\theta_i$. It will be convenient to have a more compact definition of $\vartheta'_i$. Let us agree that left multiplication by $\theta_i$ on $X \otimes K(f)$ comes with signs $\theta_i \cdot (x \otimes \eta) = (-1)^{|x|} x \otimes \theta_i \eta$ so that multiplication by $\theta_i$ defines a map $\theta_i: X \lto X \otimes K(f_i)$ and $\vartheta'_i = \theta_i - \lambda_i$.

To construct idempotents on $Z \otimes K(f)$ we can inductively apply either of the projections $\varepsilon$ or $\rho$ until we reach form degree zero, e.\,g.~in the first step we can choose to ``keep'' $\theta_n$, 
\[
Z \otimes K(f_1,\ldots,f_n) \cong (Z \otimes K(f_1,\ldots,f_{n-1})) \otimes K(f_n) \xlto{\varepsilon} Z \otimes K(f_1,\ldots,f_{n-1})\theta_n\,,
\]
or we can choose to project out $\theta_n$ by applying $\rho$ instead. If after keeping $\theta_n$ we proceed to apply the $\varepsilon$ projections for the rest of the $\theta_i$, we obtain a split epimorphism $\varepsilon: Z \otimes K(f) \lto Z[n]$ defined by $\varepsilon(x \theta_1 \ldots \theta_n) = (-1)^{n|x|} x$ with left inverse $\vartheta'$ defined by concatenating all the $\vartheta'_i$. This left inverse depends on the order in which we project out the $\theta_i$, but if we symmetrise over all permutations we obtain the following left inverse to $\varepsilon$: 
\[
\vartheta' = \frac{1}{n!} \sum_{\sigma \in S_n} (-1)^{|\sigma|} (\theta_{\sigma(1)} - \lambda_{\sigma(1)}) \circ \ldots \circ (\theta_{\sigma(n)} - \lambda_{\sigma(n)})\,.
\]
The reader may safely ignore this derivation, and instead check directly that $\vartheta'$ commutes with the differentials and satisfies $\varepsilon \circ \vartheta' = 1$, so that $\vartheta' \circ \varepsilon$ is an idempotent on $Z \otimes K(f)$ splitting to $Z[n]$.

At the other extreme we can choose at each stage to project out the $\theta_i$ using $\rho$ to obtain a split epimorphism $Z \otimes K(f) \lto Z$ with left inverse the inclusion $\kappa'(x) = x \otimes 1$. The precise formula for this epimorphism depends on the order in which we choose to project out the $\theta_i$. If we symmetrise over all permutations we arrive at the morphism
\begin{equation}\label{eq:rhoformula1}
\rho: Z \otimes K(f) \lto Z
\end{equation}
defined for $i_1 < \ldots < i_p$ by
% see syme3
\begin{equation}\label{eq:rhoformula2}
\rho( x \theta_{i_1} \ldots \theta_{i_p} ) = \frac{1}{p!} (-1)^{p|x|} \sum_{\sigma \in S_p} (-1)^{|\sigma|} \lambda_{i_{\sigma(1)}} \ldots \lambda_{i_{\sigma(p)}}(x)\,.
\end{equation}
Again one may ignore this derivation and check directly that $\rho$ commutes with the differentials and satisfies $\rho \circ \kappa' = 1$, so that $\kappa' \circ \rho$ is an idempotent splitting to $Z$.

Having constructed the maps in \eqref{eq:twoidempotents} we now proceed to transfer these two idempotents to $\bar{Z}$. We do this via the $k$-linear homotopy inverse $\sigma_\infty$ to $\pi$ which is described in \cite[Section 10]{dm1102.2957} (with $S = k$ and $X = Z$). In the notation given there
\[
\sigma_\infty = \sum_{m \ge 0} (-1)^m (\tau^{-1} \nabla_{\operatorname{gr}} D)^m \sigma\,.
\]
Here $\nabla_{\operatorname{gr}} = \sum_{j=1}^n \partial_{f_j} \circ \theta_j$ where $\theta_j$ denotes left multiplication on $Z \otimes K(f)$ with attendant Koszul sign, and $\partial_{f_j}$ is the operator extended to $Z$ using our chosen homogeneous basis. Consider now the diagram
\be\label{eq:finalidempotents}
\xymatrix@C+2pc{
& & Z[n] \ar@<-0.7ex>[dl]_-{\vartheta'}\\
\bar{Z} \ar@<-0.7ex>[r]_-{\sigma_\infty} & Z \otimes K(f) \ar@<-0.7ex>[ur]_-{\varepsilon}\ar@<-0.7ex>[l]_-{\pi} \ar@<-0.7ex>[dr]_-{\rho}\\
& & Z \ar@<-0.7ex>[ul]_-{\kappa'}
}\,.
\ee
From this we deduce two diagrams of $k$-linear factorisations of $W$, writing $\vartheta = \pi \circ \vartheta'$ and $\kappa = \pi \circ \kappa'$
\be\label{eq:finalidempotents2}
\xymatrix@C+2pc{
\bar{Z} \ar@<-0.7ex>[r]_-{\varepsilon \circ \sigma_\infty} & Z[n] \ar@<-0.7ex>[l]_-{\vartheta}
}, \qquad
\xymatrix@C+2pc{
\bar{Z} \ar@<-0.7ex>[r]_-{\rho \circ \sigma_\infty} & Z \ar@<-0.7ex>[l]_-{\kappa}
}.
\ee
The $k$-linear idempotent on $\bar{Z}$ corresponding to top degree is then $e = \vartheta \circ \varepsilon \circ \sigma_\infty$ while the bottom degree idempotent is $e' = \kappa \circ \rho \circ \sigma_\infty$. The former is described by symmetrising the content of \cite[Corollary 10.4]{dm1102.2957}: 
\begin{equation}\label{eq:ordinaryidem}
e = \frac{1}{(n!)^2} (-1)^{\binom{n+1}{2}} \sum_{\sigma, \tau \in S_n} (-1)^{|\sigma\tau|} \lambda_{\sigma(1)} \ldots \lambda_{\sigma(n)} \At_{\tau(1)} \ldots \At_{\tau(n)}
\end{equation}
where $\At_i = [D, \partial_{f_i}]$ is the $i$-th component of the Atiyah class.

\begin{proposition}\label{prop:otheridempotent} There is a $k$-linear homotopy
\begin{equation}\label{eq:propotheridempotent}
e' \simeq \frac{1}{(n!)^2} (-1)^{\binom{n+1}{2}} \sum_{\sigma, \tau \in S_n} (-1)^{|\sigma\tau|} \At_{\tau(1)} \ldots \At_{\tau(n)} \lambda_{\sigma(1)} \ldots \lambda_{\sigma(n)}\,.
\end{equation}
\end{proposition}
\begin{proof}
Working modulo the $f_i$ and using the tricks in the discussion preceeding \cite[Theorem 10.1]{dm1102.2957} we have
\begin{align*}
\sigma_\infty &= \sum_{m \ge 0} (-1)^m \frac{1}{m!} \big[ D, \nabla_{\operatorname{gr}} \big]^m \\
\end{align*}
where $\nabla_{\operatorname{gr}}$ has odd degree for the purpose of writing commutators. Expanding each of these commutators in its components $\At_i$ yields a sum
\begin{align*}
& \sum_{m \ge 0} \sum_{\sigma \in S_{m,n}} (-1)^{\binom{m+1}{2}} \frac{1}{m!} \At_{\sigma(1)} \ldots \At_{\sigma(m)} \theta_{\sigma(1)} \ldots \theta_{\sigma(m)}
\end{align*}
over all injective functions $S_{m,n}$ from $[1,m]$ to $[1,n]$. Using \eqref{eq:rhoformula2}
% see syme2
\begin{align*}
e' &= \pi \circ \kappa \circ \rho \circ \sigma_\infty\\
&= \sum_{m \ge 0} \frac{1}{m!} (-1)^{\binom{m+1}{2}} \sum_{\sigma \in S_{m,n}} \rho \At_{\sigma(1)} \ldots \At_{\sigma(m)} \theta_{\sigma(1)} \ldots \theta_{\sigma(m)}\\
&= \sum_{m \ge 0} \frac{1}{(m!)^2} (-1)^{\binom{m}{2}} \sum_{\sigma \in S_{m,n}} \sum_{\tau \in S_m} (-1)^{|\tau|} \lambda_{\sigma \tau(1)} \ldots \lambda_{\sigma \tau(m)} \At_{\sigma(1)} \ldots \At_{\sigma(m)}(x)\,.
\end{align*}
Using the relation $[ \lambda_i, \At_j ] = - \delta_{ij}$ up to homotopy given in the next lemma, we can commute all the Atiyah classes through to the left. Taking care of some combinatorics (and some delicate signs) the result is $e'$ is homotopic to the expression on the right hand side of \eqref{eq:propotheridempotent}.
\end{proof}
% see syme2

\begin{lemma} As operators on $\bar{Z}$ we have
\[
\lambda_i \At_j + \At_j \lambda_i = - \delta_{ij} + \big[ D, \big[ \partial_{f_j}, \lambda_i \big] \big]
\]
and in particular $[ \lambda_i, \At_j ] = - \delta_{ij}$ up to homotopy.
\end{lemma}
\begin{proof}
This follows from the graded Jacobi identity
\begin{align*}
[ \lambda_i, \At_j] &= [ \lambda_i, [D, \partial_{f_j}]] = [D, [\partial_{f_j}, \lambda_i]] - [ \partial_{f_j}, f_i ] 
= [ D, [\partial_{f_j}, \lambda_i]] - \delta_{ij} \cdot 1_{\bar{Z}} \, , 
\end{align*}
as claimed.
\end{proof}

\section{Homotopies and residues}\label{app:reshom}
% see reshom

In the explicit formulas for the evaluation maps, and also the nondegenerate pairing of Section \ref{section:dualityadjointop}, homotopies $\lambda_i$ appear and there are natural questions of independence of the choice of homotopy, and independence up to sign of the choice of ordering. Our aim here is to answer such questions.

The setup is as follows: $k$ is any ring, $R$ is a $k$-algebra, $W \in R$ and $X$ is a finite rank matrix factorisation of $W$ over $R$. We assume that $f_1,\ldots,f_n$ is a regular sequence in $R$ such that $R/(f_1,\ldots,f_n)$ is a finitely generated projective $k$-module and that each $f_i$ acts null-homotopically on $X$. We also assume given some $\omega \in \Omega^n_{R/k}$ and write $D = [d_X, -]$ for the differential on $\End(X) = \Hom_R(X,X)$.

For example, if $R = k[x_1,\ldots,x_n]$ and $W \in R$ is a potential in the sense of the body of the paper, all hypotheses are satisfied for $f_i = \partial_{x_i} W$ and $\omega = \ud x_1 \ldots \ud x_n$.

For succinctness we write
\[
\langle - \rangle = \Res_{R/k} \!\!\left[ \frac{ (-) \cdot \omega }{f_1, \ldots, f_n} \right].
\]
If for each $1 \le i \le n$ we choose null-homotopies for the action of the $f_i$, i.\,e.~we choose $\lambda_i \in \End(X)$ with $D(\lambda_i) = f_i \cdot 1_X$, then we may define the closed degree $n$ map
\be\label{eq:applanglerangle1}
\langle \str( - \circ \lambda_1 \cdots \lambda_n ) \rangle: \End(X) \lto k\,.
\ee
In this section all maps and homotopies are $k$-linear. Everything rests on the fact that the supertrace is a closed map, and thus for homogeneous $\alpha, \beta \in \End(X)$
\[
0 = \str( D( \alpha \beta ) ) = \str( D(\alpha) \beta ) + (-1)^{|\alpha|} \str( \alpha D(\beta) )\,.
\]

\begin{lemma}\label{lemma:inreschoosehom} The map \eqref{eq:applanglerangle1} is independent, up to homotopy, of the choice of null-homotopies $\lambda_i$.
\end{lemma}
\begin{proof}
We show that replacing $\lambda_1$ by another null-homotopy $\mu_1$ has the effect of changing \eqref{eq:applanglerangle1} by a null-homotopic linear functional; the argument for the other $\lambda_i$ is identical. Given $\alpha \in \End(X)$,
\begin{align}
\langle \str( \alpha \lambda_1 \cdots \lambda_n ) \rangle &= \Res_{R/k} \!\!\left[ \frac{ \str( \alpha f_1 \lambda_1 \cdots \lambda_n ) \omega }{f_1^2, f_2, \ldots, f_n} \right]\label{eq:inreschoosehom1}\\
&= \Res_{R/k} \!\!\left[ \frac{ \str( \alpha D(\mu_1) \lambda_1 \cdots \lambda_n ) \omega }{f_1^2, f_2, \ldots, f_n} \right]\\
&= \Res_{R/k} \!\!\left[ \frac{ \str\big( (-1)^{|\alpha|}D(\alpha) \mu_1 \lambda_1 \cdots \lambda_n + \alpha \mu_1 D(\lambda_1 \cdots \lambda_n) \big) \omega }{f_1^2, f_2, \ldots, f_n} \right]
\end{align}
The first summand inside the supertrace gives a null-homotopic functional, and in $D(\lambda_1 \cdots \lambda_n) = D(\lambda_1) \lambda_2 \cdots \lambda_n - \lambda_1 D(\lambda_2 \cdots \lambda_n)$ the second summand contains factors of $f_i$ for $i > 2$ which annihilate within the residue, so finally we have that \eqref{eq:applanglerangle1} is homotopic to the map
\begin{align*}
\Res_{R/k} \!\!\left[ \frac{ \str( - \circ \mu_1 D(\lambda_1) \lambda_2 \cdots \lambda_n ) \omega }{f_1^2, f_2, \ldots, f_n} \right] = \langle \str( - \circ \mu_1 \lambda_2 \cdots \lambda_n ) \rangle
\end{align*}
as claimed.
\end{proof}

\begin{lemma}\label{lemma:symmetrystrres} For any $\sigma \in S_n$ the map
\[
(-1)^{|\sigma|} \langle \str( - \circ \lambda_{\sigma(1)} \cdots \lambda_{\sigma(n)} ) \rangle: \End(X) \lto k
\]
is homotopic to \eqref{eq:applanglerangle1}.
\end{lemma}
\begin{proof}
If in \eqref{eq:inreschoosehom1} we instead multiplied top and bottom of the residue by $f_2$, so that the numerator reads $\str( \alpha f_2 \lambda_1 \cdots \lambda_n )$, then the same argument will show that there is a homotopy
\[
\langle \str( - \circ \lambda_1 \lambda_2 \cdots \lambda_n ) \rangle \simeq - \langle \str( - \circ \lambda_2 \lambda_1 \cdots \lambda_n )\,.
\]
The argument for a general permutation is the same.
\end{proof}

\section{Remarks on adjoints}\label{app:adjoints}
% see bicat2, adjbi, adjbi2

Let $\cat{B}$ be a bicategory. We address the following problem encountered in the construction of adjoints in the bicategory of Landau-Ginzburg models: suppose that for each $1$-morphism $f: A \lto B$ we are given a pair of $1$-morphisms ${}^\dual f, f^\dual: B \lto A$ and that for those $f$ belonging to some subcategory $\cat{C} \subseteq \cat{B}(A, B)$ we are given evaluation and coevaluation maps exhibiting ${}^\dual f, f^\dual$ as adjoints of $f$.

Provided every object of $\cat{B}(A,B)$ is a direct summand of an object of $\cat{C}$ we explain below that there is an essentially unique way of extending the definition of evaluation and coevaluation maps from $\cat{C}$ to all of $\cat{B}(A,B)$.

But before getting into that we need to recall some more background on adjoints in bicategories. Specifically, the way in which the adjoints ${}^\dual f$ and $f^\dual$ are functorial with respect to $2$-morphisms. This is an adaptation of standard material for monoidal categories, so we will be brief.

Throughout this section we write $\Hom(f,g)$ for $\Hom_{\cat{B}(A,B)}(f,g)$.

\subsection{Functoriality of adjoints}\label{section:funcadjoint}

The following lemma recasts the definition of adjunction given in Section \ref{subsec:bicat} in terms of a natural isomorphism. Observe that we insist on naturality with respect to both $1$- and $2$-morphisms. 

\begin{lemma}\label{lemma:adjoint_nat_iso} Let $f: A \lto B$ and $g: B \lto A$ be $1$-morphisms with $g$ left adjoint to $f$. Specifying $2$-morphisms $\eval, \coev$ satisfying \eqref{uglyZorro1}, \eqref{uglyZorro2} is equivalent to specifying a family of bijections
\[
\Phi_{h, l}: \Hom(g \otimes h, l) \lto \Hom(h, f \otimes l),
\]
indexed by pairs of $1$-morphisms $h: C \lto B$ and $l: C \lto A$, subject to the following conditions:
\begin{itemize}
\item[(i)] the bijections $\Phi$ are natural with respect to $2$-morphisms in the variables $h, l$, and
\item[(ii)] the bijections $\Phi$ are natural with respect to $1$-morphisms in the sense that for any $h': C' \lto C$ the diagram
\[
\xymatrix@C+2.5pc{
\Hom(g \otimes h, l) \ar[d]_-{(-) \otimes 1_{h'}}\ar[r]^-{\Phi_{h,l}} & \Hom(h, f \otimes l) \ar[d]^-{(-) \otimes 1_{h'}}\\
\Hom( (g \otimes h) \otimes h', l \otimes h') \ar[d]_\alpha & \Hom(h \otimes h', (f \otimes l) \otimes h') \ar[d]^\alpha\\
\Hom( g \otimes (h \otimes h'), l \otimes h') \ar[r]_-{\Phi_{h \otimes h', l \otimes h'}} & \Hom(h \otimes h', f \otimes (l \otimes h') )
}
\]
commutes.
\end{itemize}
\end{lemma}
\begin{proof}
The proof is essentially the same as the usual proof for adjoint functors, so we can be brief. Given evaluation and coevaluation maps for an adjunction, one defines $\Phi$ of a $2$-morphism $\tau: g \otimes h \lto l$ to be the composite
\[
\xymatrix@C+2pc{
h \ar[r]^-{\lambda^{-1}} & \Delta_B \otimes h \ar[r]^-{\coev \otimes 1_h} & (f \otimes g) \otimes h \ar[r]^-{\alpha} & f \otimes ( g \otimes h ) \ar[r]^-{1_f \otimes \tau} & f \otimes l
}\,.
\]
The inverse map $\Phi^{-1}$ sends a $2$-morphism $\beta: h \lto f \otimes l$ to the composite
\[
\xymatrix@C+2pc{
g \otimes h \ar[r]^-{1_g \otimes \beta} & g \otimes ( f \otimes l ) \ar[r]^-{\alpha^{-1}} & (g \otimes f) \otimes l \ar[r]^-{\eval \otimes 1_l} & \Delta_A \otimes l \ar[r]^-{\lambda} & l
}\,.
\]
\end{proof}

\begin{remark}
For the careful reader we mention that when working with bicategories one often needs to check commutativity of diagrams constructed from the structure morphisms $\lambda, \rho, \alpha$. Just as for monoidal categories this commutativity is, in most cases, an easy consequence of the coherence axioms. The only exceptions relevant for this paper are the diagrams $(5), (7), (10)$ of \cite{kelly}, whose commutativity follows from the coherence axioms but not in a completely obvious way.
\end{remark}

Let $f_1,f_2: A \lto B$ be $1$-morphisms with left adjoints ${}^\dual f_i$. By the previous lemma there is an isomorphism
\be\label{eq:2isolemma}
\Hom({}^\dual f_2, {}^\dual f_1) \stackrel{\rho}{\cong} \Hom({}^\dual f_2 \otimes \Delta_B, {}^\dual f_1) \stackrel{\Phi}{\cong} \Hom( \Delta_B, f_2 \otimes {}^\dual f_1)\,.
\ee
\begin{definition} Given a $2$-morphism $\zeta: f_1 \lto f_2$ we define ${}^\dual \zeta: {}^\dual f_2 \lto {}^\dual f_1$ to be the unique $2$-morphism making the diagram
\be\label{eq:dualzeta}
\xymatrix@C+1pc@R+1pc{
\Delta_B \ar[r]^-{\coev} \ar[d]_-{\coev} & f_1 \otimes {}^\dual f_1 \ar[d]^{\zeta \otimes 1}\\
f_2 \otimes {}^\dual f_2 \ar[r]_-{1 \otimes {}^\dual \zeta} & f_2 \otimes {}^\dual f_1
}
\ee
commute.
\end{definition}

\begin{remark}
\begin{itemize}
\item[(i)] The construction is functorial, in the sense that ${}^\dual(1_f) = 1_{{}^\dual f}$ and ${}^\dual( \xi \circ \zeta ) = {}^\dual \zeta \circ {}^\dual \xi$.
\item[(ii)] Using commutativity of \eqref{eq:dualzeta} and the Zorro identities one checks that
\be\label{eq:dualzeta2}
\xymatrix@C+1pc@R+1pc
{
{}^\dual f_2 \otimes f_1 \ar[r]^-{{}^\dual \zeta \otimes 1}\ar[d]_-{1 \otimes \zeta} & {}^\dual f_1 \otimes f_1 \ar[d]^-{\eval}\\
{}^\dual f_2 \otimes f_2 \ar[r]_{\eval} & \Delta_A
}
\ee
commutes.
\end{itemize}
\end{remark}

Let $f_1,f_2: A \lto B$ be $1$-morphisms with right adjoints $f_i^\dual$. There is an isomorphism
\[
\Hom(f_2^\dual, f_1^\dual) \stackrel{\rho}{\cong} \Hom(f_2^\dual, f_1^\dual \otimes \Delta_B) \stackrel{\Phi}{\cong} \Hom(f_1 \otimes f_2^\dual, \Delta_B)\,.
\]

\begin{definition} Given a $2$-morphism $\zeta: f_1 \lto f_2$ we define $\zeta^\dual: f_2^\dual \lto f_1^\dual$ to be the unique $2$-morphism making the diagram
\be\label{eq:funcrightdual}
\xymatrix@C+1pc@R+1pc{
f_1 \otimes f_2^\dual \ar[r]^-{\zeta \otimes 1}\ar[d]_-{1 \otimes \zeta^\dual} & f_2 \otimes f_2^\dual \ar[d]^-{\widetilde\eval}\\
f_1 \otimes f_1^\dual \ar[r]_{\widetilde\eval} & \Delta_B
}
\ee
commute.
\end{definition}

Again the construction is functorial, and the diagram
\be\label{eq:funcrightdual2}
\xymatrix@C+1pc@R+1pc{
\Delta_A \ar[d]_-{\widetilde\coev} \ar[r]^-{\widetilde\coev} & f_1^\dual \otimes f_1 \ar[d]^-{1 \otimes \zeta}\\
f_2^\dual \otimes f_2 \ar[r]_-{\zeta^\dual \otimes 1} & f_1^\dual \otimes f_2
}
\ee
commutes.

\subsection{Extending duality to the idempotent closure}\label{section:extendduality}

Let $\cat{B}$ be a bicategory and suppose that for fixed objects $A,B$ there is a contravariant functor
\be\label{eq:extenddual1}
(-)^\dual: \cat{B}(A,B) \lto \cat{B}(B,A)
\ee
and a full subcategory $\cat{C} \subseteq \cat{B}(A,B)$ together with, for each $f \in \cat{C}$, a pair of $2$-morphisms
\be\label{eq:extenddual2}
\widetilde\eval_f: f \otimes f^\dual \lto \Delta_B \, , \qquad \widetilde\coev_f: \Delta_A \lto f^\dual \otimes f
\ee
making $f$ into the left adjoint of $f^\dual$. Suppose that the following two conditions are satisfied:
\begin{itemize}
\item[(i)] every object in the category $\cat{B}(A,B)$ is a direct summand of an object in $\cat{C}$, and
\item[(ii)] for every morphism $\zeta: f_1 \lto f_2$ in $\cat{C}$ the morphism $\zeta^\dual: f_2^\dual \lto f_1^\dual$ defined in Section \ref{section:funcadjoint} agrees with the image of $\zeta$ under the functor $\eqref{eq:extenddual1}$. Equivalently, the image makes \eqref{eq:funcrightdual} commute.
\end{itemize}

Having been given duality in the subcategory $\cat{C}$ we show how to extend to the idempotent closure. The argument for extending left adjoints is identical and we omit it.

\begin{proposition}\label{prop:uniquext} There is a \textsl{unique} way of defining for each $x \in \cat{B}(A,B)$ a pair of $2$-morphisms
\[
\widetilde\eval_x: x \otimes x^\dual \lto \Delta_B \, , \qquad \widetilde\coev_x: \Delta_A \lto x^\dual \otimes x
\]
satisfying the conditions
\begin{itemize}
\item[(i)] if $x \in \cat{C}$ then $\widetilde\eval_x, \widetilde\coev_x$ are as given in \eqref{eq:extenddual2},
\item[(ii)] $\widetilde\eval_x, \widetilde\coev_x$ make $x$ the left adjoint of $x^\dual$, and
\item[(iii)] the diagrams
\be\label{eq:propuniquext}
\xymatrix@C+1pc@R+1pc{
\Delta_A \ar[d]_-{\widetilde\coev_{x_2}} \ar[r]^-{\widetilde\coev_{x_1}} & x_1^\dual \otimes x_1 \ar[d]^-{1 \otimes \zeta}\\
x_2^\dual \otimes x_2 \ar[r]_-{\zeta^\dual \otimes 1} & x_1^\dual \otimes x_2 , 
}
 \qquad
\xymatrix@C+1pc@R+1pc{
x_1 \otimes x_2^\dual \ar[r]^-{\zeta \otimes 1}\ar[d]_-{1 \otimes \zeta^\dual} & x_2 \otimes x_2^\dual \ar[d]^-{\widetilde\eval_{x_2}}\\
x_1 \otimes x_1^\dual \ar[r]_{\widetilde\eval_{x_1}} & \Delta_B
}
\ee
commute for every morphism $\zeta: x_1 \lto x_2$ in $\cat{B}(A,B)$.
\end{itemize}
\end{proposition}

The proof occupies the rest of this section. To begin with we choose for each $x \in \cat{B}(A,B)$ an object $f \in \cat{C}$ (depending on $x$) and $2$-morphisms $q,p$ such that $p \circ q = 1_x$ as in the diagram
\[
\xymatrix@C+2pc{
x \ar@<-1ex>[r]_-{q} & f \ar@<-1ex>[l]_-{p}
}\,.
\]
Using these choices we define the $2$-morphisms $\widetilde\eval_x, \widetilde\coev_x$, which will turn out to be independent of the choice of $f,p,q$. Applying the functor $(-)^\dual$ to the morphisms $p,q$ of $\cat{B}(A,B)$ we have summands
\[
\xymatrix@C+2pc{
x^\dual \otimes x \ar@<-1ex>[r]_-{p^\dual \otimes q} & f^\dual \otimes f \ar@<-1ex>[l]_-{q^\dual \otimes p}
}, \qquad (q^\dual \otimes p) \circ (p^\dual \otimes q) = 1_{x^\dual \otimes x}
\]
and
\[
\xymatrix@C+2pc{
x \otimes x^\dual \ar@<-1ex>[r]_-{q \otimes p^\dual} & f \otimes f^\dual \ar@<-1ex>[l]_-{p \otimes q^\dual}
}, \qquad (p \otimes q^\dual) \circ (q \otimes p^\dual) = 1_{x \otimes x^\dual}\,.
\]
Using these maps we define $\widetilde\coev_x$ to be the composite
\[
\coev_x = \xymatrix@C+1pc{ \Delta_A \ar[r]^-{\widetilde\coev_f} & f^\dual \otimes f \ar[r]^-{q^\dual \otimes p} & x^\dual \otimes x }
\]
and we define $\widetilde\eval_x$ to be
\[
\eval_x = \xymatrix@C+1pc{ x \otimes x^\dual \ar[r]^-{q \otimes p^\dual} & f \otimes f^\dual \ar[r]^-{\widetilde\eval_f} & \Delta_B }\,.
\]
First we check that $\widetilde\eval_x, \widetilde\coev_x$ make $x$ into a left adjoint of $x^\dual$.

\begin{lemma} $\eval_x, \coev_x$ satisfy \eqref{uglyZorro1} and \eqref{uglyZorro2}.
\end{lemma}
\begin{proof}
We explain the proof of \eqref{uglyZorro2}, the other verification is similar. Consider the following diagram, where we omit an associator to avoid clutter: 
\[
\xymatrix@C+2pc@R+1pc{
f \ar[d]_-{p} \ar[r]^-{\rho_f^{-1}} & f \otimes \Delta_A \ar[d]_-{p \otimes 1}\ar[r]^-{1 \otimes \widetilde\coev_f} & f \otimes f^\dual \otimes f \ar@/_1pc/[d]_-{p \otimes q^\dual \otimes p} \ar[r]^-{\widetilde\eval_f \otimes 1} & \Delta_A \otimes f \ar[r]^-{\lambda_f} & f\\
x \ar[r]_-{\rho_x^{-1}} & x \otimes \Delta_A \ar[r]_-{1 \otimes \widetilde\coev_x} & x \otimes x^\dual \otimes x \ar@/_1pc/[u]_-{q \otimes p^\dual \otimes q} \ar[r]_-{\widetilde\eval_x \otimes 1} & \Delta_A \otimes x \ar[u]_-{1 \otimes q}\ar[r]_-{\lambda_x} & x  \ar[u]_-{q}
} 
\]
Let $Z$ denote the bottom row. By definition each of the squares in this diagram commutes, so
\begin{align*}
q \circ Z \circ p &= \lambda_f \circ ( \widetilde\eval_f \otimes 1 ) \circ ( qp \otimes (qp)^\dual \otimes qp ) \circ (1 \otimes \widetilde\coev_f ) \circ \rho_f^{-1}\\
&= \lambda_f \circ (\widetilde\eval_f \otimes 1) \circ ((qp)^2 \otimes 1 \otimes qp ) \circ (1 \otimes \widetilde\coev_f ) \circ \rho_f^{-1}\\
&= \lambda_f \circ (\widetilde\eval_f \otimes 1) \circ (qp \otimes 1 \otimes qp ) \circ (1 \otimes \widetilde\coev_f ) \circ \rho_f^{-1}\\
&= qp \circ \lambda_f \circ (\widetilde\eval_f \otimes 1) \circ (1 \otimes \widetilde\coev_f ) \circ \rho_f^{-1} \circ qp\\
&= (qp)^2 = q \circ 1_x \circ p\,,
\end{align*}
and hence $Z = 1_x$ as claimed. In the second step we use the fact that $qp$ is a morphism in $\cat{C}$, so by naturality of the evaluation $\widetilde\eval_f \circ ( qp \otimes 1 ) = \widetilde\eval_f \circ ( 1 \otimes (qp)^\dual )$.
\end{proof}

Using naturality \eqref{eq:funcrightdual}, \eqref{eq:funcrightdual2} of $\widetilde\eval_f, \widetilde\coev_f$ it is straightforward to check that the diagrams \eqref{eq:propuniquext} commute. If we apply the same argument to two presentations of a $1$-morphism $x$ as a summand of $f,f'$ in $\cat{C}$ we see that $\eval_x, \coev_x$ are independent of the choice of presentation, and in particular if $x \in \cat{C}$ then these maps agree with the given ones.

To complete the proof of the proposition it only remains to argue that this family of $2$-morphisms $\{ \widetilde\eval_x, \widetilde\coev_x \}_{x \in \cat{B}(A,B)}$ is \textsl{unique}. Suppose that we are given $\{\widetilde\eval'_x, \widetilde\coev'_x\}_{x \in \cat{B}(A,B)}$ satisfying (i), (ii), (iii) of the proposition. Given $x$ with presentation as above, the solid square in the diagram
\[
\xymatrix@C+1pc{
f \otimes x^\dual \ar[d]_-{p \otimes 1}\ar[r]^-{1 \otimes p^\dual} & f \otimes f^\dual \ar[d]^-{\widetilde\eval_f}\\
x \otimes x^\dual \ar@{.>}@/_1pc/[u]_{q \otimes 1}\ar[r]_-{\widetilde\eval'_x} & \Delta_B
}
\]
commutes by (iii) and (i). But then
\[
\widetilde\eval'_x = \widetilde\eval'_x \circ (p \otimes 1) \circ (q \otimes 1) = \widetilde\eval_f \circ (1 \otimes p^\dual) \circ (q \otimes 1) = \widetilde\eval_x
\]
and similarly for $\coev'_x$.


\section{Independence of variable ordering}\label{app:variableordering}

Objects of the bicategory $\LG$ are pairs consisting of a polynomial ring $R$ and potential $W$, together with a chosen ordering of the ring variables. Thus the value of a diagram in $\LG$ depends \textsl{a priori} on the ordering of the ring variables in each of its $2$-dimensional regions. In this appendix we show that the value is actually independent of these orderings, up to the natural permutation signs.

To take a concrete example, consider for $X \in \hmf(k[z_1,\ldots,z_m], V)$ the diagram
\be\label{eq:signdependencepermdia}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}[very thick,scale=0.4,color=blue!50!black, baseline,>=stealth]
\nicecolourscheme (0,0) circle (3.5);
\fill (-2.1,-2.1) circle (0pt) node[white] {{\small$V$}};
\shadedraw[top color=white, bottom color=white, draw=white] (0,0) circle (2);
%
\draw[very thin, color=blue!55!white, decorate, decoration={snake, amplitude=0.2mm, segment length=1.0mm}] (270:2) .. controls +(3,0) and +(3,-1) .. (90:2); 
\fill (180:1.8) circle (0pt) node[left] {{\small$X$}};
\draw (0,0) circle (2);
\draw[<-, very thick] (0.100,2) -- (-0.101,2) node[above] {}; 
\draw[<-, very thick] (-0.100,-2) -- (0.101,-2) node[below] {}; 
\end{tikzpicture} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\, . 
\ee
We show in Section \ref{sec:defectaction} that the value of this diagram is the endomorphism of $\Delta_V$ given by multiplication with the polynomial $(-1)^{{m+1\choose 2}} \str( \partial_{z_1} d_X \ldots \partial_{z_m} d_X )$. While there is an obvious dependence on the variable ordering, we prove that the homotopy equivalence class of this endomorphism changes only by a permutation sign if we change the ordering of the variables~$z_i$ in the outer region.

Let $(R = k[x_1,\ldots,x_n], W)$ be an object of $\LG$. Given $\sigma \in S_n$ consider the matrix factorisation $(\Delta^\sigma_W, d_{\Delta^\sigma_W})$ of $\widetilde W$ over $\Re$ with the same underlying graded module as $\Delta_W$, but the differential that we would have written down if we had begun with the variable ordering $x_{\sigma(1)},\ldots,x_{\sigma(n)}$, namely
\be
d_{\Delta^\sigma_W} = \delta^\sigma_+ + \delta_- \, , \qquad \delta_+ = \sum_{i=1}^n \partial^{\,\sigma}_{[i]}W\cdot \theta_i\, , \qquad \delta_- =  \sum_{i=1}^n (x_i-x'_i) \cdot \theta_i^*
\ee
where $\partial^{\,\sigma}_{[i]}$ are the modified difference quotient operators, defined for $1 \le i \le n$ with $\sigma(j) = i$ by
\be\label{diffquotopmod}
\partial^{\,\sigma}_{[i]}: k[x,x'] \lra k[x,x'] \, , \qquad f \lmt \frac{{}^{t_{\sigma(1)}\ldots t_{\sigma(j-1)}}f - {}^{t_{\sigma(1)}\ldots t_{\sigma(j)}}f}{x_{\sigma(i)}-x'_{\sigma(i)}} \, . 
\ee
Together with the morphisms $\rho, \lambda$ of \eqref{lambdarho} this matrix factorisation serves as an alternative unit $1$-endomorphism of $(R,W)$. That is, $\rho$ and $\lambda$ are both isomorphisms and the coherence axioms for the unit in a bicategory holds for $\Delta^\sigma_W$. By uniqueness of units there is an isomorphism in $\hmf(\Re, \widetilde W)$
\[
\xi: \Delta_W \lto \Delta^\sigma_W
\]
unique with the property that, for any $1$-morphism $X: (k[x],W) \lto (k[z],V)$, the diagram
\be\label{eq:propertydeltasigma}
\xymatrix{
X \otimes_R \Delta_W \ar[dr]_{\rho}\ar[rr]^-{1 \otimes \xi} & & X \otimes_R \Delta^\sigma_W \ar[dl]^{\rho}\\
& X
}
\ee
commutes in $\HMF(k[x,z], V - W)$. Explicitly, $\xi$ can be constructed as the composite
$$
\xymatrix@C+1pc{
\Delta_W \ar[r]^-{\lambda_{\Delta^\sigma_W}^{-1}} & \Delta^\sigma_W \otimes_R \Delta_W \ar[r]^-{\rho_{\Delta_W}} & \Delta^\sigma_W
} ,
$$
but we will only use commutativity of \eqref{eq:propertydeltasigma}. Taking $X = \Delta_W^{\vee}$ in this diagram we deduce that
\be
\xymatrix{
\Delta_W \ar[dr]_{\pi}\ar[rr]^-{\xi} & & \Delta^\sigma_W\ar[dl]^{\pi}\\
& R
}
\ee
commutes in $\HF(\Re, \widetilde W)$, i.\,e.~$\xi$ is the isomorphism connecting these two stabilisations of $R$.

To understand how permuting variables affects the values of diagrams like \eqref{eq:signdependencepermdia}, we need to understand the effect on the evaluation and coevaluation maps of Section \ref{sec:derivcoeval}. For the remainder of this section we fix potentials $W \in R = k[x_1,\ldots,x_n]$, $V \in S = k[z_1,\ldots,z_m]$ and $X \in \hmf(k[x,z], V - W)$.

By inspection $\widetilde\coev_X$ depends only on the order of the $x$-variables and $\coev_X$ depends only on the order of the $z$-variables, through the maps $\Psi, \varepsilon$. Since $\Psi$ is independent of the ordering up to homotopy, the only ``real'' dependence in both cases is via $\varepsilon$. Similarly $\widetilde \eval_X$ depends on the order of the $x$-variables via $\Lambda^{(x)}$, $\underline{\ud x}$ and the order of the partial derivatives in the denominator of the residue, and $\eval_X$ depends on the order of the $z$-variables via $\Lambda^{(z)}$, $\underline{\ud z}$ and the residue denominator.

Let us fix permutations $\sigma \in S_n$ and $\tau \in S_m$. If we take the variable orderings $x_{\sigma(1)},\ldots,x_{\sigma(n)}$ and $z_{\tau(1)}, \ldots, z_{\tau(m)}$ in Section \ref{sec:derivcoeval} the result will be morphisms
\begin{align}
\coev^{\sigma,\tau}_X &: \Delta^\tau_V \lto X \otimes_R {}^\dual X
\, , \qquad
\eval^{\sigma,\tau}_X: {}^\dual X \otimes_{S} X \lto \Delta^\sigma_W \, ,\label{eq:permutedevcoev1}\\
\widetilde\coev^{\sigma,\tau}_X&: \Delta^\sigma_W \lto X^\dual \otimes_{S} X
\, , \qquad
\widetilde\eval^{\sigma,\tau}_X: X \otimes_{R} X^\dual \lto \Delta^\tau_V\,. \label{eq:permutedevcoev2}
\end{align}
These are related to the original evaluation and coevaluation maps as follows.

\begin{lemma}\label{lemma:evsignspermute} The diagrams
\be\label{eq:evsignspermute}
\xymatrix@C+3pc@R-1pc{
& \Delta_V \ar[dd]^-{\xi}\\
X \otimes_R X^{\dual}\ar[ur]^-{\widetilde\eval_X}\ar[dr]_-{(-1)^{|\sigma|} \widetilde \eval^{\sigma, \tau}_X} \\
& \Delta^\tau_V, 
}
\qquad
\xymatrix@C+3pc@R-1pc{
& \Delta_W \ar[dd]^-{\xi}\\
{}^\dual X \otimes_S X \ar[ur]^-{\eval_X}\ar[dr]_-{(-1)^{|\tau|} \eval^{\sigma,\tau}_X}\\
& \Delta^\sigma_W
}
\ee
commute in $\HMF(S^e, \widetilde V)$ and $\HMF(\Re, \widetilde W)$ respectively.
\end{lemma}
\begin{proof}
We give the argument for the first diagram, the second is similar. By the universal property of the stabilisation it suffices to prove that the $\Se$-linear morphisms
\[
\widetilde \eval_0\, , \; (-1)^{|\sigma|} \widetilde \eval^{\sigma, \tau}_0: X \otimes_R X^\dual \lto S
\]
are homotopic. For this it is enough to show that the $S$-linear maps
\[
\Res_{k[x]/k} \!\!\left[ \frac{ \str( \lambda_1 \ldots \lambda_n \circ (-) ) \, \underline{\ud x}}{\partial_{x_1} W \ldots \partial_{x_n} W} \right] , \qquad
(-1)^{|\sigma|}\Res_{k[x]/k} \!\!\left[  \frac{\str( \lambda_{\sigma(1)} \ldots \lambda_{\sigma(n)} \circ (-) ) \, \ud x_{\sigma(1)} \ldots \ud x_{\sigma(n)}}{\partial_{x_{\sigma(1)}} W \ldots \partial_{x_{\sigma(n)}} W} \right]
\]
are homotopic. But this follows from Appendix \ref{app:reshom}.
\end{proof}

\begin{lemma}\label{lemma:coevsignspermute} The diagrams
\be\label{eq:coevsignspermute}
\xymatrix@C+3pc@R-1pc{
\Delta_W \ar[dr]^-{\widetilde \coev_X} \ar[dd]_-{\xi}\\
& X^\dual \otimes_S X , \\
\Delta^\sigma_W \ar[ur]_-{(-1)^{|\sigma|} \widetilde \coev^{\sigma, \tau}}
}
\qquad
\xymatrix@C+3pc@R-1pc{
\Delta_V \ar[dd]_-{\xi} \ar[dr]^-{\coev^{\sigma,\tau}_X}\\
& X \otimes_R {}^\dual X\\
\Delta^\tau_V \ar[ur]_-{(-1)^{|\tau|} \coev^{\sigma,\tau}_X}
}
\ee
commute in $\HMF(\Re, \widetilde W)$ and $\HMF(\Se, \widetilde V)$ respectively.
\end{lemma}
\begin{proof}
The morphisms in \eqref{eq:permutedevcoev1} and \eqref{eq:permutedevcoev2} satisfy the Zorro moves, so commutativity of the diagrams in \eqref{eq:coevsignspermute} follows from commutativity of those in \eqref{eq:evsignspermute}.
\end{proof}

The general rule is that permuting the variables in a region by $\tau$ changes the value of a diagram by a factor of $(-1)^{M|\tau|}$ where $M$ is the number of wiggly lines (see Section~\ref{subsec:alternatives}) entering or departing an evaluation or coevaluation within that region. The simplest example is \eqref{eq:signdependencepermdia} where the value changes by the sign $(-1)^{|\tau|}$.

%Returning to the example  we have a diagram, in which the top path computes the value of the diagram with outer region given the usual variable ordering, and the bottom path computes the value given the ordering $z_{\tau(1)}, \ldots, z_{\tau(m)}$
%\[
%\xymatrix@C+2pc@R-1pc{
%\Delta_V \ar[dd]_-{\xi} \ar[dr]^-{\coev_X} &  & & \Delta_V \ar[dd]^-{\xi}\\
%& X \otimes_R X^{\vee} \otimes_S S[m] \ar[r]^-{\cong} & X \otimes_R R[m] \otimes_R X^{\vee} \ar[ur]^-{\widetilde \eval_X} \ar[dr]_-{\widetilde \eval^{\tau}_X}\\
%\Delta^\tau_V \ar[ur]_-{\coev^{\tau}_X} & & & \Delta^\tau_V.
%}
%\]
%We have shown that the left-hand triangle commutes in $\HMF(\Se, \widetilde V)$ up to a sign $(-1)^{|\tau|}$, and the right-hand triangle commutes.


\section[The map $\varepsilon \Psi$]{The map $\boldsymbol{\varepsilon \Psi}$}\label{appendix:mapeppsi}
% see divop

In this section $k$ is any commutative ring, $R = k[x_1,\ldots,x_n]$. We write $\Re = R \otimes_k R = k[x] \otimes_k k[x']$. In the notation of Section \ref{subsec:Bar} both the Koszul complex $(\Delta, \delta_{-})$ and $(\Bar, b')$ give $\Re$-resolutions of the diagonal $R$, and $\Psi$ is the unique chain map up to homotopy making the triangle in the diagram
\[
\xymatrix{
\Bar \ar[dr]_-{\pi} \ar[r]^-{\Psi} & \Delta \ar[d]^-{\pi} \ar[r]^\varepsilon & \Re[n]\\
& R
}
\]
commute. As indicated in this diagram there is a second chain map $\varepsilon: (\Delta, \delta_{-}) \lto \Re[n]$, see \eqref{eq:vareps}, and the composite $\varepsilon \Psi$ gives a cocycle in Hochschild cohomology
\[
\varepsilon \Psi \in H^n \Hom_{\Re}( \Bar, \Re ) = H^n( R, \Re )\,.
\]
This Hochschild cohomology module is a free $R$-module of rank one, and $\varepsilon \Psi$ gives a generator. In this appendix we explain that $\varepsilon \Psi$ is a product in Hochschild cohomology of the derivations
\[
\partial_{(i)}: R \lra \Re \, , \qquad f \lmt \frac{f - {}^{t_i}f}{x_i-x'_i} \, ,
\]
where we use the notation ${}^{t_i}(-)$ of Section \ref{subsec:bicatLG}. 

\begin{definition} Let $\Re_{(i)}$ denote the $R$-bimodule which is $\Re$ with the left and right actions
\[
r_1 * s * r_2 = r_1 \cdot s \cdot {}^{t_i} r_2\,, \qquad r_i \in R, s \in \Re
\]
where ``$\cdot$'' denotes ring multiplication in $\Re$.
\end{definition}

\begin{lemma} $\partial_{(i)}$ is a $k$-linear derivation of $R$ into the bimodule $\Re_{(i)}$.
\end{lemma}
\begin{proof}
Immediate from the identity in Lemma \ref{lem:LeibnizForDQO}.
\end{proof}

By the usual correspondence between bimodule derivations and Hochschild $1$-cocycles, each $\partial_{(i)}$ determines a class $[ D_i ] \in H^1(R, \Re_{(i)})$. Taking the product yields a class in
\[
[ D_1 ] * \cdots * [D_n] \in H^n(R, \Re_{(1)} \otimes_R \cdots \otimes_R \Re_{(n)})\,.
\]
Next we observe that the map
\begin{gather*}
\gamma: \Re_{(1)} \otimes_R \cdots \otimes_R \Re_{(n)} \lto \Re\,\\
\gamma( r_1 \otimes \cdots \otimes r_n ) = r_1 \cdot {}^{t_1} r_2 \cdot {}^{t_1t_2} r_3 \cdots {}^{t_1 \ldots t_{n-1}} r_n
\end{gather*}
is a morphism of $R$-bimodules.

\begin{lemma} $\varepsilon \Psi$ is the image of $[D_1] * \cdots * [D_n]$ under the induced map
\[
H^n(R, \gamma): H^n(R, \Re_{(1)} \otimes_R \cdots \otimes_R \Re_{(n)}) \lto H^n(R, \Re)\,.
\]
That is, in Hochschild cohomology
\[
\varepsilon \Psi = H^n(R, \gamma)( [ D_1 ] * \cdots * [D_n] )\,.
\]
\end{lemma}
\begin{proof}
We have
\begin{align*}
H^n(R, \gamma)( [ D_1 ] * \cdots * [D_n] )( df_1 \ldots df_p ) &= \gamma\left( \partial_{(1)}f_1 \otimes \partial_{(2)}f_2 \cdots \otimes \partial_{(n)}f_n \right)\\
&= \partial_{(1)}f_1 {}^{t_1} \partial_{(2)}f_2 \cdots \otimes {}^{t_1 \ldots t_{n-1}}\partial_{(n)}f_n\\
&= \partial_{[1]}f_1 \partial_{[2]}f_2 \cdots \otimes \partial_{[n]}f_n\\
&= \varepsilon \Psi( df_1 \ldots df_p )\,.
\end{align*}
\end{proof}

\newcommand{\etalchar}[1]{$^{#1}$}
\providecommand{\href}[2]{#2}
\begin{thebibliography}{FYH{\etalchar{+}}85}

\bibitem[Arn89]{arnold}
V.~I.~Arnold, \textsl{Mathematical methods of classical mechanics}, Graduate Texts in Mathematics Vol. 60, Springer-Verlag, 1989.

\bibitem[ABCDG]{MB2}
P.~S.~Aspinwall, T.~Bridgeland, A.~Craw, M.~R.~Douglas, and M.~Gross, \textsl{Dirichlet Branes and Mirror Symmetry}, Clay Mathematics Monographs, AMS, 2009.

%\bibitem[BN]{bnKhovanov11crossings}
%D.~Bar-Natan, \textsl{Khovanov {H}omology for {K}nots and {L}inks with up to 11
%  {C}rossings}, available at
%  \href{http://www.math.toronto.edu/drorbn/papers/KHTables/KHTables.pdf}{http:%
%//www.math.toronto.edu/drorbn/papers/KHTables/KHTables.pdf}.
%
%\bibitem[Bec]{b1105.0702}
%H.~Becker, \textsl{Khovanov-Rozansky homology via Cohen-Macaulay approximations and Soergel bimodules},
%  \href{http://arxiv.org/abs/1105.0702}{[arXiv:1105.0702]}.

\bibitem[Ati57]{atiyahconn}
M.~Atiyah, \emph{Complex analytic connections in fibre bundles}, Trans. Amer.
  Math. Soc. \textbf{85} (1957), 181--207.

\bibitem[Ben67]{benabou}
J.~B\'{e}nabou, \textsl{Introduction to bicategories}, Reports of the Midwest Category
Seminar, pages 1--77, Springer, Berlin, 1967.

\bibitem[Bor94]{bor94}
F.~Borceux, \textsl{Handbook of categorical algebra $1$}, volume $50$ of \textsl{Encyclopedia of Mathematics and its Applications}, Cambridge University Press, Cambridge, 1994.

\bibitem[BR07]{br0707.0922}
I.~Brunner and D.~Roggenkamp, \textsl{B-type defects in {L}andau-{G}inzburg
  models}, JHEP \textbf{0708} (2007), 093,
  \href{http://arxiv.org/abs/0707.0922}{[arXiv:0707.0922]}.

\bibitem[BF03]{buchweitz03}
R.-O. Buchweitz and H.~Flenner, \textsl{A semiregularity map for modules and
  applications to deformations}, Compositio Math. \textbf{137} (2003),
  135--210.

\bibitem[BF08]{buchweitz08}
R.-O. Buchweitz and H.~Flenner, \textsl{The global decomposition theorem for {H}ochschild (co-)homology of singular spaces via the Atiyah-Chern character}, Adv. Math. \textbf{217} (2008), no. 1, 243--281.

%\bibitem[CF94]{cf9405183}
%L.~Crane and I.~B. Frenkel, \textsl{Four dimensional topological quantum field
%  theory, {H}opf categories, and the canonical bases}, J. Math. Phys.
%  \textbf{35} (1994), 5136--5154,
%  \href{http://arxiv.org/abs/hep-th/9405183}{[hep-th/9405183]}.
%
%\bibitem[CK08a]{ck0701194}
%S.~Cautis and J.~Kamnitzer, \textsl{Knot homology via derived categories of
%  coherent sheaves {I}, {$sl(2)$} case}, Duke Math. J. \textbf{142} (2008),
%  511--588, \href{http://arxiv.org/abs/math/0701194}{[math.AG/0701194]}.
%
%\bibitem[CK08b]{ck0710.3216}
%S.~Cautis and J.~Kamnitzer, \textsl{Knot homology via derived categories of coherent sheaves {II},
%  {$sl(m)$} case}, Invent. Math. \textbf{174} (2008), 165--232,
%  \href{http://arxiv.org/abs/math/0710.3216}{[math.AG/0710.3216]}.
%

\bibitem[CM]{khovhompaper}
N.~Carqueville and D.~Murfet, \textsl{Computing {K}hovanov-{R}ozansky homology and defect fusion}, \href{http://arxiv.org/abs/1108.1081}{[arXiv:1108.1081]}

%\bibitem[CM]{cmWebCompileCode}
%N.~Carqueville and D.~Murfet, \textsl{Code to compute {K}hovanov-{R}ozansky
%  homology and defect fusion in {L}andau-{G}inzburg models},
%  \href{http://www.carqueville.net/nils/webCompilations}{http://www.carqueville.net/nils/webCompilations}.

\bibitem[CW10]{ct1007.2679}
A.~{C\u ald\u araru} and S.~Willerton, \textsl{The Mukai pairing, I: a categorical approach},
New York Journal of Mathematics \textbf{16} (2010), 61--98, 
  \href{http://arxiv.org/abs/0707.2052}{[arXiv:0707.2052]}.

\bibitem[CR10]{cr0909.4381}
N.~Carqueville and I.~Runkel, \textsl{On the monoidal structure of matrix bi-factorisations}, J. Phys.
  A: Math. Theor. \textbf{43} (2010), 275401,
  \href{http://arxiv.org/abs/0909.4381}{[arXiv:0909.4381]}.

\bibitem[CR12]{cr1006.5609}
N.~Carqueville and I.~Runkel, \textsl{Rigidity and defect actions in
  Landau-Ginzburg models}, Comm. Math. Phys. \textbf{310} (2012), 135--179, 
  \href{http://arxiv.org/abs/1006.5609}{[arXiv:1006.5609]}.

\bibitem[CR]{genorb}
N.~Carqueville and I.~Runkel, \textsl{Orbifold completion of defect bicategories}, in preparation. 

\bibitem[Cra]{c0403266}
M.~Crainic, \textsl{On the perturbation lemma, and deformations},
  \href{http://arxiv.org/abs/math/0403266}{[math.AT/0403266]}.

%\bibitem[DGR06]{dgr0505662}
%N.~M. Dunfield, S.~Gukov, and J.~Rasmussen, \textsl{The {S}uperpolynomial for
%  {K}not {H}omologies}, Experimental Math. \textbf{15} (2006), 129--159,
%  \href{http://arxiv.org/abs/math/0505662}{[math.GT/0505662]}.

\bibitem[CQ95]{cuntzquillen}
J.~Cuntz and D.~Quillen, \textsl{Algebra extensions and nonsingularity}, Journal of the AMS \textbf{8}, No. 2 (1995).

\bibitem[DKR]{dkr1107.0495}
A.~Davydov, L.~Kong, and I.~Runkel, \textsl{Field theories with defects and the
  centre functor}, Mathematical Foundations of Quantum Field Theory and Perturbative String Theory, 
  Proceedings of Symposia in Pure Mathematics, AMS, 2011, \href{http://arxiv.org/abs/1107.0495}{[arXiv:1107.0495]}.

%\bibitem[DBM{\etalchar{+}}11]{dbmmss1106.4305}
%P.~Dunin-Barkowski, A.~Mironov, A.~Morozov, A.~Sleptsov, A.~Smirnov, \textsl{Superpolynomials for toric knots from evolution induced by cut-and-join operators},
%  \href{http://arxiv.org/abs/1106.4305}{[arXiv:1106.4305]}. 
%  
\bibitem[Dyc11]{d0904.4713}
T.~Dyckerhoff, \textsl{Compact generators in categories of matrix factorizations},
  Duke Math. J. \textbf{159} (2011), 223--274,
  \href{http://arxiv.org/abs/0904.4713}{[arXiv:0904.4713]}.

\bibitem[DM10]{dyckmurf}
T.~Dyckerhoff and D.~Murfet, \textsl{{The Kapustin-Li formula revisited}},
  \href{http://arxiv.org/abs/1004.0687}{[arXiv:1004.0687]}.

\bibitem[DM11]{dm1102.2957}
T.~Dyckerhoff and D.~Murfet, \textsl{Pushing forward matrix factorisations},
  \href{http://arxiv.org/abs/1102.2957}{[arXiv:1102.2957]}.

\bibitem[FRS02]{tft1}
J.~Fuchs, I.~Runkel and C.~Schweigert,
\textsl{TFT construction of RCFT correlators. I: Partition functions},
Nucl.~Phys.~B {\bf 646} (2002), 353--497, \href{http://arxiv.org/abs/hep-th/0204148}{[hep-th/0204148]}.

\bibitem[FFRS09]{ffrs0909.5013}
J.~Fr\"ohlich, J.~Fuchs, I.~Runkel and C.~Schweigert,
\textsl{Defect lines, dualities, and generalised orbifolds},
Proceedings of the XVI International Congress on Mathematical Physics, Prague, August 3--8, 2009, \href{http://arxiv.org/abs/0909.5013}{[arXiv:0909.5013]}.

\bibitem[Gray74]{gray}
J.~W.~Gray, \textsl{Formal category theory: adjointness for 2-categories}, Springer-Verlag, Berlin, 1974.

\bibitem[HL]{hl0404}
M.~Herbst and C.~I. Lazaroiu, \textsl{Localization and traces in open-closed
  topological {L}andau-{G}inzburg models}, JHEP \textbf{0505} (2005), 044,
  \href{http://www.arxiv.org/abs/hep-th/0404184}{[hep-th/0404184]}.

\bibitem[Huy06]{huybrechts}
D.~Huybrechts, \textsl{Fourier-Mukai Transforms in Algebraic Geometry}, Oxford Math. Monogr., Oxford Univ. Press, New York, 2006.

\bibitem[Huy10]{huybrechts10}
D.~Huybrechts and R.~P.~Thomas, \textsl{Deformation-obstruction theory for complexes via Atiyah and Kodaira-Spencer classes}, Math. Ann. (2010) 346:545--569.

\bibitem[Ill72]{illusie}
L.~Illusie, \emph{Complexe cotangent et d\'eformations I, II}, vol. 239,
  Springer New York, 1971, 1972.

%\bibitem[FFRS07]{ffrs0607247}
%J.~Fr\"ohlich, J.~Fuchs, I.~Runkel, and C.~Schweigert, \textsl{Duality and
%  defects in rational conformal field theory}, Nucl. Phys. B \textbf{763}
%  (2007), 354--430,
%  \href{http://arxiv.org/abs/hep-th/0607247}{[hep-th/0607247]}.
%
%\bibitem[FYH{\etalchar{+}}85]{Homfly}
%P.~Freyd, D.~Yetter, J.~Hoste, W.~B.~R. Lickorish, K.~Millett, and A.~Ocneanu,
%  \textsl{A new polynomial invariant of knots and links}, Bull. Amer. Math. Soc.
%  \textbf{12} (1985), 239--246.
%
%\bibitem[GIKV10]{gikv0705.1368}
%S.~Gukov, A.~Iqbal, C.~Koz\c{c}az, and C.~Vafa, \textsl{Link {H}omologies and the
%  {R}efined {T}opological {V}ertex}, Comm. Math. Phys. \textbf{298} (2010),
%  757--785, \href{http://arxiv.org/abs/0705.1368}{[arXiv:0705.1368]}.
%
%\bibitem[GSV05]{gsv0412243}
%S.~Gukov, A.~Schwarz, and C.~Vafa, \textsl{Khovanov-{R}ozansky {H}omology and
%  {T}opological {S}trings}, Lett. Math. Phys. \textbf{74} (2005), 53--74,
%  \href{http://arxiv.org/abs/hep-th/0412243}{[hep-th/0412243]}.
%
%\bibitem[GV99]{gv9811131}
%R.~Gopakumar and C.~Vafa, \textsl{On the {G}auge {T}heory/{G}eometry
%  {C}orrespondence}, Adv. Theor. Math. Phys. \textbf{3} (1999), 1415--1443,
%  \href{http://arxiv.org/abs/hep-th/9811131}{[hep-th/9811131]}.
%
%\bibitem[GW]{gw0512298}
%S.~Gukov and J.~Walcher, \textsl{Matrix {F}actorizations and {K}auffman
%  {H}omology}, \href{http://arxiv.org/abs/hep-th/0512298}{[hep-th/0512298]}.
%
%\bibitem[Jae]{j1101.3302}
%T.~C. Jaeger, \textsl{Khovanov-{R}ozansky {H}omology and {C}onway {M}utation},
%  \href{http://arxiv.org/abs/1101.3302}{[arXiv:1101.3302]}.
%
%\bibitem[Jon85]{JonesPolynomialPaper}
%V.~F.~R. Jones, \textsl{A polynomial invariant for knots via von {N}eumann
%  algebras}, Bull. Amer. Math. Soc. \textbf{12} (1985), 103--111.

\bibitem[JS91]{JSGoTCI}
A.~Joyal and R.~Street, \textsl{The geometry of tensor calculus I}, Advances in Math. \textbf{88} (1991), 55--112.

\bibitem[JS]{JSGoTCII}
A.~Joyal and R.~Street, \textsl{The geometry of tensor calculus II}, 
draft available at 
\href{http://maths.mq.edu.au/~street/GTCII.pdf}{http://maths.mq.edu.au/\textasciitilde street/GTCII.pdf}

\bibitem[Kap]{kapranov}
M.~Kapranov, \textsl{{R}ozansky{W}itten invariants via {A}tiyah classes}, Compositio Math. \textbf{115} (1999), no. 1, 71--113.

\bibitem[Ka]{k1004.2307}
A.~Kapustin, \textsl{Topological {F}ield {T}heory, {H}igher {C}ategories, and
  {T}heir {A}pplications},
  \href{http://arxiv.org/abs/1004.2307}{[arXiv:1004.2307]}.

\bibitem[KL]{kl0305}
A.~Kapustin and Y.~Li, \textsl{Topological {C}orrelators in {L}andau-{G}inzburg {M}odels with
  {B}oundaries}, Adv. Theor. Math. Phys. \textbf{7} (2004), 727--749,
  \href{http://www.arxiv.org/abs/hep-th/0305136}{[hep-th/0305136]}.

\bibitem[KR]{kr0405232}
A.~Kapustin and L.~Rozansky, \textsl{On the relation between open and closed
  topological strings}, Commun. Math. Phys. \textbf{252} (2004), 393--414,
  \href{http://arxiv.org/abs/hep-th/0405232}{[hep-th/0405232]}.
  
\bibitem[KvBM]{keller}
B.~Keller, D.~Murfet and M.~Van den Bergh, \textsl{On two examples by Iyama and Yoshino}, Compos. Math. \textbf{147} (2011), no. 2, 591--612.

\bibitem[Kel64]{kelly}
G.~M.~Kelly, \textsl{On {M}ac{L}ane's conditions for coherence of natural associativities, commutativities, etc.}, Journal of Algebra \textbf{1} (1964), 397--402.

\bibitem[KS74]{kellystreet}
G.~M.~Kelly and R.~Street, \textsl{Review of the elements of 2-categories}, In Category Seminar (Proc. Sem., Sydney, 1972/1973), pages 75--103, Lecture Notes in Math., Vol. 420, Springer, Berlin, 1974.

\bibitem[Kho10]{khovdia}
M.~Khovanov, \textsl{Categorifications from planar diagrammatics}, Japanese J. of Mathematics \textbf{5} (2010), 153--181, \href{http://arxiv.org/abs/1008.5084}{[arXiv:1008.5084v1]}.

%\bibitem[Kaw96]{kawauchibook}
%A.~Kawauchi, \textsl{A {S}urvey of {K}not {T}heory}, Birkh\"auser, 1996.
%
%\bibitem[Kho00]{k9908171}
%M.~Khovanov, \textsl{A categorification of the {J}ones polynomial}, Duke Math. J.
%  \textbf{101} (2000), 359--426,
%  \href{http://arxiv.org/abs/math/9908171}{[math.QA/9908171]}.
%
%\bibitem[Kho07]{k0510265}
%M.~Khovanov, \textsl{Triply-graded link homology and Hochschild homology of Soergel bimodules},
%  Int. Journal of Math. \textbf{18} (2007), 869--885,
%  \href{http://arxiv.org/abs/math/0510265}{[math.GT/0510265]}.
%
%\bibitem[KR07a]{kr0701333}
%M.~Khovanov and L.~Rozansky, \textsl{Virtual crossings, convolutions and a
%  categorification of the {$\operatorname{SO}(2N)$} {K}auffman polynomial},
%  Journal of G\"okova Geometry Topology \textbf{1} (2007), 116--214,
%  \href{http://arxiv.org/abs/math/0701333}{[math.QA/0701333]}.
%
%\bibitem[KR07b]{kr0404189}
%M.~Khovanov and L.~Rozansky, \textsl{Topological Landau-Ginzburg models on the world-sheet foam},
%  Adv. Theor. Math. Phys. \textbf{11} (2007), 233--259,
%  \href{http://arxiv.org/abs/hep-th/0404189}{[hep-th/0404189]}.
%
\bibitem[KR08a]{kr0401268}
M.~Khovanov and L.~Rozansky, \textsl{Matrix factorizations and link homology}, Fund. Math.
  \textbf{199} (2008), 1--91,
  \href{http://arxiv.org/abs/math/0401268}{[math/0401268]}.
%
%\bibitem[KR08b]{kr0505056}
%M.~Khovanov and L.~Rozansky, \textsl{Matrix factorizations and link homology {II}}, Geometry \&
%  Topology \textbf{12} (2008), 1387--1425,
%  \href{http://arxiv.org/abs/math/0505056}{[math.QA/0505056]}.
%
%\bibitem[Ko]{Kock}
%J.~Kock, \textsl{Frobenius Algebras and 2D Topological Quantum Field Theories}, Cambridge University Press, 2003.
%
%\bibitem[Lam86]{LambekRingsModules}
%J.~Lambek, \textsl{Lectures on rings and modules}, AMS Chelsea Publishing, 1986.

\bibitem[Lack]{lack}
S.~Lack, \textsl{A $2$-categories companion}, \href{http://arxiv.org/abs/math/0702535}{[arXiv:math/0702535v1]}.

\bibitem[Lau12]{ladia}
A.~D.~Lauda, \textsl{An introduction to diagrammatic algebra and categorified quantum $\mathfrak{sl}_2$}, Bulletin of the Institute of Mathematics Academia Sinica (New Series), Vol. \textbf{7} (2012), No. 2, 165--270, \href{http://arxiv.org/abs/1106.2128}{[arXiv:1106.2128v2]}.

\bibitem[Laz05]{l0312}
C.~I. Lazaroiu, \textsl{On the boundary coupling of topological {L}andau-{G}inzburg
  models}, JHEP \textbf{0505} (2005), 037,
  \href{http://www.arxiv.org/abs/hep-th/0312286}{[hep-th/0312286]}.

\bibitem[LM]{Calinetal}
C.~I. Lazaroiu and D.~McNamee, unpublished.

\bibitem[Lip84]{Lipman84}
J.~Lipman, \textsl{Dualizing sheaves, differentials and residues on algebraic
  varieties}, Ast\'erisque (1984), no.~117, ii+138.

\bibitem[Lip87]{Lipman}
J.~Lipman, \textsl{Residues and traces of differential forms via {H}ochschild
  homology}, Contemporary Mathematics \textbf{61}, American Mathematical Society,
  Providence, 1987.

\bibitem[Lo]{Loday}
J.-L. Loday, \textsl{Cyclic homology}, Springer, 1997.

%\bibitem[LMnV00]{lmv0010102}
%J.~M.~F. Labastida, M.~Mari\~{n}o, and C.~Vafa, \textsl{Knot {I}nvariants and
%  {T}opological {S}trings}, JHEP \textbf{0011} (2000), 007,
%  \href{http://arxiv.org/abs/hep-th/0010102}{[hep-th/0010102]}.
%
%\bibitem[MSV09]{msv0708.2228}
%M.~Mackaay, M.~Sto\v{s}i\'{c}, and P.~Vaz, \textsl{$\mathfrak{sl}(N)$ link homology ($N\geq 4$) using foams and the Kapustin-Li formula}, Geometry \& Topology \textbf{13} (2009), 1075--1128,
%  \href{http://arxiv.org/abs/0708.2228}{[arXiv:0708.2228]}.
%
%\bibitem[Man07]{m0601629}
%C.~Manolescu, \textsl{Link homology theories from symplectic geometry}, Adv. in
%  Math. \textbf{211} (2007), 363--416,
%  \href{http://www.arxiv.org/abs/math.AG/0601629}{[math.SG/0601629]}.

\bibitem[Mar]{markarian}
N.~Markarian, \emph{The {A}tiyah class, {H}ochschild cohomology and the
  {R}iemann-{R}och theorem}, arXiv:math/0610553.

\bibitem[MR]{mazur}
B.~Mazur and L.~Roberts, \textsl{Local Euler Characteristics}, Inventiones math. \textbf{9} (1970), 201--234.

\bibitem[McN09]{McNameethesis}
D.~McNamee, \textsl{On the mathematical structure of topological defects in
  {L}andau-{G}inzburg models}, MSc Thesis, Trinity College Dublin, 2009.
  
\bibitem[Mu]{m0912.1629}
D.~Murfet, \textsl{Residues and duality for singularity categories of isolated {G}orenstein singularities},
  \href{http://arxiv.org/abs/0912.1629}{[arXiv:0912.1629]}.  

\bibitem[Mub]{meres}
D.~Murfet, \textsl{Residues via the perturbation lemma}, in preparation.

%\bibitem[Mn05]{marinoknotbook}
%M.~Mari\~{n}o, \textsl{Chern-{S}imons {T}heory, {M}atrix {M}odels, and
%  {T}opological s{t}rings}, Oxford University Press, 2005.
%
%\bibitem[MOY98]{moy1998}
%H.~Murakami, T.~Ohtsuki, and S.~Yamada, \textsl{Homfly polynomial via an
%  invariant of colored plane graphs}, Enseign. Math. \textbf{44} (1998),
%  325--360.

\bibitem[MS]{ms0609042}
G.~W. Moore and G.~Segal, \textsl{D-branes and {K}-theory in {2D} topological
  field theory}, \href{http://arxiv.org/abs/hep-th/0609042}{[hep-th/0609042]}.

\bibitem[Nee01]{NeemanBook}
\bysame, \emph{Triangulated categories}, Annals of Mathematics Studies, vol.
  148, Princeton University Press, Princeton, NJ, 2001.

%\bibitem[MS]{ms0709.1971}
%V.~Manzorchuck and C.~Stroppel, \textsl{A combinatorial approach to functorial
%  quantum {$\mathfrak{sl}_k$} knot invariants},
%  \href{http://arxiv.org/abs/0709.1971}{[arXiv:0709.1971]}.
%
%\bibitem[OV00]{ov9912123}
%H.~Ooguri and C.~Vafa, \textsl{Knot {I}nvariants and {T}opological {S}trings},
%  Nucl. Phys. B \textbf{577} (2000), 419--438,
%  \href{http://arxiv.org/abs/hep-th/9912123}{[hep-th/9912123]}.

\bibitem[P10]{p0807.1471}
K.~Ponto, \textsl{Shadows and traces in bicategories}, 
Ast\'erisque, (333), 2010, 
\href{http://arxiv.org/abs/0807.1471}{[arXiv:0807.1471]}. 

\bibitem[PS]{ps0910.1306}
K.~Ponto and M.~Shulman, \textsl{Shadows and traces in bicategories}, 
\href{http://arxiv.org/abs/0910.1306}{[arXiv:0910.1306]}. 

\bibitem[PV]{pv1002.2116}
A.~Polishchuk and A.~Vaintrob, \textsl{Chern characters and {H}irzebruch-{R}iemann-{R}och formula for matrix factorizations}, 
\href{http://arxiv.org/abs/1002.2116}{[arXiv:1002.2116]}. 


%\bibitem[PT87]{HomflyPT}
%J.~Przytycki and P.~Traczyk, \textsl{Conway algebras and skein equivalence of
%  links}, Proc. Amer. Math. Soc. \textbf{100} (1987), 744--748.
%
%\bibitem[Ras]{r0607544}
%J.~Rasmussen, \textsl{Some differentials on {K}hovanov-{R}ozansky homology},
%  \href{http://arxiv.org/abs/math/0607544}{[math.GT/0607544]}.
%
%\bibitem[Ras07]{r0508510}
%J.~Rasmussen, \textsl{Khovanov-{R}ozansky homology of two-bridge knots and links},
%  Duke Math. J. \textbf{136} (2007), 551--583,
%  \href{http://arxiv.org/abs/math/0508510}{[math.GT/0508510]}.
%  
%\bibitem[Ric94]{rickard}
%J.~Rickard, \textsl{Translation functors and equivalences of derived categories for blocks of algebraic groups}, in Finite dimensional algebras and related topics, Kluwer (1994), 255-264.
%
%\bibitem[Rou06]{RouquierMexico}
%R.~Rouquier, \textsl{Categorification of {$\mathfrak{sl}_{2}$} and braid groups},
%  Trends in representation theory of algebras and related topics (2006),
%  137--167.
%
%\bibitem[RT90]{RT1990}
%N.~Reshetikhin and V.~Turaev, \textsl{Ribbon graphs and their invariants derived
%  from quantum groups}, Comm. Math. Phys. \textbf{127} (190), 1--26.
%
%\bibitem[RT91]{RT1991}
%N.~Reshetikhin and V.~Turaev, \textsl{Invariants of 3-manifolds via link polynomials and quantum
%  groups}, Invent. Math. \textbf{103} (1991), 547--597.
%
%\bibitem[SS06]{ss0405089}
%P.~Seidel and I.~Smith, \textsl{A link invariant from the symplectic geometry of
%  nilpotent slices}, Duke Math. J. \textbf{134} (2006), 453--514,
%  \href{http://arxiv.org/abs/math/0405089}{[math.SG/0405089]}.

\bibitem[Qui85]{superquillen}
D.~Quillen, \textsl{Superconnections and the {C}hern character}, Topology \textbf{24}, No. 1 (1985), 89--95. 

\bibitem[RW10]{roberts}
J.~Roberts and S.~Willerton, \textsl{On the {R}ozansky-{W}itten weight systems}, Algebr. Geom. Topol. \textbf{10} (2010), no. 3, 1455--1519.

\bibitem[SW11]{sw0911.0917}
C.~V.~Shepler and S.~Witherspoon, \textsl{Quantum differentiation and chain maps of bimodule complexes}, Algebra and Number Theory \textbf{5}-3 (2011), 339--360, 
\href{http://arxiv.org/abs/0911.0917}{[arXiv:0911.0917]}. 

%\bibitem[Str05]{sCatTLcTCpf}
%C.~Stroppel, \textsl{Categorification of the {T}emperley-{L}ieb category,
%  tangles, and cobordisms via projective functors}, Duke Math. J. \textbf{126}
%  (2005), 547--596.
%
%\bibitem[Sus]{s0701045}
%J.~Sussan, \textsl{Category {$\mathcal O$} and {$\mathfrak{sl}_k$} link
%  invariants}, \href{http://arxiv.org/abs/math/0701045}{[math.QA/0701045]}.
%
%\bibitem[Tur88]{t1988YB}
%V.~Turaev, \textsl{The {Y}ang-{B}axter equation and invariants of links}, Invent.
%  Math. \textbf{92} (1988), 527--553.
%
%\bibitem[Tur10]{turaevbook}
%V.~Turaev, \textsl{Quantum invariants of knots and 3-manifolds}, de Gruyter, 2010,
%  2nd edition.
%
%\bibitem[Weba]{w0610650}
%B.~Webster, \textsl{Khovanov-Rozansky homology via a canopolis formalism},
%  \href{http://arxiv.org/abs/math/0610650}{[math.GT/0610650]}.
%
%\bibitem[Webb]{w1005.4559}
%B.~Webster, \textsl{Knot invariants and higher representation theory {II}: the
%  categorification of quantum knot invariants},
%  \href{http://arxiv.org/abs/1005.4559}{[arXiv:1005.4559]}.
%
%\bibitem[Wit]{w1101.3216}
%E.~Witten, \textsl{Fivebranes and {K}nots},
%  \href{http://arxiv.org/abs/1101.3216}{[arXiv:1101.3216]}.
%
%\bibitem[Wit89]{wittenjones}
%E.~Witten, \textsl{Quantum field theory and the {J}ones polynomial}, Comm. Math.
%  Phys. \textbf{121} (1989), 351--399.
%
%\bibitem[Wit95]{w9207094}
%E.~Witten, \textsl{Chern-{S}imons {G}auge {T}heory {A}s {A} {S}tring {T}heory},
%  Prog. Math. \textbf{133} (1995), 637--678,
%  \href{http://arxiv.org/abs/hep-th/9207094}{[hep-th/9207094]}.
%
%\bibitem[Wu]{w0907.0695}
%H.~Wu, \textsl{A colored {$\mathfrak{sl}(N)$}-homology for links in {$S^3$}},
%  \href{http://arxiv.org/abs/0907.0695}{[arXiv:0907.0695]}.
%
%\bibitem[Wu08]{w0508064}
%H.~Wu, \textsl{Braids, {T}ransversal links and the {K}hovanov-{R}ozansky {T}heory},
%  \href{http://arxiv.org/abs/math/0508064}{[math.GT/0508064]}, Trans. Amer. Math. Soc. \textbf{360}
%  (2008), 3365--3389.
%
%\bibitem[Yon]{y0906.0220}
%Y.~Yonezawa, \textsl{Quantum {$(\mathfrak{sl}_n, \wedge V_n)$} link invariant and
%  matrix factorizations},
%  \href{http://arxiv.org/abs/0906.0220}{[arXiv:0906.0220]}.

\end{thebibliography}

\end{document}
